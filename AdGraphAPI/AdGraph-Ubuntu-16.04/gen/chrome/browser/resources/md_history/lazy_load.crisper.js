// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.ui",function(){function FocusGrid(){this.rows=[]}FocusGrid.prototype={ignoreFocusChange_:false,onFocus:function(row,e){if(this.ignoreFocusChange_)this.ignoreFocusChange_=false;else this.lastFocused_=e.currentTarget;this.rows.forEach(function(r){r.makeActive(r==row)})},onKeydown:function(row,e){var rowIndex=this.rows.indexOf(row);assert(rowIndex>=0);var newRow=-1;if(e.key=="ArrowUp")newRow=rowIndex-1;else if(e.key=="ArrowDown")newRow=rowIndex+1;else if(e.key=="PageUp")newRow=0;else if(e.key=="PageDown")newRow=this.rows.length-1;var rowToFocus=this.rows[newRow];if(rowToFocus){this.ignoreFocusChange_=true;rowToFocus.getEquivalentElement(this.lastFocused_).focus();e.preventDefault();return true}return false},destroy:function(){this.rows.forEach(function(row){row.destroy()});this.rows.length=0},getRowIndexForTarget:function(target){for(var i=0;i<this.rows.length;++i){if(this.rows[i].getElements().indexOf(target)>=0)return i}return-1},getRowForRoot:function(root){for(var i=0;i<this.rows.length;++i){if(this.rows[i].root==root)return this.rows[i]}return null},addRow:function(row){this.addRowBefore(row,null)},addRowBefore:function(row,nextRow){row.delegate=row.delegate||this;var nextRowIndex=nextRow?this.rows.indexOf(nextRow):-1;if(nextRowIndex==-1)this.rows.push(row);else this.rows.splice(nextRowIndex,0,row)},removeRow:function(row){var nextRowIndex=row?this.rows.indexOf(row):-1;if(nextRowIndex>-1)this.rows.splice(nextRowIndex,1)},ensureRowActive:function(preferredRow){if(this.rows.length==0)return;for(var i=0;i<this.rows.length;++i){if(this.rows[i].isActive())return}(this.rows[preferredRow||0]||this.rows[0]).makeActive(true)}};return{FocusGrid:FocusGrid}});Polymer.PaperButtonBehaviorImpl={properties:{elevation:{type:Number,reflectToAttribute:true,readOnly:true}},observers:["_calculateElevation(focused, disabled, active, pressed, receivedFocusFromKeyboard)","_computeKeyboardClass(receivedFocusFromKeyboard)"],hostAttributes:{role:"button",tabindex:"0",animated:true},_calculateElevation:function(){var e=1;if(this.disabled){e=0}else if(this.active||this.pressed){e=4}else if(this.receivedFocusFromKeyboard){e=3}this._setElevation(e)},_computeKeyboardClass:function(receivedFocusFromKeyboard){this.toggleClass("keyboard-focus",receivedFocusFromKeyboard)},_spaceKeyDownHandler:function(event){Polymer.IronButtonStateImpl._spaceKeyDownHandler.call(this,event);if(this.hasRipple()&&this.getRipple().ripples.length<1){this._ripple.uiDownAction()}},_spaceKeyUpHandler:function(event){Polymer.IronButtonStateImpl._spaceKeyUpHandler.call(this,event);if(this.hasRipple()){this._ripple.uiUpAction()}}};Polymer.PaperButtonBehavior=[Polymer.IronButtonState,Polymer.IronControlState,Polymer.PaperRippleBehavior,Polymer.PaperButtonBehaviorImpl];Polymer({is:"paper-button",behaviors:[Polymer.PaperButtonBehavior],properties:{raised:{type:Boolean,reflectToAttribute:true,value:false,observer:"_calculateElevation"}},_calculateElevation:function(){if(!this.raised){this._setElevation(0)}else{Polymer.PaperButtonBehaviorImpl._calculateElevation.apply(this)}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.ui",function(){if(cr.ui.focusWithoutInk)return;var hideInk=false;assert(!cr.isIOS,"pointerdown doesn't work on iOS");document.addEventListener("pointerdown",function(){hideInk=true},true);document.addEventListener("keydown",function(){hideInk=false},true);var focusWithoutInk=function(toFocus){var innerButton=null;if(toFocus.parentElement.tagName=="PAPER-ICON-BUTTON-LIGHT"){innerButton=toFocus;toFocus=toFocus.parentElement}if(!("noink"in toFocus)){toFocus.focus();return}assert(document==toFocus.ownerDocument);var origNoInk;if(hideInk){origNoInk=toFocus.noink;toFocus.noink=true}if(innerButton)innerButton.focus();else toFocus.focus();if(hideInk)toFocus.noink=origNoInk};return{focusWithoutInk:focusWithoutInk}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var ShowAtConfig;var ShowAtPositionConfig;var AnchorAlignment={BEFORE_START:-2,AFTER_START:-1,CENTER:0,BEFORE_END:1,AFTER_END:2};var DROPDOWN_ITEM_CLASS="dropdown-item";(function(){function getStartPointWithAnchor(start,end,menuLength,anchorAlignment,min,max){var startPoint=0;switch(anchorAlignment){case AnchorAlignment.BEFORE_START:startPoint=-menuLength;break;case AnchorAlignment.AFTER_START:startPoint=start;break;case AnchorAlignment.CENTER:startPoint=(start+end-menuLength)/2;break;case AnchorAlignment.BEFORE_END:startPoint=end-menuLength;break;case AnchorAlignment.AFTER_END:startPoint=end;break}if(startPoint+menuLength>max)startPoint=end-menuLength;if(startPoint<min)startPoint=start;startPoint=Math.max(min,Math.min(startPoint,max-menuLength));return startPoint}function getDefaultShowConfig(){var doc=document.scrollingElement;return{top:0,left:0,height:0,width:0,anchorAlignmentX:AnchorAlignment.AFTER_START,anchorAlignmentY:AnchorAlignment.AFTER_START,minX:0,minY:0,maxX:0,maxY:0}}Polymer({is:"cr-action-menu",anchorElement_:null,boundClose_:null,hasMousemoveListener_:false,contentObserver_:null,resizeObserver_:null,lastConfig_:null,properties:{autoReposition:{type:Boolean,value:false},open:{type:Boolean,value:false}},listeners:{keydown:"onKeyDown_",mouseover:"onMouseover_",tap:"onTap_"},detached:function(){this.removeListeners_()},getDialog:function(){return this.$.dialog},removeListeners_:function(){window.removeEventListener("resize",this.boundClose_);window.removeEventListener("popstate",this.boundClose_);if(this.contentObserver_){Polymer.dom(this.$.contentNode).unobserveNodes(this.contentObserver_);this.contentObserver_=null}if(this.resizeObserver_){this.resizeObserver_.disconnect();this.resizeObserver_=null}},onTap_:function(e){if(e.target==this){this.close();e.stopPropagation()}},onKeyDown_:function(e){e.stopPropagation();if(e.key=="Tab"||e.key=="Escape"){this.close();e.preventDefault();return}if(e.key!=="ArrowDown"&&e.key!=="ArrowUp")return;var nextOption=this.getNextOption_(e.key=="ArrowDown"?1:-1);if(nextOption){if(!this.hasMousemoveListener_){this.hasMousemoveListener_=true;listenOnce(this,"mousemove",e=>{this.onMouseover_(e);this.hasMousemoveListener_=false})}nextOption.focus()}e.preventDefault()},onMouseover_:function(e){var i=0;do{var target=e.path[i++];if(target.classList&&target.classList.contains("dropdown-item")&&!target.disabled){target.focus();return}}while(this!=target);this.$.dialog.focus()},getNextOption_:function(step){var counter=0;var nextOption=null;var options=this.querySelectorAll(".dropdown-item");var numOptions=options.length;var focusedIndex=Array.prototype.indexOf.call(options,this.root.activeElement);if(focusedIndex===-1&&step===-1)focusedIndex=0;do{focusedIndex=(numOptions+focusedIndex+step)%numOptions;nextOption=options[focusedIndex];if(nextOption.disabled||nextOption.hidden)nextOption=null;counter++}while(!nextOption&&counter<numOptions);return nextOption},close:function(){this.removeListeners_();this.$.dialog.close();this.open=false;if(this.anchorElement_){cr.ui.focusWithoutInk(assert(this.anchorElement_));this.anchorElement_=null}if(this.lastConfig_){this.lastConfig_=null}},showAt:function(anchorElement,opt_config){this.anchorElement_=anchorElement;this.anchorElement_.scrollIntoViewIfNeeded();var rect=this.anchorElement_.getBoundingClientRect();this.showAtPosition(Object.assign({top:rect.top,left:rect.left,height:rect.height,width:rect.width,anchorAlignmentX:AnchorAlignment.BEFORE_END},opt_config))},showAtPosition:function(config){var doc=document.scrollingElement;var scrollLeft=doc.scrollLeft;var scrollTop=doc.scrollTop;this.resetStyle_();this.$.dialog.showModal();this.open=true;config.top+=scrollTop;config.left+=scrollLeft;this.positionDialog_(Object.assign({minX:scrollLeft,minY:scrollTop,maxX:scrollLeft+doc.clientWidth,maxY:scrollTop+doc.clientHeight},config));doc.scrollTop=scrollTop;doc.scrollLeft=scrollLeft;this.addListeners_()},resetStyle_:function(){this.$.dialog.style.left="";this.$.dialog.style.right="";this.$.dialog.style.top="0"},positionDialog_:function(config){this.lastConfig_=config;var c=Object.assign(getDefaultShowConfig(),config);var top=c.top;var left=c.left;var bottom=top+c.height;var right=left+c.width;var rtl=getComputedStyle(this).direction=="rtl";if(rtl)c.anchorAlignmentX*=-1;const offsetWidth=this.$.dialog.offsetWidth;var menuLeft=getStartPointWithAnchor(left,right,offsetWidth,c.anchorAlignmentX,c.minX,c.maxX);if(rtl){var menuRight=document.scrollingElement.clientWidth-menuLeft-offsetWidth;this.$.dialog.style.right=menuRight+"px"}else{this.$.dialog.style.left=menuLeft+"px"}var menuTop=getStartPointWithAnchor(top,bottom,this.$.dialog.offsetHeight,c.anchorAlignmentY,c.minY,c.maxY);this.$.dialog.style.top=menuTop+"px"},addListeners_:function(){this.boundClose_=this.boundClose_||function(){if(this.$.dialog.open)this.close()}.bind(this);window.addEventListener("resize",this.boundClose_);window.addEventListener("popstate",this.boundClose_);this.contentObserver_=Polymer.dom(this.$.contentNode).observeNodes(info=>{info.addedNodes.forEach(node=>{if(node.classList&&node.classList.contains(DROPDOWN_ITEM_CLASS)&&!node.getAttribute("role")){node.setAttribute("role","menuitem")}})});if(this.autoReposition){this.resizeObserver_=new ResizeObserver(()=>{if(this.lastConfig_){this.positionDialog_(this.lastConfig_);this.fire("cr-action-menu-repositioned")}});this.resizeObserver_.observe(this.$.dialog)}}})})();Polymer({is:"iron-collapse",behaviors:[Polymer.IronResizableBehavior],properties:{horizontal:{type:Boolean,value:false,observer:"_horizontalChanged"},opened:{type:Boolean,value:false,notify:true,observer:"_openedChanged"},transitioning:{type:Boolean,notify:true,readOnly:true},noAnimation:{type:Boolean},_desiredSize:{type:String,value:""}},get dimension(){return this.horizontal?"width":"height"},get _dimensionMax(){return this.horizontal?"maxWidth":"maxHeight"},get _dimensionMaxCss(){return this.horizontal?"max-width":"max-height"},hostAttributes:{role:"group","aria-hidden":"true"},listeners:{transitionend:"_onTransitionEnd"},toggle:function(){this.opened=!this.opened},show:function(){this.opened=true},hide:function(){this.opened=false},updateSize:function(size,animated){size=size==="auto"?"":size;var willAnimate=animated&&!this.noAnimation&&this.isAttached&&this._desiredSize!==size;this._desiredSize=size;this._updateTransition(false);if(willAnimate){var startSize=this._calcSize();if(size===""){this.style[this._dimensionMax]="";size=this._calcSize()}this.style[this._dimensionMax]=startSize;this.scrollTop=this.scrollTop;this._updateTransition(true);willAnimate=size!==startSize}this.style[this._dimensionMax]=size;if(!willAnimate){this._transitionEnd()}},enableTransition:function(enabled){Polymer.Base._warn("`enableTransition()` is deprecated, use `noAnimation` instead.");this.noAnimation=!enabled},_updateTransition:function(enabled){this.style.transitionDuration=enabled&&!this.noAnimation?"":"0s"},_horizontalChanged:function(){this.style.transitionProperty=this._dimensionMaxCss;var otherDimension=this._dimensionMax==="maxWidth"?"maxHeight":"maxWidth";this.style[otherDimension]="";this.updateSize(this.opened?"auto":"0px",false)},_openedChanged:function(){this.setAttribute("aria-hidden",!this.opened);this._setTransitioning(true);this.toggleClass("iron-collapse-closed",false);this.toggleClass("iron-collapse-opened",false);this.updateSize(this.opened?"auto":"0px",true);if(this.opened){this.focus()}},_transitionEnd:function(){this.style[this._dimensionMax]=this._desiredSize;this.toggleClass("iron-collapse-closed",!this.opened);this.toggleClass("iron-collapse-opened",this.opened);this._updateTransition(false);this.notifyResize();this._setTransitioning(false)},_onTransitionEnd:function(event){if(Polymer.dom(event).rootTarget===this){this._transitionEnd()}},_calcSize:function(){return this.getBoundingClientRect()[this.dimension]+"px"}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"history-synced-device-card",properties:{tabs:{type:Array,value:function(){return[]},observer:"updateIcons_"},device:String,lastUpdateTime:String,opened:Boolean,searchTerm:String,separatorIndexes:Array,sessionTag:String},listeners:{"dom-change":"notifyFocusUpdate_"},createFocusRows:function(){const titleRow=new cr.ui.FocusRow(this.$["card-heading"],null);titleRow.addItem("menu","#menu-button");titleRow.addItem("collapse","#collapse-button");const rows=[titleRow];if(this.opened){Polymer.dom(this.root).querySelectorAll(".item-container").forEach(function(el){const row=new cr.ui.FocusRow(el,null);row.addItem("title",".website-title");rows.push(row)})}return rows},openTab_:function(e){const tab=e.model.tab;const browserService=md_history.BrowserService.getInstance();browserService.recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,SyncedTabsHistogram.LINK_CLICKED,SyncedTabsHistogram.LIMIT);browserService.openForeignSessionTab(this.sessionTag,tab.windowId,tab.sessionId,e);e.preventDefault()},toggleTabCard:function(){const histogramValue=this.$.collapse.opened?SyncedTabsHistogram.COLLAPSE_SESSION:SyncedTabsHistogram.EXPAND_SESSION;md_history.BrowserService.getInstance().recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,histogramValue,SyncedTabsHistogram.LIMIT);this.$.collapse.toggle();this.$["dropdown-indicator"].icon=this.$.collapse.opened?"cr:expand-less":"cr:expand-more";this.fire("update-focus-grid")},notifyFocusUpdate_:function(){this.fire("update-focus-grid")},updateIcons_:function(){this.async(function(){const icons=Polymer.dom(this.root).querySelectorAll(".website-icon");for(let i=0;i<this.tabs.length;i++){icons[i].style.backgroundImage=cr.icon.getFavicon(this.tabs[i].url)}})},isWindowSeparatorIndex_:function(index,separatorIndexes){return this.separatorIndexes.indexOf(index)!=-1},getCollapseIcon_:function(opened){return opened?"cr:expand-less":"cr:expand-more"},getCollapseTitle_:function(opened){return opened?loadTimeData.getString("collapseSessionButton"):loadTimeData.getString("expandSessionButton")},onMenuButtonTap_:function(e){this.fire("open-menu",{target:Polymer.dom(e).localTarget,tag:this.sessionTag});e.stopPropagation()},onLinkRightClick_:function(){md_history.BrowserService.getInstance().recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,SyncedTabsHistogram.LINK_RIGHT_CLICKED,SyncedTabsHistogram.LIMIT)}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
let ForeignDeviceInternal;Polymer({is:"history-synced-device-manager",properties:{sessionList:{type:Array,observer:"updateSyncedDevices"},searchTerm:{type:String,observer:"searchTermChanged"},syncedDevices_:{type:Array,value:function(){return[]}},signInState:{type:Boolean,observer:"signInStateChanged_"},guestSession_:{type:Boolean,value:loadTimeData.getBoolean("isGuestSession")},fetchingSyncedTabs_:{type:Boolean,value:false},hasSeenForeignData_:Boolean,actionMenuModel_:String},listeners:{"open-menu":"onOpenMenu_","update-focus-grid":"updateFocusGrid_"},focusGrid_:null,attached:function(){this.focusGrid_=new cr.ui.FocusGrid;chrome.send("otherDevicesInitialized");md_history.BrowserService.getInstance().recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,SyncedTabsHistogram.INITIALIZED,SyncedTabsHistogram.LIMIT)},detached:function(){this.focusGrid_.destroy()},getContentScrollTarget:function(){return this},createInternalDevice_:function(session){let tabs=[];const separatorIndexes=[];for(let i=0;i<session.windows.length;i++){const windowId=session.windows[i].sessionId;const newTabs=session.windows[i].tabs;if(newTabs.length==0)continue;newTabs.forEach(function(tab){tab.windowId=windowId});let windowAdded=false;if(!this.searchTerm){tabs=tabs.concat(newTabs);windowAdded=true}else{const searchText=this.searchTerm.toLowerCase();for(let j=0;j<newTabs.length;j++){const tab=newTabs[j];if(tab.title.toLowerCase().indexOf(searchText)!=-1){tabs.push(tab);windowAdded=true}}}if(windowAdded&&i!=session.windows.length-1)separatorIndexes.push(tabs.length-1)}return{device:session.name,lastUpdateTime:"– "+session.modifiedTime,opened:true,separatorIndexes:separatorIndexes,timestamp:session.timestamp,tabs:tabs,tag:session.tag}},onSignInTap_:function(){chrome.send("startSignInFlow")},onOpenMenu_:function(e){const menu=this.$.menu.get();this.actionMenuModel_=e.detail.tag;menu.showAt(e.detail.target);md_history.BrowserService.getInstance().recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,SyncedTabsHistogram.SHOW_SESSION_MENU,SyncedTabsHistogram.LIMIT)},onOpenAllTap_:function(){const menu=assert(this.$.menu.getIfExists());const browserService=md_history.BrowserService.getInstance();browserService.recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,SyncedTabsHistogram.OPEN_ALL,SyncedTabsHistogram.LIMIT);browserService.openForeignSessionAllTabs(assert(this.actionMenuModel_));this.actionMenuModel_=null;menu.close()},updateFocusGrid_:function(){if(!this.focusGrid_)return;this.focusGrid_.destroy();this.debounce("updateFocusGrid",function(){Polymer.dom(this.root).querySelectorAll("history-synced-device-card").reduce(function(prev,cur){return prev.concat(cur.createFocusRows())},[]).forEach(row=>{this.focusGrid_.addRow(row)});this.focusGrid_.ensureRowActive(1)})},onDeleteSessionTap_:function(){const menu=assert(this.$.menu.getIfExists());const browserService=md_history.BrowserService.getInstance();browserService.recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,SyncedTabsHistogram.HIDE_FOR_NOW,SyncedTabsHistogram.LIMIT);browserService.deleteForeignSession(assert(this.actionMenuModel_));this.actionMenuModel_=null;menu.close()},clearDisplayedSyncedDevices_:function(){this.syncedDevices_=[]},showNoSyncedMessage:function(signInState,syncedDevicesLength,guestSession){if(guestSession)return true;return signInState&&syncedDevicesLength==0},showSignInGuide:function(signInState,guestSession){const show=!signInState&&!guestSession;if(show){md_history.BrowserService.getInstance().recordAction("Signin_Impression_FromRecentTabs")}return show},noSyncedTabsMessage:function(){let stringName=this.fetchingSyncedTabs_?"loading":"noSyncedResults";if(this.searchTerm!=="")stringName="noSearchResults";return loadTimeData.getString(stringName)},updateSyncedDevices:function(sessionList){this.fetchingSyncedTabs_=false;if(!sessionList)return;if(sessionList.length>0&&!this.hasSeenForeignData_){this.hasSeenForeignData_=true;md_history.BrowserService.getInstance().recordHistogram(SYNCED_TABS_HISTOGRAM_NAME,SyncedTabsHistogram.HAS_FOREIGN_DATA,SyncedTabsHistogram.LIMIT)}const devices=[];sessionList.forEach(session=>{const device=this.createInternalDevice_(session);if(device.tabs.length!=0)devices.push(device)});this.syncedDevices_=devices},signInStateChanged_:function(){this.fire("history-view-changed");if(!this.signInState){this.clearDisplayedSyncedDevices_();return}this.fetchingSyncedTabs_=true},searchTermChanged:function(searchTerm){this.clearDisplayedSyncedDevices_();this.updateSyncedDevices(this.sessionList)}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-checkbox",behaviors:[Polymer.PaperRippleBehavior],properties:{checked:{type:Boolean,value:false,reflectToAttribute:true,observer:"checkedChanged_",notify:true},disabled:{type:Boolean,value:false,reflectToAttribute:true,observer:"disabledChanged_"}},hostAttributes:{"aria-disabled":"false","aria-checked":"false",role:"checkbox",tabindex:0},listeners:{click:"onClick_",keypress:"onKeyPress_",focus:"onFocus_",blur:"onBlur_"},ready:function(){this.removeAttribute("unresolved")},checkedChanged_:function(){this.setAttribute("aria-checked",this.checked?"true":"false")},disabledChanged_:function(current,previous){if(previous===undefined&&!this.disabled)return;this.setAttribute("tabindex",this.disabled?-1:0);this.setAttribute("aria-disabled",this.disabled?"true":"false")},onFocus_:function(){this.ensureRipple();this.$$("paper-ripple").holdDown=true},onBlur_:function(){this.ensureRipple();this.$$("paper-ripple").holdDown=false},shouldHandleEvent_:function(e){return!this.disabled&&e.target.tagName!="A"},onClick_:function(e){if(!this.shouldHandleEvent_(e))return;e.stopPropagation();e.preventDefault();this.toggleState_(false)},toggleState_:function(fromKeyboard){this.checked=!this.checked;if(!fromKeyboard){this.ensureRipple();this.$$("paper-ripple").holdDown=false}this.fire("change",this.checked)},onKeyPress_:function(e){if(!this.shouldHandleEvent_(e)||e.key!=" "&&e.key!="Enter")return;e.preventDefault();this.toggleState_(true)},onButtonFocus_:function(){this.focus()},_createRipple:function(){this._rippleContainer=this.$.checkbox;let ripple=Polymer.PaperRippleBehavior._createRipple();ripple.id="ink";ripple.setAttribute("recenters","");ripple.classList.add("circle","toggle-ink");return ripple}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-dialog",properties:{open:{type:Boolean,value:false,reflectToAttribute:true},closeText:String,ignorePopstate:{type:Boolean,value:false},ignoreEnterKey:{type:Boolean,value:false},noCancel:{type:Boolean,value:false},showCloseButton:{type:Boolean,value:false}},listeners:{pointerdown:"onPointerdown_"},intersectionObserver_:null,mutationObserver_:null,ready:function(){window.addEventListener("popstate",function(){if(!this.ignorePopstate&&this.$.dialog.open)this.cancel()}.bind(this));if(!this.ignoreEnterKey)this.addEventListener("keypress",this.onKeypress_.bind(this));if(this.noCancel)this.addEventListener("cancel",this.onCancel_.bind(this))},attached:function(){var mutationObserverCallback=function(){if(this.$.dialog.open)this.addIntersectionObserver_();else this.removeIntersectionObserver_()}.bind(this);this.mutationObserver_=new MutationObserver(mutationObserverCallback);this.mutationObserver_.observe(this.$.dialog,{attributes:true,attributeFilter:["open"]});mutationObserverCallback()},detached:function(){this.removeIntersectionObserver_();if(this.mutationObserver_){this.mutationObserver_.disconnect();this.mutationObserver_=null}},addIntersectionObserver_:function(){if(this.intersectionObserver_)return;var bodyContainer=this.$$(".body-container");var bottomMarker=this.$.bodyBottomMarker;var topMarker=this.$.bodyTopMarker;var callback=function(entries){for(var i=0;i<entries.length;i++){var target=entries[i].target;assert(target==bottomMarker||target==topMarker);var classToToggle=target==bottomMarker?"bottom-scrollable":"top-scrollable";bodyContainer.classList.toggle(classToToggle,entries[i].intersectionRatio==0)}};this.intersectionObserver_=new IntersectionObserver(callback,{root:bodyContainer,threshold:0});this.intersectionObserver_.observe(bottomMarker);this.intersectionObserver_.observe(topMarker)},removeIntersectionObserver_:function(){if(this.intersectionObserver_){this.intersectionObserver_.disconnect();this.intersectionObserver_=null}},showModal:function(){this.$.dialog.showModal();this.open=this.$.dialog.open},cancel:function(){this.fire("cancel");this.$.dialog.close();this.open=this.$.dialog.open},close:function(){this.$.dialog.close("success");this.open=this.$.dialog.open},onCloseKeypress_:function(e){e.stopPropagation()},getNative:function(){return this.$.dialog},getCloseButton:function(){return this.$.close},onKeypress_:function(e){if(e.key!="Enter")return;if(e.target!=this&&e.target.tagName!="PAPER-INPUT")return;var actionButton=this.querySelector(".action-button:not([disabled]):not([hidden])");if(actionButton){actionButton.click();e.preventDefault()}},onCancel_:function(e){if(this.noCancel)e.preventDefault()},onPointerdown_:function(e){if(e.button!=0||e.composedPath()[0].tagName!=="DIALOG")return;this.$.dialog.animate([{transform:"scale(1)",offset:0},{transform:"scale(1.02)",offset:.4},{transform:"scale(1.02)",offset:.6},{transform:"scale(1)",offset:1}],{duration:180,easing:"ease-in-out",iterations:1});e.preventDefault()}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-drawer",properties:{heading:String,open:{type:Boolean,notify:true},align:{type:String,value:"ltr",reflectToAttribute:true}},listeners:{transitionend:"onDialogTransitionEnd_"},toggle:function(){if(this.$.dialog.open)this.closeDrawer();else this.openDrawer()},openDrawer:function(){if(!this.$.dialog.open){this.$.dialog.showModal();this.open=true;this.classList.add("opening")}},closeDrawer:function(){if(this.$.dialog.open){this.classList.remove("opening");this.classList.add("closing")}},onContainerTap_:function(event){event.stopPropagation()},onDialogTap_:function(){this.closeDrawer()},onDialogCancel_:function(event){event.preventDefault();this.closeDrawer()},onDialogTransitionEnd_:function(){if(this.classList.contains("closing")){this.classList.remove("closing");this.$.dialog.close();this.open=false}else if(this.classList.contains("opening")){this.fire("cr-drawer-opened")}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-toolbar-selection-overlay",properties:{deleteLabel:String,cancelLabel:String,selectionLabel:String,deleteDisabled:Boolean},get deleteButton(){return this.$.delete},onClearSelectionTap_:function(){this.fire("clear-selected-items")},onDeleteTap_:function(){this.fire("delete-selected-items")}});