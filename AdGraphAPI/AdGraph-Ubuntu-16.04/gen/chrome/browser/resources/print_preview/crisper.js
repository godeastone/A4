// Copyright (c) 2011 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var EventTrackerEntry;function EventTracker(){this.listeners_=[]}EventTracker.prototype={add:function(target,eventType,listener,opt_capture){var capture=!!opt_capture;var h={target:target,eventType:eventType,listener:listener,capture:capture};this.listeners_.push(h);target.addEventListener(eventType,listener,capture)},remove:function(target,eventType){this.listeners_=this.listeners_.filter(function(h){if(h.target==target&&(!eventType||h.eventType==eventType)){EventTracker.removeEventListener_(h);return false}return true})},removeAll:function(){this.listeners_.forEach(EventTracker.removeEventListener_);this.listeners_=[]}};EventTracker.removeEventListener_=function(h){h.target.removeEventListener(h.eventType,h.listener,h.capture)};
// Copyright (c) 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function assert(condition,opt_message){if(!condition){var message="Assertion failed";if(opt_message)message=message+": "+opt_message;var error=new Error(message);var global=function(){return this}();if(global.traceAssertionsForTesting)console.warn(error.stack);throw error}return condition}function assertNotReached(opt_message){assert(false,opt_message||"Unreachable code hit")}function assertInstanceof(value,type,opt_message){if(!(value instanceof type)){assertNotReached(opt_message||"Value "+value+" is not a[n] "+(type.name||typeof type))}return value}
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function $(id){var el=document.getElementById(id);return el?assertInstanceof(el,HTMLElement):null}function getSVGElement(id){var el=document.getElementById(id);return el?assertInstanceof(el,Element):null}function announceAccessibleMessage(msg){var element=document.createElement("div");element.setAttribute("aria-live","polite");element.style.position="fixed";element.style.left="-9999px";element.style.height="0px";element.innerText=msg;document.body.appendChild(element);window.setTimeout(function(){document.body.removeChild(element)},0)}function getUrlForCss(s){var s2=s.replace(/(\(|\)|\,|\s|\'|\"|\\)/g,"\\$1");if(/\\\\$/.test(s2)){s2+=" "}return'url("'+s2+'")'}function parseQueryParams(location){var params={};var query=unescape(location.search.substring(1));var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");params[pair[0]]=pair[1]}return params}function setQueryParam(location,key,value){var query=parseQueryParams(location);query[encodeURIComponent(key)]=encodeURIComponent(value);var newQuery="";for(var q in query){newQuery+=(newQuery?"&":"?")+q+"="+query[q]}return location.origin+location.pathname+newQuery+location.hash}function findAncestorByClass(el,className){return findAncestor(el,function(el){return el.classList&&el.classList.contains(className)})}function findAncestor(node,predicate){var last=false;while(node!=null&&!(last=predicate(node))){node=node.parentNode}return last?node:null}function swapDomNodes(a,b){var afterA=a.nextSibling;if(afterA==b){swapDomNodes(b,a);return}var aParent=a.parentNode;b.parentNode.replaceChild(a,b);aParent.insertBefore(b,afterA)}function disableTextSelectAndDrag(opt_allowSelectStart,opt_allowDragStart){document.onselectstart=function(e){if(!(opt_allowSelectStart&&opt_allowSelectStart.call(this,e)))e.preventDefault()};document.ondragstart=function(e){if(!(opt_allowDragStart&&opt_allowDragStart.call(this,e)))e.preventDefault()}}function isRTL(){return document.documentElement.dir=="rtl"}function getRequiredElement(id){return assertInstanceof($(id),HTMLElement,"Missing required element: "+id)}function queryRequiredElement(selectors,opt_context){var element=(opt_context||document).querySelector(selectors);return assertInstanceof(element,HTMLElement,"Missing required element: "+selectors)}["click","auxclick"].forEach(function(eventName){document.addEventListener(eventName,function(e){if(e.button>1)return;if(e.defaultPrevented)return;var eventPath=e.path;var anchor=null;if(eventPath){for(var i=0;i<eventPath.length;i++){var element=eventPath[i];if(element.tagName==="A"&&element.href){anchor=element;break}}}var el=e.target;if(!anchor&&el.nodeType==Node.ELEMENT_NODE&&el.webkitMatchesSelector("A, A *")){while(el.tagName!="A"){el=el.parentElement}anchor=el}if(!anchor)return;anchor=anchor;if((anchor.protocol=="file:"||anchor.protocol=="about:")&&(e.button==0||e.button==1)){chrome.send("navigateToUrl",[anchor.href,anchor.target,e.button,e.altKey,e.ctrlKey,e.metaKey,e.shiftKey]);e.preventDefault()}})});function appendParam(url,key,value){var param=encodeURIComponent(key)+"="+encodeURIComponent(value);if(url.indexOf("?")==-1)return url+"?"+param;return url+"&"+param}function createElementWithClassName(type,className){var elm=document.createElement(type);elm.className=className;return elm}function ensureTransitionEndEvent(el,opt_timeOut){if(opt_timeOut===undefined){var style=getComputedStyle(el);opt_timeOut=parseFloat(style.transitionDuration)*1e3;opt_timeOut+=50}var fired=false;el.addEventListener("transitionend",function f(e){el.removeEventListener("transitionend",f);fired=true});window.setTimeout(function(){if(!fired)cr.dispatchSimpleEvent(el,"transitionend",true)},opt_timeOut)}function scrollTopForDocument(doc){return doc.documentElement.scrollTop||doc.body.scrollTop}function setScrollTopForDocument(doc,value){doc.documentElement.scrollTop=doc.body.scrollTop=value}function scrollLeftForDocument(doc){return doc.documentElement.scrollLeft||doc.body.scrollLeft}function setScrollLeftForDocument(doc,value){doc.documentElement.scrollLeft=doc.body.scrollLeft=value}function HTMLEscape(original){return original.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function elide(original,maxLength){if(original.length<=maxLength)return original;return original.substring(0,maxLength-1)+"…"}function quoteString(str){return str.replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}function listenOnce(target,eventNames,callback){if(!Array.isArray(eventNames))eventNames=eventNames.split(/ +/);var removeAllAndCallCallback=function(event){eventNames.forEach(function(eventName){target.removeEventListener(eventName,removeAllAndCallCallback,false)});return callback(event)};eventNames.forEach(function(eventName){target.addEventListener(eventName,removeAllAndCallCallback,false)})}
// <if expr="is_ios">
if(!("key"in KeyboardEvent.prototype)){Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){if(this.keyCode>=48&&this.keyCode<=57)return String.fromCharCode(this.keyCode);if(this.keyCode>=65&&this.keyCode<=90){var result=String.fromCharCode(this.keyCode).toLowerCase();if(this.shiftKey)result=result.toUpperCase();return result}switch(this.keyCode){case 8:return"Backspace";case 9:return"Tab";case 13:return"Enter";case 16:return"Shift";case 17:return"Control";case 18:return"Alt";case 27:return"Escape";case 32:return" ";case 33:return"PageUp";case 34:return"PageDown";case 35:return"End";case 36:return"Home";case 37:return"ArrowLeft";case 38:return"ArrowUp";case 39:return"ArrowRight";case 40:return"ArrowDown";case 45:return"Insert";case 46:return"Delete";case 91:return"Meta";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 187:return"=";case 189:return"-";case 219:return"[";case 221:return"]"}return"Unidentified"}})}else{window.console.log("KeyboardEvent.Key polyfill not required")}
// </if>  /* is_ios */
function hasKeyModifiers(e){return!!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)}
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function WebUIListenerTracker(){this.listeners_=[]}WebUIListenerTracker.prototype={add:function(eventName,callback){this.listeners_.push(cr.addWebUIListener(eventName,callback))},removeAll:function(){while(this.listeners_.length>0){cr.removeWebUIListener(this.listeners_.pop())}}};Polymer.IronResizableBehavior={properties:{_parentResizable:{type:Object,observer:"_parentResizableChanged"},_notifyingDescendant:{type:Boolean,value:false}},listeners:{"iron-request-resize-notifications":"_onIronRequestResizeNotifications"},created:function(){this._interestedResizables=[];this._boundNotifyResize=this.notifyResize.bind(this)},attached:function(){this._requestResizeNotifications()},detached:function(){if(this._parentResizable){this._parentResizable.stopResizeNotificationsFor(this)}else{window.removeEventListener("resize",this._boundNotifyResize)}this._parentResizable=null},notifyResize:function(){if(!this.isAttached){return}this._interestedResizables.forEach(function(resizable){if(this.resizerShouldNotify(resizable)){this._notifyDescendant(resizable)}},this);this._fireResize()},assignParentResizable:function(parentResizable){this._parentResizable=parentResizable},stopResizeNotificationsFor:function(target){var index=this._interestedResizables.indexOf(target);if(index>-1){this._interestedResizables.splice(index,1);this.unlisten(target,"iron-resize","_onDescendantIronResize")}},resizerShouldNotify:function(element){return true},_onDescendantIronResize:function(event){if(this._notifyingDescendant){event.stopPropagation();return}if(!Polymer.Settings.useShadow){this._fireResize()}},_fireResize:function(){this.fire("iron-resize",null,{node:this,bubbles:false})},_onIronRequestResizeNotifications:function(event){var target=Polymer.dom(event).rootTarget;if(target===this){return}if(this._interestedResizables.indexOf(target)===-1){this._interestedResizables.push(target);this.listen(target,"iron-resize","_onDescendantIronResize")}target.assignParentResizable(this);this._notifyDescendant(target);event.stopPropagation()},_parentResizableChanged:function(parentResizable){if(parentResizable){window.removeEventListener("resize",this._boundNotifyResize)}},_notifyDescendant:function(descendant){if(!this.isAttached){return}this._notifyingDescendant=true;descendant.notifyResize();this._notifyingDescendant=false},_requestResizeNotifications:function(){if(!this.isAttached)return;if(document.readyState==="loading"){var _requestResizeNotifications=this._requestResizeNotifications.bind(this);document.addEventListener("readystatechange",function readystatechanged(){document.removeEventListener("readystatechange",readystatechanged);_requestResizeNotifications()})}else{this.fire("iron-request-resize-notifications",null,{node:this,bubbles:true,cancelable:true});if(!this._parentResizable){window.addEventListener("resize",this._boundNotifyResize);this.notifyResize()}}}};Polymer({is:"iron-collapse",behaviors:[Polymer.IronResizableBehavior],properties:{horizontal:{type:Boolean,value:false,observer:"_horizontalChanged"},opened:{type:Boolean,value:false,notify:true,observer:"_openedChanged"},transitioning:{type:Boolean,notify:true,readOnly:true},noAnimation:{type:Boolean},_desiredSize:{type:String,value:""}},get dimension(){return this.horizontal?"width":"height"},get _dimensionMax(){return this.horizontal?"maxWidth":"maxHeight"},get _dimensionMaxCss(){return this.horizontal?"max-width":"max-height"},hostAttributes:{role:"group","aria-hidden":"true"},listeners:{transitionend:"_onTransitionEnd"},toggle:function(){this.opened=!this.opened},show:function(){this.opened=true},hide:function(){this.opened=false},updateSize:function(size,animated){size=size==="auto"?"":size;var willAnimate=animated&&!this.noAnimation&&this.isAttached&&this._desiredSize!==size;this._desiredSize=size;this._updateTransition(false);if(willAnimate){var startSize=this._calcSize();if(size===""){this.style[this._dimensionMax]="";size=this._calcSize()}this.style[this._dimensionMax]=startSize;this.scrollTop=this.scrollTop;this._updateTransition(true);willAnimate=size!==startSize}this.style[this._dimensionMax]=size;if(!willAnimate){this._transitionEnd()}},enableTransition:function(enabled){Polymer.Base._warn("`enableTransition()` is deprecated, use `noAnimation` instead.");this.noAnimation=!enabled},_updateTransition:function(enabled){this.style.transitionDuration=enabled&&!this.noAnimation?"":"0s"},_horizontalChanged:function(){this.style.transitionProperty=this._dimensionMaxCss;var otherDimension=this._dimensionMax==="maxWidth"?"maxHeight":"maxWidth";this.style[otherDimension]="";this.updateSize(this.opened?"auto":"0px",false)},_openedChanged:function(){this.setAttribute("aria-hidden",!this.opened);this._setTransitioning(true);this.toggleClass("iron-collapse-closed",false);this.toggleClass("iron-collapse-opened",false);this.updateSize(this.opened?"auto":"0px",true);if(this.opened){this.focus()}},_transitionEnd:function(){this.style[this._dimensionMax]=this._desiredSize;this.toggleClass("iron-collapse-closed",!this.opened);this.toggleClass("iron-collapse-opened",this.opened);this._updateTransition(false);this.notifyResize();this._setTransitioning(false)},_onTransitionEnd:function(event){if(Polymer.dom(event).rootTarget===this){this._transitionEnd()}},_calcSize:function(){return this.getBoundingClientRect()[this.dimension]+"px"}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function PromiseResolver(){this.resolve_;this.reject_;this.promise_=new Promise(function(resolve,reject){this.resolve_=resolve;this.reject_=reject}.bind(this))}PromiseResolver.prototype={get promise(){return this.promise_},set promise(p){assertNotReached()},get resolve(){return this.resolve_},set resolve(r){assertNotReached()},get reject(){return this.reject_},set reject(s){assertNotReached()}};
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var global=this;var WebUIListener;var cr=cr||function(){"use strict";function exportPath(name,opt_object,opt_objectToExportTo){var parts=name.split(".");var cur=opt_objectToExportTo||global;for(var part;parts.length&&(part=parts.shift());){if(!parts.length&&opt_object!==undefined){cur[part]=opt_object}else if(part in cur){cur=cur[part]}else{cur=cur[part]={}}}return cur}function dispatchPropertyChange(target,propertyName,newValue,oldValue){var e=new Event(propertyName+"Change");e.propertyName=propertyName;e.newValue=newValue;e.oldValue=oldValue;target.dispatchEvent(e)}function getAttributeName(jsName){return jsName.replace(/([A-Z])/g,"-$1").toLowerCase()}var PropertyKind={JS:"js",ATTR:"attr",BOOL_ATTR:"boolAttr"};function getGetter(name,kind){switch(kind){case PropertyKind.JS:var privateName=name+"_";return function(){return this[privateName]};case PropertyKind.ATTR:var attributeName=getAttributeName(name);return function(){return this.getAttribute(attributeName)};case PropertyKind.BOOL_ATTR:var attributeName=getAttributeName(name);return function(){return this.hasAttribute(attributeName)}}throw"not reached"}function getSetter(name,kind,opt_setHook){switch(kind){case PropertyKind.JS:var privateName=name+"_";return function(value){var oldValue=this[name];if(value!==oldValue){this[privateName]=value;if(opt_setHook)opt_setHook.call(this,value,oldValue);dispatchPropertyChange(this,name,value,oldValue)}};case PropertyKind.ATTR:var attributeName=getAttributeName(name);return function(value){var oldValue=this[name];if(value!==oldValue){if(value==undefined)this.removeAttribute(attributeName);else this.setAttribute(attributeName,value);if(opt_setHook)opt_setHook.call(this,value,oldValue);dispatchPropertyChange(this,name,value,oldValue)}};case PropertyKind.BOOL_ATTR:var attributeName=getAttributeName(name);return function(value){var oldValue=this[name];if(value!==oldValue){if(value)this.setAttribute(attributeName,name);else this.removeAttribute(attributeName);if(opt_setHook)opt_setHook.call(this,value,oldValue);dispatchPropertyChange(this,name,value,oldValue)}}}throw"not reached"}function defineProperty(obj,name,opt_kind,opt_setHook){if(typeof obj=="function")obj=obj.prototype;var kind=opt_kind||PropertyKind.JS;if(!obj.__lookupGetter__(name))obj.__defineGetter__(name,getGetter(name,kind));if(!obj.__lookupSetter__(name))obj.__defineSetter__(name,getSetter(name,kind,opt_setHook))}var uidCounter=1;function createUid(){return uidCounter++}function getUid(item){if(item.hasOwnProperty("uid"))return item.uid;return item.uid=createUid()}function dispatchSimpleEvent(target,type,opt_bubbles,opt_cancelable){var e=new Event(type,{bubbles:opt_bubbles,cancelable:opt_cancelable===undefined||opt_cancelable});return target.dispatchEvent(e)}function define(name,fun){var obj=exportPath(name);var exports=fun();for(var propertyName in exports){var propertyDescriptor=Object.getOwnPropertyDescriptor(exports,propertyName);if(propertyDescriptor)Object.defineProperty(obj,propertyName,propertyDescriptor)}}function addSingletonGetter(ctor){ctor.getInstance=function(){return ctor.instance_||(ctor.instance_=new ctor)}}function makePublic(ctor,methods,opt_target){methods.forEach(function(method){ctor[method]=function(){var target=opt_target?document.getElementById(opt_target):ctor.getInstance();return target[method+"_"].apply(target,arguments)}})}var chromeSendResolverMap={};function webUIResponse(id,isSuccess,response){var resolver=chromeSendResolverMap[id];delete chromeSendResolverMap[id];if(isSuccess)resolver.resolve(response);else resolver.reject(response)}function sendWithPromise(methodName,var_args){var args=Array.prototype.slice.call(arguments,1);var promiseResolver=new PromiseResolver;var id=methodName+"_"+createUid();chromeSendResolverMap[id]=promiseResolver;chrome.send(methodName,[id].concat(args));return promiseResolver.promise}var webUIListenerMap={};function webUIListenerCallback(event,var_args){var eventListenersMap=webUIListenerMap[event];if(!eventListenersMap){return}var args=Array.prototype.slice.call(arguments,1);for(var listenerId in eventListenersMap){eventListenersMap[listenerId].apply(null,args)}}function addWebUIListener(eventName,callback){webUIListenerMap[eventName]=webUIListenerMap[eventName]||{};var uid=createUid();webUIListenerMap[eventName][uid]=callback;return{eventName:eventName,uid:uid}}function removeWebUIListener(listener){var listenerExists=webUIListenerMap[listener.eventName]&&webUIListenerMap[listener.eventName][listener.uid];if(listenerExists){delete webUIListenerMap[listener.eventName][listener.uid];return true}return false}return{addSingletonGetter:addSingletonGetter,createUid:createUid,define:define,defineProperty:defineProperty,dispatchPropertyChange:dispatchPropertyChange,dispatchSimpleEvent:dispatchSimpleEvent,exportPath:exportPath,getUid:getUid,makePublic:makePublic,PropertyKind:PropertyKind,addWebUIListener:addWebUIListener,removeWebUIListener:removeWebUIListener,sendWithPromise:sendWithPromise,webUIListenerCallback:webUIListenerCallback,webUIResponse:webUIResponse,get doc(){return document},get isMac(){return/Mac/.test(navigator.platform)},get isWindows(){return/Win/.test(navigator.platform)},get isChromeOS(){return/CrOS/.test(navigator.userAgent)},get isLinux(){return/Linux/.test(navigator.userAgent)},get isAndroid(){return/Android/.test(navigator.userAgent)},get isIOS(){return/iPad|iPhone|iPod/.test(navigator.platform)}}}();
// Copyright (c) 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function assert(condition,opt_message){if(!condition){var message="Assertion failed";if(opt_message)message=message+": "+opt_message;var error=new Error(message);var global=function(){return this}();if(global.traceAssertionsForTesting)console.warn(error.stack);throw error}return condition}function assertNotReached(opt_message){assert(false,opt_message||"Unreachable code hit")}function assertInstanceof(value,type,opt_message){if(!(value instanceof type)){assertNotReached(opt_message||"Value "+value+" is not a[n] "+(type.name||typeof type))}return value}
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var parseHtmlSubset=function(){"use strict";var allowedAttributes={href:function(node,value){return node.tagName=="A"&&(value.startsWith("chrome://")||value.startsWith("https://"))},target:function(node,value){return node.tagName=="A"&&value=="_blank"}};var allowedTags=["A","B","SPAN","STRONG"];function merge(var_args){var clone={};for(var i=0;i<arguments.length;++i){if(typeof arguments[i]=="object"){for(var key in arguments[i]){if(arguments[i].hasOwnProperty(key))clone[key]=arguments[i][key]}}}return clone}function walk(n,f){f(n);for(var i=0;i<n.childNodes.length;i++){walk(n.childNodes[i],f)}}function assertElement(tags,node){if(tags.indexOf(node.tagName)==-1)throw Error(node.tagName+" is not supported")}function assertAttribute(attrs,attrNode,node){var n=attrNode.nodeName;var v=attrNode.nodeValue;if(!attrs.hasOwnProperty(n)||!attrs[n](node,v))throw Error(node.tagName+"["+n+'="'+v+'"] is not supported')}return function(s,opt_extraTags,opt_extraAttrs){var extraTags=(opt_extraTags||[]).map(function(str){return str.toUpperCase()});var tags=allowedTags.concat(extraTags);var attrs=merge(allowedAttributes,opt_extraAttrs||{});var doc=document.implementation.createHTMLDocument("");var r=doc.createRange();r.selectNode(doc.body);var df=r.createContextualFragment(s);walk(df,function(node){switch(node.nodeType){case Node.ELEMENT_NODE:assertElement(tags,node);var nodeAttrs=node.attributes;for(var i=0;i<nodeAttrs.length;++i){assertAttribute(attrs,nodeAttrs[i],node)}break;case Node.COMMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:case Node.TEXT_NODE:break;default:throw Error("Node type "+node.nodeType+" is not supported")}});return df}}();
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";class Coordinate2d{constructor(x,y){this.x_=x;this.y_=y}get x(){return this.x_}get y(){return this.y_}translate(x,y){return new Coordinate2d(this.x_+x,this.y_+y)}scale(factor){return new Coordinate2d(this.x_*factor,this.y_*factor)}equals(other){return other!=null&&this.x_==other.x_&&this.y_==other.y_}}return{Coordinate2d:Coordinate2d}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";class Size{constructor(width,height){this.width_=width;this.height_=height}get width(){return this.width_}get height(){return this.height_}equals(other){return other!=null&&this.width_==other.width_&&this.height_==other.height_}}return{Size:Size}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function isInteger(toTest){const numericExp=/^\s*[0-9]+\s*$/;return numericExp.test(toTest)}function isPositiveInteger(value){return isInteger(value)&&parseInt(value,10)>0}function areArraysEqual(array1,array2){if(array1.length!=array2.length)return false;for(let i=0;i<array1.length;i++)if(array1[i]!==array2[i])return false;return true}function areRangesEqual(array1,array2){if(array1.length!=array2.length)return false;for(let i=0;i<array1.length;i++)if(array1[i].from!=array2[i].from||array1[i].to!=array2[i].to){return false}return true}function removeDuplicates(inArray){const out=[];if(inArray.length==0)return out;out.push(inArray[0]);for(let i=1;i<inArray.length;++i)if(inArray[i]!=inArray[i-1])out.push(inArray[i]);return out}const PageRangeStatus={NO_ERROR:0,SYNTAX_ERROR:-1,LIMIT_ERROR:-2};function pageRangeTextToPageRanges(pageRangeText,opt_totalPageCount){if(pageRangeText==""){return[]}const MAX_PAGE_NUMBER=1e9;const totalPageCount=opt_totalPageCount?opt_totalPageCount:MAX_PAGE_NUMBER;const regex=/^\s*([0-9]*)\s*-\s*([0-9]*)\s*$/;const parts=pageRangeText.split(/,|\u3001/);const pageRanges=[];for(let i=0;i<parts.length;++i){const match=parts[i].match(regex);if(match){if(!isPositiveInteger(match[1])&&match[1]!=="")return PageRangeStatus.SYNTAX_ERROR;if(!isPositiveInteger(match[2])&&match[2]!=="")return PageRangeStatus.SYNTAX_ERROR;const from=match[1]?parseInt(match[1],10):1;const to=match[2]?parseInt(match[2],10):totalPageCount;if(from>to)return PageRangeStatus.SYNTAX_ERROR;if(to>totalPageCount)return PageRangeStatus.LIMIT_ERROR;pageRanges.push({from:from,to:to})}else{if(!isPositiveInteger(parts[i]))return PageRangeStatus.SYNTAX_ERROR;const singlePageNumber=parseInt(parts[i],10);if(singlePageNumber>totalPageCount)return PageRangeStatus.LIMIT_ERROR;pageRanges.push({from:singlePageNumber,to:singlePageNumber})}}return pageRanges}function pageRangeTextToPageList(pageRangeText,totalPageCount){const pageRanges=pageRangeTextToPageRanges(pageRangeText,totalPageCount);const pageList=[];if(Array.isArray(pageRanges)){for(let i=0;i<pageRanges.length;++i){for(let j=pageRanges[i].from;j<=Math.min(pageRanges[i].to,totalPageCount);++j){pageList.push(j)}}}if(pageList.length==0){for(let j=1;j<=totalPageCount;++j)pageList.push(j)}return pageList}function pageListToPageSet(pageList){let pageSet=[];if(pageList.length==0)return pageSet;pageSet=pageList.slice(0);pageSet.sort(function(a,b){return a-b});pageSet=removeDuplicates(pageSet);return pageSet}function getIsVisible(element){return!element.hidden}function setIsVisible(element,isVisible){element.hidden=!isVisible}function arrayContains(array,item){return array.indexOf(item)!=-1}function getStringForLocale(localizedStrings,locale){locale=locale.toLowerCase();for(let i=0;i<localizedStrings.length;i++){if(localizedStrings[i].locale.toLowerCase()==locale)return localizedStrings[i].value}return""}function getStringForCurrentLocale(localizedStrings){return getStringForLocale(localizedStrings,navigator.language)||getStringForLocale(localizedStrings,navigator.language.split("-")[0])}
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview");print_preview.DestinationType={GOOGLE:"google",GOOGLE_PROMOTED:"google_promoted",LOCAL:"local",MOBILE:"mobile"};print_preview.DestinationOrigin={LOCAL:"local",COOKIES:"cookies",DEVICE:"device",PRIVET:"privet",EXTENSION:"extension",CROS:"chrome_os"};print_preview.DestinationConnectionStatus={DORMANT:"DORMANT",OFFLINE:"OFFLINE",ONLINE:"ONLINE",UNKNOWN:"UNKNOWN",UNREGISTERED:"UNREGISTERED"};print_preview.DestinationProvisionalType={NONE:"NONE",NEEDS_USB_PERMISSION:"NEEDS_USB_PERMISSION"};print_preview.DestinationCertificateStatus={NONE:"NONE",NO:"NO",UNKNOWN:"UNKNOWN",YES:"YES"};print_preview.VendorCapabilitySelectOption;print_preview.VendorCapability;print_preview.CddCapabilities;print_preview.Cdd;print_preview.ColorMode={GRAY:1,COLOR:2};print_preview.RecentDestination;cr.define("print_preview",function(){"use strict";function makeRecentDestination(destination){return{id:destination.id,origin:destination.origin,account:destination.account||"",capabilities:destination.capabilities,displayName:destination.displayName||"",extensionId:destination.extensionId||"",extensionName:destination.extensionName||""}}class Destination{constructor(id,type,origin,displayName,isRecent,connectionStatus,opt_params){this.id_=id;this.type_=type;this.origin_=origin;this.displayName_=displayName||"";this.isRecent_=isRecent;this.tags_=opt_params&&opt_params.tags||[];this.capabilities_=null;this.isOwned_=opt_params&&opt_params.isOwned||false;this.isEnterprisePrinter_=opt_params&&opt_params.isEnterprisePrinter||false;this.account_=opt_params&&opt_params.account||"";this.location_=null;this.description_=opt_params&&opt_params.description||"";this.connectionStatus_=connectionStatus;this.lastAccessTime_=opt_params&&opt_params.lastAccessTime||Date.now();this.cloudID_=opt_params&&opt_params.cloudID||"";this.extensionId_=opt_params&&opt_params.extensionId||"";this.extensionName_=opt_params&&opt_params.extensionName||"";this.provisionalType_=opt_params&&opt_params.provisionalType||print_preview.DestinationProvisionalType.NONE;this.certificateStatus_=opt_params&&opt_params.certificateStatus||print_preview.DestinationCertificateStatus.NONE;assert(this.provisionalType_!=print_preview.DestinationProvisionalType.NEEDS_USB_PERMISSION||this.isExtension,"Provisional USB destination only supprted with extension origin.");this.COLOR_TYPES_=["STANDARD_COLOR","CUSTOM_COLOR"];this.MONOCHROME_TYPES_=["STANDARD_MONOCHROME","CUSTOM_MONOCHROME"]}get id(){return this.id_}get type(){return this.type_}get origin(){return this.origin_}get displayName(){return this.displayName_}get isRecent(){return this.isRecent_}set isRecent(isRecent){this.isRecent_=isRecent}get isOwned(){return this.isOwned_}get account(){return this.account_}get isLocal(){return this.origin_==print_preview.DestinationOrigin.LOCAL||this.origin_==print_preview.DestinationOrigin.EXTENSION||this.origin_==print_preview.DestinationOrigin.CROS||this.origin_==print_preview.DestinationOrigin.PRIVET&&this.connectionStatus_!=print_preview.DestinationConnectionStatus.UNREGISTERED}get isPrivet(){return this.origin_==print_preview.DestinationOrigin.PRIVET}get isExtension(){return this.origin_==print_preview.DestinationOrigin.EXTENSION}get location(){if(this.location_==null){this.location_="";this.tags_.some(tag=>{return Destination.LOCATION_TAG_PREFIXES.some(prefix=>{if(tag.startsWith(prefix)){this.location_=tag.substring(prefix.length)||"";return true}})})}return this.location_}get description(){return this.description_}get hint(){if(this.id_==Destination.GooglePromotedId.DOCS){return this.account_}return this.location||this.extensionName||this.description}get tags(){return this.tags_.slice(0)}get cloudID(){return this.cloudID_}get extensionId(){return this.extensionId_}get extensionName(){return this.extensionName_}get capabilities(){return this.capabilities_}set capabilities(capabilities){if(capabilities)this.capabilities_=capabilities}get connectionStatus(){return this.connectionStatus_}set connectionStatus(status){this.connectionStatus_=status}get hasInvalidCertificate(){return this.certificateStatus_==print_preview.DestinationCertificateStatus.NO}get shouldShowInvalidCertificateError(){return this.certificateStatus_==print_preview.DestinationCertificateStatus.NO&&!loadTimeData.getBoolean("isEnterpriseManaged")}get isOffline(){return arrayContains([print_preview.DestinationConnectionStatus.OFFLINE,print_preview.DestinationConnectionStatus.DORMANT],this.connectionStatus_)}get isOfflineOrInvalid(){return this.isOffline||this.shouldShowInvalidCertificateError}get readyForSelection(){return(!cr.isChromeOS||this.origin_!=print_preview.DestinationOrigin.CROS||this.capabilities_!=null)&&!this.isProvisional}get connectionStatusText(){if(!this.isOfflineOrInvalid)return"";const offlineDurationMs=Date.now()-this.lastAccessTime_;let statusMessageId;if(this.shouldShowInvalidCertificateError){statusMessageId="noLongerSupported"}else if(offlineDurationMs>316224e5){statusMessageId="offlineForYear"}else if(offlineDurationMs>26784e5){statusMessageId="offlineForMonth"}else if(offlineDurationMs>6048e5){statusMessageId="offlineForWeek"}else{statusMessageId="offline"}return loadTimeData.getString(statusMessageId)}get lastAccessTime(){return this.lastAccessTime_}get iconUrl(){if(this.id_==Destination.GooglePromotedId.DOCS){return Destination.IconUrl_.DOCS}if(this.id_==Destination.GooglePromotedId.SAVE_AS_PDF){return Destination.IconUrl_.PDF}if(this.isEnterprisePrinter){return Destination.IconUrl_.ENTERPRISE}if(this.isLocal){return Destination.IconUrl_.LOCAL_1X}if(this.type_==print_preview.DestinationType.MOBILE&&this.isOwned_){return Destination.IconUrl_.MOBILE}if(this.type_==print_preview.DestinationType.MOBILE){return Destination.IconUrl_.MOBILE_SHARED}if(this.isOwned_){return Destination.IconUrl_.CLOUD_1X}return Destination.IconUrl_.CLOUD_SHARED_1X}get srcSet(){let srcSetIcon="";let iconUrl=this.iconUrl;if(iconUrl==Destination.IconUrl_.LOCAL_1X){srcSetIcon=Destination.IconUrl_.LOCAL_2X}else if(iconUrl==Destination.IconUrl_.CLOUD_1X){srcSetIcon=Destination.IconUrl_.CLOUD_2X}else if(iconUrl==Destination.IconUrl_.CLOUD_SHARED_1X){srcSetIcon=Destination.IconUrl_.CLOUD_SHARED_2X}if(srcSetIcon){srcSetIcon+=" 2x"}return srcSetIcon}get extraPropertiesToMatch(){return[this.location,this.description]}matches(query){return!!this.displayName_.match(query)||!!this.extensionName_.match(query)||this.extraPropertiesToMatch.some(p=>p.match(query))}get provisionalType(){return this.provisionalType_}get certificateStatus(){return this.certificateStatus_}get isProvisional(){return this.provisionalType_!=print_preview.DestinationProvisionalType.NONE}get isEnterprisePrinter(){return this.isEnterprisePrinter_}colorCapability_(){return this.capabilities&&this.capabilities.printer&&this.capabilities.printer.color?this.capabilities.printer.color:null}get hasColorCapability(){const capability=this.colorCapability_();if(!capability||!capability.option)return false;let hasColor=false;let hasMonochrome=false;capability.option.forEach(option=>{const type=assert(option.type);hasColor=hasColor||this.COLOR_TYPES_.includes(option.type);hasMonochrome=hasMonochrome||this.MONOCHROME_TYPES_.includes(option.type)});return hasColor&&hasMonochrome}getSelectedColorOption(isColor){const typesToLookFor=isColor?this.COLOR_TYPES_:this.MONOCHROME_TYPES_;const capability=this.colorCapability_();if(!capability||!capability.option)return null;for(let i=0;i<typesToLookFor.length;i++){const matchingOptions=capability.option.filter(option=>{return option.type==typesToLookFor[i]});if(matchingOptions.length>0)return matchingOptions[0]}return null}getNativeColorModel(isColor){const capability=this.colorCapability_();if(!capability||!capability.option||!this.isLocal){return isColor?print_preview.ColorMode.COLOR:print_preview.ColorMode.GRAY}const selected=this.getSelectedColorOption(isColor);const mode=parseInt(selected?selected.vendor_id:null,10);if(isNaN(mode)){return isColor?print_preview.ColorMode.COLOR:print_preview.ColorMode.GRAY}return mode}get defaultColorOption(){const capability=this.colorCapability_();if(!capability||!capability.option)return null;const defaultOptions=capability.option.filter(option=>{return option.is_default});return defaultOptions.length!=0?defaultOptions[0]:null}}Destination.LOCATION_TAG_PREFIXES=["__cp__location=","__cp__printer-location="];Destination.GooglePromotedId={DOCS:"__google__docs",SAVE_AS_PDF:"Save as PDF"};Destination.IconUrl_={CLOUD_1X:"images/1x/printer.png",CLOUD_2X:"images/2x/printer.png",CLOUD_SHARED_1X:"images/1x/printer_shared.png",CLOUD_SHARED_2X:"images/2x/printer_shared.png",LOCAL_1X:"images/1x/printer.png",LOCAL_2X:"images/2x/printer.png",MOBILE:"images/mobile.png",MOBILE_SHARED:"images/mobile_shared.png",PDF:"images/pdf.png",DOCS:"images/google_doc.png",ENTERPRISE:"images/business.svg"};return{Destination:Destination,makeRecentDestination:makeRecentDestination}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview");print_preview.MeasurementSystemUnitType={METRIC:0,IMPERIAL:1};print_preview.MeasurementSystemPrefs;cr.define("print_preview",function(){"use strict";class MeasurementSystem{constructor(thousandsDelimeter,decimalDelimeter,unitType){this.thousandsDelimeter_=thousandsDelimeter||",";this.decimalDelimeter_=decimalDelimeter||".";assert(measurementSystemPrefs.has(unitType));this.measurementSystemPrefs_=measurementSystemPrefs.get(unitType)}get unitSymbol(){return this.measurementSystemPrefs_.unitSymbol}get thousandsDelimeter(){return this.thousandsDelimeter_}get decimalDelimeter(){return this.decimalDelimeter_}setSystem(thousandsDelimeter,decimalDelimeter,unitType){this.thousandsDelimeter_=thousandsDelimeter;this.decimalDelimeter_=decimalDelimeter;assert(measurementSystemPrefs.has(unitType));this.measurementSystemPrefs_=measurementSystemPrefs.get(unitType)}roundValue(value){const precision=this.measurementSystemPrefs_.precision;const roundedValue=Math.round(value/precision)*precision;return+roundedValue.toFixed(this.measurementSystemPrefs_.decimalPlaces)}convertFromPoints(pts){return pts/this.measurementSystemPrefs_.ptsPerUnit}convertToPoints(localUnits){return localUnits*this.measurementSystemPrefs_.ptsPerUnit}}const measurementSystemPrefs=new Map([[print_preview.MeasurementSystemUnitType.METRIC,{precision:.5,decimalPlaces:1,ptsPerUnit:72/25.4,unitSymbol:"mm"}],[print_preview.MeasurementSystemUnitType.IMPERIAL,{precision:.01,decimalPlaces:2,ptsPerUnit:72,unitSymbol:'"'}]]);return{MeasurementSystem:MeasurementSystem}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview");print_preview.PreviewSettings;print_preview.LocalDestinationInfo;print_preview.NativeInitialSettings;print_preview.PrivetPrinterDescription;print_preview.CapabilitiesResponse;print_preview.PrinterSetupResponse;print_preview.ProvisionalDestinationInfo;print_preview.PrinterType={PRIVET_PRINTER:0,EXTENSION_PRINTER:1,PDF_PRINTER:2,LOCAL_PRINTER:3};cr.define("print_preview",function(){"use strict";class NativeLayer{static getInstance(){if(currentInstance==null)currentInstance=new NativeLayer;return assert(currentInstance)}static setInstance(instance){currentInstance=instance}getAccessToken(authType){return cr.sendWithPromise("getAccessToken",authType)}getInitialSettings(){return cr.sendWithPromise("getInitialSettings")}getPrinters(type){return cr.sendWithPromise("getPrinters",type)}getPrinterCapabilities(destinationId,type){return cr.sendWithPromise("getPrinterCapabilities",destinationId,destinationId==print_preview.Destination.GooglePromotedId.SAVE_AS_PDF?print_preview.PrinterType.PDF_PRINTER:type)}grantExtensionPrinterAccess(provisionalDestinationId){return cr.sendWithPromise("grantExtensionPrinterAccess",provisionalDestinationId)}setupPrinter(printerId){return cr.sendWithPromise("setupPrinter",printerId)}getPreview(printTicket){return cr.sendWithPromise("getPreview",printTicket)}print(printTicket){return cr.sendWithPromise("print",printTicket)}cancelPendingPrintRequest(){chrome.send("cancelPendingPrintRequest")}saveAppState(appStateStr){chrome.send("saveAppState",[appStateStr])}showSystemDialog(){assert(!cr.isWindows);chrome.send("showSystemDialog")}dialogClose(isCancel){if(isCancel)chrome.send("closePrintPreviewDialog");chrome.send("dialogClose")}hidePreview(){chrome.send("hidePreview")}signIn(addAccount){return cr.sendWithPromise("signIn",addAccount)}managePrinters(){chrome.send("managePrinters")}forceOpenNewTab(url){chrome.send("forceOpenNewTab",[url])}uiLoadedForTest(){chrome.send("UILoadedForTest")}uiFailedLoadingForTest(){chrome.send("UIFailedLoadingForTest")}recordInHistogram(histogram,bucket,maxBucket){chrome.send("metricsHandler:recordInHistogram",[histogram,bucket,maxBucket])}}let currentInstance=null;NativeLayer.SERIALIZED_STATE_VERSION_=1;return{NativeLayer:NativeLayer}});
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";class Invitation{constructor(sender,receiver,destination,aclEntry,account){this.sender_=sender;this.receiver_=receiver;this.destination_=destination;this.aclEntry_=aclEntry;this.account_=account}get sender(){return this.sender_}get receiver(){return this.receiver_}get asGroupManager(){return!!this.receiver_}get destination(){return this.destination_}get scopeId(){return this.aclEntry_["scope"]||""}get account(){return this.account_}}return{Invitation:Invitation}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cloudprint",function(){"use strict";const CloudDestinationField={CAPABILITIES:"capabilities",CONNECTION_STATUS:"connectionStatus",DESCRIPTION:"description",DISPLAY_NAME:"displayName",ID:"id",LAST_ACCESS:"accessTime",TAGS:"tags",TYPE:"type"};const RECENT_TAG="^recent";const OWNED_TAG="^own";const CERT_TAG="__cp_printer_passes_2018_cert__=";const DestinationCloudType={ANDROID:"ANDROID_CHROME_SNAPSHOT",DOCS:"DOCS",IOS:"IOS_CHROME_SNAPSHOT"};function parseType(typeStr){if(typeStr==DestinationCloudType.ANDROID||typeStr==DestinationCloudType.IOS){return print_preview.DestinationType.MOBILE}if(typeStr==DestinationCloudType.DOCS){return print_preview.DestinationType.GOOGLE_PROMOTED}return print_preview.DestinationType.GOOGLE}function extractCertificateStatus(tags){const certTag=tags.find(tag=>tag.startsWith(CERT_TAG));if(!certTag)return print_preview.DestinationCertificateStatus.NONE;const value=certTag.substring(CERT_TAG.length);assert(value==print_preview.DestinationCertificateStatus.UNKNOWN||value==print_preview.DestinationCertificateStatus.YES||value==print_preview.DestinationCertificateStatus.NO);return value}function parseCloudDestination(json,origin,account){if(!json.hasOwnProperty(CloudDestinationField.ID)||!json.hasOwnProperty(CloudDestinationField.TYPE)||!json.hasOwnProperty(CloudDestinationField.DISPLAY_NAME)){throw Error("Cloud destination does not have an ID or a display name")}const id=json[CloudDestinationField.ID];const tags=json[CloudDestinationField.TAGS]||[];const connectionStatus=json[CloudDestinationField.CONNECTION_STATUS]||print_preview.DestinationConnectionStatus.UNKNOWN;const optionalParams={account:account,tags:tags,isOwned:arrayContains(tags,OWNED_TAG),lastAccessTime:parseInt(json[CloudDestinationField.LAST_ACCESS],10)||Date.now(),cloudID:id,description:json[CloudDestinationField.DESCRIPTION],certificateStatus:extractCertificateStatus(tags)};const cloudDest=new print_preview.Destination(id,parseType(json[CloudDestinationField.TYPE]),origin,json[CloudDestinationField.DISPLAY_NAME],arrayContains(tags,RECENT_TAG),connectionStatus,optionalParams);if(json.hasOwnProperty(CloudDestinationField.CAPABILITIES)){cloudDest.capabilities=json[CloudDestinationField.CAPABILITIES]}return cloudDest}const InvitationField={PRINTER:"printer",RECEIVER:"receiver",SENDER:"sender"};const InvitationAclType={DOMAIN:"DOMAIN",GROUP:"GROUP",PUBLIC:"PUBLIC",USER:"USER"};function parseInvitation(json,account){if(!json.hasOwnProperty(InvitationField.SENDER)||!json.hasOwnProperty(InvitationField.RECEIVER)||!json.hasOwnProperty(InvitationField.PRINTER)){throw Error("Invitation does not have necessary info.")}const nameFormatter=function(name,scope){return name&&scope?name+" ("+scope+")":name||scope};const sender=json[InvitationField.SENDER];const senderName=nameFormatter(sender["name"],sender["email"]);const receiver=json[InvitationField.RECEIVER];let receiverName="";const receiverType=receiver["type"];if(receiverType==InvitationAclType.USER){}else if(receiverType==InvitationAclType.GROUP||receiverType==InvitationAclType.DOMAIN){receiverName=nameFormatter(receiver["name"],receiver["scope"])}else{throw Error("Invitation of unsupported receiver type")}const destination=cloudprint.parseCloudDestination(json[InvitationField.PRINTER],print_preview.DestinationOrigin.COOKIES,account);return new print_preview.Invitation(senderName,receiverName,destination,receiver,account)}return{parseCloudDestination:parseCloudDestination,parseInvitation:parseInvitation}});
// Copyright (c) 2010 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var EventListenerType;cr.define("cr",function(){function EventTarget(){}EventTarget.prototype={addEventListener:function(type,handler){if(!this.listeners_)this.listeners_=Object.create(null);if(!(type in this.listeners_)){this.listeners_[type]=[handler]}else{var handlers=this.listeners_[type];if(handlers.indexOf(handler)<0)handlers.push(handler)}},removeEventListener:function(type,handler){if(!this.listeners_)return;if(type in this.listeners_){var handlers=this.listeners_[type];var index=handlers.indexOf(handler);if(index>=0){if(handlers.length==1)delete this.listeners_[type];else handlers.splice(index,1)}}},dispatchEvent:function(event){if(!this.listeners_)return true;var self=this;event.__defineGetter__("target",function(){return self});var type=event.type;var prevented=0;if(type in this.listeners_){var handlers=this.listeners_[type].concat();for(var i=0,handler;handler=handlers[i];i++){if(handler.handleEvent)prevented|=handler.handleEvent.call(handler,event)===false;else prevented|=handler.call(this,event)===false}}return!prevented&&!event.defaultPrevented}};return{EventTarget:EventTarget}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview.ticket_items");print_preview.ticket_items.CustomMarginsOrientation={TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"};print_preview.ticket_items.MarginsTypeValue={DEFAULT:0,NO_MARGINS:1,MINIMUM:2,CUSTOM:3};print_preview.MarginsSetting;cr.define("print_preview",function(){"use strict";class Margins{constructor(top,right,bottom,left){this.value_={};this.value_[print_preview.ticket_items.CustomMarginsOrientation.TOP]=top;this.value_[print_preview.ticket_items.CustomMarginsOrientation.RIGHT]=right;this.value_[print_preview.ticket_items.CustomMarginsOrientation.BOTTOM]=bottom;this.value_[print_preview.ticket_items.CustomMarginsOrientation.LEFT]=left}static parse(state){return new print_preview.Margins(state[print_preview.ticket_items.CustomMarginsOrientation.TOP]||0,state[print_preview.ticket_items.CustomMarginsOrientation.RIGHT]||0,state[print_preview.ticket_items.CustomMarginsOrientation.BOTTOM]||0,state[print_preview.ticket_items.CustomMarginsOrientation.LEFT]||0)}get(orientation){return this.value_[orientation]}set(orientation,value){const newValue=this.clone_();newValue[orientation]=value;return new Margins(newValue[print_preview.ticket_items.CustomMarginsOrientation.TOP],newValue[print_preview.ticket_items.CustomMarginsOrientation.RIGHT],newValue[print_preview.ticket_items.CustomMarginsOrientation.BOTTOM],newValue[print_preview.ticket_items.CustomMarginsOrientation.LEFT])}equals(other){if(other==null){return false}for(const orientation in this.value_){if(this.value_[orientation]!=other.value_[orientation]){return false}}return true}serialize(){return this.clone_()}clone_(){const clone={};for(const o in this.value_){clone[o]=this.value_[o]}return clone}}return{Margins:Margins}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";class PrintableArea{constructor(origin,size){this.origin_=origin;this.size_=size}get origin(){return this.origin_}get size(){return this.size_}equals(other){return other!=null&&this.origin_.equals(other.origin_)&&this.size_.equals(other.size_)}}return{PrintableArea:PrintableArea}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";class DocumentInfo extends cr.EventTarget{constructor(){super();this.hasCssMediaStyles_=false;this.hasSelection_=false;this.isModifiable_=true;this.isScalingDisabled_=false;this.fitToPageScaling_=100;this.margins_=null;this.pageCount_=0;this.pageSize_=new print_preview.Size(612,792);this.printableArea_=new print_preview.PrintableArea(new print_preview.Coordinate2d(0,0),this.pageSize_);this.title_="";this.isInitialized_=false}get hasCssMediaStyles(){return this.hasCssMediaStyles_}get hasSelection(){return this.hasSelection_}get isModifiable(){return this.isModifiable_}get isScalingDisabled(){return this.isScalingDisabled_}get fitToPageScaling(){return this.fitToPageScaling_}get margins(){return this.margins_}get pageCount(){return this.pageCount_}get pageSize(){return this.pageSize_}get printableArea(){return this.printableArea_}get title(){return this.title_}init(isModifiable,title,hasSelection){this.isModifiable_=isModifiable;this.title_=title;this.hasSelection_=hasSelection;this.isInitialized_=true;cr.dispatchSimpleEvent(this,DocumentInfo.EventType.CHANGE)}updateIsScalingDisabled(isScalingDisabled){if(this.isInitialized_&&this.isScalingDisabled_!=isScalingDisabled){this.isScalingDisabled_=isScalingDisabled;cr.dispatchSimpleEvent(this,DocumentInfo.EventType.CHANGE)}}updatePageCount(pageCount){if(this.isInitialized_&&this.pageCount_!=pageCount){this.pageCount_=pageCount;cr.dispatchSimpleEvent(this,DocumentInfo.EventType.CHANGE)}}updateFitToPageScaling(scaleFactor){this.fitToPageScaling_=scaleFactor}updatePageInfo(printableArea,pageSize,hasCssMediaStyles,margins){if(this.isInitialized_&&(!this.printableArea_.equals(printableArea)||!this.pageSize_.equals(pageSize)||this.hasCssMediaStyles_!=hasCssMediaStyles||this.margins_==null||!this.margins_.equals(margins))){this.printableArea_=printableArea;this.pageSize_=pageSize;this.hasCssMediaStyles_=hasCssMediaStyles;this.margins_=margins;cr.dispatchSimpleEvent(this,DocumentInfo.EventType.CHANGE)}}}DocumentInfo.EventType={CHANGE:"print_preview.DocumentInfo.CHANGE"};return{DocumentInfo:DocumentInfo}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";class UserInfo extends cr.EventTarget{constructor(){super();this.activeUser_=null;this.users_=null}get initialized(){return this.users_!=null}get loggedIn(){return!!this.activeUser}get activeUser(){return this.activeUser_}set activeUser(activeUser){if(!!activeUser&&this.activeUser_!=activeUser){this.activeUser_=activeUser;cr.dispatchSimpleEvent(this,UserInfo.EventType.ACTIVE_USER_CHANGED)}}get users(){return this.users_}setUsers(activeUser,users){this.activeUser_=activeUser;this.users_=users||[];cr.dispatchSimpleEvent(this,UserInfo.EventType.USERS_CHANGED)}}UserInfo.EventType={ACTIVE_USER_CHANGED:"print_preview.UserInfo.ACTIVE_USER_CHANGED",USERS_CHANGED:"print_preview.UserInfo.USERS_CHANGED"};return{UserInfo:UserInfo}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("cloudprint");cloudprint.CloudPrintInterfaceEventType={INVITES_DONE:"cloudprint.CloudPrintInterface.INVITES_DONE",INVITES_FAILED:"cloudprint.CloudPrintInterface.INVITES_FAILED",PRINTER_DONE:"cloudprint.CloudPrintInterface.PRINTER_DONE",PRINTER_FAILED:"cloudprint.CloudPrintInterface.PRINTER_FAILED",PROCESS_INVITE_DONE:"cloudprint.CloudPrintInterface.PROCESS_INVITE_DONE",PROCESS_INVITE_FAILED:"cloudprint.CloudPrintInterface.PROCESS_INVITE_FAILED",SEARCH_DONE:"cloudprint.CloudPrintInterface.SEARCH_DONE",SEARCH_FAILED:"cloudprint.CloudPrintInterface.SEARCH_FAILED",SUBMIT_DONE:"cloudprint.CloudPrintInterface.SUBMIT_DONE",SUBMIT_FAILED:"cloudprint.CloudPrintInterface.SUBMIT_FAILED"};cr.define("cloudprint",function(){"use strict";const CloudPrintInterfaceEventType=cloudprint.CloudPrintInterfaceEventType;class CloudPrintInterface extends cr.EventTarget{constructor(baseUrl,nativeLayer,userInfo,isInAppKioskMode){super();this.baseUrl_=baseUrl;this.nativeLayer_=nativeLayer;this.userInfo_=userInfo;this.isInAppKioskMode_=isInAppKioskMode;this.userSessionIndex_={};this.xsrfTokens_={};this.outstandingCloudSearchRequests_=[];this.accessTokenRequestPromise_=null}get baseUrl(){return this.baseUrl_}get isCloudDestinationSearchInProgress(){return this.outstandingCloudSearchRequests_.length>0}search(opt_account,opt_origin){const account=opt_account||"";let origins=opt_origin&&[opt_origin]||CLOUD_ORIGINS_;if(this.isInAppKioskMode_){origins=origins.filter(function(origin){return origin!=print_preview.DestinationOrigin.COOKIES})}this.abortSearchRequests_(origins);this.search_(true,account,origins);this.search_(false,account,origins)}search_(isRecent,account,origins){const params=[new HttpParam("connection_status","ALL"),new HttpParam("client","chrome"),new HttpParam("use_cdd","true")];if(isRecent){params.push(new HttpParam("q","^recent"))}origins.forEach(function(origin){const cpRequest=this.buildRequest_("GET","search",params,origin,account,this.onSearchDone_.bind(this,isRecent));this.outstandingCloudSearchRequests_.push(cpRequest);this.sendOrQueueRequest_(cpRequest)},this)}invites(account){const params=[new HttpParam("client","chrome")];this.sendOrQueueRequest_(this.buildRequest_("GET","invites",params,print_preview.DestinationOrigin.COOKIES,account,this.onInvitesDone_.bind(this)))}processInvite(invitation,accept){const params=[new HttpParam("printerid",invitation.destination.id),new HttpParam("email",invitation.scopeId),new HttpParam("accept",accept?"true":"false"),new HttpParam("use_cdd","true")];this.sendOrQueueRequest_(this.buildRequest_("POST","processinvite",params,invitation.destination.origin,invitation.destination.account,this.onProcessInviteDone_.bind(this,invitation,accept)))}submit(destination,printTicket,documentInfo,data){const result=VERSION_REGEXP_.exec(navigator.userAgent);let chromeVersion="unknown";if(result&&result.length==2){chromeVersion=result[1]}const params=[new HttpParam("printerid",destination.id),new HttpParam("contentType","dataUrl"),new HttpParam("title",documentInfo.title),new HttpParam("ticket",printTicket),new HttpParam("content","data:application/pdf;base64,"+data),new HttpParam("tag","__google__chrome_version="+chromeVersion),new HttpParam("tag","__google__os="+navigator.platform)];const cpRequest=this.buildRequest_("POST","submit",params,destination.origin,destination.account,this.onSubmitDone_.bind(this));this.sendOrQueueRequest_(cpRequest)}printer(printerId,origin,account){const params=[new HttpParam("printerid",printerId),new HttpParam("use_cdd","true"),new HttpParam("printer_connection_status","true")];this.sendOrQueueRequest_(this.buildRequest_("GET","printer",params,origin,account||"",this.onPrinterDone_.bind(this,printerId)))}buildRequest_(method,action,params,origin,account,callback){let url=this.baseUrl_+"/"+action+"?xsrf=";if(origin==print_preview.DestinationOrigin.COOKIES){const xsrfToken=this.xsrfTokens_[account];if(!xsrfToken){}else{url=url+xsrfToken}if(account){const index=this.userSessionIndex_[account]||0;if(index>0){url+="&authuser="+index}}}let body=null;if(params){if(method=="GET"){url=params.reduce(function(partialUrl,param){return partialUrl+"&"+param.name+"="+encodeURIComponent(param.value)},url)}else if(method=="POST"){body=params.reduce(function(partialBody,param){return partialBody+'Content-Disposition: form-data; name="'+param.name+'"\r\n\r\n'+param.value+"\r\n--"+MULTIPART_BOUNDARY_+"\r\n"},"--"+MULTIPART_BOUNDARY_+"\r\n")}}const headers={};headers["X-CloudPrint-Proxy"]="ChromePrintPreview";if(method=="GET"){headers["Content-Type"]=URL_ENCODED_CONTENT_TYPE_}else if(method=="POST"){headers["Content-Type"]=MULTIPART_CONTENT_TYPE_}const xhr=new XMLHttpRequest;xhr.open(method,url,true);xhr.withCredentials=origin==print_preview.DestinationOrigin.COOKIES;for(const header in headers){xhr.setRequestHeader(header,headers[header])}return new cloudprint.CloudPrintRequest(xhr,body,origin,account,callback)}sendOrQueueRequest_(request){if(request.origin==print_preview.DestinationOrigin.COOKIES){this.sendRequest_(request);return}if(this.accessTokenRequestPromise_==null){this.accessTokenRequestPromise_=this.nativeLayer_.getAccessToken(request.origin)}this.accessTokenRequestPromise_.then(this.onAccessTokenReady_.bind(this,request))}sendRequest_(request){request.xhr.onreadystatechange=this.onReadyStateChange_.bind(this,request);request.xhr.send(request.body)}createErrorEvent_(type,request){const errorEvent=new Event(type);errorEvent.status=request.xhr.status;if(request.xhr.status==200){errorEvent.errorCode=request.result["errorCode"];errorEvent.message=request.result["message"]}else{errorEvent.errorCode=0;errorEvent.message=""}errorEvent.origin=request.origin;return errorEvent}setUsers_(request){if(request.origin==print_preview.DestinationOrigin.COOKIES){const users=request.result["request"]["users"]||[];this.userSessionIndex_={};for(let i=0;i<users.length;i++){this.userSessionIndex_[users[i]]=i}this.userInfo_.setUsers(request.result["request"]["user"],users)}}abortSearchRequests_(origins){this.outstandingCloudSearchRequests_=this.outstandingCloudSearchRequests_.filter(function(request){if(origins.indexOf(request.origin)>=0){request.xhr.abort();return false}return true})}onAccessTokenReady_(request,accessToken){assert(request.origin==print_preview.DestinationOrigin.DEVICE);if(accessToken){request.xhr.setRequestHeader("Authorization","Bearer "+accessToken);this.sendRequest_(request)}else{request.xhr.abort();request.callback(request)}this.accessTokenRequestPromise_=null}onReadyStateChange_(request){if(request.xhr.readyState==4){if(request.xhr.status==200){request.result=JSON.parse(request.xhr.responseText);if(request.origin==print_preview.DestinationOrigin.COOKIES&&request.result["success"]){this.xsrfTokens_[request.result["request"]["user"]]=request.result["xsrf_token"]}}request.callback(request)}}onSearchDone_(isRecent,request){let lastRequestForThisOrigin=true;this.outstandingCloudSearchRequests_=this.outstandingCloudSearchRequests_.filter(function(item){if(item!=request&&item.origin==request.origin){lastRequestForThisOrigin=false}return item!=request});let activeUser="";if(request.origin==print_preview.DestinationOrigin.COOKIES){activeUser=request.result&&request.result["request"]&&request.result["request"]["user"]}let event=null;if(request.xhr.status==200&&request.result["success"]){const printerListJson=request.result["printers"]||[];const printerList=[];printerListJson.forEach(function(printerJson){try{printerList.push(cloudprint.parseCloudDestination(printerJson,request.origin,activeUser))}catch(err){console.error("Unable to parse cloud print destination: "+err)}});this.setUsers_(request);event=new Event(CloudPrintInterfaceEventType.SEARCH_DONE);event.origin=request.origin;event.printers=printerList;event.isRecent=isRecent}else{event=this.createErrorEvent_(CloudPrintInterfaceEventType.SEARCH_FAILED,request)}event.user=activeUser;event.searchDone=lastRequestForThisOrigin;this.dispatchEvent(event)}onInvitesDone_(request){let event=null;const activeUser=request.result&&request.result["request"]&&request.result["request"]["user"]||"";if(request.xhr.status==200&&request.result["success"]){const invitationListJson=request.result["invites"]||[];const invitationList=[];invitationListJson.forEach(function(invitationJson){try{invitationList.push(cloudprint.parseInvitation(invitationJson,activeUser))}catch(e){console.error("Unable to parse invitation: "+e)}});event=new Event(CloudPrintInterfaceEventType.INVITES_DONE);event.invitations=invitationList}else{event=this.createErrorEvent_(CloudPrintInterfaceEventType.INVITES_FAILED,request)}event.user=activeUser;this.dispatchEvent(event)}onProcessInviteDone_(invitation,accept,request){let event=null;const activeUser=request.result&&request.result["request"]&&request.result["request"]["user"]||"";if(request.xhr.status==200&&request.result["success"]){event=new Event(CloudPrintInterfaceEventType.PROCESS_INVITE_DONE);if(accept){try{event.printer=cloudprint.parseCloudDestination(request.result["printer"],request.origin,activeUser)}catch(e){console.error("Failed to parse cloud print destination: "+e)}}}else{event=this.createErrorEvent_(CloudPrintInterfaceEventType.PROCESS_INVITE_FAILED,request)}event.invitation=invitation;event.accept=accept;event.user=activeUser;this.dispatchEvent(event)}onSubmitDone_(request){if(request.xhr.status==200&&request.result["success"]){const submitDoneEvent=new Event(CloudPrintInterfaceEventType.SUBMIT_DONE);submitDoneEvent.jobId=request.result["job"]["id"];this.dispatchEvent(submitDoneEvent)}else{const errorEvent=this.createErrorEvent_(CloudPrintInterfaceEventType.SUBMIT_FAILED,request);this.dispatchEvent(errorEvent)}}onPrinterDone_(destinationId,request){if(request.origin==print_preview.DestinationOrigin.COOKIES&&request.result&&request.account&&request.result["request"]["user"]&&request.result["request"]["users"]&&request.account!=request.result["request"]["user"]){this.setUsers_(request);if(this.userSessionIndex_[request.account]>0){this.userInfo_.activeUser=request.account;this.printer(request.result["request"]["params"]["printerid"],request.origin,request.account);return}}if(request.xhr.status==200&&request.result["success"]){let activeUser="";if(request.origin==print_preview.DestinationOrigin.COOKIES){activeUser=request.result["request"]["user"]}const printerJson=request.result["printers"][0];let printer;try{printer=cloudprint.parseCloudDestination(printerJson,request.origin,activeUser)}catch(err){console.error("Failed to parse cloud print destination: "+JSON.stringify(printerJson));return}const printerDoneEvent=new Event(CloudPrintInterfaceEventType.PRINTER_DONE);printerDoneEvent.printer=printer;this.dispatchEvent(printerDoneEvent)}else{const errorEvent=this.createErrorEvent_(CloudPrintInterfaceEventType.PRINTER_FAILED,request);errorEvent.destinationId=destinationId;errorEvent.destinationOrigin=request.origin;this.dispatchEvent(errorEvent)}}}const URL_ENCODED_CONTENT_TYPE_="application/x-www-form-urlencoded";const MULTIPART_BOUNDARY_="----CloudPrintFormBoundaryjc9wuprokl8i";const MULTIPART_CONTENT_TYPE_="multipart/form-data; boundary="+MULTIPART_BOUNDARY_;const VERSION_REGEXP_=/.*Chrome\/([\d\.]+)/i;const CLOUD_ORIGINS_=[print_preview.DestinationOrigin.COOKIES,print_preview.DestinationOrigin.DEVICE];class CloudPrintRequest{constructor(xhr,body,origin,account,callback){this.xhr=xhr;this.body=body;this.origin=origin;this.account=account;this.callback=callback;this.result=null}}class HttpParam{constructor(name,value){this.name=name;this.value=value}}return{CloudPrintInterface:CloudPrintInterface,CloudPrintRequest:CloudPrintRequest}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";function Metrics(){}Metrics.DestinationSearchBucket={DESTINATION_SHOWN:0,DESTINATION_CLOSED_CHANGED:1,DESTINATION_CLOSED_UNCHANGED:2,SIGNIN_PROMPT:3,SIGNIN_TRIGGERED:4,PRIVET_DUPLICATE_SELECTED:5,CLOUD_DUPLICATE_SELECTED:6,REGISTER_PROMO_SHOWN:7,REGISTER_PROMO_SELECTED:8,ACCOUNT_CHANGED:9,ADD_ACCOUNT_SELECTED:10,INVITATION_AVAILABLE:11,INVITATION_ACCEPTED:12,INVITATION_REJECTED:13,DESTINATION_SEARCH_MAX_BUCKET:14};Metrics.PrintSettingsUiBucket={ADVANCED_SETTINGS_DIALOG_SHOWN:0,ADVANCED_SETTINGS_DIALOG_CANCELED:1,MORE_SETTINGS_CLICKED:2,LESS_SETTINGS_CLICKED:3,PRINT_WITH_SETTINGS_EXPANDED:4,PRINT_WITH_SETTINGS_COLLAPSED:5,PRINT_SETTINGS_UI_MAX_BUCKET:6};function MetricsContext(histogram,maxBucket){this.histogram_=histogram;this.maxBucket_=maxBucket;this.nativeLayer_=print_preview.NativeLayer.getInstance()}MetricsContext.prototype={record:function(bucket){this.nativeLayer_.recordInHistogram(this.histogram_,bucket>this.maxBucket_?this.maxBucket_:bucket,this.maxBucket_)}};function DestinationSearchMetricsContext(){MetricsContext.call(this,"PrintPreview.DestinationAction",Metrics.DestinationSearchBucket.DESTINATION_SEARCH_MAX_BUCKET)}DestinationSearchMetricsContext.prototype={__proto__:MetricsContext.prototype};function PrintSettingsUiMetricsContext(){MetricsContext.call(this,"PrintPreview.PrintSettingsUi",Metrics.PrintSettingsUiBucket.PRINT_SETTINGS_UI_MAX_BUCKET)}PrintSettingsUiMetricsContext.prototype={__proto__:MetricsContext.prototype};return{Metrics:Metrics,MetricsContext:MetricsContext,DestinationSearchMetricsContext:DestinationSearchMetricsContext,PrintSettingsUiMetricsContext:PrintSettingsUiMetricsContext}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";const originToType=function(origin){if(origin===print_preview.DestinationOrigin.LOCAL||origin===print_preview.DestinationOrigin.CROS){return print_preview.PrinterType.LOCAL_PRINTER}if(origin===print_preview.DestinationOrigin.PRIVET)return print_preview.PrinterType.PRIVET_PRINTER;if(origin===print_preview.DestinationOrigin.EXTENSION)return print_preview.PrinterType.EXTENSION_PRINTER;return null};class DestinationMatch{constructor(origins,idRegExp,displayNameRegExp,skipVirtualDestinations){this.origins_=origins;this.idRegExp_=idRegExp;this.displayNameRegExp_=displayNameRegExp;this.skipVirtualDestinations_=skipVirtualDestinations}matchOrigin(origin){return arrayContains(this.origins_,origin)}matchIdAndOrigin(id,origin){return this.matchOrigin(origin)&&!!this.idRegExp_&&this.idRegExp_.test(id)}match(destination){if(!this.matchOrigin(destination.origin)){return false}if(this.idRegExp_&&!this.idRegExp_.test(destination.id)){return false}if(this.displayNameRegExp_&&!this.displayNameRegExp_.test(destination.displayName)){return false}if(this.skipVirtualDestinations_&&this.isVirtualDestination_(destination)){return false}return true}isVirtualDestination_(destination){if(destination.origin==print_preview.DestinationOrigin.LOCAL){return arrayContains([print_preview.Destination.GooglePromotedId.SAVE_AS_PDF],destination.id)}return arrayContains([print_preview.Destination.GooglePromotedId.DOCS],destination.id)}getTypes(){return new Set(this.origins_.map(origin=>originToType(origin)))}}return{originToType:originToType,DestinationMatch:DestinationMatch}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";function parseDestination(type,printer){if(type===print_preview.PrinterType.LOCAL_PRINTER){return parseLocalDestination(printer)}if(type===print_preview.PrinterType.PRIVET_PRINTER){return parsePrivetDestination(printer)}if(type===print_preview.PrinterType.EXTENSION_PRINTER){return parseExtensionDestination(printer)}assertNotReached("Unknown printer type "+type);return[]}function parseLocalDestination(destinationInfo){const options={description:destinationInfo.printerDescription,isEnterprisePrinter:destinationInfo.cupsEnterprisePrinter};if(destinationInfo.printerOptions){options.tags=Object.keys(destinationInfo.printerOptions).map(function(key){return"__cp__"+key+"="+this[key]},destinationInfo.printerOptions)}return new print_preview.Destination(destinationInfo.deviceName,print_preview.DestinationType.LOCAL,cr.isChromeOS?print_preview.DestinationOrigin.CROS:print_preview.DestinationOrigin.LOCAL,destinationInfo.printerName,false,print_preview.DestinationConnectionStatus.ONLINE,options)}function parsePrivetDestination(destinationInfo){const returnedPrinters=[];if(destinationInfo.hasLocalPrinting){returnedPrinters.push(new print_preview.Destination(destinationInfo.serviceName,print_preview.DestinationType.LOCAL,print_preview.DestinationOrigin.PRIVET,destinationInfo.name,false,print_preview.DestinationConnectionStatus.ONLINE,{cloudID:destinationInfo.cloudID}))}if(destinationInfo.isUnregistered){returnedPrinters.push(new print_preview.Destination(destinationInfo.serviceName,print_preview.DestinationType.GOOGLE,print_preview.DestinationOrigin.PRIVET,destinationInfo.name,false,print_preview.DestinationConnectionStatus.UNREGISTERED))}return returnedPrinters.length===1?returnedPrinters[0]:returnedPrinters}function parseExtensionDestination(destinationInfo){const provisionalType=destinationInfo.provisional?print_preview.DestinationProvisionalType.NEEDS_USB_PERMISSION:print_preview.DestinationProvisionalType.NONE;return new print_preview.Destination(destinationInfo.id,print_preview.DestinationType.LOCAL,print_preview.DestinationOrigin.EXTENSION,destinationInfo.name,false,print_preview.DestinationConnectionStatus.ONLINE,{description:destinationInfo.description||"",extensionId:destinationInfo.extensionId,extensionName:destinationInfo.extensionName||"",provisionalType:provisionalType})}return{parseDestination:parseDestination,parseExtensionDestination:parseExtensionDestination}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview");print_preview.DestinationStorePrinterSearchStatus={START:"start",SEARCHING:"searching",DONE:"done"};cr.define("print_preview",function(){"use strict";const localizeCapabilities=function(capabilities){if(!capabilities.printer)return capabilities;const mediaSize=capabilities.printer.media_size;if(!mediaSize)return capabilities;for(let i=0,media;media=mediaSize.option[i];i++){if(!media.custom_display_name_localized){media.custom_display_name=media.custom_display_name||DestinationStore.MEDIA_DISPLAY_NAMES_[media.name]||media.name}}return capabilities};const compareMediaNames=function(a,b){const nameA=a.custom_display_name_localized||a.custom_display_name;const nameB=b.custom_display_name_localized||b.custom_display_name;return nameA==nameB?0:nameA>nameB?1:-1};const sortMediaSizes=function(capabilities){if(!capabilities.printer)return capabilities;const mediaSize=capabilities.printer.media_size;if(!mediaSize)return capabilities;const categoryStandardNA=[];const categoryStandardCN=[];const categoryStandardISO=[];const categoryStandardJP=[];const categoryStandardMisc=[];const categoryCustom=[];for(let i=0,media;media=mediaSize.option[i];i++){const name=media.name||"CUSTOM";let category;if(name.startsWith("NA_")){category=categoryStandardNA}else if(name.startsWith("PRC_")||name.startsWith("ROC_")||name=="OM_DAI_PA_KAI"||name=="OM_JUURO_KU_KAI"||name=="OM_PA_KAI"){category=categoryStandardCN}else if(name.startsWith("ISO_")){category=categoryStandardISO}else if(name.startsWith("JIS_")||name.startsWith("JPN_")){category=categoryStandardJP}else if(name.startsWith("OM_")){category=categoryStandardMisc}else{assert(name=="CUSTOM","Unknown media size. Assuming custom");category=categoryCustom}category.push(media)}categoryStandardNA.sort(compareMediaNames);categoryStandardCN.sort(compareMediaNames);categoryStandardISO.sort(compareMediaNames);categoryStandardJP.sort(compareMediaNames);categoryStandardMisc.sort(compareMediaNames);categoryCustom.sort(compareMediaNames);mediaSize.option=categoryStandardNA;mediaSize.option.push(...categoryStandardCN,...categoryStandardISO,...categoryStandardJP,...categoryStandardMisc,...categoryCustom);return capabilities};class DestinationStore extends cr.EventTarget{constructor(userInfo,listenerTracker){super();this.nativeLayer_=print_preview.NativeLayer.getInstance();this.userInfo_=userInfo;this.metrics_=new print_preview.DestinationSearchMetricsContext;this.destinations_=[];this.destinationMap_={};this.selectedDestination_=null;this.autoSelectMatchingDestination_=null;this.tracker_=new EventTracker;this.pdfPrinterEnabled_=false;this.systemDefaultDestinationId_="";this.cloudPrintInterface_=null;this.loadedCloudOrigins_={};this.autoSelectTimeout_=null;this.destinationSearchStatus_=new Map([[print_preview.PrinterType.EXTENSION_PRINTER,print_preview.DestinationStorePrinterSearchStatus.START],[print_preview.PrinterType.PRIVET_PRINTER,print_preview.DestinationStorePrinterSearchStatus.START],[print_preview.PrinterType.LOCAL_PRINTER,print_preview.DestinationStorePrinterSearchStatus.START]]);this.waitForRegisterDestination_=null;this.platformOrigin_=cr.isChromeOS?print_preview.DestinationOrigin.CROS:print_preview.DestinationOrigin.LOCAL;this.useSystemDefaultAsDefault_=loadTimeData.getBoolean("useSystemDefaultPrinter");this.recentDestinations_=[];this.reset_();this.addWebUIEventListeners_(listenerTracker)}destinations(opt_account){if(opt_account){return this.destinations_.filter(function(destination){return!destination.account||destination.account==opt_account})}return this.destinations_.slice(0)}getDestination(origin,id,account){return this.destinationMap_[this.getDestinationKey_(origin,id,account)]}get selectedDestination(){return this.selectedDestination_}get isAutoSelectDestinationInProgress(){return this.selectedDestination_==null&&this.autoSelectTimeout_!=null}get isPrintDestinationSearchInProgress(){let isLocalDestinationSearchInProgress=Array.from(this.destinationSearchStatus_.values()).some(el=>el===print_preview.DestinationStorePrinterSearchStatus.SEARCHING);if(isLocalDestinationSearchInProgress)return true;let isCloudDestinationSearchInProgress=!!this.cloudPrintInterface_&&this.cloudPrintInterface_.isCloudDestinationSearchInProgress;return isCloudDestinationSearchInProgress}addWebUIEventListeners_(listenerTracker){listenerTracker.add("printers-added",this.onPrintersAdded_.bind(this));listenerTracker.add("reload-printer-list",this.onDestinationsReload.bind(this))}isDestinationValid(destination){return!!destination&&!!destination.id&&!!destination.origin}init(isInAppKioskMode,systemDefaultDestinationId,serializedDefaultDestinationSelectionRulesStr,recentDestinations){this.pdfPrinterEnabled_=!isInAppKioskMode;this.systemDefaultDestinationId_=systemDefaultDestinationId;this.createLocalPdfPrintDestination_();const isRecentDestinationValid=recentDestinations.length>0&&this.isDestinationValid(recentDestinations[0]);if(!isRecentDestinationValid){const destinationMatch=this.convertToDestinationMatch_(serializedDefaultDestinationSelectionRulesStr);if(destinationMatch){this.fetchMatchingDestination_(destinationMatch);return}}if(this.systemDefaultDestinationId_.length==0&&!isRecentDestinationValid){this.selectPdfDestination_();return}this.recentDestinations_=recentDestinations;let origin=null;let id="";let account="";let name="";let capabilities=null;let extensionId="";let extensionName="";let foundDestination=false;for(let destination of recentDestinations){origin=destination.origin;id=destination.id;account=destination.account||"";name=destination.displayName||"";capabilities=destination.capabilities;extensionId=destination.extensionId||"";extensionName=destination.extensionName||"";const candidate=this.destinationMap_[this.getDestinationKey_(origin,id,account)];if(candidate!=null){candidate.isRecent=true;if(!foundDestination&&!this.useSystemDefaultAsDefault_)this.selectDestination(candidate);foundDestination=true}else if(!foundDestination&&!this.useSystemDefaultAsDefault_){foundDestination=this.fetchPreselectedDestination_(origin,id,account,name,capabilities,extensionId,extensionName)}}if(foundDestination&&!this.useSystemDefaultAsDefault_)return;id=this.systemDefaultDestinationId_;origin=id==print_preview.Destination.GooglePromotedId.SAVE_AS_PDF?print_preview.DestinationOrigin.LOCAL:this.platformOrigin_;account="";const systemDefaultCandidate=this.destinationMap_[this.getDestinationKey_(origin,id,account)];if(systemDefaultCandidate!=null){this.selectDestination(systemDefaultCandidate);return}if(this.fetchPreselectedDestination_(origin,id,account,name,capabilities,extensionId,extensionName)){return}this.selectPdfDestination_()}fetchPreselectedDestination_(origin,id,account,name,capabilities,extensionId,extensionName){this.autoSelectMatchingDestination_=this.createExactDestinationMatch_(origin,id);const type=print_preview.originToType(origin);if(type==print_preview.PrinterType.LOCAL_PRINTER){this.nativeLayer_.getPrinterCapabilities(id,type).then(this.onCapabilitiesSet_.bind(this,origin,id),this.onGetCapabilitiesFail_.bind(this,origin,id));return true}if(this.cloudPrintInterface_&&(origin==print_preview.DestinationOrigin.COOKIES||origin==print_preview.DestinationOrigin.DEVICE)){this.cloudPrintInterface_.printer(id,origin,account);return true}if(origin==print_preview.DestinationOrigin.PRIVET||origin==print_preview.DestinationOrigin.EXTENSION){this.startLoadDestinations(type);const params=origin===print_preview.DestinationOrigin.PRIVET?{}:{description:"",extensionId:extensionId,extensionName:extensionName,provisionalType:print_preview.DestinationProvisionalType.NONE};this.selectedDestination_=new print_preview.Destination(id,print_preview.DestinationType.LOCAL,origin,name,false,print_preview.DestinationConnectionStatus.ONLINE,params);if(capabilities){this.selectedDestination_.capabilities=capabilities;cr.dispatchSimpleEvent(this,DestinationStore.EventType.CACHED_SELECTED_DESTINATION_INFO_READY)}return true}return false}fetchMatchingDestination_(destinationMatch){this.autoSelectMatchingDestination_=destinationMatch;const types=destinationMatch.getTypes();types.forEach(type=>{if(type!=null){this.startLoadDestinations(type)}else if(destinationMatch.matchOrigin(print_preview.DestinationOrigin.COOKIES)||destinationMatch.matchOrigin(print_preview.DestinationOrigin.DEVICE)){this.startLoadCloudDestinations()}})}convertToDestinationMatch_(serializedDefaultDestinationSelectionRulesStr){let matchRules=null;try{if(serializedDefaultDestinationSelectionRulesStr){matchRules=JSON.parse(serializedDefaultDestinationSelectionRulesStr)}}catch(e){console.error("Failed to parse defaultDestinationSelectionRules: "+e)}if(!matchRules)return null;const isLocal=!matchRules.kind||matchRules.kind=="local";const isCloud=!matchRules.kind||matchRules.kind=="cloud";if(!isLocal&&!isCloud){console.error('Unsupported type: "'+matchRules.kind+'"');return null}const origins=[];if(isLocal){origins.push(print_preview.DestinationOrigin.LOCAL);origins.push(print_preview.DestinationOrigin.PRIVET);origins.push(print_preview.DestinationOrigin.EXTENSION);origins.push(print_preview.DestinationOrigin.CROS)}if(isCloud){origins.push(print_preview.DestinationOrigin.COOKIES);origins.push(print_preview.DestinationOrigin.DEVICE)}let idRegExp=null;try{if(matchRules.idPattern){idRegExp=new RegExp(matchRules.idPattern||".*")}}catch(e){console.error('Failed to parse regexp for "id": '+e)}let displayNameRegExp=null;try{if(matchRules.namePattern){displayNameRegExp=new RegExp(matchRules.namePattern||".*")}}catch(e){console.error('Failed to parse regexp for "name": '+e)}return new print_preview.DestinationMatch(origins,idRegExp,displayNameRegExp,true)}convertPreselectedToDestinationMatch_(){if(this.isDestinationValid(this.selectedDestination_)){return this.createExactDestinationMatch_(this.selectedDestination_.origin,this.selectedDestination_.id)}if(this.systemDefaultDestinationId_.length>0){return this.createExactDestinationMatch_(this.platformOrigin_,this.systemDefaultDestinationId_)}return null}createExactDestinationMatch_(origin,id){return new print_preview.DestinationMatch([origin],new RegExp("^"+id.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"$"),null,false)}setCloudPrintInterface(cloudPrintInterface){assert(this.cloudPrintInterface_==null);this.cloudPrintInterface_=cloudPrintInterface;this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.SEARCH_DONE,this.onCloudPrintSearchDone_.bind(this));this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.SEARCH_FAILED,this.onCloudPrintSearchDone_.bind(this));this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.PRINTER_DONE,this.onCloudPrintPrinterDone_.bind(this));this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.PRINTER_FAILED,this.onCloudPrintPrinterFailed_.bind(this));this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.PROCESS_INVITE_DONE,this.onCloudPrintProcessInviteDone_.bind(this))}selectDestination(destination){this.autoSelectMatchingDestination_=null;if(this.autoSelectTimeout_){clearTimeout(this.autoSelectTimeout_);this.autoSelectTimeout_=null}else if(destination==this.selectedDestination_){return}if(destination==null){this.selectedDestination_=null;cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATION_SELECT);return}assert(!destination.isProvisional,"Unable to select provisonal destinations");this.selectedDestination_=destination;this.selectedDestination_.isRecent=true;if(destination.cloudID&&this.destinations_.some(function(otherDestination){return otherDestination.cloudID==destination.cloudID&&otherDestination!=destination})){this.metrics_.record(destination.isPrivet?print_preview.Metrics.DestinationSearchBucket.PRIVET_DUPLICATE_SELECTED:print_preview.Metrics.DestinationSearchBucket.CLOUD_DUPLICATE_SELECTED)}cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATION_SELECT);if(destination.capabilities==null){const type=print_preview.originToType(destination.origin);if(type!==null){this.nativeLayer_.getPrinterCapabilities(destination.id,type).then(caps=>this.onCapabilitiesSet_(destination.origin,destination.id,caps),()=>this.onGetCapabilitiesFail_(destination.origin,destination.id))}else{assert(this.cloudPrintInterface_!=null,"Cloud destination selected, but GCP is not enabled");this.cloudPrintInterface_.printer(destination.id,destination.origin,destination.account)}}else{this.sendSelectedDestinationUpdateEvent_()}}resolveCrosDestination(destination){assert(destination.origin==print_preview.DestinationOrigin.CROS);return this.nativeLayer_.setupPrinter(destination.id)}resolveProvisionalDestination(destination){assert(destination.provisionalType==print_preview.DestinationProvisionalType.NEEDS_USB_PERMISSION,"Provisional type cannot be resolved.");return this.nativeLayer_.grantExtensionPrinterAccess(destination.id).then(destinationInfo=>{this.removeProvisionalDestination_(destination.id);const parsedDestination=print_preview.parseExtensionDestination(destinationInfo);this.insertIntoStore_(parsedDestination);this.dispatchProvisionalDestinationResolvedEvent_(destination.id,parsedDestination);return parsedDestination},()=>{this.removeProvisionalDestination_(destination.id);this.dispatchProvisionalDestinationResolvedEvent_(destination.id,null);return null})}selectPdfDestination_(){const saveToPdfKey=this.getDestinationKey_(print_preview.DestinationOrigin.LOCAL,print_preview.Destination.GooglePromotedId.SAVE_AS_PDF,"");this.selectDestination(this.destinationMap_[saveToPdfKey]||this.destinations_[0]||null)}selectDefaultDestination_(){if(this.systemDefaultDestinationId_.length>0){if(this.autoSelectMatchingDestination_&&!this.autoSelectMatchingDestination_.matchIdAndOrigin(this.systemDefaultDestinationId_,this.platformOrigin_)){if(this.fetchPreselectedDestination_(this.platformOrigin_,this.systemDefaultDestinationId_,"","",null,"","")){return}}}this.selectPdfDestination_()}startLoadDestinations(type){if(this.destinationSearchStatus_.get(type)===print_preview.DestinationStorePrinterSearchStatus.DONE){return}this.destinationSearchStatus_.set(type,print_preview.DestinationStorePrinterSearchStatus.SEARCHING);this.nativeLayer_.getPrinters(type).then(this.onDestinationSearchDone_.bind(this,type),()=>{assert(type===print_preview.PrinterType.PRIVET_PRINTER);this.destinationSearchStatus_.set(type,print_preview.DestinationStorePrinterSearchStatus.DONE)});cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATION_SEARCH_STARTED)}startLoadCloudDestinations(opt_origin){if(this.cloudPrintInterface_!=null){const origins=this.loadedCloudOrigins_[this.userInfo_.activeUser]||[];if(origins.length==0||opt_origin&&origins.indexOf(opt_origin)<0){this.cloudPrintInterface_.search(this.userInfo_.activeUser,opt_origin);cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATION_SEARCH_STARTED)}}}reloadUserCookieBasedDestinations(){const origins=this.loadedCloudOrigins_[this.userInfo_.activeUser]||[];if(origins.indexOf(print_preview.DestinationOrigin.COOKIES)>=0){cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATION_SEARCH_DONE)}else{this.startLoadCloudDestinations(print_preview.DestinationOrigin.COOKIES)}}startLoadAllDestinations(){this.startLoadCloudDestinations();for(const printerType of Object.values(print_preview.PrinterType)){if(printerType!==print_preview.PrinterType.PDF_PRINTER)this.startLoadDestinations(printerType)}}waitForRegister(id){const privetType=print_preview.PrinterType.PRIVET_PRINTER;this.nativeLayer_.getPrinters(privetType).then(this.onDestinationSearchDone_.bind(this,privetType));this.waitForRegisterDestination_=id}removeProvisionalDestination_(provisionalId){this.destinations_=this.destinations_.filter(function(el){if(el.id==provisionalId){delete this.destinationMap_[this.getKey_(el)];return false}return true},this)}dispatchProvisionalDestinationResolvedEvent_(provisionalId,destination){const event=new Event(DestinationStore.EventType.PROVISIONAL_DESTINATION_RESOLVED);event.provisionalId=provisionalId;event.destination=destination;this.dispatchEvent(event)}insertDestination_(destination){if(this.insertIntoStore_(destination)){this.destinationsInserted_(destination)}}insertDestinations_(destinations){let inserted=false;destinations.forEach(destination=>{if(Array.isArray(destination)){inserted=destination.reduce(function(soFar,d){return this.insertIntoStore_(d)||soFar},inserted)}else{inserted=this.insertIntoStore_(destination)||inserted}});if(inserted){this.destinationsInserted_()}}destinationsInserted_(opt_destination){cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATIONS_INSERTED);if(this.autoSelectMatchingDestination_){const destinationsToSearch=opt_destination&&[opt_destination]||this.destinations_;destinationsToSearch.some(function(destination){if(this.autoSelectMatchingDestination_.match(destination)){this.selectDestination(destination);return true}},this)}}sendSelectedDestinationUpdateEvent_(){cr.dispatchSimpleEvent(this,this.selectedDestination_.shouldShowInvalidCertificateError?DestinationStore.EventType.SELECTED_DESTINATION_UNSUPPORTED:DestinationStore.EventType.SELECTED_DESTINATION_CAPABILITIES_READY)}updateDestination_(destination){assert(destination.constructor!==Array,"Single printer expected");destination.capabilities=localizeCapabilities(assert(destination.capabilities));if(print_preview.originToType(destination.origin)!==print_preview.PrinterType.LOCAL_PRINTER){destination.capabilities=sortMediaSizes(destination.capabilities)}const existingDestination=this.destinationMap_[this.getKey_(destination)];if(existingDestination!=null){existingDestination.capabilities=destination.capabilities}else{this.insertDestination_(destination)}if(this.selectedDestination_&&(existingDestination==this.selectedDestination_||destination==this.selectedDestination_)){this.sendSelectedDestinationUpdateEvent_()}}endExtensionPrinterSearch_(){if(this.autoSelectMatchingDestination_&&this.autoSelectMatchingDestination_.matchOrigin(print_preview.DestinationOrigin.EXTENSION)&&this.selectedDestination_&&this.selectedDestination_.isExtension){this.selectDefaultDestination_()}}insertIntoStore_(destination){const key=this.getKey_(destination);const existingDestination=this.destinationMap_[key];if(existingDestination==null){destination.isRecent=destination.isRecent||this.recentDestinations_.some(function(recent){return destination.id==recent.id&&destination.origin==recent.origin},this);this.destinations_.push(destination);this.destinationMap_[key]=destination;return true}if(existingDestination.connectionStatus==print_preview.DestinationConnectionStatus.UNKNOWN&&destination.connectionStatus!=print_preview.DestinationConnectionStatus.UNKNOWN){existingDestination.connectionStatus=destination.connectionStatus;return true}return false}createLocalPdfPrintDestination_(){if(this.pdfPrinterEnabled_){this.insertDestination_(new print_preview.Destination(print_preview.Destination.GooglePromotedId.SAVE_AS_PDF,print_preview.DestinationType.LOCAL,print_preview.DestinationOrigin.LOCAL,loadTimeData.getString("printToPDF"),false,print_preview.DestinationConnectionStatus.ONLINE))}}reset_(){this.destinations_=[];this.destinationMap_={};this.selectDestination(null);this.loadedCloudOrigins_={};for(const printerType of Object.values(print_preview.PrinterType)){if(printerType!==print_preview.PrinterType.PDF_PRINTER){this.destinationSearchStatus_.set(printerType,print_preview.DestinationStorePrinterSearchStatus.START)}}clearTimeout(this.autoSelectTimeout_);this.autoSelectTimeout_=setTimeout(this.selectDefaultDestination_.bind(this),DestinationStore.AUTO_SELECT_TIMEOUT_)}onDestinationSearchDone_(type){this.destinationSearchStatus_.set(type,print_preview.DestinationStorePrinterSearchStatus.DONE);cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATION_SEARCH_DONE);if(type===print_preview.PrinterType.EXTENSION_PRINTER)this.endExtensionPrinterSearch_()}onCapabilitiesSet_(origin,id,settingsInfo){let dest=null;if(origin!==print_preview.DestinationOrigin.PRIVET){const key=this.getDestinationKey_(origin,id,"");dest=this.destinationMap_[key]}if(!dest){if(!settingsInfo.printer){assert(origin===print_preview.DestinationOrigin.EXTENSION);return}dest=print_preview.parseDestination(print_preview.originToType(origin),assert(settingsInfo.printer))}if(dest){if((origin===print_preview.DestinationOrigin.LOCAL||origin===print_preview.DestinationOrigin.CROS)&&dest.capabilities){return}const updateDestination=destination=>{destination.capabilities=settingsInfo.capabilities;this.updateDestination_(destination)};if(Array.isArray(dest)){dest.forEach(updateDestination)}else{updateDestination(dest)}}}onGetCapabilitiesFail_(origin,destinationId){console.warn("Failed to get print capabilities for printer "+destinationId);if(this.selectedDestination_&&this.selectedDestination_.id==destinationId){const event=new Event(DestinationStore.EventType.SELECTED_DESTINATION_INVALID);event.destinationId=destinationId;this.dispatchEvent(event)}if(this.autoSelectMatchingDestination_&&this.autoSelectMatchingDestination_.matchIdAndOrigin(destinationId,origin)){this.selectDefaultDestination_()}}onCloudPrintSearchDone_(event){if(event.printers){this.insertDestinations_(event.printers)}if(event.searchDone){const origins=this.loadedCloudOrigins_[event.user]||[];if(origins.indexOf(event.origin)<0){this.loadedCloudOrigins_[event.user]=origins.concat([event.origin])}}cr.dispatchSimpleEvent(this,DestinationStore.EventType.DESTINATION_SEARCH_DONE)}onCloudPrintPrinterDone_(event){this.updateDestination_(event.printer)}onCloudPrintPrinterFailed_(event){if(this.autoSelectMatchingDestination_&&this.autoSelectMatchingDestination_.matchIdAndOrigin(event.destinationId,event.destinationOrigin)){console.error("Failed to fetch last used printer caps: "+event.destinationId);this.selectDefaultDestination_()}}onCloudPrintProcessInviteDone_(event){if(event.accept&&event.printer){event.printer.isRecent=true;this.insertDestination_(event.printer)}}onPrintersAdded_(type,printers){if(type==print_preview.PrinterType.PRIVET_PRINTER){const printer=printers[0];if(printer.serviceName==this.waitForRegisterDestination_&&!printer.isUnregistered){this.waitForRegisterDestination_=null;this.onDestinationsReload();return}}this.insertDestinations_(printers.map(printer=>print_preview.parseDestination(type,printer)))}onDestinationsReload(){this.reset_();this.autoSelectMatchingDestination_=this.convertPreselectedToDestinationMatch_();this.createLocalPdfPrintDestination_();this.startLoadAllDestinations()}getDestinationKey_(origin,id,account){return origin+"/"+id+"/"+account}getKey_(destination){return this.getDestinationKey_(destination.origin,destination.id,destination.account)}}DestinationStore.EventType={DESTINATION_SEARCH_DONE:"print_preview.DestinationStore.DESTINATION_SEARCH_DONE",DESTINATION_SEARCH_STARTED:"print_preview.DestinationStore.DESTINATION_SEARCH_STARTED",DESTINATION_SELECT:"print_preview.DestinationStore.DESTINATION_SELECT",DESTINATIONS_INSERTED:"print_preview.DestinationStore.DESTINATIONS_INSERTED",PROVISIONAL_DESTINATION_RESOLVED:"print_preview.DestinationStore.PROVISIONAL_DESTINATION_RESOLVED",CACHED_SELECTED_DESTINATION_INFO_READY:"print_preview.DestinationStore.CACHED_SELECTED_DESTINATION_INFO_READY",SELECTED_DESTINATION_CAPABILITIES_READY:"print_preview.DestinationStore"+".SELECTED_DESTINATION_CAPABILITIES_READY",SELECTED_DESTINATION_INVALID:"print_preview.DestinationStore.SELECTED_DESTINATION_INVALID",SELECTED_DESTINATION_UNSUPPORTED:"print_preview.DestinationStore.SELECTED_DESTINATION_UNSUPPORTED"};DestinationStore.AUTO_SELECT_TIMEOUT_=15e3;DestinationStore.EXTENSION_SEARCH_DURATION_=5e3;DestinationStore.MEDIA_DISPLAY_NAMES_={ISO_2A0:"2A0",ISO_A0:"A0",ISO_A0X3:"A0x3",ISO_A1:"A1",ISO_A10:"A10",ISO_A1X3:"A1x3",ISO_A1X4:"A1x4",ISO_A2:"A2",ISO_A2X3:"A2x3",ISO_A2X4:"A2x4",ISO_A2X5:"A2x5",ISO_A3:"A3",ISO_A3X3:"A3x3",ISO_A3X4:"A3x4",ISO_A3X5:"A3x5",ISO_A3X6:"A3x6",ISO_A3X7:"A3x7",ISO_A3_EXTRA:"A3 Extra",ISO_A4:"A4",ISO_A4X3:"A4x3",ISO_A4X4:"A4x4",ISO_A4X5:"A4x5",ISO_A4X6:"A4x6",ISO_A4X7:"A4x7",ISO_A4X8:"A4x8",ISO_A4X9:"A4x9",ISO_A4_EXTRA:"A4 Extra",ISO_A4_TAB:"A4 Tab",ISO_A5:"A5",ISO_A5_EXTRA:"A5 Extra",ISO_A6:"A6",ISO_A7:"A7",ISO_A8:"A8",ISO_A9:"A9",ISO_B0:"B0",ISO_B1:"B1",ISO_B10:"B10",ISO_B2:"B2",ISO_B3:"B3",ISO_B4:"B4",ISO_B5:"B5",ISO_B5_EXTRA:"B5 Extra",ISO_B6:"B6",ISO_B6C4:"B6C4",ISO_B7:"B7",ISO_B8:"B8",ISO_B9:"B9",ISO_C0:"C0",ISO_C1:"C1",ISO_C10:"C10",ISO_C2:"C2",ISO_C3:"C3",ISO_C4:"C4",ISO_C5:"C5",ISO_C6:"C6",ISO_C6C5:"C6C5",ISO_C7:"C7",ISO_C7C6:"C7C6",ISO_C8:"C8",ISO_C9:"C9",ISO_DL:"Envelope DL",ISO_RA0:"RA0",ISO_RA1:"RA1",ISO_RA2:"RA2",ISO_SRA0:"SRA0",ISO_SRA1:"SRA1",ISO_SRA2:"SRA2",JIS_B0:"B0 (JIS)",JIS_B1:"B1 (JIS)",JIS_B10:"B10 (JIS)",JIS_B2:"B2 (JIS)",JIS_B3:"B3 (JIS)",JIS_B4:"B4 (JIS)",JIS_B5:"B5 (JIS)",JIS_B6:"B6 (JIS)",JIS_B7:"B7 (JIS)",JIS_B8:"B8 (JIS)",JIS_B9:"B9 (JIS)",JIS_EXEC:"Executive (JIS)",JPN_CHOU2:"Choukei 2",JPN_CHOU3:"Choukei 3",JPN_CHOU4:"Choukei 4",JPN_HAGAKI:"Hagaki",JPN_KAHU:"Kahu Envelope",JPN_KAKU2:"Kaku 2",JPN_OUFUKU:"Oufuku Hagaki",JPN_YOU4:"You 4",NA_10X11:"10x11",NA_10X13:"10x13",NA_10X14:"10x14",NA_10X15:"10x15",NA_11X12:"11x12",NA_11X15:"11x15",NA_12X19:"12x19",NA_5X7:"5x7",NA_6X9:"6x9",NA_7X9:"7x9",NA_9X11:"9x11",NA_A2:"A2",NA_ARCH_A:"Arch A",NA_ARCH_B:"Arch B",NA_ARCH_C:"Arch C",NA_ARCH_D:"Arch D",NA_ARCH_E:"Arch E",NA_ASME_F:"ASME F",NA_B_PLUS:"B-plus",NA_C:"C",NA_C5:"C5",NA_D:"D",NA_E:"E",NA_EDP:"EDP",NA_EUR_EDP:"European EDP",NA_EXECUTIVE:"Executive",NA_F:"F",NA_FANFOLD_EUR:"FanFold European",NA_FANFOLD_US:"FanFold US",NA_FOOLSCAP:"FanFold German Legal",NA_GOVT_LEGAL:"Government Legal",NA_GOVT_LETTER:"Government Letter",NA_INDEX_3X5:"Index 3x5",NA_INDEX_4X6:"Index 4x6",NA_INDEX_4X6_EXT:"Index 4x6 ext",NA_INDEX_5X8:"5x8",NA_INVOICE:"Invoice",NA_LEDGER:"Tabloid",NA_LEGAL:"Legal",NA_LEGAL_EXTRA:"Legal extra",NA_LETTER:"Letter",NA_LETTER_EXTRA:"Letter extra",NA_LETTER_PLUS:"Letter plus",NA_MONARCH:"Monarch",NA_NUMBER_10:"Envelope #10",NA_NUMBER_11:"Envelope #11",NA_NUMBER_12:"Envelope #12",NA_NUMBER_14:"Envelope #14",NA_NUMBER_9:"Envelope #9",NA_PERSONAL:"Personal",NA_QUARTO:"Quarto",NA_SUPER_A:"Super A",NA_SUPER_B:"Super B",NA_WIDE_FORMAT:"Wide format",OM_DAI_PA_KAI:"Dai-pa-kai",OM_FOLIO:"Folio",OM_FOLIO_SP:"Folio SP",OM_INVITE:"Invite Envelope",OM_ITALIAN:"Italian Envelope",OM_JUURO_KU_KAI:"Juuro-ku-kai",OM_LARGE_PHOTO:"Large photo",OM_OFICIO:"Oficio",OM_PA_KAI:"Pa-kai",OM_POSTFIX:"Postfix Envelope",OM_SMALL_PHOTO:"Small photo",PRC_1:"prc1 Envelope",PRC_10:"prc10 Envelope",PRC_16K:"prc 16k",PRC_2:"prc2 Envelope",PRC_3:"prc3 Envelope",PRC_32K:"prc 32k",PRC_4:"prc4 Envelope",PRC_5:"prc5 Envelope",PRC_6:"prc6 Envelope",PRC_7:"prc7 Envelope",PRC_8:"prc8 Envelope",ROC_16K:"ROC 16K",ROC_8K:"ROC 8k"};return{DestinationStore:DestinationStore}});
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview");print_preview.InvitationStoreLoadStatus={IN_PROGRESS:1,DONE:2,FAILED:3};cr.define("print_preview",function(){"use strict";class InvitationStore extends cr.EventTarget{constructor(userInfo){super();this.userInfo_=userInfo;this.invitations_={};this.loadStatus_={};this.tracker_=new EventTracker;this.cloudPrintInterface_=null;this.invitationInProgress_=null}get invitationInProgress(){return this.invitationInProgress_}invitations(account){return this.invitations_[account]||[]}setCloudPrintInterface(cloudPrintInterface){assert(this.cloudPrintInterface_==null);this.cloudPrintInterface_=cloudPrintInterface;this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.INVITES_DONE,this.onCloudPrintInvitesDone_.bind(this));this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.INVITES_FAILED,this.onCloudPrintInvitesDone_.bind(this));this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.PROCESS_INVITE_DONE,this.onCloudPrintProcessInviteDone_.bind(this));this.tracker_.add(this.cloudPrintInterface_,cloudprint.CloudPrintInterfaceEventType.PROCESS_INVITE_FAILED,this.onCloudPrintProcessInviteFailed_.bind(this))}startLoadingInvitations(){if(!this.cloudPrintInterface_)return;if(!this.userInfo_.activeUser)return;if(this.loadStatus_.hasOwnProperty(this.userInfo_.activeUser)){if(this.loadStatus_[this.userInfo_.activeUser]==print_preview.InvitationStoreLoadStatus.DONE){cr.dispatchSimpleEvent(this,InvitationStore.EventType.INVITATION_SEARCH_DONE)}return}this.loadStatus_[this.userInfo_.activeUser]=print_preview.InvitationStoreLoadStatus.IN_PROGRESS;this.cloudPrintInterface_.invites(this.userInfo_.activeUser)}processInvitation(invitation,accept){if(this.invitationInProgress_)return;this.invitationInProgress_=invitation;this.cloudPrintInterface_.processInvite(invitation,accept)}invitationProcessed_(invitation){if(this.invitations_.hasOwnProperty(invitation.account)){this.invitations_[invitation.account]=this.invitations_[invitation.account].filter(function(i){return i!=invitation})}if(this.invitationInProgress_==invitation)this.invitationInProgress_=null}onCloudPrintInvitesDone_(event){this.loadStatus_[event.user]=print_preview.InvitationStoreLoadStatus.DONE;this.invitations_[event.user]=event.invitations;cr.dispatchSimpleEvent(this,InvitationStore.EventType.INVITATION_SEARCH_DONE)}onCloudPrintInvitesFailed_(event){this.loadStatus_[event.user]=print_preview.InvitationStoreLoadStatus.FAILED}onCloudPrintProcessInviteDone_(event){this.invitationProcessed_(event.invitation);cr.dispatchSimpleEvent(this,InvitationStore.EventType.INVITATION_PROCESSED)}onCloudPrintProcessInviteFailed_(event){this.invitationProcessed_(event.invitation);cr.dispatchSimpleEvent(this,InvitationStore.EventType.INVITATION_PROCESSED)}}InvitationStore.EventType={INVITATION_PROCESSED:"print_preview.InvitationStore.INVITATION_PROCESSED",INVITATION_SEARCH_DONE:"print_preview.InvitationStore.INVITATION_SEARCH_DONE"};return{InvitationStore:InvitationStore}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.Setting;print_preview_new.Settings;const SettingsBehavior={properties:{settings:{type:Object,notify:true}},getSetting:function(settingName){const setting=this.get(settingName,this.settings);assert(!!setting,"Setting is missing: "+settingName);return setting},getSettingValue:function(settingName){const setting=this.getSetting(settingName);return setting.available?setting.value:setting.unavailableValue},setSetting:function(settingName,value){const setting=this.getSetting(settingName);this.set(`settings.${settingName}.value`,value)},setSettingValid:function(settingName,valid){const setting=this.getSetting(settingName);if(!valid)assert(setting.available,"Setting is not available: "+settingName);const shouldFireEvent=valid!=setting.valid;this.set(`settings.${settingName}.valid`,valid);if(shouldFireEvent)this.fire("setting-valid-changed",valid)}};
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.State={NOT_READY:0,READY:1,HIDDEN:2,PRINTING:3,SYSTEM_DIALOG:4,INVALID_TICKET:5,INVALID_PRINTER:6,FATAL_ERROR:7,CLOSING:8};Polymer({is:"print-preview-state",properties:{state:{type:Number,notify:true,value:print_preview_new.State.NOT_READY}},transitTo:function(newState){switch(newState){case print_preview_new.State.NOT_READY:assert(this.state==print_preview_new.State.NOT_READY||this.state==print_preview_new.State.READY||this.state==print_preview_new.State.INVALID_PRINTER);break;case print_preview_new.State.READY:assert(this.state==print_preview_new.State.INVALID_TICKET||this.state==print_preview_new.State.NOT_READY||this.state==print_preview_new.State.PRINTING);break;case print_preview_new.State.HIDDEN:assert(this.state==print_preview_new.State.READY);break;case print_preview_new.State.PRINTING:assert(this.state==print_preview_new.State.READY||this.state==print_preview_new.State.HIDDEN);break;case print_preview_new.State.SYSTEM_DIALOG:assert(this.state!=print_preview_new.State.HIDDEN&&this.state!=print_preview_new.State.PRINTING&&this.state!=print_preview_new.State.CLOSING);break;case print_preview_new.State.INVALID_TICKET:assert(this.state==print_preview_new.State.READY);break;case print_preview_new.State.INVALID_PRINTER:assert(this.state==print_preview_new.State.INVALID_PRINTER||this.state==print_preview_new.State.NOT_READY||this.state==print_preview_new.State.READY);break;case print_preview_new.State.CLOSING:assert(this.state!=print_preview_new.State.HIDDEN);break}this.state=newState}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.SerializedSettings;print_preview_new.DuplexMode={SIMPLEX:0,LONG_EDGE:1,UNKNOWN_DUPLEX_MODE:-1};(function(){"use strict";const NUM_DESTINATIONS=3;const STICKY_SETTING_NAMES=["collate","color","cssBackground","customMargins","dpi","duplex","headerFooter","layout","margins","mediaSize","scaling","fitToPage","vendorItems"];const MINIMUM_HEIGHT_MICRONS=25400;Polymer({is:"print-preview-model",behaviors:[SettingsBehavior],properties:{settings:{type:Object,notify:true,value:function(){return{pages:{value:[1],unavailableValue:[],valid:true,available:true,key:""},copies:{value:"1",unavailableValue:"1",valid:true,available:true,key:""},collate:{value:true,unavailableValue:false,valid:true,available:true,key:"isCollateEnabled"},layout:{value:false,unavailableValue:false,valid:true,available:true,key:"isLandscapeEnabled"},color:{value:true,unavailableValue:false,valid:true,available:true,key:"isColorEnabled"},mediaSize:{value:{width_microns:215900,height_microns:279400},unavailableValue:{},valid:true,available:true,key:"mediaSize"},margins:{value:print_preview.ticket_items.MarginsTypeValue.DEFAULT,unavailableValue:print_preview.ticket_items.MarginsTypeValue.DEFAULT,valid:true,available:true,key:"marginsType"},customMargins:{value:{marginTop:0,marginRight:0,marginBottom:0,marginLeft:0},unavailableValue:{},valid:true,available:true,key:"customMargins"},dpi:{value:{},unavailableValue:{},valid:true,available:true,key:"dpi"},fitToPage:{value:false,unavailableValue:false,valid:true,available:true,key:"isFitToPageEnabled"},scaling:{value:"100",unavailableValue:"100",valid:true,available:true,key:"scaling"},duplex:{value:true,unavailableValue:false,valid:true,available:true,key:"isDuplexEnabled"},cssBackground:{value:false,unavailableValue:false,valid:true,available:true,key:"isCssBackgroundEnabled"},selectionOnly:{value:false,unavailableValue:false,valid:true,available:true,key:""},headerFooter:{value:true,unavailableValue:false,valid:true,available:true,key:"isHeaderFooterEnabled"},rasterize:{value:false,unavailableValue:false,valid:true,available:true,key:""},vendorItems:{value:{},unavailableValue:{},valid:true,available:true,key:"vendorOptions"},pagesPerSheet:{value:1,unavailableValue:1,valid:true,available:true,key:""},otherOptions:{value:null,unavailableValue:null,valid:true,available:true,key:""},ranges:{value:[],unavailableValue:[],valid:true,available:true,key:""}}}},destination:{type:Object,notify:true},recentDestinations:{type:Array,notify:true,value:function(){return[]}},documentInfo:{type:Object,notify:true}},observers:["updateSettingsFromDestination_(destination.capabilities)","updateSettingsAvailabilityFromDocumentInfo_("+"documentInfo.isModifiable, documentInfo.hasCssMediaStyles,"+"documentInfo.hasSelection)","updateHeaderFooterAvailable_("+"documentInfo.margins, settings.margins.value, "+"settings.customMargins.value, settings.mediaSize.value)","updateRecentDestinations_(destination, destination.capabilities)","stickySettingsChanged_("+"settings.collate.value, settings.layout.value, settings.color.value,"+"settings.mediaSize.value, settings.margins.value, "+"settings.customMargins.value, settings.dpi.value, "+"settings.fitToPage.value, settings.scaling.value, "+"settings.duplex.value, settings.headerFooter.value, "+"settings.cssBackground.value, settings.vendorItems.value)"],initialized_:false,stickySettings_:null,lastDestinationCapabilities_:null,updateSettingsFromDestination_:function(){if(!this.destination)return;if(this.destination.capabilities==this.lastDestinationCapabilities_)return;this.lastDestinationCapabilities_=this.destination.capabilities;const caps=!!this.destination.capabilities?this.destination.capabilities.printer:null;this.updateSettingsAvailabilityFromDestination_(caps);if(!caps)return;this.updateSettingsValues_(caps)},updateSettingsAvailabilityFromDestination_:function(caps){this.set("settings.copies.available",!!caps&&!!caps.copies);this.set("settings.collate.available",!!caps&&!!caps.collate);this.set("settings.layout.available",this.isLayoutAvailable_(caps));this.set("settings.color.available",this.destination.hasColorCapability);this.set("settings.dpi.available",!!caps&&!!caps.dpi&&!!caps.dpi.option&&caps.dpi.option.length>1);this.set("settings.duplex.available",!!caps&&!!caps.duplex);this.set("settings.vendorItems.available",!!caps&&!!caps.vendor_capability);if(this.documentInfo)this.updateSettingsAvailabilityFromDestinationAndDocumentInfo_()},updateSettingsAvailabilityFromDestinationAndDocumentInfo_:function(){const knownSizeToSaveAsPdf=this.destination.id==print_preview.Destination.GooglePromotedId.SAVE_AS_PDF&&(!this.documentInfo.isModifiable||this.documentInfo.hasCssMediaStyles);this.set("settings.fitToPage.available",!knownSizeToSaveAsPdf&&!this.documentInfo.isModifiable);this.set("settings.scaling.available",!knownSizeToSaveAsPdf);const caps=!!this.destination&&!!this.destination.capabilities?this.destination.capabilities.printer:null;this.set("settings.mediaSize.available",!!caps&&!!caps.media_size&&!knownSizeToSaveAsPdf);this.set("settings.layout.available",this.isLayoutAvailable_(caps));this.set("settings.otherOptions.available",this.settings.duplex.available||this.settings.cssBackground.available||this.settings.selectionOnly.available||this.settings.headerFooter.available||this.settings.rasterize.available)},updateSettingsAvailabilityFromDocumentInfo_:function(){this.set("settings.margins.available",this.documentInfo.isModifiable);this.set("settings.customMargins.available",this.documentInfo.isModifiable);this.set("settings.cssBackground.available",this.documentInfo.isModifiable);this.set("settings.selectionOnly.available",this.documentInfo.isModifiable&&this.documentInfo.hasSelection);this.set("settings.headerFooter.available",this.isHeaderFooterAvailable_());this.set("settings.rasterize.available",!this.documentInfo.isModifiable&&!cr.isWindows&&!cr.isMac);if(this.destination)this.updateSettingsAvailabilityFromDestinationAndDocumentInfo_()},updateHeaderFooterAvailable_:function(){this.set("settings.headerFooter.available",this.isHeaderFooterAvailable_())},isHeaderFooterAvailable_:function(){if(!this.documentInfo.isModifiable)return false;const microns=this.getSettingValue("layout")?this.getSettingValue("mediaSize").width_microns:this.getSettingValue("mediaSize").height_microns;if(microns<MINIMUM_HEIGHT_MICRONS)return false;let available=false;const marginsType=this.getSettingValue("margins");switch(marginsType){case print_preview.ticket_items.MarginsTypeValue.DEFAULT:available=!this.documentInfo.margins||this.documentInfo.margins.get(print_preview.ticket_items.CustomMarginsOrientation.TOP)>0||this.documentInfo.margins.get(print_preview.ticket_items.CustomMarginsOrientation.BOTTOM)>0;break;case print_preview.ticket_items.MarginsTypeValue.NO_MARGINS:break;case print_preview.ticket_items.MarginsTypeValue.MINIMUM:available=true;break;case print_preview.ticket_items.MarginsTypeValue.CUSTOM:const margins=this.getSettingValue("customMargins");available=margins.marginTop>0||margins.marginBottom>0;break;default:break}return available},isLayoutAvailable_:function(caps){if(!caps||!caps.page_orientation||!caps.page_orientation.option||!this.documentInfo.isModifiable||this.documentInfo.hasCssMediaStyles){return false}let hasAutoOrPortraitOption=false;let hasLandscapeOption=false;caps.page_orientation.option.forEach(option=>{hasAutoOrPortraitOption=hasAutoOrPortraitOption||option.type=="AUTO"||option.type=="PORTRAIT";hasLandscapeOption=hasLandscapeOption||option.type=="LANDSCAPE"});return hasLandscapeOption&&hasAutoOrPortraitOption},updateSettingsValues_:function(caps){if(this.settings.mediaSize.available){const defaultOption=caps.media_size.option.find(o=>!!o.is_default);this.set("settings.mediaSize.value",defaultOption)}if(this.settings.dpi.available){const defaultOption=caps.dpi.option.find(o=>!!o.is_default);this.set("settings.dpi.value",defaultOption)}else if(caps&&caps.dpi&&caps.dpi.option&&caps.dpi.option.length>0){this.set("settings.dpi.unavailableValue",caps.dpi.option[0])}if(this.settings.color.available){const defaultOption=this.destination.defaultColorOption;if(defaultOption){this.set("settings.color.value",!["STANDARD_MONOCHROME","CUSTOM_MONOCHROME"].includes(defaultOption.type))}}else if(caps&&caps.color&&caps.color.option&&caps.color.option.length>0){this.set("settings.color.unavailableValue",!["STANDARD_MONOCHROME","CUSTOM_MONOCHROME"].includes(caps.color.option[0].type))}else{this.set("settings.color.unavailableValue",false)}if(this.settings.vendorItems.available){const vendorSettings={};for(const item of caps.vendor_capability){let defaultValue=null;if(item.type=="SELECT"&&!!item.select_cap&&!!item.select_cap.option){const defaultOption=item.select_cap.option.find(o=>!!o.is_default);defaultValue=!!defaultOption?defaultOption.value:null}else if(item.type=="RANGE"){if(!!item.range_cap)defaultValue=item.range_cap.default||null}else if(item.type=="TYPED_VALUE"){if(!!item.typed_value_cap)defaultValue=item.typed_value_cap.default||null}if(defaultValue!=null)vendorSettings[item.id]=defaultValue}this.set("settings.vendorItems.value",vendorSettings)}},updateRecentDestinations_:function(){if(!this.initialized_)return;const newDestination=print_preview.makeRecentDestination(assert(this.destination));let indexFound=this.recentDestinations.findIndex(function(recent){return newDestination.id==recent.id&&newDestination.origin==recent.origin});if(indexFound==0&&this.recentDestinations[0].capabilities==newDestination.capabilities){return}if(indexFound==-1&&this.recentDestinations.length==NUM_DESTINATIONS){indexFound=NUM_DESTINATIONS-1}if(indexFound!=-1)this.recentDestinations.splice(indexFound,1);this.splice("recentDestinations",0,0,newDestination);this.stickySettingsChanged_()},setStickySettings:function(savedSettingsStr){assert(!this.stickySettings_&&this.recentDestinations.length==0);if(!savedSettingsStr)return;let savedSettings;try{savedSettings=JSON.parse(savedSettingsStr)}catch(e){console.error("Unable to parse state "+e);return}if(savedSettings.version!=2)return;let recentDestinations=savedSettings.recentDestinations||[];if(!Array.isArray(recentDestinations)){recentDestinations=[recentDestinations]}this.recentDestinations=recentDestinations;this.stickySettings_=savedSettings},applyStickySettings:function(){if(this.stickySettings_){STICKY_SETTING_NAMES.forEach(settingName=>{const setting=this.get(settingName,this.settings);const value=this.stickySettings_[setting.key];if(value!=undefined)this.set(`settings.${settingName}.value`,value)})}this.initialized_=true;this.stickySettings_=null;this.stickySettingsChanged_()},initialized:function(){return this.initialized_},stickySettingsChanged_:function(){if(!this.initialized_)return;const serialization={version:2,recentDestinations:this.recentDestinations};STICKY_SETTING_NAMES.forEach(settingName=>{const setting=this.get(settingName,this.settings);serialization[assert(setting.key)]=setting.value});this.fire("save-sticky-settings",JSON.stringify(serialization))},createPrintTicket:function(destination,openPdfInPreview,showSystemDialog){const dpi=this.getSettingValue("dpi");const ticket={mediaSize:this.getSettingValue("mediaSize"),pageCount:this.getSettingValue("pages").length,landscape:this.getSettingValue("layout"),color:destination.getNativeColorModel(this.getSettingValue("color")),headerFooterEnabled:false,marginsType:this.getSettingValue("margins"),duplex:this.getSettingValue("duplex")?print_preview_new.DuplexMode.LONG_EDGE:print_preview_new.DuplexMode.SIMPLEX,copies:parseInt(this.getSettingValue("copies"),10),collate:this.getSettingValue("collate"),shouldPrintBackgrounds:this.getSettingValue("cssBackground"),shouldPrintSelectionOnly:false,previewModifiable:this.documentInfo.isModifiable,printToPDF:destination.id==print_preview.Destination.GooglePromotedId.SAVE_AS_PDF,printWithCloudPrint:!destination.isLocal,printWithPrivet:destination.isPrivet,printWithExtension:destination.isExtension,rasterizePDF:this.getSettingValue("rasterize"),scaleFactor:parseInt(this.getSettingValue("scaling"),10),pagesPerSheet:this.getSettingValue("pagesPerSheet"),dpiHorizontal:dpi&&"horizontal_dpi"in dpi?dpi.horizontal_dpi:0,dpiVertical:dpi&&"vertical_dpi"in dpi?dpi.vertical_dpi:0,deviceName:destination.id,fitToPageEnabled:this.getSettingValue("fitToPage"),pageWidth:this.documentInfo.pageSize.width,pageHeight:this.documentInfo.pageSize.height,showSystemDialog:showSystemDialog};if(!destination.isLocal)ticket.cloudPrintID=destination.id;if(this.getSettingValue("margins")==print_preview.ticket_items.MarginsTypeValue.CUSTOM){ticket.marginsCustom=this.getSettingValue("customMargins")}if(destination.isPrivet||destination.isExtension){ticket.ticket=this.createCloudJobTicket(destination);ticket.capabilities=JSON.stringify(destination.capabilities)}if(openPdfInPreview)ticket.OpenPDFInPreview=true;return JSON.stringify(ticket)},createCloudJobTicket:function(destination){assert(!destination.isLocal||destination.isPrivet||destination.isExtension,"Trying to create a Google Cloud Print print ticket for a local "+" non-privet and non-extension destination");assert(destination.capabilities,"Trying to create a Google Cloud Print print ticket for a "+"destination with no print capabilities");const cjt={version:"1.0",print:{}};if(this.settings.collate.available)cjt.print.collate={collate:this.settings.collate.value};if(this.settings.color.available){const selectedOption=destination.getSelectedColorOption(this.settings.color.value);if(!selectedOption){console.error("Could not find correct color option")}else{cjt.print.color={type:selectedOption.type};if(selectedOption.hasOwnProperty("vendor_id")){cjt.print.color.vendor_id=selectedOption.vendor_id}}}else{const defaultOption=destination.defaultColorOption;if(defaultOption){cjt.print.color={type:defaultOption.type};if(defaultOption.hasOwnProperty("vendor_id")){cjt.print.color.vendor_id=defaultOption.vendor_id}}}if(this.settings.copies.available)cjt.print.copies={copies:this.settings.copies.value};if(this.settings.duplex.available){cjt.print.duplex={type:this.settings.duplex.value?"LONG_EDGE":"NO_DUPLEX"}}if(this.settings.mediaSize.available){const mediaValue=this.settings.mediaSize.value;cjt.print.media_size={width_microns:mediaValue.width_microns,height_microns:mediaValue.height_microns,is_continuous_feed:mediaValue.is_continuous_feed,vendor_id:mediaValue.vendor_id}}if(!this.settings.layout.available){const capability=destination.capabilities.printer?destination.capabilities.printer.page_orientation:null;if(capability&&capability.option&&capability.option.some(option=>option.type=="AUTO")){cjt.print.page_orientation={type:"AUTO"}}}else{cjt.print.page_orientation={type:this.settings.layout?"LANDSCAPE":"PORTRAIT"}}if(this.settings.dpi.available){const dpiValue=this.settings.dpi.value;cjt.print.dpi={horizontal_dpi:dpiValue.horizontal_dpi,vertical_dpi:dpiValue.vertical_dpi,vendor_id:dpiValue.vendor_id}}if(this.settings.vendorItems.available){const items=this.settings.vendorItems.value;cjt.print.vendor_ticket_item=[];for(const itemId in items){if(items.hasOwnProperty(itemId)){cjt.print.vendor_ticket_item.push({id:itemId,value:items[itemId]})}}}return JSON.stringify(cjt)}})})();
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new.Header");print_preview_new.Header.LabelInfo;Polymer({is:"print-preview-header",behaviors:[SettingsBehavior],properties:{destination:Object,state:Number,printButtonEnabled_:{type:Boolean,value:false},summary_:{type:String,notify:true,value:null},summaryLabel_:{type:String,notify:true,value:null},errorMessage:String},observers:["update_(settings.copies.value, settings.duplex.value, "+"settings.pages.value, settings.pagesPerSheet.value, state, "+"destination.id)"],onPrintClick_:function(){this.fire("print-requested")},onCancelClick_:function(){this.fire("cancel-requested")},isPdfOrDrive_:function(){return this.destination&&(this.destination.id==print_preview.Destination.GooglePromotedId.SAVE_AS_PDF||this.destination.id==print_preview.Destination.GooglePromotedId.DOCS)},getPrintButton_:function(){return loadTimeData.getString(this.isPdfOrDrive_()?"saveButton":"printButton")},computeLabelInfo_:function(){const saveToPdfOrDrive=this.isPdfOrDrive_();let numPages=this.getSettingValue("pages").length;let numSheets=numPages;if(!saveToPdfOrDrive&&this.getSettingValue("duplex")){numSheets=Math.ceil(numPages/2)}const pagesPerSheet=parseInt(this.getSettingValue("pagesPerSheet"),10);if(!Number.isNaN(pagesPerSheet)){assert(pagesPerSheet>0);numSheets=Math.ceil(numSheets/pagesPerSheet);numPages=Math.ceil(numPages/pagesPerSheet)}const copies=parseInt(this.getSettingValue("copies"),10);numSheets*=copies;numPages*=copies;const pagesLabel=loadTimeData.getString("printPreviewPageLabelPlural");let summaryLabel;if(numSheets>1){summaryLabel=saveToPdfOrDrive?pagesLabel:loadTimeData.getString("printPreviewSheetsLabelPlural")}else{summaryLabel=loadTimeData.getString(saveToPdfOrDrive?"printPreviewPageLabelSingular":"printPreviewSheetsLabelSingular")}return{numPages:numPages,numSheets:numSheets,pagesLabel:pagesLabel,summaryLabel:summaryLabel}},update_:function(){switch(this.state){case print_preview_new.State.PRINTING:this.printButtonEnabled_=false;this.summary_=loadTimeData.getString(this.isPdfOrDrive_()?"saving":"printing");this.summaryLabel_=this.summary_;break;case print_preview_new.State.READY:this.printButtonEnabled_=true;const labelInfo=this.computeLabelInfo_();this.summary_=this.getSummary_(labelInfo);this.summaryLabel_=this.getSummaryLabel_(labelInfo);break;case print_preview_new.State.FATAL_ERROR:this.printButtonEnabled_=false;this.summary_=this.errorMessage;this.summaryLabel_=this.errorMessage;break;default:this.summary_=null;this.summaryLabel_=null;this.printButtonEnabled_=false;break}},getSummary_:function(labelInfo){let html=loadTimeData.getStringF("printPreviewSummaryFormatShort","<b>"+labelInfo.numSheets.toLocaleString()+"</b>","<b>"+labelInfo.summaryLabel+"</b>");html=html.replace(/\s{2,}/g," ");return html},getSummaryLabel_:function(labelInfo){return loadTimeData.getStringF("printPreviewSummaryFormatShort",labelInfo.numSheets.toLocaleString(),labelInfo.summaryLabel)}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var parseHtmlSubset=function(){"use strict";var allowedAttributes={href:function(node,value){return node.tagName=="A"&&(value.startsWith("chrome://")||value.startsWith("https://"))},target:function(node,value){return node.tagName=="A"&&value=="_blank"}};var allowedTags=["A","B","SPAN","STRONG"];function merge(var_args){var clone={};for(var i=0;i<arguments.length;++i){if(typeof arguments[i]=="object"){for(var key in arguments[i]){if(arguments[i].hasOwnProperty(key))clone[key]=arguments[i][key]}}}return clone}function walk(n,f){f(n);for(var i=0;i<n.childNodes.length;i++){walk(n.childNodes[i],f)}}function assertElement(tags,node){if(tags.indexOf(node.tagName)==-1)throw Error(node.tagName+" is not supported")}function assertAttribute(attrs,attrNode,node){var n=attrNode.nodeName;var v=attrNode.nodeValue;if(!attrs.hasOwnProperty(n)||!attrs[n](node,v))throw Error(node.tagName+"["+n+'="'+v+'"] is not supported')}return function(s,opt_extraTags,opt_extraAttrs){var extraTags=(opt_extraTags||[]).map(function(str){return str.toUpperCase()});var tags=allowedTags.concat(extraTags);var attrs=merge(allowedAttributes,opt_extraAttrs||{});var doc=document.implementation.createHTMLDocument("");var r=doc.createRange();r.selectNode(doc.body);var df=r.createContextualFragment(s);walk(df,function(node){switch(node.nodeType){case Node.ELEMENT_NODE:assertElement(tags,node);var nodeAttrs=node.attributes;for(var i=0;i<nodeAttrs.length;++i){assertAttribute(attrs,nodeAttrs[i],node)}break;case Node.COMMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:case Node.TEXT_NODE:break;default:throw Error("Node type "+node.nodeType+" is not supported")}});return df}}();
// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var I18nBehavior={properties:{locale:{type:String,value:""}},i18nRaw_:function(id,var_args){return arguments.length==1?loadTimeData.getString(id):loadTimeData.getStringF.apply(loadTimeData,arguments)},i18n:function(id,var_args){var rawString=this.i18nRaw_.apply(this,arguments);return parseHtmlSubset("<b>"+rawString+"</b>").firstChild.textContent},i18nAdvanced:function(id,opts){opts=opts||{};var args=[id].concat(opts.substitutions||[]);var rawString=this.i18nRaw_.apply(this,args);return loadTimeData.sanitizeInnerHtml(rawString,opts)},i18nDynamic:function(locale,id,var_args){return this.i18n.apply(this,Array.prototype.slice.call(arguments,1))},i18nExists:function(id){return loadTimeData.valueExists(id)},i18nUpdateLocale:function(){this.locale=loadTimeData.getString("language")}};I18nBehavior.Proto;
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var WebUIListenerBehavior={properties:{webUIListeners_:{type:Array,value:function(){return[]}}},addWebUIListener:function(eventName,callback){this.webUIListeners_.push(cr.addWebUIListener(eventName,callback))},detached:function(){while(this.webUIListeners_.length>0){cr.removeWebUIListener(this.webUIListeners_.pop())}}};
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview_new",function(){const InputBehavior={properties:{lastValue_:{type:String,value:""}},timeout_:null,ready:function(){this.getInput().addEventListener("input",this.resetTimeout_.bind(this));this.getInput().addEventListener("keydown",this.onKeyDown_.bind(this))},getInput:function(){},getTimeoutDelayMs_:function(){const delay=parseInt(this.getInput().dataset.timeoutDelay,10);assert(!Number.isNaN(delay));return delay},onKeyDown_:function(event){if(event.code!="Enter")return;this.resetAndUpdate_()},resetTimeout_:function(){if(this.timeout_){clearTimeout(this.timeout_)}this.timeout_=setTimeout(this.onTimeout_.bind(this),this.getTimeoutDelayMs_())},onTimeout_:function(){this.timeout_=null;const value=this.getInput().value;if(this.lastValue_!=value){this.lastValue_=value;this.fire("input-change",value)}},resetString:function(){this.lastValue_=null},resetAndUpdate:function(){if(this.timeout_){clearTimeout(this.timeout_)}this.onTimeout_()}};return{InputBehavior:InputBehavior}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
(function(){"use strict";const RADIUS_PX=9;Polymer({is:"print-preview-margin-control",behaviors:[print_preview_new.InputBehavior],properties:{side:{type:String,reflectToAttribute:true},invalid:{type:Boolean,reflectToAttribute:true},invisible:{type:Boolean,reflectToAttribute:true,observer:"onClipSizeChange_"},positionInPts_:{type:Number,notify:true,value:0},scaleTransform:{type:Number,notify:true},translateTransform:{type:Object,notify:true},pageSize:{type:Object,notify:true},clipSize:{type:Object,notify:true,observer:"onClipSizeChange_"}},observers:["updatePosition_(positionInPts_, scaleTransform, translateTransform, "+"pageSize, side)"],listeners:{"input-change":"onInputChange_"},getInput:function(){return this.$.textbox},setTextboxValue:function(value){const textbox=this.$.textbox;if(textbox.value!=value)textbox.value=value},getPositionInPts:function(){return this.positionInPts_},setPositionInPts:function(position){this.positionInPts_=position},getAriaHidden_:function(){return this.invisible.toString()},convertPixelsToPts:function(pixels){let pts;const orientationEnum=print_preview.ticket_items.CustomMarginsOrientation;if(this.side==orientationEnum.TOP){pts=pixels-this.translateTransform.y+RADIUS_PX;pts/=this.scaleTransform}else if(this.side==orientationEnum.RIGHT){pts=pixels-this.translateTransform.x+RADIUS_PX;pts/=this.scaleTransform;pts=this.pageSize.width-pts}else if(this.side==orientationEnum.BOTTOM){pts=pixels-this.translateTransform.y+RADIUS_PX;pts/=this.scaleTransform;pts=this.pageSize.height-pts}else{assert(this.side==orientationEnum.LEFT);pts=pixels-this.translateTransform.x+RADIUS_PX;pts/=this.scaleTransform}return pts},shouldDrag:function(event){return!this.$.textbox.disabled&&event.button==0&&(event.path[0]==this||event.path[0]==this.$.line)},onInputChange_:function(e){this.fire("text-change",e.detail)},onBlur_:function(){this.resetAndUpdate();if(this.invalid)this.fire("text-blur")},updatePosition_:function(){const orientationEnum=print_preview.ticket_items.CustomMarginsOrientation;let x=this.translateTransform.x;let y=this.translateTransform.y;let width=null;let height=null;if(this.side==orientationEnum.TOP){y=this.scaleTransform*this.positionInPts_+this.translateTransform.y-RADIUS_PX;width=this.scaleTransform*this.pageSize.width}else if(this.side==orientationEnum.RIGHT){x=this.scaleTransform*(this.pageSize.width-this.positionInPts_)+this.translateTransform.x-RADIUS_PX;height=this.scaleTransform*this.pageSize.height}else if(this.side==orientationEnum.BOTTOM){y=this.scaleTransform*(this.pageSize.height-this.positionInPts_)+this.translateTransform.y-RADIUS_PX;width=this.scaleTransform*this.pageSize.width}else{x=this.scaleTransform*this.positionInPts_+this.translateTransform.x-RADIUS_PX;height=this.scaleTransform*this.pageSize.height}window.requestAnimationFrame(()=>{this.style.left=Math.round(x)+"px";this.style.top=Math.round(y)+"px";if(width!=null){this.style.width=Math.round(width)+"px"}if(height!=null){this.style.height=Math.round(height)+"px"}});this.onClipSizeChange_()},onClipSizeChange_:function(){if(!this.clipSize)return;window.requestAnimationFrame(()=>{const offsetLeft=this.offsetLeft;const offsetTop=this.offsetTop;this.style.clip="rect("+-offsetTop+"px, "+(this.clipSize.width-offsetLeft)+"px, "+(this.clipSize.height-offsetTop)+"px, "+-offsetLeft+"px)"})}})})();
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
(function(){"use strict";const MINIMUM_DISTANCE=72;const MARGIN_KEY_MAP=new Map([[print_preview.ticket_items.CustomMarginsOrientation.TOP,"marginTop"],[print_preview.ticket_items.CustomMarginsOrientation.RIGHT,"marginRight"],[print_preview.ticket_items.CustomMarginsOrientation.BOTTOM,"marginBottom"],[print_preview.ticket_items.CustomMarginsOrientation.LEFT,"marginLeft"]]);Polymer({is:"print-preview-margin-control-container",behaviors:[SettingsBehavior],properties:{pageSize:{type:Object,notify:true},documentMargins:{type:Object,notify:true},previewLoaded:Boolean,measurementSystem:Object,scaleTransform_:{type:Number,notify:true,value:0},translateTransform_:{type:Object,notify:true,value:new print_preview.Coordinate2d(0,0)},clipSize_:{type:Object,notify:true,value:null},available_:{type:Boolean,notify:true,computed:"computeAvailable_(previewLoaded, settings.margins.value)",observer:"onAvailableChange_"},invisible_:{type:Boolean,reflectToAttribute:true,value:true},marginSides_:{type:Array,notify:true,value:[print_preview.ticket_items.CustomMarginsOrientation.TOP,print_preview.ticket_items.CustomMarginsOrientation.RIGHT,print_preview.ticket_items.CustomMarginsOrientation.BOTTOM,print_preview.ticket_items.CustomMarginsOrientation.LEFT]},dragging_:{type:String,reflectToAttribute:true,value:""}},observers:["onMarginSettingsChange_(settings.customMargins.value)"],pointerStartPositionInPixels_:new print_preview.Coordinate2d(0,0),marginStartPositionInPixels_:null,computeAvailable_:function(){return this.previewLoaded&&!!this.clipSize_&&this.getSettingValue("margins")==print_preview.ticket_items.MarginsTypeValue.CUSTOM&&!!this.pageSize},onAvailableChange_:function(){if(this.available_&&!!this.documentMargins){const newMargins={};const oldMargins=this.getSettingValue("customMargins");let change=false;for(let side of Object.values(print_preview.ticket_items.CustomMarginsOrientation)){const key=MARGIN_KEY_MAP.get(side);newMargins[key]=this.documentMargins.get(side);change=change||newMargins[key]!=oldMargins[key]}if(change)this.setSetting("customMargins",newMargins)}this.invisible_=!this.available_},onMarginSettingsChange_:function(){const margins=this.getSettingValue("customMargins");this.shadowRoot.querySelectorAll("print-preview-margin-control").forEach(control=>{const key=MARGIN_KEY_MAP.get(control.side);const newValue=margins[key]||0;control.setPositionInPts(newValue);control.setTextboxValue(this.serializeValueFromPts_(newValue))})},isTopOrBottom_:function(orientation){return orientation==print_preview.ticket_items.CustomMarginsOrientation.TOP||orientation==print_preview.ticket_items.CustomMarginsOrientation.BOTTOM},posInPixelsToPts_:function(control,posInPixels){const side=control.side;return this.clipAndRoundValue_(side,control.convertPixelsToPts(this.isTopOrBottom_(side)?posInPixels.y:posInPixels.x))},moveControlWithConstraints_:function(control,posInPts){control.setPositionInPts(posInPts);control.setTextboxValue(this.serializeValueFromPts_(posInPts))},serializeValueFromPts_:function(value){assert(this.measurementSystem);value=this.measurementSystem.convertFromPoints(value);value=this.measurementSystem.roundValue(value);return value+this.measurementSystem.unitSymbol},translatePointerToPositionInPixels:function(pointerPosition){return new print_preview.Coordinate2d(pointerPosition.x-this.pointerStartPositionInPixels_.x+this.marginStartPositionInPixels_.x,pointerPosition.y-this.pointerStartPositionInPixels_.y+this.marginStartPositionInPixels_.y)},onPointerMove_:function(event){const control=event.target;const posInPts=this.posInPixelsToPts_(control,this.translatePointerToPositionInPixels(new print_preview.Coordinate2d(event.x,event.y)));this.moveControlWithConstraints_(control,posInPts)},onPointerUp_:function(event){const control=event.target;this.dragging_="";const posInPixels=this.translatePointerToPositionInPixels(new print_preview.Coordinate2d(event.x,event.y));const posInPts=this.posInPixelsToPts_(control,posInPixels);this.moveControlWithConstraints_(control,posInPts);this.setMargin_(control.side,posInPts);this.updateClippingMask(this.clipSize_);this.unlisten(control,"pointercancel","onPointerUp_");this.unlisten(control,"pointerup","onPointerUp_");this.unlisten(control,"pointermove","onPointerMove_");this.fire("margin-drag-changed",false)},setInvisible:function(invisible){if(!this.available_)return;if(invisible&&this.dragging_!="")return;this.invisible_=invisible},setMargin_:function(side,marginValue){const marginSide=side;const oldMargins=this.getSettingValue("customMargins");const key=MARGIN_KEY_MAP.get(marginSide);if(oldMargins[key]==marginValue)return;const newMargins=Object.assign({},oldMargins);newMargins[key]=marginValue;this.setSetting("customMargins",newMargins)},clipAndRoundValue_:function(side,value){const marginSide=side;if(value<0)return 0;const Orientation=print_preview.ticket_items.CustomMarginsOrientation;let limit=0;const margins=this.getSettingValue("customMargins");if(marginSide==Orientation.TOP)limit=this.pageSize.height-margins.marginBottom-MINIMUM_DISTANCE;else if(marginSide==Orientation.RIGHT)limit=this.pageSize.width-margins.marginLeft-MINIMUM_DISTANCE;else if(marginSide==Orientation.BOTTOM)limit=this.pageSize.height-margins.marginTop-MINIMUM_DISTANCE;else{assert(marginSide==Orientation.LEFT);limit=this.pageSize.width-margins.marginRight-MINIMUM_DISTANCE}return Math.round(Math.min(value,limit))},onTextChange_:function(e){const marginValue=this.parseValueToPts_(e.detail);const control=e.target;if(marginValue==null){control.invalid=true;return}control.invalid=false;const clippedValue=this.clipAndRoundValue_(control.side,marginValue);control.setPositionInPts(clippedValue);this.setMargin_(control.side,clippedValue)},onTextBlur_:function(e){const control=e.target;control.setTextboxValue(this.serializeValueFromPts_(control.getPositionInPts()));control.invalid=false},onPointerDown_:function(e){const control=e.target;if(!control.shouldDrag(e))return;this.pointerStartPositionInPixels_=new print_preview.Coordinate2d(e.x,e.y);this.marginStartPositionInPixels_=new print_preview.Coordinate2d(control.offsetLeft,control.offsetTop);this.dragging_=this.isTopOrBottom_(control.side)?"dragging-vertical":"dragging-horizontal";this.listen(control,"pointercancel","onPointerUp_");this.listen(control,"pointerup","onPointerUp_");this.listen(control,"pointermove","onPointerMove_");control.setPointerCapture(e.pointerId);this.fire("margin-drag-changed",true)},onTransitionEnd_:function(){if(this.invisible_)this.style.display="none"},parseValueToPts_:function(value){value=value.replace(/\s*/g,"");if(value.length==0){return null}assert(this.measurementSystem);const validationRegex=new RegExp("^(^-?)(\\d)+(\\"+this.measurementSystem.thousandsDelimeter+"\\d{3})*(\\"+this.measurementSystem.decimalDelimeter+"\\d*)?"+"("+this.measurementSystem.unitSymbol+")?$");if(validationRegex.test(value)){const replacementRegex=new RegExp("\\"+this.measurementSystem.decimalDelimeter+"{1}");value=value.replace(replacementRegex,".");return this.measurementSystem.convertToPoints(parseFloat(value))}return null},updateTranslationTransform:function(translateTransform){if(!translateTransform.equals(this.translateTransform_)){this.translateTransform_=translateTransform}},updateScaleTransform:function(scaleTransform){if(scaleTransform!=this.scaleTransform_)this.scaleTransform_=scaleTransform},updateClippingMask:function(clipSize){if(!clipSize){return}this.clipSize_=clipSize;this.notifyPath("clipSize_")}})})();
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.PDFPlugin;print_preview_new.MediaSizeValue;print_preview_new.PreviewAreaState={NO_PLUGIN:"no-plugin",LOADING:"loading",DISPLAY_PREVIEW:"display-preview",OPEN_IN_PREVIEW_LOADING:"open-in-preview-loading",OPEN_IN_PREVIEW_LOADED:"open-in-preview-loaded",INVALID_SETTINGS:"invalid-settings",PREVIEW_FAILED:"preview-failed",UNSUPPORTED_CLOUD_PRINTER:"unsupported-cloud-printer"};Polymer({is:"print-preview-preview-area",behaviors:[WebUIListenerBehavior,SettingsBehavior,I18nBehavior],properties:{documentInfo:Object,destination:Object,state:{type:Number,observer:"onStateChanged_"},measurementSystem:Object,pluginLoaded_:{type:Boolean,value:false},documentReady_:{type:Boolean,value:false},previewState:{type:String,notify:true,value:print_preview_new.PreviewAreaState.LOADING},previewLoaded_:{type:Boolean,notify:true,computed:"computePreviewLoaded_(documentReady_, pluginLoaded_)"}},listeners:{pointerover:"onPointerOver_",pointerout:"onPointerOut_"},observers:["onSettingsChanged_(settings.color.value, settings.cssBackground.value, "+"settings.fitToPage.value, settings.headerFooter.value, "+"settings.layout.value, settings.ranges.value, "+"settings.selectionOnly.value, settings.scaling.value, "+"settings.pagesPerSheet.value, settings.rasterize.value, destination)","onMarginsChanged_(settings.margins.value)","onCustomMarginsChanged_(settings.customMargins.value)","onMediaSizeChanged_(settings.mediaSize.value)","pluginOrDocumentStatusChanged_(pluginLoaded_, documentReady_)"],nativeLayer_:null,lastCustomMargins_:null,lastMediaSize_:null,inFlightRequestId_:-1,requestPreviewWhenReady_:false,plugin_:null,keyEventCallback_:null,attached:function(){this.nativeLayer_=print_preview.NativeLayer.getInstance();this.addWebUIListener("page-count-ready",this.onPageCountReady_.bind(this));this.addWebUIListener("page-layout-ready",this.onPageLayoutReady_.bind(this));this.addWebUIListener("page-preview-ready",this.onPagePreviewReady_.bind(this));if(!this.checkPluginCompatibility())this.previewState=print_preview_new.PreviewAreaState.NO_PLUGIN},checkPluginCompatibility:function(){const oopCompatObj=this.$$(".preview-area-compatibility-object-out-of-process");const isOOPCompatible=oopCompatObj.postMessage;oopCompatObj.parentElement.removeChild(oopCompatObj);return isOOPCompatible},computePreviewLoaded_:function(){return this.documentReady_&&this.pluginLoaded_},previewLoaded:function(){return this.previewLoaded_},onPointerOver_:function(event){const marginControlContainer=this.$.marginControlContainer;let fromElement=event.fromElement;while(fromElement!=null){if(fromElement==marginControlContainer)return;fromElement=fromElement.parentElement}marginControlContainer.setInvisible(false)},onPointerOut_:function(event){const marginControlContainer=this.$.marginControlContainer;let toElement=event.toElement;while(toElement!=null){if(toElement==marginControlContainer)return;toElement=toElement.parentElement}marginControlContainer.setInvisible(true)},onSettingsChanged_:function(){if(this.state==print_preview_new.State.READY){this.startPreview_();return}this.requestPreviewWhenReady_=true},pluginOrDocumentStatusChanged_:function(){if(!this.pluginLoaded_||!this.documentReady_)return;this.previewState=this.previewState==print_preview_new.PreviewAreaState.OPEN_IN_PREVIEW_LOADING?print_preview_new.PreviewAreaState.OPEN_IN_PREVIEW_LOADED:print_preview_new.PreviewAreaState.DISPLAY_PREVIEW},getInvisible_:function(){return this.isInDisplayPreviewState_()?"invisible":""},getAriaHidden_:function(){return this.isInDisplayPreviewState_().toString()},isInDisplayPreviewState_:function(){return this.previewState==print_preview_new.PreviewAreaState.DISPLAY_PREVIEW},isPreviewLoading_:function(){return this.previewState==print_preview_new.PreviewAreaState.LOADING},getJumpingDots_:function(){return this.isPreviewLoading_()?"jumping-dots":""},displaySystemDialogButton_:function(){return this.previewState==print_preview_new.PreviewAreaState.INVALID_SETTINGS||this.previewState==print_preview_new.PreviewAreaState.OPEN_IN_PREVIEW_LOADING||this.previewState==print_preview_new.PreviewAreaState.OPEN_IN_PREVIEW_LOADED},shouldShowLearnMoreLink_:function(){return this.previewState==print_preview_new.PreviewAreaState.UNSUPPORTED_CLOUD_PRINTER},currentMessage_:function(){switch(this.previewState){case print_preview_new.PreviewAreaState.NO_PLUGIN:return this.i18n("noPlugin");case print_preview_new.PreviewAreaState.LOADING:return this.i18n("loading");case print_preview_new.PreviewAreaState.DISPLAY_PREVIEW:return"";case print_preview_new.PreviewAreaState.INVALID_SETTINGS:return this.i18n("invalidPrinterSettings");case print_preview_new.PreviewAreaState.PREVIEW_FAILED:return this.i18n("previewFailed");case print_preview_new.PreviewAreaState.UNSUPPORTED_CLOUD_PRINTER:return this.i18n("unsupportedCloudPrinter");default:return""}},startPreview_:function(){this.previewState=print_preview_new.PreviewAreaState.LOADING;this.documentReady_=false;this.getPreview_().then(previewUid=>{if(!this.documentInfo.isModifiable)this.onPreviewStart_(previewUid,-1);this.documentReady_=true},type=>{if(type=="SETTINGS_INVALID"){this.previewState=print_preview_new.PreviewAreaState.INVALID_SETTINGS}else if(type!="CANCELLED"){this.previewState=print_preview_new.PreviewAreaState.PREVIEW_FAILED}})},onStateChanged_:function(){if(this.state==print_preview_new.State.READY&&this.requestPreviewWhenReady_){this.startPreview_();this.requestPreviewWhenReady_=false}},onPreviewStart_:function(previewUid,index){if(!this.plugin_)this.createPlugin_(previewUid,index);this.pluginLoaded_=false;this.plugin_.resetPrintPreviewMode(this.getPreviewUrl_(previewUid,index),!this.getSettingValue("color"),this.getSetting("pages").value,this.documentInfo.isModifiable)},onPageLayoutReady_:function(pageLayout,hasCustomPageSizeStyle){const origin=new print_preview.Coordinate2d(pageLayout.printableAreaX,pageLayout.printableAreaY);const size=new print_preview.Size(pageLayout.printableAreaWidth,pageLayout.printableAreaHeight);const margins=new print_preview.Margins(Math.round(pageLayout.marginTop),Math.round(pageLayout.marginRight),Math.round(pageLayout.marginBottom),Math.round(pageLayout.marginLeft));const o=print_preview.ticket_items.CustomMarginsOrientation;const pageSize=new print_preview.Size(pageLayout.contentWidth+margins.get(o.LEFT)+margins.get(o.RIGHT),pageLayout.contentHeight+margins.get(o.TOP)+margins.get(o.BOTTOM));this.documentInfo.updatePageInfo(new print_preview.PrintableArea(origin,size),pageSize,hasCustomPageSizeStyle,margins);this.notifyPath("documentInfo.printableArea");this.notifyPath("documentInfo.pageSize");this.notifyPath("documentInfo.margins");this.notifyPath("documentInfo.hasCssMediaStyles")},onPageCountReady_:function(pageCount,previewResponseId,fitToPageScaling){if(this.inFlightRequestId_!=previewResponseId)return;this.documentInfo.updatePageCount(pageCount);this.documentInfo.updateFitToPageScaling(fitToPageScaling);this.notifyPath("documentInfo.pageCount");this.notifyPath("documentInfo.fitToPageScaling")},onPluginLoad_:function(){this.pluginLoaded_=true},onPreviewVisualStateChange_:function(pageX,pageY,pageWidth,viewportWidth,viewportHeight){this.$.marginControlContainer.updateTranslationTransform(new print_preview.Coordinate2d(pageX,pageY));this.$.marginControlContainer.updateScaleTransform(pageWidth/this.documentInfo.pageSize.width);this.$.marginControlContainer.updateClippingMask(new print_preview.Size(viewportWidth,viewportHeight))},getPreviewUrl_:function(previewUid,index){return`chrome://print/${previewUid}/${index}/print.pdf`},onPagePreviewReady_:function(pageIndex,previewUid,previewResponseId){if(this.inFlightRequestId_!=previewResponseId)return;const pageNumber=pageIndex+1;const index=this.getSettingValue("pages").indexOf(pageNumber);if(index==0)this.onPreviewStart_(previewUid,pageIndex);if(index!=-1){this.plugin_.loadPreviewPage(this.getPreviewUrl_(previewUid,pageIndex),index)}},handleDirectionalKeyEvent:function(e){if(!this.plugin_||!arrayContains(["PageUp","PageDown","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],e.code)||hasKeyModifiers(e)){return}const tagName=e.path[0].tagName;if(["INPUT","SELECT","EMBED"].includes(tagName))return;let element=e.target;while(element){if(element.scrollHeight>element.clientHeight||element.scrollWidth>element.clientWidth){return}element=element.parentElement}this.plugin_.sendKeyEvent(e);e.preventDefault()},setPluginKeyEventCallback:function(callback){this.keyEventCallback_=callback},createPlugin_:function(previewUid,index){assert(!this.plugin_);const srcUrl=this.getPreviewUrl_(previewUid,index);this.plugin_=PDFCreateOutOfProcessPlugin(srcUrl,"chrome://print/pdf");this.plugin_.setKeyEventCallback(this.keyEventCallback_);this.plugin_.classList.add("preview-area-plugin");this.plugin_.setAttribute("aria-live","polite");this.plugin_.setAttribute("aria-atomic","true");this.plugin_.setAttribute("id","pdf-viewer");this.$$(".preview-area-plugin-wrapper").appendChild(this.plugin_);this.plugin_.setLoadCallback(this.onPluginLoad_.bind(this));this.plugin_.setViewportChangedCallback(this.onPreviewVisualStateChange_.bind(this))},onMarginDragChanged_:function(e){if(!this.plugin_)return;this.plugin_.style.pointerEvents=e.detail?"none":"auto"},onGcpErrorLearnMoreClick_:function(){this.nativeLayer_.forceOpenNewTab(this.i18n("gcpCertificateErrorLearnMoreURL"))},onMarginsChanged_:function(){if(this.getSettingValue("margins")!=print_preview.ticket_items.MarginsTypeValue.CUSTOM){this.lastCustomMargins_=null;this.onSettingsChanged_()}else{this.lastCustomMargins_=this.getSettingValue("customMargins")}},onCustomMarginsChanged_:function(){const newValue=this.getSettingValue("customMargins");if(!!this.lastCustomMargins_&&this.getSettingValue("margins")==print_preview.ticket_items.MarginsTypeValue.CUSTOM&&(this.lastCustomMargins_.marginTop!=newValue.marginTop||this.lastCustomMargins_.marginLeft!=newValue.marginLeft||this.lastCustomMargins_.marginRight!=newValue.marginRight||this.lastCustomMargins_.marginBottom!=newValue.marginBottom)){this.onSettingsChanged_()}this.lastCustomMargins_=newValue},onMediaSizeChanged_:function(){const newValue=this.getSettingValue("mediaSize");if(!!this.lastMediaSize_&&(newValue.height_microns!=this.lastMediaSize_.height_microns||newValue.width_microns!=this.lastMediaSize_.width_microns)){this.onSettingsChanged_()}this.lastMediaSize_=newValue},getPreview_:function(){this.inFlightRequestId_++;const dpi=this.getSettingValue("dpi");const ticket={pageRange:this.getSettingValue("ranges"),mediaSize:this.getSettingValue("mediaSize"),landscape:this.getSettingValue("layout"),color:this.destination.getNativeColorModel(this.getSettingValue("color")),headerFooterEnabled:this.getSettingValue("headerFooter"),marginsType:this.getSettingValue("margins"),pagesPerSheet:this.getSettingValue("pagesPerSheet"),isFirstRequest:this.inFlightRequestId_==0,requestID:this.inFlightRequestId_,previewModifiable:this.documentInfo.isModifiable,fitToPageEnabled:this.getSettingValue("fitToPage"),scaleFactor:parseInt(this.getSettingValue("scaling"),10),shouldPrintBackgrounds:this.getSettingValue("cssBackground"),shouldPrintSelectionOnly:this.getSettingValue("selectionOnly"),collate:true,copies:1,deviceName:this.destination.id,dpiHorizontal:dpi&&"horizontal_dpi"in dpi?dpi.horizontal_dpi:0,dpiVertical:dpi&&"vertical_dpi"in dpi?dpi.vertical_dpi:0,duplex:this.getSettingValue("duplex")?print_preview_new.DuplexMode.LONG_EDGE:print_preview_new.DuplexMode.SIMPLEX,printToPDF:this.destination.id==print_preview.Destination.GooglePromotedId.SAVE_AS_PDF,printWithCloudPrint:!this.destination.isLocal,printWithPrivet:this.destination.isPrivet,printWithExtension:this.destination.isExtension,rasterizePDF:this.getSettingValue("rasterize")};if(this.destination&&!this.destination.isLocal){ticket.cloudPrintID=this.destination.id}if(this.getSettingValue("margins")==print_preview.ticket_items.MarginsTypeValue.CUSTOM){ticket.marginsCustom=this.getSettingValue("customMargins")}return this.nativeLayer_.getPreview(JSON.stringify(ticket))}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-lazy-render",behaviors:[Polymer.Templatizer],child_:null,get:function(){if(!this.child_)this.render_();return this.child_},getIfExists:function(){return this.child_},render_:function(){var template=this.getContentChildren()[0];if(!template.ctor)this.templatize(template);var parentNode=this.parentNode;if(parentNode&&!this.child_){var instance=this.stamp({});this.child_=instance.root.firstElementChild;parentNode.insertBefore(instance.root,this)}},_forwardParentProp:function(prop,value){if(this.child_)this.child_._templateInstance[prop]=value},_forwardParentPath:function(path,value){if(this.child_)this.child_._templateInstance.notifyPath(path,value,true)}});(function(){"use strict";var KEY_IDENTIFIER={"U+0008":"backspace","U+0009":"tab","U+001B":"esc","U+0020":"space","U+007F":"del"};var KEY_CODE={8:"backspace",9:"tab",13:"enter",27:"esc",33:"pageup",34:"pagedown",35:"end",36:"home",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",106:"*"};var MODIFIER_KEYS={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"};var KEY_CHAR=/[a-z0-9*]/;var IDENT_CHAR=/U\+/;var ARROW_KEY=/^arrow/;var SPACE_KEY=/^space(bar)?/;var ESC_KEY=/^escape$/;function transformKey(key,noSpecialChars){var validKey="";if(key){var lKey=key.toLowerCase();if(lKey===" "||SPACE_KEY.test(lKey)){validKey="space"}else if(ESC_KEY.test(lKey)){validKey="esc"}else if(lKey.length==1){if(!noSpecialChars||KEY_CHAR.test(lKey)){validKey=lKey}}else if(ARROW_KEY.test(lKey)){validKey=lKey.replace("arrow","")}else if(lKey=="multiply"){validKey="*"}else{validKey=lKey}}return validKey}function transformKeyIdentifier(keyIdent){var validKey="";if(keyIdent){if(keyIdent in KEY_IDENTIFIER){validKey=KEY_IDENTIFIER[keyIdent]}else if(IDENT_CHAR.test(keyIdent)){keyIdent=parseInt(keyIdent.replace("U+","0x"),16);validKey=String.fromCharCode(keyIdent).toLowerCase()}else{validKey=keyIdent.toLowerCase()}}return validKey}function transformKeyCode(keyCode){var validKey="";if(Number(keyCode)){if(keyCode>=65&&keyCode<=90){validKey=String.fromCharCode(32+keyCode)}else if(keyCode>=112&&keyCode<=123){validKey="f"+(keyCode-112+1)}else if(keyCode>=48&&keyCode<=57){validKey=String(keyCode-48)}else if(keyCode>=96&&keyCode<=105){validKey=String(keyCode-96)}else{validKey=KEY_CODE[keyCode]}}return validKey}function normalizedKeyForEvent(keyEvent,noSpecialChars){if(keyEvent.key){return transformKey(keyEvent.key,noSpecialChars)}if(keyEvent.detail&&keyEvent.detail.key){return transformKey(keyEvent.detail.key,noSpecialChars)}return transformKeyIdentifier(keyEvent.keyIdentifier)||transformKeyCode(keyEvent.keyCode)||""}function keyComboMatchesEvent(keyCombo,event){var keyEvent=normalizedKeyForEvent(event,keyCombo.hasModifiers);return keyEvent===keyCombo.key&&(!keyCombo.hasModifiers||!!event.shiftKey===!!keyCombo.shiftKey&&!!event.ctrlKey===!!keyCombo.ctrlKey&&!!event.altKey===!!keyCombo.altKey&&!!event.metaKey===!!keyCombo.metaKey)}function parseKeyComboString(keyComboString){if(keyComboString.length===1){return{combo:keyComboString,key:keyComboString,event:"keydown"}}return keyComboString.split("+").reduce(function(parsedKeyCombo,keyComboPart){var eventParts=keyComboPart.split(":");var keyName=eventParts[0];var event=eventParts[1];if(keyName in MODIFIER_KEYS){parsedKeyCombo[MODIFIER_KEYS[keyName]]=true;parsedKeyCombo.hasModifiers=true}else{parsedKeyCombo.key=keyName;parsedKeyCombo.event=event||"keydown"}return parsedKeyCombo},{combo:keyComboString.split(":").shift()})}function parseEventString(eventString){return eventString.trim().split(" ").map(function(keyComboString){return parseKeyComboString(keyComboString)})}Polymer.IronA11yKeysBehavior={properties:{keyEventTarget:{type:Object,value:function(){return this}},stopKeyboardEventPropagation:{type:Boolean,value:false},_boundKeyHandlers:{type:Array,value:function(){return[]}},_imperativeKeyBindings:{type:Object,value:function(){return{}}}},observers:["_resetKeyEventListeners(keyEventTarget, _boundKeyHandlers)"],keyBindings:{},registered:function(){this._prepKeyBindings()},attached:function(){this._listenKeyEventListeners()},detached:function(){this._unlistenKeyEventListeners()},addOwnKeyBinding:function(eventString,handlerName){this._imperativeKeyBindings[eventString]=handlerName;this._prepKeyBindings();this._resetKeyEventListeners()},removeOwnKeyBindings:function(){this._imperativeKeyBindings={};this._prepKeyBindings();this._resetKeyEventListeners()},keyboardEventMatchesKeys:function(event,eventString){var keyCombos=parseEventString(eventString);for(var i=0;i<keyCombos.length;++i){if(keyComboMatchesEvent(keyCombos[i],event)){return true}}return false},_collectKeyBindings:function(){var keyBindings=this.behaviors.map(function(behavior){return behavior.keyBindings});if(keyBindings.indexOf(this.keyBindings)===-1){keyBindings.push(this.keyBindings)}return keyBindings},_prepKeyBindings:function(){this._keyBindings={};this._collectKeyBindings().forEach(function(keyBindings){for(var eventString in keyBindings){this._addKeyBinding(eventString,keyBindings[eventString])}},this);for(var eventString in this._imperativeKeyBindings){this._addKeyBinding(eventString,this._imperativeKeyBindings[eventString])}for(var eventName in this._keyBindings){this._keyBindings[eventName].sort(function(kb1,kb2){var b1=kb1[0].hasModifiers;var b2=kb2[0].hasModifiers;return b1===b2?0:b1?-1:1})}},_addKeyBinding:function(eventString,handlerName){parseEventString(eventString).forEach(function(keyCombo){this._keyBindings[keyCombo.event]=this._keyBindings[keyCombo.event]||[];this._keyBindings[keyCombo.event].push([keyCombo,handlerName])},this)},_resetKeyEventListeners:function(){this._unlistenKeyEventListeners();if(this.isAttached){this._listenKeyEventListeners()}},_listenKeyEventListeners:function(){if(!this.keyEventTarget){return}Object.keys(this._keyBindings).forEach(function(eventName){var keyBindings=this._keyBindings[eventName];var boundKeyHandler=this._onKeyBindingEvent.bind(this,keyBindings);this._boundKeyHandlers.push([this.keyEventTarget,eventName,boundKeyHandler]);this.keyEventTarget.addEventListener(eventName,boundKeyHandler)},this)},_unlistenKeyEventListeners:function(){var keyHandlerTuple;var keyEventTarget;var eventName;var boundKeyHandler;while(this._boundKeyHandlers.length){keyHandlerTuple=this._boundKeyHandlers.pop();keyEventTarget=keyHandlerTuple[0];eventName=keyHandlerTuple[1];boundKeyHandler=keyHandlerTuple[2];keyEventTarget.removeEventListener(eventName,boundKeyHandler)}},_onKeyBindingEvent:function(keyBindings,event){if(this.stopKeyboardEventPropagation){event.stopPropagation()}if(event.defaultPrevented){return}for(var i=0;i<keyBindings.length;i++){var keyCombo=keyBindings[i][0];var handlerName=keyBindings[i][1];if(keyComboMatchesEvent(keyCombo,event)){this._triggerKeyHandler(keyCombo,handlerName,event);if(event.defaultPrevented){return}}}},_triggerKeyHandler:function(keyCombo,handlerName,keyboardEvent){var detail=Object.create(keyCombo);detail.keyboardEvent=keyboardEvent;var event=new CustomEvent(keyCombo.event,{detail:detail,cancelable:true});this[handlerName].call(this,event);if(event.defaultPrevented){keyboardEvent.preventDefault()}}}})();Polymer.IronControlState={properties:{focused:{type:Boolean,value:false,notify:true,readOnly:true,reflectToAttribute:true},disabled:{type:Boolean,value:false,notify:true,observer:"_disabledChanged",reflectToAttribute:true},_oldTabIndex:{type:String},_boundFocusBlurHandler:{type:Function,value:function(){return this._focusBlurHandler.bind(this)}},__handleEventRetargeting:{type:Boolean,value:function(){return!this.shadowRoot&&!Polymer.Element}}},observers:["_changedControlState(focused, disabled)"],ready:function(){this.addEventListener("focus",this._boundFocusBlurHandler,true);this.addEventListener("blur",this._boundFocusBlurHandler,true)},_focusBlurHandler:function(event){if(Polymer.Element){this._setFocused(event.type==="focus");return}if(event.target===this){this._setFocused(event.type==="focus")}else if(this.__handleEventRetargeting){var target=Polymer.dom(event).localTarget;if(!this.isLightDescendant(target)){this.fire(event.type,{sourceEvent:event},{node:this,bubbles:event.bubbles,cancelable:event.cancelable})}}},_disabledChanged:function(disabled,old){this.setAttribute("aria-disabled",disabled?"true":"false");this.style.pointerEvents=disabled?"none":"";if(disabled){this._oldTabIndex=this.getAttribute("tabindex");this._setFocused(false);this.tabIndex=-1;this.blur()}else if(this._oldTabIndex!==undefined){if(this._oldTabIndex===null){this.removeAttribute("tabindex")}else{this.setAttribute("tabindex",this._oldTabIndex)}}},_changedControlState:function(){if(this._controlStateChanged){this._controlStateChanged()}}};Polymer.IronButtonStateImpl={properties:{pressed:{type:Boolean,readOnly:true,value:false,reflectToAttribute:true,observer:"_pressedChanged"},toggles:{type:Boolean,value:false,reflectToAttribute:true},active:{type:Boolean,value:false,notify:true,reflectToAttribute:true},pointerDown:{type:Boolean,readOnly:true,value:false},receivedFocusFromKeyboard:{type:Boolean,readOnly:true},ariaActiveAttribute:{type:String,value:"aria-pressed",observer:"_ariaActiveAttributeChanged"}},listeners:{down:"_downHandler",up:"_upHandler",tap:"_tapHandler"},observers:["_focusChanged(focused)","_activeChanged(active, ariaActiveAttribute)"],keyBindings:{"enter:keydown":"_asyncClick","space:keydown":"_spaceKeyDownHandler","space:keyup":"_spaceKeyUpHandler"},_mouseEventRe:/^mouse/,_tapHandler:function(){if(this.toggles){this._userActivate(!this.active)}else{this.active=false}},_focusChanged:function(focused){this._detectKeyboardFocus(focused);if(!focused){this._setPressed(false)}},_detectKeyboardFocus:function(focused){this._setReceivedFocusFromKeyboard(!this.pointerDown&&focused)},_userActivate:function(active){if(this.active!==active){this.active=active;this.fire("change")}},_downHandler:function(event){this._setPointerDown(true);this._setPressed(true);this._setReceivedFocusFromKeyboard(false)},_upHandler:function(){this._setPointerDown(false);this._setPressed(false)},_spaceKeyDownHandler:function(event){var keyboardEvent=event.detail.keyboardEvent;var target=Polymer.dom(keyboardEvent).localTarget;if(this.isLightDescendant(target))return;keyboardEvent.preventDefault();keyboardEvent.stopImmediatePropagation();this._setPressed(true)},_spaceKeyUpHandler:function(event){var keyboardEvent=event.detail.keyboardEvent;var target=Polymer.dom(keyboardEvent).localTarget;if(this.isLightDescendant(target))return;if(this.pressed){this._asyncClick()}this._setPressed(false)},_asyncClick:function(){this.async(function(){this.click()},1)},_pressedChanged:function(pressed){this._changedButtonState()},_ariaActiveAttributeChanged:function(value,oldValue){if(oldValue&&oldValue!=value&&this.hasAttribute(oldValue)){this.removeAttribute(oldValue)}},_activeChanged:function(active,ariaActiveAttribute){if(this.toggles){this.setAttribute(this.ariaActiveAttribute,active?"true":"false")}else{this.removeAttribute(this.ariaActiveAttribute)}this._changedButtonState()},_controlStateChanged:function(){if(this.disabled){this._setPressed(false)}else{this._changedButtonState()}},_changedButtonState:function(){if(this._buttonStateChanged){this._buttonStateChanged()}}};Polymer.IronButtonState=[Polymer.IronA11yKeysBehavior,Polymer.IronButtonStateImpl];(function(){var MAX_RADIUS_PX=300;var MIN_DURATION_MS=800;var distance=function(x1,y1,x2,y2){var xDelta=x1-x2;var yDelta=y1-y2;return Math.sqrt(xDelta*xDelta+yDelta*yDelta)};Polymer({is:"paper-ripple",behaviors:[Polymer.IronA11yKeysBehavior],properties:{center:{type:Boolean,value:false},holdDown:{type:Boolean,value:false,observer:"_holdDownChanged"},recenters:{type:Boolean,value:false},noink:{type:Boolean,value:false}},keyBindings:{"enter:keydown":"_onEnterKeydown","space:keydown":"_onSpaceKeydown","space:keyup":"_onSpaceKeyup"},created:function(){this.ripples=[]},attached:function(){this.keyEventTarget=this.parentNode.nodeType==11?Polymer.dom(this).getOwnerRoot().host:this.parentNode;this.keyEventTarget=this.keyEventTarget;this.listen(this.keyEventTarget,"up","uiUpAction");this.listen(this.keyEventTarget,"down","uiDownAction")},detached:function(){this.unlisten(this.keyEventTarget,"up","uiUpAction");this.unlisten(this.keyEventTarget,"down","uiDownAction");this.keyEventTarget=null},simulatedRipple:function(){this.downAction();this.async(function(){this.upAction()}.bind(this),1)},uiDownAction:function(e){if(!this.noink)this.downAction(e)},downAction:function(e){if(this.ripples.length&&this.holdDown)return;this.debounce("show ripple",function(){this.__showRipple(e)},1)},__showRipple:function(e){var rect=this.getBoundingClientRect();var roundedCenterX=function(){return Math.round(rect.width/2)};var roundedCenterY=function(){return Math.round(rect.height/2)};var centered=!e||this.center;if(centered){var x=roundedCenterX();var y=roundedCenterY()}else{var sourceEvent=e.detail.sourceEvent;var x=Math.round(sourceEvent.clientX-rect.left);var y=Math.round(sourceEvent.clientY-rect.top)}var corners=[{x:0,y:0},{x:rect.width,y:0},{x:0,y:rect.height},{x:rect.width,y:rect.height}];var cornerDistances=corners.map(function(corner){return Math.round(distance(x,y,corner.x,corner.y))});var radius=Math.min(MAX_RADIUS_PX,Math.max.apply(Math,cornerDistances));var startTranslate=x-radius+"px, "+(y-radius)+"px";if(this.recenters&&!centered){var endTranslate=roundedCenterX()-radius+"px, "+(roundedCenterY()-radius)+"px"}else{var endTranslate=startTranslate}var ripple=document.createElement("div");ripple.classList.add("ripple");ripple.style.height=ripple.style.width=2*radius+"px";this.ripples.push(ripple);this.shadowRoot.appendChild(ripple);ripple.animate({transform:["translate("+startTranslate+") scale(0)","translate("+endTranslate+") scale(1)"]},{duration:Math.max(MIN_DURATION_MS,Math.log(radius)*radius)||0,easing:"cubic-bezier(.2, .9, .1, .9)",fill:"forwards"})},uiUpAction:function(e){if(!this.noink)this.upAction()},upAction:function(e){if(!this.holdDown)this.debounce("hide ripple",function(){this.__hideRipple()},1)},__hideRipple:function(){Promise.all(this.ripples.map(function(ripple){return new Promise(function(resolve){var removeRipple=function(){ripple.remove();resolve()};var opacity=getComputedStyle(ripple).opacity;if(!opacity.length){removeRipple()}else{var animation=ripple.animate({opacity:[opacity,0]},{duration:150,fill:"forwards"});animation.addEventListener("finish",removeRipple);animation.addEventListener("cancel",removeRipple)}})})).then(function(){this.fire("transitionend")}.bind(this));this.ripples=[]},_onEnterKeydown:function(){this.uiDownAction();this.async(this.uiUpAction,1)},_onSpaceKeydown:function(){this.uiDownAction()},_onSpaceKeyup:function(){this.uiUpAction()},_holdDownChanged:function(newHoldDown,oldHoldDown){if(oldHoldDown===undefined)return;if(newHoldDown)this.downAction();else this.upAction()}})})();Polymer.PaperRippleBehavior={properties:{noink:{type:Boolean,observer:"_noinkChanged"},_rippleContainer:{type:Object}},_buttonStateChanged:function(){if(this.focused){this.ensureRipple()}},_downHandler:function(event){Polymer.IronButtonStateImpl._downHandler.call(this,event);if(this.pressed){this.ensureRipple(event)}},ensureRipple:function(optTriggeringEvent){if(!this.hasRipple()){this._ripple=this._createRipple();this._ripple.noink=this.noink;var rippleContainer=this._rippleContainer||this.root;if(rippleContainer){Polymer.dom(rippleContainer).appendChild(this._ripple)}if(optTriggeringEvent){var domContainer=Polymer.dom(this._rippleContainer||this);var target=Polymer.dom(optTriggeringEvent).rootTarget;if(domContainer.deepContains(target)){this._ripple.uiDownAction(optTriggeringEvent)}}}},getRipple:function(){this.ensureRipple();return this._ripple},hasRipple:function(){return Boolean(this._ripple)},_createRipple:function(){var element=document.createElement("paper-ripple");return element},_noinkChanged:function(noink){if(this.hasRipple()){this._ripple.noink=noink}}};Polymer({is:"paper-icon-button-light",behaviors:[Polymer.PaperRippleBehavior],ready:function(){Polymer.RenderStatus.afterNextRender(this,()=>{this.addEventListener("down",this._rippleDown.bind(this));this.addEventListener("up",this._rippleUp.bind(this));var button=this.getEffectiveChildren()[0];this._rippleContainer=button;button.addEventListener("focus",this._rippleDown.bind(this));button.addEventListener("blur",this._rippleUp.bind(this))})},_rippleDown:function(){this.getRipple().uiDownAction()},_rippleUp:function(){this.getRipple().uiUpAction()},ensureRipple:function(var_args){var lastRipple=this._ripple;Polymer.PaperRippleBehavior.ensureRipple.apply(this,arguments);if(this._ripple&&this._ripple!==lastRipple){this._ripple.center=true;this._ripple.classList.add("circle")}}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-dialog",properties:{open:{type:Boolean,value:false,reflectToAttribute:true},closeText:String,ignorePopstate:{type:Boolean,value:false},ignoreEnterKey:{type:Boolean,value:false},noCancel:{type:Boolean,value:false},showCloseButton:{type:Boolean,value:false}},listeners:{pointerdown:"onPointerdown_"},intersectionObserver_:null,mutationObserver_:null,ready:function(){window.addEventListener("popstate",function(){if(!this.ignorePopstate&&this.$.dialog.open)this.cancel()}.bind(this));if(!this.ignoreEnterKey)this.addEventListener("keypress",this.onKeypress_.bind(this));if(this.noCancel)this.addEventListener("cancel",this.onCancel_.bind(this))},attached:function(){var mutationObserverCallback=function(){if(this.$.dialog.open)this.addIntersectionObserver_();else this.removeIntersectionObserver_()}.bind(this);this.mutationObserver_=new MutationObserver(mutationObserverCallback);this.mutationObserver_.observe(this.$.dialog,{attributes:true,attributeFilter:["open"]});mutationObserverCallback()},detached:function(){this.removeIntersectionObserver_();if(this.mutationObserver_){this.mutationObserver_.disconnect();this.mutationObserver_=null}},addIntersectionObserver_:function(){if(this.intersectionObserver_)return;var bodyContainer=this.$$(".body-container");var bottomMarker=this.$.bodyBottomMarker;var topMarker=this.$.bodyTopMarker;var callback=function(entries){for(var i=0;i<entries.length;i++){var target=entries[i].target;assert(target==bottomMarker||target==topMarker);var classToToggle=target==bottomMarker?"bottom-scrollable":"top-scrollable";bodyContainer.classList.toggle(classToToggle,entries[i].intersectionRatio==0)}};this.intersectionObserver_=new IntersectionObserver(callback,{root:bodyContainer,threshold:0});this.intersectionObserver_.observe(bottomMarker);this.intersectionObserver_.observe(topMarker)},removeIntersectionObserver_:function(){if(this.intersectionObserver_){this.intersectionObserver_.disconnect();this.intersectionObserver_=null}},showModal:function(){this.$.dialog.showModal();this.open=this.$.dialog.open},cancel:function(){this.fire("cancel");this.$.dialog.close();this.open=this.$.dialog.open},close:function(){this.$.dialog.close("success");this.open=this.$.dialog.open},onCloseKeypress_:function(e){e.stopPropagation()},getNative:function(){return this.$.dialog},getCloseButton:function(){return this.$.close},onKeypress_:function(e){if(e.key!="Enter")return;if(e.target!=this&&e.target.tagName!="PAPER-INPUT")return;var actionButton=this.querySelector(".action-button:not([disabled]):not([hidden])");if(actionButton){actionButton.click();e.preventDefault()}},onCancel_:function(e){if(this.noCancel)e.preventDefault()},onPointerdown_:function(e){if(e.button!=0||e.composedPath()[0].tagName!=="DIALOG")return;this.$.dialog.animate([{transform:"scale(1)",offset:0},{transform:"scale(1.02)",offset:.4},{transform:"scale(1.02)",offset:.6},{transform:"scale(1)",offset:1}],{duration:180,easing:"ease-in-out",iterations:1});e.preventDefault()}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.search_highlight_utils",function(){const WRAPPER_CSS_CLASS="search-highlight-wrapper";const ORIGINAL_CONTENT_CSS_CLASS="search-highlight-original-content";const HIT_CSS_CLASS="search-highlight-hit";const SEARCH_BUBBLE_CSS_CLASS="search-bubble";function highlight(node,tokens){const wrapper=document.createElement("span");wrapper.classList.add(WRAPPER_CSS_CLASS);node.parentNode.replaceChild(wrapper,node);const span=document.createElement("span");span.classList.add(ORIGINAL_CONTENT_CSS_CLASS);span.style.display="none";span.appendChild(node);wrapper.appendChild(span);for(let i=0;i<tokens.length;++i){if(i%2==0){wrapper.appendChild(document.createTextNode(tokens[i]))}else{const hitSpan=document.createElement("span");hitSpan.classList.add(HIT_CSS_CLASS);hitSpan.style.backgroundColor="#ffeb3b";hitSpan.textContent=tokens[i];wrapper.appendChild(hitSpan)}}}function findAndRemoveHighlights(node){const wrappers=node.querySelectorAll(`* /deep/ .${WRAPPER_CSS_CLASS}`);for(let i=0;i<wrappers.length;i++){const wrapper=wrappers[i];const textNode=wrapper.querySelector(`.${ORIGINAL_CONTENT_CSS_CLASS}`).firstChild;wrapper.parentElement.replaceChild(textNode,wrapper)}}function findAndRemoveBubbles(node){const searchBubbles=node.querySelectorAll(`* /deep/ .${SEARCH_BUBBLE_CSS_CLASS}`);for(let bubble of searchBubbles)bubble.remove()}function highlightControlWithBubble(element,rawQuery){let searchBubble=element.querySelector(`.${SEARCH_BUBBLE_CSS_CLASS}`);if(searchBubble)return;searchBubble=document.createElement("div");searchBubble.classList.add(SEARCH_BUBBLE_CSS_CLASS);const innards=document.createElement("div");innards.classList.add("search-bubble-innards");innards.textContent=rawQuery;searchBubble.appendChild(innards);element.appendChild(searchBubble);const updatePosition=function(){searchBubble.style.top=element.offsetTop+(innards.classList.contains("above")?-searchBubble.offsetHeight:element.offsetHeight)+"px"};updatePosition();searchBubble.addEventListener("mouseover",function(){innards.classList.toggle("above");updatePosition()})}return{highlight:highlight,highlightControlWithBubble:highlightControlWithBubble,findAndRemoveBubbles:findAndRemoveBubbles,findAndRemoveHighlights:findAndRemoveHighlights}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview",function(){"use strict";function updateHighlights(element,query,wasHighlighted){if(wasHighlighted){cr.search_highlight_utils.findAndRemoveHighlights(element);cr.search_highlight_utils.findAndRemoveBubbles(element)}if(!query)return false;let isHighlighted=false;element.shadowRoot.querySelectorAll(".searchable").forEach(childElement=>{childElement.childNodes.forEach(node=>{if(node.nodeType!=Node.TEXT_NODE)return;const textContent=node.nodeValue.trim();if(textContent.length==0)return;if(query.test(textContent)){isHighlighted=true;if(node.parentNode.nodeName!="OPTION"){cr.search_highlight_utils.highlight(node,textContent.split(query))}else{const selectNode=node.parentNode.parentNode;cr.search_highlight_utils.highlightControlWithBubble(assert(selectNode.parentNode),textContent.match(query)[0])}}})});return isHighlighted}return{updateHighlights:updateHighlights}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");Polymer({is:"print-preview-destination-list-item",properties:{destination:Object,searchQuery:Object,stale_:{type:Boolean,reflectToAttribute:true},searchHint_:String},observers:["onDestinationPropertiesChange_("+"destination.displayName, destination.isOfflineOrInvalid, "+"destination.isExtension)"],highlighted_:false,onDestinationPropertiesChange_:function(){this.title=this.destination.displayName;this.stale_=this.destination.isOfflineOrInvalid;if(this.destination.isExtension){const icon=this.$$(".extension-icon");icon.style.backgroundImage="-webkit-image-set("+"url(chrome://extension-icon/"+this.destination.extensionId+"/24/1) 1x,"+"url(chrome://extension-icon/"+this.destination.extensionId+"/48/1) 2x)"}},onLearnMoreLinkClick_:function(){print_preview.NativeLayer.getInstance().forceOpenNewTab(loadTimeData.getString("gcpCertificateErrorLearnMoreURL"))},update:function(){this.updateSearchHint_();this.updateHighlighting_()},updateSearchHint_:function(){this.searchHint_=!this.searchQuery?"":this.destination.extraPropertiesToMatch.filter(p=>p.match(this.searchQuery)).join(" ")},updateHighlighting_:function(){this.highlighted_=print_preview.updateHighlights(this,this.searchQuery,this.highlighted_)}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
(function(){"use strict";Polymer({is:"print-preview-destination-list",behaviors:[I18nBehavior],properties:{destinations:{type:Array,observer:"destinationsChanged_"},hasActionLink:{type:Boolean,value:false},loadingDestinations:{type:Boolean,value:false},searchQuery:{type:Object,observer:"update_"},title:String,matchingDestinationsCount_:{type:Number,value:0},hasDestinations_:{type:Boolean,computed:"computeHasDestinations_(matchingDestinationsCount_)"},showDestinationsTotal_:{type:Boolean,computed:"computeShowDestinationsTotal_(matchingDestinationsCount_)"}},newDestinations_:false,destinationsChanged_:function(current,previous){if(previous==undefined){this.matchingDestinationsCount_=this.destinations.length}else{this.newDestinations_=true}},updateIfNeeded_:function(){if(!this.newDestinations_)return;this.newDestinations_=false;this.update_()},update_:function(){if(!this.destinations)return;const listItems=this.shadowRoot.querySelectorAll("print-preview-destination-list-item");let matchCount=0;listItems.forEach(item=>{item.hidden=!!this.searchQuery&&!item.destination.matches(this.searchQuery);if(!item.hidden){matchCount++;item.update()}});this.matchingDestinationsCount_=!this.searchQuery?listItems.length:matchCount},computeHasDestinations_:function(){return!this.destinations||this.matchingDestinationsCount_>0},computeShowDestinationsTotal_:function(){return this.matchingDestinationsCount_>4},onActionLinkClick_:function(){print_preview.NativeLayer.getInstance().managePrinters()},onDestinationSelected_:function(e){this.fire("destination-selected",e.target)}})})();
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var CrSearchFieldBehavior={properties:{label:{type:String,value:""},clearLabel:{type:String,value:""},hasSearchText:{type:Boolean,reflectToAttribute:true,value:false},lastValue_:{type:String,value:""}},getSearchInput:function(){},getValue:function(){return this.getSearchInput().value},setValue:function(value,opt_noEvent){var searchInput=this.getSearchInput();searchInput.value=value;this.onSearchTermInput();this.onValueChanged_(value,!!opt_noEvent)},onSearchTermSearch:function(){this.onValueChanged_(this.getValue(),false)},onSearchTermInput:function(){this.hasSearchText=this.$.searchInput.value!=""},onValueChanged_:function(newValue,noEvent){if(newValue==this.lastValue_)return;this.lastValue_=newValue;if(!noEvent)this.fire("search-changed",newValue)}};
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
(function(){"use strict";const SANITIZE_REGEX=/[-[\]{}()*+?.,\\^$|#\s]/g;Polymer({is:"print-preview-search-box",behaviors:[CrSearchFieldBehavior],properties:{searchQuery:{type:Object,notify:true}},listeners:{"search-changed":"onSearchChanged_"},timeout_:null,getSearchInput:function(){return this.$.searchInput},onSearchChanged_:function(e){let safeQuery=e.detail.trim().replace(SANITIZE_REGEX,"\\$&");safeQuery=safeQuery.length>0?new RegExp(`(${safeQuery})`,"i"):null;if(this.timeout_)clearTimeout(this.timeout_);this.timeout_=setTimeout(()=>{this.searchQuery=safeQuery;this.timeout_=null},150)}})})();
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.ResolverState={INITIAL:"INITIAL",ACTIVE:"ACTIVE",GRANTING_PERMISSION:"GRANTING_PERMISSION",ERROR:"ERROR",DONE:"DONE"};Polymer({is:"print-preview-provisional-destination-resolver",behaviors:[I18nBehavior],properties:{destinationStore:Object,destination_:{type:Object,value:null},state_:{type:String,value:print_preview_new.ResolverState.INITIAL}},promiseResolver_:null,resolveDestination:function(destination){this.state_=print_preview_new.ResolverState.ACTIVE;this.destination_=destination;this.$.dialog.showModal();const icon=this.$$(".extension-icon");icon.style.backgroundImage="-webkit-image-set("+"url(chrome://extension-icon/"+this.destination_.extensionId+"/24/1) 1x,"+"url(chrome://extension-icon/"+this.destination_.extensionId+"/48/1) 2x)";this.promiseResolver_=new PromiseResolver;return this.promiseResolver_.promise},startResolveDestination_:function(){assert(this.state_==print_preview_new.ResolverState.ACTIVE,"Invalid state in request grant permission");this.state_=print_preview_new.ResolverState.GRANTING_PERMISSION;const destination=this.destination_;this.destinationStore.resolveProvisionalDestination(destination).then(resolvedDestination=>{if(this.state_!=print_preview_new.ResolverState.GRANTING_PERMISSION){return}if(destination.id!=this.destination_.id)return;if(resolvedDestination){this.state_=print_preview_new.ResolverState.DONE;this.promiseResolver_.resolve(resolvedDestination);this.promiseResolver_=null;this.$.dialog.close()}else{this.state_=print_preview_new.ResolverState.ERROR}})},onCancel_:function(){this.promiseResolver_.reject();this.$.dialog.close();this.state_=print_preview_new.ResolverState.INITIAL},getPermissionMessage_:function(){return this.state_==print_preview_new.ResolverState.ERROR?this.i18n("resolveExtensionUSBErrorMessage",this.destination_.extensionName):this.i18n("resolveExtensionUSBPermissionMessage")},isInErrorState_:function(){return this.state_==print_preview_new.ResolverState.ERROR},isInActiveState_:function(){return this.state_==print_preview_new.ResolverState.ACTIVE},getThrobberClass_:function(){return this.state_==print_preview_new.ResolverState.GRANTING_PERMISSION?"throbber":""}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-destination-dialog",behaviors:[I18nBehavior],properties:{destinationStore:{type:Object,observer:"onDestinationStoreSet_"},invitationStore:{type:Object,observer:"onInvitationStoreSet_"},invitation_:{type:Object,value:null},userInfo:{type:Object,notify:true},showCloudPrintPromo:{type:Boolean,notify:true,observer:"onShowCloudPrintPromoChanged_"},destinations_:{type:Array,notify:true,value:[]},loadingDestinations_:{type:Boolean,value:false},recentDestinations:Array,recentDestinationList_:{type:Array,notify:true,computed:"computeRecentDestinationList_("+"destinationStore, recentDestinations, recentDestinations.*, "+"userInfo, destinations_.*)"},searchQuery_:{type:Object,value:null}},tracker_:new EventTracker,metrics_:new print_preview.DestinationSearchMetricsContext,ready:function(){this.$$(".promo-text").innerHTML=this.i18nAdvanced("cloudPrintPromotion",{substitutions:['<a is="action-link" class="sign-in">',"</a>"],attrs:{is:(node,v)=>v=="action-link",class:(node,v)=>v=="sign-in",tabindex:(node,v)=>v=="0",role:(node,v)=>v=="link"}})},attached:function(){this.tracker_.add(assert(this.$$(".sign-in")),"click",this.onSignInClick_.bind(this));this.tracker_.add(assert(this.$$("#cloudprintPromo > .close-button")),"click",this.onCloudPrintPromoDismissed_.bind(this))},onDestinationStoreSet_:function(){assert(this.destinations_.length==0);const destinationStore=assert(this.destinationStore);this.tracker_.add(destinationStore,print_preview.DestinationStore.EventType.DESTINATIONS_INSERTED,this.updateDestinations_.bind(this));this.tracker_.add(destinationStore,print_preview.DestinationStore.EventType.DESTINATION_SEARCH_DONE,this.onDestinationSearchDone_.bind(this))},onInvitationStoreSet_:function(){const invitationStore=assert(this.invitationStore);this.tracker_.add(invitationStore,print_preview.InvitationStore.EventType.INVITATION_SEARCH_DONE,this.updateInvitations_.bind(this));this.tracker_.add(invitationStore,print_preview.InvitationStore.EventType.INVITATION_PROCESSED,this.updateInvitations_.bind(this))},onDestinationSearchDone_:function(){this.updateDestinations_();this.invitationStore.startLoadingInvitations()},updateDestinations_:function(){this.notifyPath("userInfo.users");this.notifyPath("userInfo.activeUser");this.notifyPath("userInfo.loggedIn");if(this.userInfo.loggedIn)this.showCloudPrintPromo=false;this.destinations_=this.userInfo?this.destinationStore.destinations(this.userInfo.activeUser):[];this.loadingDestinations_=this.destinationStore.isPrintDestinationSearchInProgress},computeRecentDestinationList_:function(){let recentDestinations=[];const filterAccount=this.userInfo.activeUser;this.recentDestinations.forEach(recentDestination=>{const destination=this.destinationStore.getDestination(recentDestination.origin,recentDestination.id,recentDestination.account||"");if(destination&&(!destination.account||destination.account==filterAccount)){recentDestinations.push(destination)}});return recentDestinations},onCloseOrCancel_:function(){if(this.searchQuery_)this.$.searchBox.setValue("");if(this.$.dialog.getNative().returnValue=="success"){this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.DESTINATION_CLOSED_CHANGED)}else{this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.DESTINATION_CLOSED_UNCHANGED)}},onCancelButtonClick_:function(){this.$.dialog.cancel()},onDestinationSelected_:function(e){const listItem=e.detail;const destination=listItem.destination;if(destination.readyForSelection){this.selectDestination_(destination);return}if(destination.isProvisional){this.$.provisionalResolver.resolveDestination(destination).then(this.selectDestination_.bind(this)).catch(function(){console.error("Failed to resolve provisional destination: "+destination.id)}).then(()=>{if(this.$.dialog.open&&!!listItem&&!listItem.hidden){listItem.focus()}});return}},selectDestination_:function(destination){this.destinationStore.selectDestination(destination);this.$.dialog.close()},show:function(){this.loadingDestinations_=this.destinationStore.isPrintDestinationSearchInProgress;this.$.dialog.showModal();this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.DESTINATION_SHOWN)},isOpen:function(){return this.$.dialog.hasAttribute("open")},isSelected_:function(account){return account==this.userInfo.activeUser},onSignInClick_:function(){this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.SIGNIN_TRIGGERED);print_preview.NativeLayer.getInstance().signIn(false).then(()=>{this.destinationStore.onDestinationsReload()})},onCloudPrintPromoDismissed_:function(){this.showCloudPrintPromo=false},updateInvitations_:function(){const invitations=this.userInfo.activeUser?this.invitationStore.invitations(this.userInfo.activeUser):[];if(this.invitation_!=invitations[0]){this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.INVITATION_AVAILABLE)}this.invitation_=invitations.length>0?invitations[0]:null},getAcceptButtonText_:function(){if(!this.invitation_)return"";return this.invitation_.asGroupManager?this.i18n("acceptForGroup"):this.i18n("accept")},getInvitationText_:function(){if(!this.invitation_)return"";if(this.invitation_.asGroupManager){return this.i18nAdvanced("groupPrinterSharingInviteText",{substitutions:[this.invitation_.sender,this.invitation_.destination.displayName,this.invitation_.receiver]})}return this.i18nAdvanced("printerSharingInviteText",{substitutions:[this.invitation_.sender,this.invitation_.destination.displayName]})},onInvitationAcceptClick_:function(){this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.INVITATION_ACCEPTED);this.invitationStore.processInvitation(assert(this.invitation_),true);this.updateInvitations_()},onInvitationRejectClick_:function(){this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.INVITATION_REJECTED);this.invitationStore.processInvitation(assert(this.invitation_),false);this.updateInvitations_()},onUserChange_:function(){const select=this.$$("select");const account=select.value;if(account){this.showCloudPrintPromo=false;this.userInfo.activeUser=account;this.notifyPath("userInfo.activeUser");this.notifyPath("userInfo.loggedIn");this.destinationStore.reloadUserCookieBasedDestinations();this.invitationStore.startLoadingInvitations();this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.ACCOUNT_CHANGED)}else{print_preview.NativeLayer.getInstance().signIn(true).then(this.destinationStore.onDestinationsReload.bind(this.destinationStore));const options=select.querySelectorAll("option");for(let i=0;i<options.length;i++){if(options[i].value==this.userInfo.activeUser){select.selectedIndex=i;break}}this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.ADD_ACCOUNT_SELECTED)}},onShowCloudPrintPromoChanged_:function(){if(this.showCloudPrintPromo){this.metrics_.record(print_preview.Metrics.DestinationSearchBucket.SIGNIN_PROMPT)}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-settings-section"});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-destination-settings",behaviors:[I18nBehavior],properties:{destination:Object,destinationStore:Object,invitationStore:Object,recentDestinations:Array,userInfo:{type:Object,notify:true},disabled:Boolean,state:Number,showCloudPrintPromo_:{type:Boolean,value:false},loadingDestination_:{type:Boolean,value:true},stale_:{type:Boolean,computed:"computeStale_(destination)",reflectToAttribute:true}},observers:["onDestinationSet_(destination, destination.id)"],shouldDisableButton_:function(){return!this.destinationStore||this.disabled&&this.state!=print_preview_new.State.INVALID_PRINTER},onDestinationSet_:function(){if(this.destination&&this.destination.id)this.loadingDestination_=false},getStatusText_:function(){return this.destination.shouldShowInvalidCertificateError?this.i18n("noLongerSupportedFragment"):this.destination.connectionStatusText},onChangeButtonClick_:function(){this.destinationStore.startLoadAllDestinations();this.invitationStore.startLoadingInvitations();const dialog=this.$.destinationDialog.get();this.async(()=>{dialog.show()},1)},showCloudPrintPromo:function(){this.showCloudPrintPromo_=true},isDialogOpen:function(){const destinationDialog=this.$$("print-preview-destination-dialog");return destinationDialog&&destinationDialog.isOpen()},computeStale_:function(){return!!this.destination&&(this.destination.isOffline||this.destination.shouldShowInvalidCertificateError)}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
(function(){"use strict";const PagesInputErrorState={NO_ERROR:0,INVALID_SYNTAX:1,OUT_OF_BOUNDS:2};Polymer({is:"print-preview-pages-settings",behaviors:[SettingsBehavior,print_preview_new.InputBehavior],properties:{documentInfo:Object,inputString_:{type:String,value:""},allPagesArray_:{type:Array,computed:"computeAllPagesArray_(documentInfo.pageCount)"},allSelected_:{type:Boolean,value:true},customSelected_:{type:Boolean,value:false},disabled:Boolean,errorState_:{type:Number,value:PagesInputErrorState.NO_ERROR},pagesToPrint_:{type:Array,computed:"computePagesToPrint_("+"inputString_, allSelected_, allPagesArray_)"},rangesToPrint_:{type:Array,computed:"computeRangesToPrint_(pagesToPrint_, allPagesArray_)"},inputPattern_:{type:String,notify:true,value:"([0-9]*(-)?[0-9]*(,|、)( )?)*([0-9]*(-)?[0-9]*(,|、)?( )?)?"}},observers:["onRangeChange_(errorState_, rangesToPrint_)","onRadioChange_(allSelected_, customSelected_)"],listeners:{"input-change":"onInputChange_"},getInput:function(){return this.$.pageSettingsCustomInput},onInputChange_:function(e){this.inputString_=e.detail},getDisabled_:function(){return this.errorState_==PagesInputErrorState.NO_ERROR&&this.disabled},computeAllPagesArray_:function(){const array=new Array(this.documentInfo.pageCount);for(let i=0;i<array.length;i++)array[i]=i+1;return array},computePagesToPrint_:function(){if(this.allSelected_||this.inputString_.trim()==""){this.errorState_=PagesInputErrorState.NO_ERROR;return this.allPagesArray_}if(!this.$.pageSettingsCustomInput.validity.valid){this.errorState_=PagesInputErrorState.INVALID_SYNTAX;return this.pagesToPrint_}const pages=[];const added={};const ranges=this.inputString_.split(/,|\u3001/);const maxPage=this.allPagesArray_.length;for(let range of ranges){range=range.trim();if(range==""){this.errorState_=PagesInputErrorState.INVALID_SYNTAX;return this.pagesToPrint_}const limits=range.split("-");let min=parseInt(limits[0],10);if(min<1){this.errorState_=PagesInputErrorState.INVALID_SYNTAX;return this.pagesToPrint_}if(limits.length==1){if(min>maxPage){this.errorState_=PagesInputErrorState.OUT_OF_BOUNDS;return this.pagesToPrint_}if(!added.hasOwnProperty(min)){pages.push(min);added[min]=true}continue}let max=parseInt(limits[1],10);if(isNaN(min))min=1;if(isNaN(max))max=maxPage;if(min>max){this.errorState_=PagesInputErrorState.INVALID_SYNTAX;return this.pagesToPrint_}if(max>maxPage){this.errorState_=PagesInputErrorState.OUT_OF_BOUNDS;return this.pagesToPrint_}for(let i=min;i<=max;i++){if(!added.hasOwnProperty(i)){pages.push(i);added[i]=true}}}this.errorState_=PagesInputErrorState.NO_ERROR;return pages},computeRangesToPrint_:function(){let lastPage=0;if(this.pagesToPrint_.length==0||this.pagesToPrint_[0]==-1||this.pagesToPrint_==this.allPagesArray_)return[];let from=this.pagesToPrint_[0];let to=this.pagesToPrint_[0];let ranges=[];for(let page of this.pagesToPrint_.slice(1)){if(page==to+1){to=page;continue}ranges.push({from:from,to:to});from=page;to=page}ranges.push({from:from,to:to});return ranges},settingMatches_:function(){const setting=this.getSetting("pages").value;if(setting.length!=this.pagesToPrint_.length)return false;for(let index=0;index<this.pagesToPrint_.length;index++){if(this.pagesToPrint_[index]!=setting[index])return false}return true},onRangeChange_:function(){if(this.errorState_!=PagesInputErrorState.NO_ERROR){this.setSettingValid("pages",false);this.$.pageSettingsCustomInput.classList.add("invalid");return}this.$.pageSettingsCustomInput.classList.remove("invalid");this.setSettingValid("pages",true);if(!this.settingMatches_()){this.setSetting("pages",this.pagesToPrint_);this.setSetting("ranges",this.rangesToPrint_)}},onRadioChange_:function(){if(this.$$("#all-radio-button").checked)this.customSelected_=false;if(this.$$("#custom-radio-button").checked)this.allSelected_=false},onCustomRadioClick_:function(){this.$.pageSettingsCustomInput.focus()},onCustomInputFocus_:function(){this.$$("#all-radio-button").checked=false;this.$$("#custom-radio-button").checked=true;this.customSelected_=true},onCustomInputBlur_:function(event){if(this.inputString_.trim()==""&&event.relatedTarget!=this.$$(".custom-input-wrapper")&&event.relatedTarget!=this.$$("#custom-radio-button")){this.$$("#all-radio-button").checked=true;this.$$("#custom-radio-button").checked=false;this.allSelected_=true}},getHintMessage_:function(){if(this.errorState_==PagesInputErrorState.INVALID_SYNTAX){return loadTimeData.getStringF("pageRangeSyntaxInstruction",loadTimeData.getString("examplePageRangeText"))}else{return loadTimeData.getStringF("pageRangeLimitInstructionWithValue",this.documentInfo.pageCount)}},hintHidden_:function(){return this.errorState_==PagesInputErrorState.NO_ERROR}})})();
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-number-settings-section",behaviors:[print_preview_new.InputBehavior],properties:{inputString_:{type:String,notify:true,observer:"onInputChanged_"},inputValid:{type:Boolean,notify:true,value:true},currentValue:{type:String,notify:true,observer:"onCurrentValueChanged_"},defaultValue:String,maxValue:Number,minValue:Number,inputLabel:String,hintMessage:String,disabled:Boolean},listeners:{"input-change":"onInputChange_"},getInput:function(){return this.$.userValue},onInputChange_:function(e){this.inputString_=e.detail},getDisabled_:function(){return this.disabled&&this.inputValid},onKeydown_:function(e){if(e.key=="."||e.key=="e"||e.key=="-")e.preventDefault()},onBlur_:function(){if(this.inputString_=="")this.set("inputString_",this.defaultValue);if(this.$.userValue.value=="")this.$.userValue.value=this.defaultValue},onInputChanged_:function(){this.inputValid=this.computeValid_();this.currentValue=this.inputString_},onCurrentValueChanged_:function(){this.inputString_=this.currentValue;this.resetString()},computeValid_:function(){this.$.userValue.value=this.inputString_;return this.$.userValue.validity.valid&&this.inputString_!=""},hintHidden_:function(){return this.inputValid||this.inputString_==""}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-copies-settings",behaviors:[SettingsBehavior],properties:{currentValue_:String,inputValid_:Boolean,disabled:Boolean},observers:["onInputChanged_(currentValue_, inputValid_)","onSettingsChanged_(settings.copies.value, settings.collate.value)"],onSettingsChanged_:function(){const copies=this.getSetting("copies");this.currentValue_=copies.value.toString();const collate=this.getSetting("collate");this.$.collate.checked=collate.value},onInputChanged_:function(){this.setSetting("copies",this.inputValid_?parseInt(this.currentValue_,10):1);this.setSettingValid("copies",this.inputValid_)},collateHidden_:function(){return!this.inputValid_||parseInt(this.currentValue_,10)==1},onCollateChange_:function(){this.setSetting("collate",this.$.collate.checked)}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("print_preview_new",function(){const SelectBehavior={lastValue_:"",timeout_:null,ready:function(){assert(this.shadowRoot.querySelectorAll("select").length==1);this.$$("select").addEventListener("change",()=>{if(this.timeout_){clearTimeout(this.timeout_)}this.timeout_=setTimeout(this.onTimeout_.bind(this),100)})},onProcessSelectChange:function(value){},onTimeout_:function(){this.timeout_=null;const value=this.$$("select").value;if(this.lastValue_!=value){this.lastValue_=value;this.onProcessSelectChange(value);this.fire("process-select-change")}}};return{SelectBehavior:SelectBehavior}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-layout-settings",behaviors:[SettingsBehavior,print_preview_new.SelectBehavior],properties:{disabled:Boolean},observers:["onLayoutSettingChange_(settings.layout.value)"],onLayoutSettingChange_:function(value){this.$$("select").value=value?"landscape":"portrait"},onProcessSelectChange:function(value){this.setSetting("layout",value=="landscape")}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-color-settings",behaviors:[SettingsBehavior,print_preview_new.SelectBehavior],properties:{disabled:Boolean},observers:["onColorSettingChange_(settings.color.value)"],onColorSettingChange_:function(value){this.$$("select").value=value?"color":"bw"},onProcessSelectChange:function(value){this.setSetting("color",value=="color")}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.SelectOption;Polymer({is:"print-preview-settings-select",behaviors:[SettingsBehavior,print_preview_new.SelectBehavior],properties:{capability:Object,settingName:String,disabled:Boolean,selectedValue_:{type:String,notify:true,value:""}},isSelected_:function(option){return this.getValue_(option)==this.selectedValue_||!!option.is_default&&this.selectedValue_==""},selectValue:function(value){this.selectedValue_=value},getValue_:function(option){return JSON.stringify(option)},getDisplayName_:function(option){let displayName=option.custom_display_name;if(!displayName&&option.custom_display_name_localized){displayName=getStringForCurrentLocale(assert(option.custom_display_name_localized))}return displayName||option.name||""},onProcessSelectChange:function(value){let newValue=null;try{newValue=JSON.parse(value)}catch(e){assertNotReached();return}this.setSetting(this.settingName,newValue)}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-media-size-settings",behaviors:[SettingsBehavior],properties:{capability:Object,disabled:Boolean},observers:["onMediaSizeSettingChange_(settings.mediaSize.value, "+"capability.option)"],onMediaSizeSettingChange_:function(value){const valueToSet=JSON.stringify(value);for(const option of this.capability.option){if(JSON.stringify(option)==valueToSet){this.$$("print-preview-settings-select").selectValue(valueToSet);return}}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-margins-settings",behaviors:[SettingsBehavior,print_preview_new.SelectBehavior],properties:{disabled:Boolean},observers:["onMarginsSettingChange_(settings.margins.value)"],onMarginsSettingChange_:function(value){this.$$("select").value=value.toString()},onProcessSelectChange:function(value){this.setSetting("margins",parseInt(value,10))}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.DpiOption;print_preview_new.LabelledDpiOption;Polymer({is:"print-preview-dpi-settings",behaviors:[SettingsBehavior],properties:{capability:Object,disabled:Boolean,capabilityWithLabels_:{type:Object,computed:"computeCapabilityWithLabels_(capability)"}},observers:["onDpiSettingChange_(settings.dpi.value, capabilityWithLabels_.option)"],computeCapabilityWithLabels_:function(){if(!this.capability||!this.capability.option)return this.capability;const result=JSON.parse(JSON.stringify(this.capability));this.capability.option.forEach((option,index)=>{const dpiOption=option;const hDpi=dpiOption.horizontal_dpi||0;const vDpi=dpiOption.vertical_dpi||0;if(hDpi>0&&vDpi>0&&hDpi!=vDpi){result.option[index].name=loadTimeData.getStringF("nonIsotropicDpiItemLabel",hDpi.toLocaleString(),vDpi.toLocaleString())}else{result.option[index].name=loadTimeData.getStringF("dpiItemLabel",(hDpi||vDpi).toLocaleString())}});return result},onDpiSettingChange_:function(value){const dpiValue=value;for(const option of assert(this.capabilityWithLabels_.option)){const dpiOption=option;if(dpiValue.horizontal_dpi==dpiOption.horizontal_dpi&&dpiValue.vertical_dpi==dpiOption.vertical_dpi&&dpiValue.vendor_id==dpiOption.vendor_id){this.$$("print-preview-settings-select").selectValue(JSON.stringify(option));return}}}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-pages-per-sheet-settings",behaviors:[SettingsBehavior,print_preview_new.SelectBehavior],properties:{disabled:Boolean},observers:["onPagesPerSheetSettingChange_(settings.pagesPerSheet.value)"],onPagesPerSheetSettingChange_:function(value){this.$$("select").value=value.toString()},onProcessSelectChange:function(value){this.setSetting("pagesPerSheet",parseInt(value,10))}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.exportPath("print_preview_new");print_preview_new.ScalingState={INIT:0,VALID:1,INVALID:2,FIT_TO_PAGE:3};Polymer({is:"print-preview-scaling-settings",behaviors:[SettingsBehavior],properties:{documentInfo:Object,currentValue_:String,inputValid_:Boolean,hideInput_:Boolean,disabled:Boolean,currentState_:{type:Number,value:print_preview_new.ScalingState.INIT,observer:"onStateChange_"}},observers:["onFitToPageSettingChange_(settings.fitToPage.value)","onFitToPageScalingSet_(documentInfo.fitToPageScaling)","onInputChanged_(currentValue_, inputValid_)","onScalingSettingChanged_(settings.scaling.value)","onScalingValidChanged_(settings.scaling.valid)"],fitToPageTimeout_:null,ignoreFtp_:false,ignoreValid_:false,ignoreValue_:false,lastValidScaling_:"100",lastFitToPageValue_:null,onFitToPageSettingChange_:function(){if(this.ignoreFtp_||!this.getSetting("fitToPage").available)return;const fitToPage=this.getSetting("fitToPage").value;if(fitToPage){this.currentState_=print_preview_new.ScalingState.FIT_TO_PAGE;return}this.currentState_=this.getSetting("scaling").valid?print_preview_new.ScalingState.VALID:print_preview_new.ScalingState.INVALID},onFitToPageScalingSet_:function(){if(this.currentState_!=print_preview_new.ScalingState.FIT_TO_PAGE)return;this.ignoreValue_=true;this.currentValue_=this.documentInfo.fitToPageScaling.toString();this.ignoreValue_=false},onScalingSettingChanged_:function(){this.lastValidScaling_=this.getSetting("scaling").value;this.currentValue_=this.lastValidScaling_;this.currentState_=print_preview_new.ScalingState.VALID},onScalingValidChanged_:function(){if(this.ignoreValid_)return;this.currentState_=this.getSetting("scaling").valid?print_preview_new.ScalingState.VALID:print_preview_new.ScalingState.INVALID},onInputChanged_:function(){if(this.ignoreValue_)return;this.setSettingValid("scaling",this.inputValid_);if(this.inputValid_)this.setSetting("scaling",this.currentValue_)},onFitToPageChange_:function(){const newValue=this.$$("#fit-to-page-checkbox").checked;if(this.fitToPageTimeout_!==null)clearTimeout(this.fitToPageTimeout_);this.fitToPageTimeout_=setTimeout(()=>{this.fitToPageTimeout_=null;if(newValue===this.lastFitToPageValue_)return;this.lastFitToPageValue_=newValue;this.setSetting("fitToPage",newValue);if(newValue==false)this.currentValue_=this.lastValidScaling_;this.fire("update-checkbox-setting","fitToPage")},100)},getDisabled_:function(){return this.disabled&&this.inputValid_},onStateChange_:function(current,previous){if(previous==print_preview_new.ScalingState.FIT_TO_PAGE){this.ignoreFtp_=true;this.$$("#fit-to-page-checkbox").checked=false;this.lastFitToPageValue_=false;this.setSetting("fitToPage",false);this.ignoreFtp_=false}if(current==print_preview_new.ScalingState.FIT_TO_PAGE){if(previous==print_preview_new.ScalingState.INVALID){this.ignoreValid_=true;this.setSettingValid("scaling",true);this.ignoreValid_=false}this.$$("#fit-to-page-checkbox").checked=true;this.ignoreValue_=true;this.currentValue_=this.documentInfo.fitToPageScaling.toString();this.ignoreValue_=false}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-other-options-settings",behaviors:[SettingsBehavior],properties:{disabled:Boolean},observers:["onHeaderFooterSettingChange_(settings.headerFooter.value)","onDuplexSettingChange_(settings.duplex.value)","onCssBackgroundSettingChange_(settings.cssBackground.value)","onRasterizeSettingChange_(settings.rasterize.value)","onSelectionOnlySettingChange_(settings.selectionOnly.value)"],timeouts_:new Map,previousValues_:new Map,updateSettingWithTimeout_:function(settingName,newValue){const timeout=this.timeouts_.get(settingName);if(timeout!=null)clearTimeout(timeout);this.timeouts_.set(settingName,setTimeout(()=>{this.timeouts_.delete(settingName);if(this.previousValues_.get(settingName)==newValue)return;this.previousValues_.set(settingName,newValue);this.setSetting(settingName,newValue);this.fire("update-checkbox-setting",settingName)},100))},onHeaderFooterSettingChange_:function(value){this.$.headerFooter.checked=value},onDuplexSettingChange_:function(value){this.$.duplex.checked=value},onCssBackgroundSettingChange_:function(value){this.$.cssBackground.checked=value},onRasterizeSettingChange_:function(value){this.$.rasterize.checked=value},onSelectionOnlySettingChange_:function(value){this.$.selectionOnly.checked=value},onHeaderFooterChange_:function(){this.updateSettingWithTimeout_("headerFooter",this.$.headerFooter.checked)},onDuplexChange_:function(){this.updateSettingWithTimeout_("duplex",this.$.duplex.checked)},onCssBackgroundChange_:function(){this.updateSettingWithTimeout_("cssBackground",this.$.cssBackground.checked)},onRasterizeChange_:function(){this.updateSettingWithTimeout_("rasterize",this.$.rasterize.checked)},onSelectionOnlyChange_:function(){this.updateSettingWithTimeout_("selectionOnly",this.$.selectionOnly.checked)}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-advanced-settings-item",behaviors:[SettingsBehavior],properties:{capability:Object,currentValue_:{type:Object,value:null}},observers:["updateFromSettings_(capability, settings.vendorItems.value)"],highlighted_:false,updateFromSettings_:function(){const settings=this.getSetting("vendorItems").value;if(!settings.hasOwnProperty(this.capability.id))return;const value=settings[this.capability.id];if(this.isCapabilityTypeSelect_()){if(this.hasOptionWithValue_(value))this.currentValue_=value}else{this.currentValue_=value;this.$$('input[type="text"]').value=this.currentValue_}},getDisplayName_:function(item){let displayName=item.display_name;if(!displayName&&item.display_name_localized)displayName=getStringForCurrentLocale(item.display_name_localized);return displayName||""},isCapabilityTypeSelect_:function(){return this.capability.type=="SELECT"},isOptionSelected_:function(option){return this.currentValue_!==null&&option.value===this.currentValue_||this.currentValue_==null&&!!option.is_default},getCapabilityPlaceholder_:function(){if(this.capability.type=="TYPED_VALUE"&&this.capability.typed_value_cap&&this.capability.typed_value_cap.default!=undefined){return this.capability.typed_value_cap.default.toString()||""}if(this.capability.type=="RANGE"&&this.capability.range_cap&&this.capability.range_cap.default!=undefined)return this.capability.range_cap.default.toString()||"";return""},hasOptionWithValue_:function(value){return!!this.capability.select_cap&&!!this.capability.select_cap.option&&this.capability.select_cap.option.some(option=>option.value==value)},hasMatch:function(query){if(!query||this.getDisplayName_(this.capability).match(query))return true;if(!this.isCapabilityTypeSelect_())return false;for(let option of this.capability.select_cap.option){if(this.getDisplayName_(option).match(query))return true}return false},onUserInput_:function(e){this.currentValue_=e.target.value},getCurrentValue:function(){return this.currentValue_},updateHighlighting:function(query){this.highlighted_=print_preview.updateHighlights(this,query,this.highlighted_);return this.highlighted_||!query}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-advanced-dialog",behaviors:[SettingsBehavior,I18nBehavior],properties:{destination:Object,searchQuery_:{type:Object,value:null},hasMatching_:{type:Boolean,notify:true,computed:"computeHasMatching_(searchQuery_)"}},metrics_:new print_preview.PrintSettingsUiMetricsContext,hasMultipleItems_:function(){return this.destination.capabilities.printer.vendor_capability.length>1},computeHasMatching_:function(){const listItems=this.shadowRoot.querySelectorAll("print-preview-advanced-settings-item");let hasMatch=false;listItems.forEach(item=>{const matches=item.hasMatch(this.searchQuery_);item.hidden=!matches;hasMatch=hasMatch||matches;item.updateHighlighting(this.searchQuery_)});return hasMatch},shouldShowHint_:function(){return!!this.searchQuery_&&!this.hasMatching_},onCloseOrCancel_:function(){if(this.searchQuery_)this.$.searchBox.setValue("");if(this.$.dialog.getNative().returnValue=="success"){this.metrics_.record(print_preview.Metrics.PrintSettingsUiBucket.ADVANCED_SETTINGS_DIALOG_CANCELED)}},onCancelButtonClick_:function(){this.$.dialog.cancel()},onApplyButtonClick_:function(){const settingsValues={};this.shadowRoot.querySelectorAll("print-preview-advanced-settings-item").forEach(item=>{settingsValues[item.capability.id]=item.getCurrentValue()});this.setSetting("vendorItems",settingsValues);this.$.dialog.close()},show:function(){this.metrics_.record(print_preview.Metrics.PrintSettingsUiBucket.ADVANCED_SETTINGS_DIALOG_SHOWN);this.$.dialog.showModal()},close:function(){this.$.dialog.close()}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-advanced-options-settings",behaviors:[SettingsBehavior],properties:{disabled:Boolean,destination:Object},onButtonClick_:function(){const dialog=this.$.advancedDialog.get();this.async(()=>{dialog.show()},1)}});
// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var ActionLink=document.registerElement("action-link",{prototype:{__proto__:HTMLAnchorElement.prototype,createdCallback:function(){this.tabIndex=this.disabled?-1:0;if(!this.hasAttribute("role"))this.setAttribute("role","link");this.addEventListener("keydown",function(e){if(!this.disabled&&e.key=="Enter"&&!this.href){window.setTimeout(this.click.bind(this),0)}});function preventDefault(e){e.preventDefault()}function removePreventDefault(){document.removeEventListener("selectstart",preventDefault);document.removeEventListener("mouseup",removePreventDefault)}this.addEventListener("mousedown",function(){document.addEventListener("selectstart",preventDefault);document.addEventListener("mouseup",removePreventDefault);if(document.activeElement!=this)this.classList.add("no-outline")});this.addEventListener("blur",function(){this.classList.remove("no-outline")})},set disabled(disabled){if(disabled)HTMLAnchorElement.prototype.setAttribute.call(this,"disabled","");else HTMLAnchorElement.prototype.removeAttribute.call(this,"disabled");this.tabIndex=disabled?-1:0},get disabled(){return this.hasAttribute("disabled")},setAttribute:function(attr,val){if(attr.toLowerCase()=="disabled")this.disabled=true;else HTMLAnchorElement.prototype.setAttribute.apply(this,arguments)},removeAttribute:function(attr){if(attr.toLowerCase()=="disabled")this.disabled=false;else HTMLAnchorElement.prototype.removeAttribute.apply(this,arguments)}},extends:"a"});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-more-settings",behaviors:[I18nBehavior],properties:{settingsExpandedByUser:{type:Boolean,notify:true},disabled:Boolean},listeners:{click:"onMoreSettingsClick_"},metrics_:new print_preview.PrintSettingsUiMetricsContext,getIconClass_:function(){return this.settingsExpandedByUser?"minus-icon":"plus-icon"},getLabelText_:function(){return this.i18n(this.settingsExpandedByUser?"lessOptionsLabel":"moreOptionsLabel")},onMoreSettingsClick_:function(){this.settingsExpandedByUser=!this.settingsExpandedByUser;this.metrics_.record(this.settingsExpandedByUser?print_preview.Metrics.PrintSettingsUiBucket.MORE_SETTINGS_CLICKED:print_preview.Metrics.PrintSettingsUiBucket.LESS_SETTINGS_CLICKED)}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"print-preview-link-container",properties:{appKioskMode:Boolean,destination:Object,disabled:Boolean,shouldShowSystemDialogLink_:{type:Boolean,computed:"computeShouldShowSystemDialogLink_(appKioskMode, destination)"}},computeShouldShowSystemDialogLink_:function(){if(this.appKioskMode)return false;if(!cr.isWindows)return true;return!!this.destination&&this.destination.origin==print_preview.DestinationOrigin.LOCAL&&this.destination.id!=print_preview.Destination.GooglePromotedId.SAVE_AS_PDF},onSystemDialogClick_:function(){if(!this.shouldShowSystemDialogLink_)return;this.$.systemDialogThrobber.removeAttribute("hidden");this.fire("print-with-system-dialog")}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
(function(){"use strict";const MAX_SECTIONS_TO_SHOW=6;Polymer({is:"print-preview-app",behaviors:[SettingsBehavior],properties:{settings:{type:Object,notify:true},destination_:{type:Object,notify:true},destinationStore_:{type:Object,notify:true,value:null},documentInfo_:{type:Object,notify:true},invitationStore_:{type:Object,notify:true,value:null},recentDestinations_:{type:Array,notify:true},state:{type:Number,observer:"onStateChanged_"},userInfo_:{type:Object,notify:true,value:null},errorMessage_:{type:String,notify:true,value:""},controlsDisabled_:{type:Boolean,notify:true,computed:"computeControlsDisabled_(state)"},measurementSystem_:{type:Object,notify:true,value:null},isInAppKioskMode_:{type:Boolean,notify:true,value:false},previewState_:{type:String,observer:"onPreviewAreaStateChanged_"},settingsExpandedByUser_:{type:Boolean,notify:true,value:false},shouldShowMoreSettings_:{type:Boolean,notify:true,computed:"computeShouldShowMoreSettings_(settings.pages.available, "+"settings.copies.available, settings.layout.available, "+"settings.color.available, settings.mediaSize.available, "+"settings.dpi.available, settings.margins.available, "+"settings.pagesPerSheet.available, settings.scaling.available, "+"settings.otherOptions.available, settings.vendorItems.available)"},showPagesPerSheet_:{type:Boolean,value:function(){return loadTimeData.getBoolean("pagesPerSheetEnabled")}}},listenerTracker_:null,nativeLayer_:null,cloudPrintInterface_:null,tracker_:new EventTracker,cancelled_:false,showSystemDialogBeforePrint_:false,openPdfInPreview_:false,isInKioskAutoPrintMode_:false,attached:function(){this.nativeLayer_=print_preview.NativeLayer.getInstance();this.documentInfo_=new print_preview.DocumentInfo;this.userInfo_=new print_preview.UserInfo;this.listenerTracker_=new WebUIListenerTracker;this.listenerTracker_.add("use-cloud-print",this.onCloudPrintEnable_.bind(this));this.listenerTracker_.add("print-failed",this.onPrintFailed_.bind(this));this.listenerTracker_.add("print-preset-options",this.onPrintPresetOptions_.bind(this));this.destinationStore_=new print_preview.DestinationStore(this.userInfo_,this.listenerTracker_);this.invitationStore_=new print_preview.InvitationStore(this.userInfo_);this.tracker_.add(window,"keydown",this.onKeyDown_.bind(this));this.$.previewArea.setPluginKeyEventCallback(this.onKeyDown_.bind(this));this.tracker_.add(this.destinationStore_,print_preview.DestinationStore.EventType.DESTINATION_SELECT,this.onDestinationSelect_.bind(this));this.tracker_.add(this.destinationStore_,print_preview.DestinationStore.EventType.SELECTED_DESTINATION_CAPABILITIES_READY,this.onDestinationUpdated_.bind(this));this.tracker_.add(this.destinationStore_,print_preview.DestinationStore.EventType.SELECTED_DESTINATION_UNSUPPORTED,this.onInvalidPrinter_.bind(this));this.nativeLayer_.getInitialSettings().then(this.onInitialSettingsSet_.bind(this))},detached:function(){this.listenerTracker_.removeAll();this.tracker_.removeAll()},computeControlsDisabled_:function(){return this.state!=print_preview_new.State.READY},onKeyDown_:function(e){if(e.code=="Escape"&&!hasKeyModifiers(e)){if(cr.isMac){this.close_();e.preventDefault()}return}if(cr.isMac&&e.code=="Minus"&&e.metaKey){this.close_();e.preventDefault();return}if(e.code=="KeyP"){if(cr.isMac&&e.metaKey&&e.altKey&&!e.shiftKey&&!e.ctrlKey||!cr.isMac&&e.shiftKey&&e.ctrlKey&&!e.altKey&&!e.metaKey){if(!cr.isWin||this.state==print_preview_new.State.READY)this.onPrintWithSystemDialog_();e.preventDefault();return}}if(e.code=="Enter"&&this.state==print_preview_new.State.READY){const activeElementTag=e.path[0].tagName;if(["BUTTON","SELECT","A"].includes(activeElementTag))return;this.onPrintRequested_();e.preventDefault();return}this.$.previewArea.handleDirectionalKeyEvent(e)},onInitialSettingsSet_:function(settings){this.documentInfo_.init(settings.previewModifiable,settings.documentTitle,settings.documentHasSelection);this.notifyPath("documentInfo_.isModifiable");this.notifyPath("documentInfo_.hasSelection");this.notifyPath("documentInfo_.title");this.notifyPath("documentInfo_.pageCount");this.$.model.setStickySettings(settings.serializedAppStateStr);this.measurementSystem_=new print_preview.MeasurementSystem(settings.thousandsDelimeter,settings.decimalDelimeter,settings.unitType);this.setSetting("selectionOnly",settings.shouldPrintSelectionOnly);this.destinationStore_.init(settings.isInAppKioskMode,settings.printerName,settings.serializedDefaultDestinationSelectionRulesStr,this.recentDestinations_);this.isInAppKioskMode_=settings.isInAppKioskMode;this.isInKioskAutoPrintMode_=settings.isInKioskAutoPrintMode},onCloudPrintEnable_:function(cloudPrintUrl,appKioskMode){assert(!this.cloudPrintInterface_);this.cloudPrintInterface_=new cloudprint.CloudPrintInterface(cloudPrintUrl,assert(this.nativeLayer_),assert(this.userInfo_),appKioskMode);this.tracker_.add(assert(this.cloudPrintInterface_),cloudprint.CloudPrintInterfaceEventType.SUBMIT_DONE,this.close_.bind(this));[cloudprint.CloudPrintInterfaceEventType.SEARCH_FAILED,cloudprint.CloudPrintInterfaceEventType.SUBMIT_FAILED,cloudprint.CloudPrintInterfaceEventType.PRINTER_FAILED].forEach(eventType=>{this.tracker_.add(assert(this.cloudPrintInterface_),eventType,this.onCloudPrintError_.bind(this))});this.destinationStore_.setCloudPrintInterface(this.cloudPrintInterface_);this.invitationStore_.setCloudPrintInterface(this.cloudPrintInterface_);if(this.$.destinationSettings.isDialogOpen()){this.destinationStore_.startLoadCloudDestinations();this.invitationStore_.startLoadingInvitations()}},onDestinationSelect_:function(){if(this.state==print_preview_new.State.FATAL_ERROR)return;this.$.state.transitTo(print_preview_new.State.NOT_READY);this.destination_=this.destinationStore_.selectedDestination},onDestinationUpdated_:function(){this.set("destination_.capabilities",this.destinationStore_.selectedDestination.capabilities);if(!this.$.model.initialized())this.$.model.applyStickySettings();if(this.state==print_preview_new.State.NOT_READY||this.state==print_preview_new.State.INVALID_PRINTER){this.$.state.transitTo(print_preview_new.State.READY);if(this.isInKioskAutoPrintMode_)this.onPrintRequested_()}},onSaveStickySettings_:function(e){this.nativeLayer_.saveAppState(e.detail)},onStateChanged_:function(){if(this.state==print_preview_new.State.CLOSING){this.remove();this.nativeLayer_.dialogClose(this.cancelled_)}else if(this.state==print_preview_new.State.HIDDEN){this.nativeLayer_.hidePreview()}else if(this.state==print_preview_new.State.PRINTING){if(this.shouldShowMoreSettings_){(new print_preview.PrintSettingsUiMetricsContext).record(this.settingsExpandedByUser_?print_preview.Metrics.PrintSettingsUiBucket.PRINT_WITH_SETTINGS_EXPANDED:print_preview.Metrics.PrintSettingsUiBucket.PRINT_WITH_SETTINGS_COLLAPSED)}const destination=assert(this.destinationStore_.selectedDestination);const whenPrintDone=this.nativeLayer_.print(this.$.model.createPrintTicket(destination,this.openPdfInPreview_,this.showSystemDialogBeforePrint_));if(destination.isLocal){const onError=destination.id==print_preview.Destination.GooglePromotedId.SAVE_AS_PDF?this.onFileSelectionCancel_.bind(this):this.onPrintFailed_.bind(this);whenPrintDone.then(this.close_.bind(this),onError)}else{whenPrintDone.then(this.onPrintToCloud_.bind(this),this.onPrintFailed_.bind(this))}}},onPrintRequested_:function(){this.$.state.transitTo(this.$.previewArea.previewLoaded()?print_preview_new.State.PRINTING:print_preview_new.State.HIDDEN)},onCancelRequested_:function(){this.cancelled_=true;this.$.state.transitTo(print_preview_new.State.CLOSING)},onSettingValidChanged_:function(e){this.$.state.transitTo(e.detail?print_preview_new.State.READY:print_preview_new.State.INVALID_TICKET)},onFileSelectionCancel_:function(){this.$.state.transitTo(print_preview_new.State.READY)},onPrintToCloud_:function(data){assert(this.cloudPrintInterface_!=null,"Google Cloud Print is not enabled");const destination=assert(this.destinationStore_.selectedDestination);this.cloudPrintInterface_.submit(destination,this.$.model.createCloudJobTicket(destination),assert(this.documentInfo_),data)},
// <if expr="not chromeos">
onPrintWithSystemDialog_:function(){assert(!cr.isChromeOS);if(cr.isWindows){this.showSystemDialogBeforePrint_=true;this.onPrintRequested_();return}this.nativeLayer_.showSystemDialog();this.$.state.transitTo(print_preview_new.State.SYSTEM_DIALOG)},
// </if>
// <if expr="is_macosx">
onOpenPdfInPreview_:function(){this.openPdfInPreview_=true;this.$.previewArea.setOpeningPdfInPreview();this.onPrintRequested_()},
// </if>
onPrintFailed_:function(httpError){console.error("Printing failed with error code "+httpError);this.errorMessage_=httpError.toString();this.$.state.transitTo(print_preview_new.State.FATAL_ERROR)},onInvalidPrinter_:function(){this.previewState_=print_preview_new.PreviewAreaState.UNSUPPORTED_CLOUD_PRINTER},onPreviewAreaStateChanged_:function(){switch(this.previewState_){case print_preview_new.PreviewAreaState.PREVIEW_FAILED:case print_preview_new.PreviewAreaState.NO_PLUGIN:this.$.state.transitTo(print_preview_new.State.FATAL_ERROR);break;case print_preview_new.PreviewAreaState.INVALID_SETTINGS:case print_preview_new.PreviewAreaState.UNSUPPORTED_CLOUD_PRINTER:if(this.state!=print_preview_new.State.INVALID_PRINTER)this.$.state.transitTo(print_preview_new.State.INVALID_PRINTER);break;case print_preview_new.PreviewAreaState.DISPLAY_PREVIEW:case print_preview_new.PreviewAreaState.OPEN_IN_PREVIEW_LOADED:if(this.state==print_preview_new.State.HIDDEN)this.$.state.transitTo(print_preview_new.State.PRINTING);break;default:break}},onCloudPrintError_:function(event){if(event.status==0){return}if(event.status==403){if(!this.isInAppKioskMode_){this.$.destinationSettings.showCloudPrintPromo()}}else{this.set("state_.cloudPrintError",event.message)}if(event.status==200){console.error(`Google Cloud Print Error: (${event.errorCode}) ${event.message}`)}else{console.error(`Google Cloud Print Error: HTTP status ${event.status}`)}},onPrintPresetOptions_:function(disableScaling,copies,duplex){if(disableScaling)this.documentInfo_.updateIsScalingDisabled(true);if(copies>0&&this.getSetting("copies").available)this.setSetting("copies",copies);if(duplex>=0&&this.getSetting("duplex").available)this.setSetting("duplex",duplex)},computeShouldShowMoreSettings_:function(){return["pages","copies","layout","color","mediaSize","margins","color","pagesPerSheet","scaling","otherOptions","vendorItems"].reduce((count,setting)=>{return this.getSetting(setting).available?count+1:count},1)>MAX_SECTIONS_TO_SHOW},shouldExpandSettings_:function(){return this.settingsExpandedByUser_||!this.shouldShowMoreSettings_},close_:function(){this.$.state.transitTo(print_preview_new.State.CLOSING)}})})();