// Copyright (c) 2013 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function assert(condition,opt_message){if(!condition){var message="Assertion failed";if(opt_message)message=message+": "+opt_message;var error=new Error(message);var global=function(){return this}();if(global.traceAssertionsForTesting)console.warn(error.stack);throw error}return condition}function assertNotReached(opt_message){assert(false,opt_message||"Unreachable code hit")}function assertInstanceof(value,type,opt_message){if(!(value instanceof type)){assertNotReached(opt_message||"Value "+value+" is not a[n] "+(type.name||typeof type))}return value}
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function PromiseResolver(){this.resolve_;this.reject_;this.promise_=new Promise(function(resolve,reject){this.resolve_=resolve;this.reject_=reject}.bind(this))}PromiseResolver.prototype={get promise(){return this.promise_},set promise(p){assertNotReached()},get resolve(){return this.resolve_},set resolve(r){assertNotReached()},get reject(){return this.reject_},set reject(s){assertNotReached()}};
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var global=this;var WebUIListener;var cr=cr||function(){"use strict";function exportPath(name,opt_object,opt_objectToExportTo){var parts=name.split(".");var cur=opt_objectToExportTo||global;for(var part;parts.length&&(part=parts.shift());){if(!parts.length&&opt_object!==undefined){cur[part]=opt_object}else if(part in cur){cur=cur[part]}else{cur=cur[part]={}}}return cur}function dispatchPropertyChange(target,propertyName,newValue,oldValue){var e=new Event(propertyName+"Change");e.propertyName=propertyName;e.newValue=newValue;e.oldValue=oldValue;target.dispatchEvent(e)}function getAttributeName(jsName){return jsName.replace(/([A-Z])/g,"-$1").toLowerCase()}var PropertyKind={JS:"js",ATTR:"attr",BOOL_ATTR:"boolAttr"};function getGetter(name,kind){switch(kind){case PropertyKind.JS:var privateName=name+"_";return function(){return this[privateName]};case PropertyKind.ATTR:var attributeName=getAttributeName(name);return function(){return this.getAttribute(attributeName)};case PropertyKind.BOOL_ATTR:var attributeName=getAttributeName(name);return function(){return this.hasAttribute(attributeName)}}throw"not reached"}function getSetter(name,kind,opt_setHook){switch(kind){case PropertyKind.JS:var privateName=name+"_";return function(value){var oldValue=this[name];if(value!==oldValue){this[privateName]=value;if(opt_setHook)opt_setHook.call(this,value,oldValue);dispatchPropertyChange(this,name,value,oldValue)}};case PropertyKind.ATTR:var attributeName=getAttributeName(name);return function(value){var oldValue=this[name];if(value!==oldValue){if(value==undefined)this.removeAttribute(attributeName);else this.setAttribute(attributeName,value);if(opt_setHook)opt_setHook.call(this,value,oldValue);dispatchPropertyChange(this,name,value,oldValue)}};case PropertyKind.BOOL_ATTR:var attributeName=getAttributeName(name);return function(value){var oldValue=this[name];if(value!==oldValue){if(value)this.setAttribute(attributeName,name);else this.removeAttribute(attributeName);if(opt_setHook)opt_setHook.call(this,value,oldValue);dispatchPropertyChange(this,name,value,oldValue)}}}throw"not reached"}function defineProperty(obj,name,opt_kind,opt_setHook){if(typeof obj=="function")obj=obj.prototype;var kind=opt_kind||PropertyKind.JS;if(!obj.__lookupGetter__(name))obj.__defineGetter__(name,getGetter(name,kind));if(!obj.__lookupSetter__(name))obj.__defineSetter__(name,getSetter(name,kind,opt_setHook))}var uidCounter=1;function createUid(){return uidCounter++}function getUid(item){if(item.hasOwnProperty("uid"))return item.uid;return item.uid=createUid()}function dispatchSimpleEvent(target,type,opt_bubbles,opt_cancelable){var e=new Event(type,{bubbles:opt_bubbles,cancelable:opt_cancelable===undefined||opt_cancelable});return target.dispatchEvent(e)}function define(name,fun){var obj=exportPath(name);var exports=fun();for(var propertyName in exports){var propertyDescriptor=Object.getOwnPropertyDescriptor(exports,propertyName);if(propertyDescriptor)Object.defineProperty(obj,propertyName,propertyDescriptor)}}function addSingletonGetter(ctor){ctor.getInstance=function(){return ctor.instance_||(ctor.instance_=new ctor)}}function makePublic(ctor,methods,opt_target){methods.forEach(function(method){ctor[method]=function(){var target=opt_target?document.getElementById(opt_target):ctor.getInstance();return target[method+"_"].apply(target,arguments)}})}var chromeSendResolverMap={};function webUIResponse(id,isSuccess,response){var resolver=chromeSendResolverMap[id];delete chromeSendResolverMap[id];if(isSuccess)resolver.resolve(response);else resolver.reject(response)}function sendWithPromise(methodName,var_args){var args=Array.prototype.slice.call(arguments,1);var promiseResolver=new PromiseResolver;var id=methodName+"_"+createUid();chromeSendResolverMap[id]=promiseResolver;chrome.send(methodName,[id].concat(args));return promiseResolver.promise}var webUIListenerMap={};function webUIListenerCallback(event,var_args){var eventListenersMap=webUIListenerMap[event];if(!eventListenersMap){return}var args=Array.prototype.slice.call(arguments,1);for(var listenerId in eventListenersMap){eventListenersMap[listenerId].apply(null,args)}}function addWebUIListener(eventName,callback){webUIListenerMap[eventName]=webUIListenerMap[eventName]||{};var uid=createUid();webUIListenerMap[eventName][uid]=callback;return{eventName:eventName,uid:uid}}function removeWebUIListener(listener){var listenerExists=webUIListenerMap[listener.eventName]&&webUIListenerMap[listener.eventName][listener.uid];if(listenerExists){delete webUIListenerMap[listener.eventName][listener.uid];return true}return false}return{addSingletonGetter:addSingletonGetter,createUid:createUid,define:define,defineProperty:defineProperty,dispatchPropertyChange:dispatchPropertyChange,dispatchSimpleEvent:dispatchSimpleEvent,exportPath:exportPath,getUid:getUid,makePublic:makePublic,PropertyKind:PropertyKind,addWebUIListener:addWebUIListener,removeWebUIListener:removeWebUIListener,sendWithPromise:sendWithPromise,webUIListenerCallback:webUIListenerCallback,webUIResponse:webUIResponse,get doc(){return document},get isMac(){return/Mac/.test(navigator.platform)},get isWindows(){return/Win/.test(navigator.platform)},get isChromeOS(){return/CrOS/.test(navigator.userAgent)},get isLinux(){return/Linux/.test(navigator.userAgent)},get isAndroid(){return/Android/.test(navigator.userAgent)},get isIOS(){return/iPad|iPhone|iPod/.test(navigator.platform)}}}();
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.ui",function(){function decorate(source,constr){var elements;if(typeof source=="string")elements=cr.doc.querySelectorAll(source);else elements=[source];for(var i=0,el;el=elements[i];i++){if(!(el instanceof constr))constr.decorate(el)}}function createElementHelper(tagName,opt_bag){var doc;if(opt_bag&&opt_bag.ownerDocument)doc=opt_bag.ownerDocument;else doc=cr.doc;return doc.createElement(tagName)}function define(tagNameOrFunction){var createFunction,tagName;if(typeof tagNameOrFunction=="function"){createFunction=tagNameOrFunction;tagName=""}else{createFunction=createElementHelper;tagName=tagNameOrFunction}function f(opt_propertyBag){var el=createFunction(tagName,opt_propertyBag);f.decorate(el);for(var propertyName in opt_propertyBag){el[propertyName]=opt_propertyBag[propertyName]}return el}f.decorate=function(el){el.__proto__=f.prototype;el.decorate()};return f}function limitInputWidth(el,parentEl,min,opt_scale){el.style.width="10px";var doc=el.ownerDocument;var win=doc.defaultView;var computedStyle=win.getComputedStyle(el);var parentComputedStyle=win.getComputedStyle(parentEl);var rtl=computedStyle.direction=="rtl";var inputRect=el.getBoundingClientRect();var parentRect=parentEl.getBoundingClientRect();var startPos=rtl?parentRect.right-inputRect.right:inputRect.left-parentRect.left;var inner=parseInt(computedStyle.borderLeftWidth,10)+parseInt(computedStyle.paddingLeft,10)+parseInt(computedStyle.paddingRight,10)+parseInt(computedStyle.borderRightWidth,10);var parentPadding=rtl?parseInt(parentComputedStyle.paddingLeft,10):parseInt(parentComputedStyle.paddingRight,10);var max=parentEl.clientWidth-startPos-inner-parentPadding;if(opt_scale)max*=opt_scale;function limit(){if(el.scrollWidth>max){el.style.width=max+"px"}else{el.style.width=0;var sw=el.scrollWidth;if(sw<min){el.style.width=min+"px"}else{el.style.width=sw+"px"}}}el.addEventListener("input",limit);limit()}function toCssPx(pixels){if(!window.isFinite(pixels))console.error("Pixel value is not a number: "+pixels);return Math.round(pixels)+"px"}function swallowDoubleClick(e){var doc=e.target.ownerDocument;var counter=Math.min(1,e.detail);function swallow(e){e.stopPropagation();e.preventDefault()}function onclick(e){if(e.detail>counter){counter=e.detail;swallow(e)}else{doc.removeEventListener("dblclick",swallow,true);doc.removeEventListener("click",onclick,true)}}setTimeout(function(){doc.addEventListener("click",onclick,true);doc.addEventListener("dblclick",swallow,true)},0)}return{decorate:decorate,define:define,limitInputWidth:limitInputWidth,toCssPx:toCssPx,swallowDoubleClick:swallowDoubleClick}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.ui",function(){function getComputedWidth(el){return parseFloat(el.ownerDocument.defaultView.getComputedStyle(el).width)/getZoomFactor(el.ownerDocument)}function getZoomFactor(doc){var dummyElement=doc.createElement("div");dummyElement.style.cssText="position:absolute;width:100px;height:100px;"+"top:-1000px;overflow:hidden";doc.body.appendChild(dummyElement);var cs=doc.defaultView.getComputedStyle(dummyElement);var rect=dummyElement.getBoundingClientRect();var zoomFactor=parseFloat(cs.width)/100;doc.body.removeChild(dummyElement);return zoomFactor}var Splitter=cr.ui.define("div");Splitter.prototype={__proto__:HTMLDivElement.prototype,decorate:function(){this.addEventListener("mousedown",this.handleMouseDown_.bind(this),true);this.addEventListener("touchstart",this.handleTouchStart_.bind(this),true);this.resizeNextElement_=false},set resizeNextElement(resizeNext){this.resizeNextElement_=resizeNext},startDrag:function(clientX,isTouchEvent){if(this.handlers_){console.log("Concurent drags");this.endDrag_()}if(isTouchEvent){var endDragBound=this.endDrag_.bind(this);this.handlers_={touchmove:this.handleTouchMove_.bind(this),touchend:endDragBound,touchcancel:endDragBound,touchstart:endDragBound}}else{this.handlers_={mousemove:this.handleMouseMove_.bind(this),mouseup:this.handleMouseUp_.bind(this)}}var doc=this.ownerDocument;for(var eventType in this.handlers_){doc.addEventListener(eventType,this.handlers_[eventType],true)}this.startX_=clientX;this.handleSplitterDragStart()},endDrag_:function(){var doc=this.ownerDocument;for(var eventType in this.handlers_){doc.removeEventListener(eventType,this.handlers_[eventType],true)}this.handlers_=null;this.handleSplitterDragEnd()},getResizeTarget_:function(){return this.resizeNextElement_?this.nextElementSibling:this.previousElementSibling},calcDeltaX_:function(deltaX){return this.resizeNextElement_?-deltaX:deltaX},handleMouseDown_:function(e){e=e;if(e.button)return;this.startDrag(e.clientX,false);e.preventDefault()},handleTouchStart_:function(e){e=e;if(e.touches.length==1){this.startDrag(e.touches[0].clientX,true);e.preventDefault()}},handleMouseMove_:function(e){this.handleMove_(e.clientX)},handleTouchMove_:function(e){if(e.touches.length==1)this.handleMove_(e.touches[0].clientX)},handleMove_:function(clientX){var rtl=this.ownerDocument.defaultView.getComputedStyle(this).direction=="rtl";var dirMultiplier=rtl?-1:1;var deltaX=dirMultiplier*(clientX-this.startX_);this.handleSplitterDragMove(deltaX)},handleMouseUp_:function(e){this.endDrag_()},handleSplitterDragStart:function(){var targetElement=this.getResizeTarget_();var doc=targetElement.ownerDocument;this.startWidth_=parseFloat(doc.defaultView.getComputedStyle(targetElement).width)+targetElement.offsetWidth-targetElement.clientWidth;this.classList.add("splitter-active")},handleSplitterDragMove:function(deltaX){var targetElement=this.getResizeTarget_();var newWidth=this.startWidth_+this.calcDeltaX_(deltaX);targetElement.style.width=newWidth+"px";cr.dispatchSimpleEvent(this,"dragmove")},handleSplitterDragEnd:function(){var targetElement=this.getResizeTarget_();var doc=targetElement.ownerDocument;var computedWidth=parseFloat(doc.defaultView.getComputedStyle(targetElement).width);if(this.startWidth_!=computedWidth)cr.dispatchSimpleEvent(this,"resize");this.classList.remove("splitter-active")}};return{Splitter:Splitter}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks.actions",function(){function createBookmark(id,treeNode){return{name:"create-bookmark",id:id,parentId:treeNode.parentId,parentIndex:treeNode.index,node:bookmarks.util.normalizeNode(treeNode)}}function editBookmark(id,changeInfo){return{name:"edit-bookmark",id:id,changeInfo:changeInfo}}function moveBookmark(id,parentId,index,oldParentId,oldIndex){return{name:"move-bookmark",id:id,parentId:parentId,index:index,oldParentId:oldParentId,oldIndex:oldIndex}}function reorderChildren(id,newChildIds){return{name:"reorder-children",id:id,children:newChildIds}}function removeBookmark(id,parentId,index,nodes){const descendants=bookmarks.util.getDescendants(nodes,id);return{name:"remove-bookmark",id:id,descendants:descendants,parentId:parentId,index:index}}function refreshNodes(nodeMap){return{name:"refresh-nodes",nodes:nodeMap}}function selectFolder(id,nodes){if(nodes&&(id==ROOT_NODE_ID||!nodes[id]||nodes[id].url)){console.warn("Tried to select invalid folder: "+id);return null}return{name:"select-folder",id:id}}function changeFolderOpen(id,open){return{name:"change-folder-open",id:id,open:open}}function clearSearch(){return{name:"clear-search"}}function deselectItems(){return{name:"deselect-items"}}function selectItem(id,state,config){assert(!config.toggle||!config.range);assert(!config.toggle||!config.clear);const anchor=state.selection.anchor;const toSelect=[];let newAnchor=id;if(config.range&&anchor){const displayedList=bookmarks.util.getDisplayedList(state);const selectedIndex=displayedList.indexOf(id);assert(selectedIndex!=-1);let anchorIndex=displayedList.indexOf(anchor);if(anchorIndex==-1)anchorIndex=selectedIndex;newAnchor=displayedList[anchorIndex];const startIndex=Math.min(anchorIndex,selectedIndex);const endIndex=Math.max(anchorIndex,selectedIndex);for(let i=startIndex;i<=endIndex;i++)toSelect.push(displayedList[i])}else{toSelect.push(id)}return{name:"select-items",clear:config.clear,toggle:config.toggle,anchor:newAnchor,items:toSelect}}function selectAll(ids,state,anchor){return{name:"select-items",clear:true,toggle:false,anchor:anchor?anchor:state.selection.anchor,items:ids}}function updateAnchor(id){return{name:"update-anchor",anchor:id}}function setSearchTerm(term){if(!term)return clearSearch();return{name:"start-search",term:term}}function setSearchResults(ids){return{name:"finish-search",results:ids}}function setIncognitoAvailability(availability){assert(availability!=IncognitoAvailability.FORCED);return{name:"set-incognito-availability",value:availability}}function setCanEditBookmarks(canEdit){return{name:"set-can-edit",value:canEdit}}return{changeFolderOpen:changeFolderOpen,clearSearch:clearSearch,createBookmark:createBookmark,deselectItems:deselectItems,editBookmark:editBookmark,moveBookmark:moveBookmark,refreshNodes:refreshNodes,removeBookmark:removeBookmark,reorderChildren:reorderChildren,selectAll:selectAll,selectFolder:selectFolder,selectItem:selectItem,setCanEditBookmarks:setCanEditBookmarks,setIncognitoAvailability:setIncognitoAvailability,setSearchResults:setSearchResults,setSearchTerm:setSearchTerm,updateAnchor:updateAnchor}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){class Debouncer{constructor(callback){this.callback_=callback;this.timerProxy_=window;this.timer_=null;this.boundTimerCallback_=this.timerCallback_.bind(this);this.isDone_=false;this.promiseResolver_=new PromiseResolver}restartTimeout(delay){assert(!this.isDone_);this.cancelTimeout_();this.timer_=this.timerProxy_.setTimeout(this.boundTimerCallback_,delay||0)}done(){return this.isDone_}get promise(){return this.promiseResolver_.promise}reset(){this.isDone_=false;this.promiseResolver_=new PromiseResolver;this.cancelTimeout_()}cancelTimeout_(){if(this.timer_)this.timerProxy_.clearTimeout(this.timer_)}timerCallback_(){this.isDone_=true;this.callback_.call();this.promiseResolver_.resolve()}}return{Debouncer:Debouncer}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
const DropPosition={NONE:0,ABOVE:1,ON:2,BELOW:4};const Command={EDIT:0,COPY_URL:1,SHOW_IN_FOLDER:2,DELETE:3,OPEN_NEW_TAB:4,OPEN_NEW_WINDOW:5,OPEN_INCOGNITO:6,UNDO:7,REDO:8,OPEN:9,SELECT_ALL:10,DESELECT_ALL:11,COPY:12,CUT:13,PASTE:14,SORT:15,ADD_BOOKMARK:16,ADD_FOLDER:17,IMPORT:18,EXPORT:19,HELP_CENTER:20,MAX_VALUE:21};const MenuSource={NONE:0,ITEM:1,TREE:2,TOOLBAR:3,LIST:4,NUM_VALUES:5};const IncognitoAvailability={ENABLED:0,DISABLED:1,FORCED:2};const LOCAL_STORAGE_FOLDER_STATE_KEY="folderOpenState";const LOCAL_STORAGE_TREE_WIDTH_KEY="treeWidth";const ROOT_NODE_ID="0";const BOOKMARKS_BAR_ID="1";const OPEN_CONFIRMATION_LIMIT=15;const FOLDER_OPEN_BY_DEFAULT_DEPTH=1;
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){const SelectionState={};SelectionState.selectItems=function(selectionState,action){let newItems=new Set;if(!action.clear)newItems=new Set(selectionState.items);action.items.forEach(function(id){let add=true;if(action.toggle)add=!newItems.has(id);if(add)newItems.add(id);else newItems.delete(id)});return Object.assign({},selectionState,{items:newItems,anchor:action.anchor})};SelectionState.deselectAll=function(selectionState){return{items:new Set,anchor:null}};SelectionState.deselectItems=function(selectionState,deleted){return Object.assign({},selectionState,{items:bookmarks.util.removeIdsFromSet(selectionState.items,deleted),anchor:!selectionState.anchor||deleted.has(selectionState.anchor)?null:selectionState.anchor})};SelectionState.updateAnchor=function(selectionState,action){return Object.assign({},selectionState,{anchor:action.anchor})};SelectionState.updateSelection=function(selection,action){switch(action.name){case"clear-search":case"finish-search":case"select-folder":case"deselect-items":return SelectionState.deselectAll(selection);case"select-items":return SelectionState.selectItems(selection,action);case"remove-bookmark":return SelectionState.deselectItems(selection,action.descendants);case"move-bookmark":if(action.parentId!=action.oldParentId&&selection.items.has(action.id)){return SelectionState.deselectItems(selection,new Set([action.id]))}return selection;case"update-anchor":return SelectionState.updateAnchor(selection,action);default:return selection}};const SearchState={};SearchState.startSearch=function(search,action){return{term:action.term,inProgress:true,results:search.results}};SearchState.finishSearch=function(search,action){return Object.assign({},search,{inProgress:false,results:action.results})};SearchState.clearSearch=function(){return{term:"",inProgress:false,results:null}};SearchState.removeDeletedResults=function(search,deletedIds){if(!search.results)return search;const newResults=[];search.results.forEach(function(id){if(!deletedIds.has(id))newResults.push(id)});return Object.assign({},search,{results:newResults})};SearchState.updateSearch=function(search,action){switch(action.name){case"start-search":return SearchState.startSearch(search,action);case"select-folder":case"clear-search":return SearchState.clearSearch();case"finish-search":return SearchState.finishSearch(search,action);case"remove-bookmark":return SearchState.removeDeletedResults(search,action.descendants);default:return search}};const NodeState={};NodeState.modifyNode_=function(nodes,id,callback){const nodeModification={};nodeModification[id]=callback(nodes[id]);return Object.assign({},nodes,nodeModification)};NodeState.createBookmark=function(nodes,action){const nodeModifications={};nodeModifications[action.id]=action.node;const parentNode=nodes[action.parentId];const newChildren=parentNode.children.slice();newChildren.splice(action.parentIndex,0,action.id);nodeModifications[action.parentId]=Object.assign({},parentNode,{children:newChildren});return Object.assign({},nodes,nodeModifications)};NodeState.editBookmark=function(nodes,action){if(!nodes[action.id].url&&action.changeInfo.url)delete action.changeInfo.url;return NodeState.modifyNode_(nodes,action.id,function(node){return Object.assign({},node,action.changeInfo)})};NodeState.moveBookmark=function(nodes,action){const nodeModifications={};const id=action.id;nodeModifications[id]=Object.assign({},nodes[id],{parentId:action.parentId});const oldParentId=action.oldParentId;const oldParentChildren=nodes[oldParentId].children.slice();oldParentChildren.splice(action.oldIndex,1);nodeModifications[oldParentId]=Object.assign({},nodes[oldParentId],{children:oldParentChildren});const parentId=action.parentId;const parentChildren=oldParentId==parentId?oldParentChildren:nodes[parentId].children.slice();parentChildren.splice(action.index,0,action.id);nodeModifications[parentId]=Object.assign({},nodes[parentId],{children:parentChildren});return Object.assign({},nodes,nodeModifications)};NodeState.removeBookmark=function(nodes,action){const newState=NodeState.modifyNode_(nodes,action.parentId,function(node){const newChildren=node.children.slice();newChildren.splice(action.index,1);return Object.assign({},node,{children:newChildren})});return bookmarks.util.removeIdsFromObject(newState,action.descendants)};NodeState.reorderChildren=function(nodes,action){return NodeState.modifyNode_(nodes,action.id,function(node){return Object.assign({},node,{children:action.children})})};NodeState.updateNodes=function(nodes,action){switch(action.name){case"create-bookmark":return NodeState.createBookmark(nodes,action);case"edit-bookmark":return NodeState.editBookmark(nodes,action);case"move-bookmark":return NodeState.moveBookmark(nodes,action);case"remove-bookmark":return NodeState.removeBookmark(nodes,action);case"reorder-children":return NodeState.reorderChildren(nodes,action);case"refresh-nodes":return action.nodes;default:return nodes}};const SelectedFolderState={};SelectedFolderState.isAncestorOf=function(nodes,ancestorId,childId){let currentId=childId;while(currentId){if(currentId==ancestorId)return true;currentId=nodes[currentId].parentId}return false};SelectedFolderState.updateSelectedFolder=function(selectedFolder,action,nodes){switch(action.name){case"select-folder":return action.id;case"change-folder-open":if(!action.open&&selectedFolder&&SelectedFolderState.isAncestorOf(nodes,action.id,selectedFolder)){return action.id}return selectedFolder;case"remove-bookmark":if(selectedFolder&&SelectedFolderState.isAncestorOf(nodes,action.id,selectedFolder))return assert(nodes[action.id].parentId);return selectedFolder;default:return selectedFolder}};const FolderOpenState={};FolderOpenState.openFolderAndAncestors=function(folderOpenState,id,nodes){const newFolderOpenState=new Map(folderOpenState);for(let currentId=id;currentId;currentId=nodes[currentId].parentId)newFolderOpenState.set(currentId,true);return newFolderOpenState};FolderOpenState.changeFolderOpen=function(folderOpenState,action){const newFolderOpenState=new Map(folderOpenState);newFolderOpenState.set(action.id,action.open);return newFolderOpenState};FolderOpenState.updateFolderOpenState=function(folderOpenState,action,nodes){switch(action.name){case"change-folder-open":return FolderOpenState.changeFolderOpen(folderOpenState,action);case"select-folder":return FolderOpenState.openFolderAndAncestors(folderOpenState,nodes[action.id].parentId,nodes);case"move-bookmark":if(!nodes[action.id].children)return folderOpenState;return FolderOpenState.openFolderAndAncestors(folderOpenState,action.parentId,nodes);case"remove-bookmark":return bookmarks.util.removeIdsFromMap(folderOpenState,action.descendants);default:return folderOpenState}};const PreferencesState={};PreferencesState.updatePrefs=function(prefs,action){switch(action.name){case"set-incognito-availability":return Object.assign({},prefs,{incognitoAvailability:action.value});case"set-can-edit":return Object.assign({},prefs,{canEdit:action.value});default:return prefs}};function reduceAction(state,action){return{nodes:NodeState.updateNodes(state.nodes,action),selectedFolder:SelectedFolderState.updateSelectedFolder(state.selectedFolder,action,state.nodes),folderOpenState:FolderOpenState.updateFolderOpenState(state.folderOpenState,action,state.nodes),prefs:PreferencesState.updatePrefs(state.prefs,action),search:SearchState.updateSearch(state.search,action),selection:SelectionState.updateSelection(state.selection,action)}}return{reduceAction:reduceAction,FolderOpenState:FolderOpenState,NodeState:NodeState,PreferencesState:PreferencesState,SearchState:SearchState,SelectedFolderState:SelectedFolderState,SelectionState:SelectionState}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks.util",function(){function getDisplayedList(state){if(isShowingSearch(state))return assert(state.search.results);return assert(state.nodes[state.selectedFolder].children)}function normalizeNode(treeNode){const node=Object.assign({},treeNode);delete node.index;if(!("url"in node)){node.children=(node.children||[]).map(function(child){return child.id})}return node}function normalizeNodes(rootNode){const nodeMap={};const stack=[];stack.push(rootNode);while(stack.length>0){const node=stack.pop();nodeMap[node.id]=normalizeNode(node);if(!node.children)continue;node.children.forEach(function(child){stack.push(child)})}return nodeMap}function createEmptyState(){return{nodes:{},selectedFolder:BOOKMARKS_BAR_ID,folderOpenState:new Map,prefs:{canEdit:true,incognitoAvailability:IncognitoAvailability.ENABLED},search:{term:"",inProgress:false,results:null},selection:{items:new Set,anchor:null}}}function isShowingSearch(state){return state.search.results!=null}function canEditNode(state,itemId){return itemId!=ROOT_NODE_ID&&state.nodes[itemId].parentId!=ROOT_NODE_ID&&!state.nodes[itemId].unmodifiable&&state.prefs.canEdit}function canReorderChildren(state,itemId){return itemId!=ROOT_NODE_ID&&!state.nodes[itemId].unmodifiable&&state.prefs.canEdit}function hasChildFolders(id,nodes){const children=nodes[id].children;for(let i=0;i<children.length;i++){if(nodes[children[i]].children)return true}return false}function getDescendants(nodes,baseId){const descendants=new Set;const stack=[];stack.push(baseId);while(stack.length>0){const id=stack.pop();const node=nodes[id];if(!node)continue;descendants.add(id);if(!node.children)continue;node.children.forEach(function(childId){stack.push(childId)})}return descendants}function recordEnumHistogram(name,value,maxValue){chrome.send("metricsHandler:recordInHistogram",[name,value,maxValue])}function removeIdsFromObject(map,ids){const newObject=Object.assign({},map);ids.forEach(function(id){delete newObject[id]});return newObject}function removeIdsFromMap(map,ids){const newMap=new Map(map);ids.forEach(function(id){newMap.delete(id)});return newMap}function removeIdsFromSet(set,ids){const difference=new Set(set);ids.forEach(function(id){difference.delete(id)});return difference}return{canEditNode:canEditNode,canReorderChildren:canReorderChildren,createEmptyState:createEmptyState,getDescendants:getDescendants,getDisplayedList:getDisplayedList,hasChildFolders:hasChildFolders,isShowingSearch:isShowingSearch,normalizeNode:normalizeNode,normalizeNodes:normalizeNodes,recordEnumHistogram:recordEnumHistogram,removeIdsFromMap:removeIdsFromMap,removeIdsFromObject:removeIdsFromObject,removeIdsFromSet:removeIdsFromSet}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){function Store(){this.data_=bookmarks.util.createEmptyState();this.initialized_=false;this.queuedActions_=[];this.observers_=[];this.batchMode_=false}Store.prototype={init:function(initialState){this.data_=initialState;this.queuedActions_.forEach(action=>{this.dispatchInternal_(action)});this.initialized_=true;this.notifyObservers_(this.data_)},get data(){return this.data_},isInitialized:function(){return this.initialized_},addObserver:function(observer){this.observers_.push(observer)},removeObserver:function(observer){const index=this.observers_.indexOf(observer);this.observers_.splice(index,1)},beginBatchUpdate:function(){this.batchMode_=true},endBatchUpdate:function(){this.batchMode_=false;this.notifyObservers_(this.data)},dispatchAsync:function(action){if(!this.initialized_){this.queuedActions_.push(action);return}this.dispatchInternal_(action)},dispatch:function(action){this.dispatchAsync(function(dispatch){dispatch(action)})},dispatchInternal_:function(action){action(this.reduce_.bind(this))},reduce_:function(action){if(!action)return;this.data_=bookmarks.reduceAction(this.data_,action);if(this.isInitialized()&&!this.batchMode_)this.notifyObservers_(this.data_)},notifyObservers_:function(state){this.observers_.forEach(function(o){o.onStateChanged(state)})}};cr.addSingletonGetter(Store);return{Store:Store}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks.ApiListener",function(){let trackUpdates=false;let updatedItems=[];let debouncer;function batchUIUpdates(){if(!debouncer){debouncer=new bookmarks.Debouncer(()=>bookmarks.Store.getInstance().endBatchUpdate())}if(debouncer.done()){bookmarks.Store.getInstance().beginBatchUpdate();debouncer.reset()}debouncer.restartTimeout()}function trackUpdatedItems(){trackUpdates=true}function highlightUpdatedItemsImpl(){if(!trackUpdates)return;document.dispatchEvent(new CustomEvent("highlight-items",{detail:updatedItems}));updatedItems=[];trackUpdates=false}function highlightUpdatedItems(){assert(debouncer);debouncer.promise.then(highlightUpdatedItemsImpl)}function dispatch(action){bookmarks.Store.getInstance().dispatch(action)}function onBookmarkChanged(id,changeInfo){dispatch(bookmarks.actions.editBookmark(id,changeInfo))}function onBookmarkCreated(id,treeNode){batchUIUpdates();if(trackUpdates)updatedItems.push(id);dispatch(bookmarks.actions.createBookmark(id,treeNode))}function onBookmarkRemoved(id,removeInfo){batchUIUpdates();const nodes=bookmarks.Store.getInstance().data.nodes;dispatch(bookmarks.actions.removeBookmark(id,removeInfo.parentId,removeInfo.index,nodes))}function onBookmarkMoved(id,moveInfo){batchUIUpdates();if(trackUpdates)updatedItems.push(id);dispatch(bookmarks.actions.moveBookmark(id,moveInfo.parentId,moveInfo.index,moveInfo.oldParentId,moveInfo.oldIndex))}function onChildrenReordered(id,reorderInfo){dispatch(bookmarks.actions.reorderChildren(id,reorderInfo.childIds))}function onImportBegan(){chrome.bookmarks.onCreated.removeListener(onBookmarkCreated)}function onImportEnded(){chrome.bookmarks.getTree(function(results){dispatch(bookmarks.actions.refreshNodes(bookmarks.util.normalizeNodes(results[0])))});chrome.bookmarks.onCreated.addListener(onBookmarkCreated)}function onIncognitoAvailabilityChanged(availability){dispatch(bookmarks.actions.setIncognitoAvailability(availability))}function onCanEditBookmarksChanged(canEdit){dispatch(bookmarks.actions.setCanEditBookmarks(canEdit))}const listeners=[{api:chrome.bookmarks.onChanged,fn:onBookmarkChanged},{api:chrome.bookmarks.onChildrenReordered,fn:onChildrenReordered},{api:chrome.bookmarks.onCreated,fn:onBookmarkCreated},{api:chrome.bookmarks.onMoved,fn:onBookmarkMoved},{api:chrome.bookmarks.onRemoved,fn:onBookmarkRemoved},{api:chrome.bookmarks.onImportBegan,fn:onImportBegan},{api:chrome.bookmarks.onImportEnded,fn:onImportEnded}];function init(){listeners.forEach(listener=>listener.api.addListener(listener.fn));cr.sendWithPromise("getIncognitoAvailability").then(onIncognitoAvailabilityChanged);cr.addWebUIListener("incognito-availability-changed",onIncognitoAvailabilityChanged);cr.sendWithPromise("getCanEditBookmarks").then(onCanEditBookmarksChanged);cr.addWebUIListener("can-edit-bookmarks-changed",onCanEditBookmarksChanged)}function destroy(){listeners.forEach(listener=>listener.api.removeListener(listener.fn));cr.removeWebUIListener("incognito-availability-changed",onIncognitoAvailabilityChanged);cr.removeWebUIListener("can-edit-bookmarks-changed",onCanEditBookmarksChanged)}return{init:init,destroy:destroy,trackUpdatedItems:trackUpdatedItems,highlightUpdatedItems:highlightUpdatedItems}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.ui",function(){if(cr.ui.focusWithoutInk)return;var hideInk=false;assert(!cr.isIOS,"pointerdown doesn't work on iOS");document.addEventListener("pointerdown",function(){hideInk=true},true);document.addEventListener("keydown",function(){hideInk=false},true);var focusWithoutInk=function(toFocus){var innerButton=null;if(toFocus.parentElement.tagName=="PAPER-ICON-BUTTON-LIGHT"){innerButton=toFocus;toFocus=toFocus.parentElement}if(!("noink"in toFocus)){toFocus.focus();return}assert(document==toFocus.ownerDocument);var origNoInk;if(hideInk){origNoInk=toFocus.noink;toFocus.noink=true}if(innerButton)innerButton.focus();else toFocus.focus();if(hideInk)toFocus.noink=origNoInk};return{focusWithoutInk:focusWithoutInk}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
function $(id){var el=document.getElementById(id);return el?assertInstanceof(el,HTMLElement):null}function getSVGElement(id){var el=document.getElementById(id);return el?assertInstanceof(el,Element):null}function announceAccessibleMessage(msg){var element=document.createElement("div");element.setAttribute("aria-live","polite");element.style.position="fixed";element.style.left="-9999px";element.style.height="0px";element.innerText=msg;document.body.appendChild(element);window.setTimeout(function(){document.body.removeChild(element)},0)}function getUrlForCss(s){var s2=s.replace(/(\(|\)|\,|\s|\'|\"|\\)/g,"\\$1");if(/\\\\$/.test(s2)){s2+=" "}return'url("'+s2+'")'}function parseQueryParams(location){var params={};var query=unescape(location.search.substring(1));var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");params[pair[0]]=pair[1]}return params}function setQueryParam(location,key,value){var query=parseQueryParams(location);query[encodeURIComponent(key)]=encodeURIComponent(value);var newQuery="";for(var q in query){newQuery+=(newQuery?"&":"?")+q+"="+query[q]}return location.origin+location.pathname+newQuery+location.hash}function findAncestorByClass(el,className){return findAncestor(el,function(el){return el.classList&&el.classList.contains(className)})}function findAncestor(node,predicate){var last=false;while(node!=null&&!(last=predicate(node))){node=node.parentNode}return last?node:null}function swapDomNodes(a,b){var afterA=a.nextSibling;if(afterA==b){swapDomNodes(b,a);return}var aParent=a.parentNode;b.parentNode.replaceChild(a,b);aParent.insertBefore(b,afterA)}function disableTextSelectAndDrag(opt_allowSelectStart,opt_allowDragStart){document.onselectstart=function(e){if(!(opt_allowSelectStart&&opt_allowSelectStart.call(this,e)))e.preventDefault()};document.ondragstart=function(e){if(!(opt_allowDragStart&&opt_allowDragStart.call(this,e)))e.preventDefault()}}function isRTL(){return document.documentElement.dir=="rtl"}function getRequiredElement(id){return assertInstanceof($(id),HTMLElement,"Missing required element: "+id)}function queryRequiredElement(selectors,opt_context){var element=(opt_context||document).querySelector(selectors);return assertInstanceof(element,HTMLElement,"Missing required element: "+selectors)}["click","auxclick"].forEach(function(eventName){document.addEventListener(eventName,function(e){if(e.button>1)return;if(e.defaultPrevented)return;var eventPath=e.path;var anchor=null;if(eventPath){for(var i=0;i<eventPath.length;i++){var element=eventPath[i];if(element.tagName==="A"&&element.href){anchor=element;break}}}var el=e.target;if(!anchor&&el.nodeType==Node.ELEMENT_NODE&&el.webkitMatchesSelector("A, A *")){while(el.tagName!="A"){el=el.parentElement}anchor=el}if(!anchor)return;anchor=anchor;if((anchor.protocol=="file:"||anchor.protocol=="about:")&&(e.button==0||e.button==1)){chrome.send("navigateToUrl",[anchor.href,anchor.target,e.button,e.altKey,e.ctrlKey,e.metaKey,e.shiftKey]);e.preventDefault()}})});function appendParam(url,key,value){var param=encodeURIComponent(key)+"="+encodeURIComponent(value);if(url.indexOf("?")==-1)return url+"?"+param;return url+"&"+param}function createElementWithClassName(type,className){var elm=document.createElement(type);elm.className=className;return elm}function ensureTransitionEndEvent(el,opt_timeOut){if(opt_timeOut===undefined){var style=getComputedStyle(el);opt_timeOut=parseFloat(style.transitionDuration)*1e3;opt_timeOut+=50}var fired=false;el.addEventListener("transitionend",function f(e){el.removeEventListener("transitionend",f);fired=true});window.setTimeout(function(){if(!fired)cr.dispatchSimpleEvent(el,"transitionend",true)},opt_timeOut)}function scrollTopForDocument(doc){return doc.documentElement.scrollTop||doc.body.scrollTop}function setScrollTopForDocument(doc,value){doc.documentElement.scrollTop=doc.body.scrollTop=value}function scrollLeftForDocument(doc){return doc.documentElement.scrollLeft||doc.body.scrollLeft}function setScrollLeftForDocument(doc,value){doc.documentElement.scrollLeft=doc.body.scrollLeft=value}function HTMLEscape(original){return original.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function elide(original,maxLength){if(original.length<=maxLength)return original;return original.substring(0,maxLength-1)+"â€¦"}function quoteString(str){return str.replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}function listenOnce(target,eventNames,callback){if(!Array.isArray(eventNames))eventNames=eventNames.split(/ +/);var removeAllAndCallCallback=function(event){eventNames.forEach(function(eventName){target.removeEventListener(eventName,removeAllAndCallCallback,false)});return callback(event)};eventNames.forEach(function(eventName){target.addEventListener(eventName,removeAllAndCallCallback,false)})}
// <if expr="is_ios">
if(!("key"in KeyboardEvent.prototype)){Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){if(this.keyCode>=48&&this.keyCode<=57)return String.fromCharCode(this.keyCode);if(this.keyCode>=65&&this.keyCode<=90){var result=String.fromCharCode(this.keyCode).toLowerCase();if(this.shiftKey)result=result.toUpperCase();return result}switch(this.keyCode){case 8:return"Backspace";case 9:return"Tab";case 13:return"Enter";case 16:return"Shift";case 17:return"Control";case 18:return"Alt";case 27:return"Escape";case 32:return" ";case 33:return"PageUp";case 34:return"PageDown";case 35:return"End";case 36:return"Home";case 37:return"ArrowLeft";case 38:return"ArrowUp";case 39:return"ArrowRight";case 40:return"ArrowDown";case 45:return"Insert";case 46:return"Delete";case 91:return"Meta";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 187:return"=";case 189:return"-";case 219:return"[";case 221:return"]"}return"Unidentified"}})}else{window.console.log("KeyboardEvent.Key polyfill not required")}
// </if>  /* is_ios */
function hasKeyModifiers(e){return!!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)}
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var ShowAtConfig;var ShowAtPositionConfig;var AnchorAlignment={BEFORE_START:-2,AFTER_START:-1,CENTER:0,BEFORE_END:1,AFTER_END:2};var DROPDOWN_ITEM_CLASS="dropdown-item";(function(){function getStartPointWithAnchor(start,end,menuLength,anchorAlignment,min,max){var startPoint=0;switch(anchorAlignment){case AnchorAlignment.BEFORE_START:startPoint=-menuLength;break;case AnchorAlignment.AFTER_START:startPoint=start;break;case AnchorAlignment.CENTER:startPoint=(start+end-menuLength)/2;break;case AnchorAlignment.BEFORE_END:startPoint=end-menuLength;break;case AnchorAlignment.AFTER_END:startPoint=end;break}if(startPoint+menuLength>max)startPoint=end-menuLength;if(startPoint<min)startPoint=start;startPoint=Math.max(min,Math.min(startPoint,max-menuLength));return startPoint}function getDefaultShowConfig(){var doc=document.scrollingElement;return{top:0,left:0,height:0,width:0,anchorAlignmentX:AnchorAlignment.AFTER_START,anchorAlignmentY:AnchorAlignment.AFTER_START,minX:0,minY:0,maxX:0,maxY:0}}Polymer({is:"cr-action-menu",anchorElement_:null,boundClose_:null,hasMousemoveListener_:false,contentObserver_:null,resizeObserver_:null,lastConfig_:null,properties:{autoReposition:{type:Boolean,value:false},open:{type:Boolean,value:false}},listeners:{keydown:"onKeyDown_",mouseover:"onMouseover_",tap:"onTap_"},detached:function(){this.removeListeners_()},getDialog:function(){return this.$.dialog},removeListeners_:function(){window.removeEventListener("resize",this.boundClose_);window.removeEventListener("popstate",this.boundClose_);if(this.contentObserver_){Polymer.dom(this.$.contentNode).unobserveNodes(this.contentObserver_);this.contentObserver_=null}if(this.resizeObserver_){this.resizeObserver_.disconnect();this.resizeObserver_=null}},onTap_:function(e){if(e.target==this){this.close();e.stopPropagation()}},onKeyDown_:function(e){e.stopPropagation();if(e.key=="Tab"||e.key=="Escape"){this.close();e.preventDefault();return}if(e.key!=="ArrowDown"&&e.key!=="ArrowUp")return;var nextOption=this.getNextOption_(e.key=="ArrowDown"?1:-1);if(nextOption){if(!this.hasMousemoveListener_){this.hasMousemoveListener_=true;listenOnce(this,"mousemove",e=>{this.onMouseover_(e);this.hasMousemoveListener_=false})}nextOption.focus()}e.preventDefault()},onMouseover_:function(e){var i=0;do{var target=e.path[i++];if(target.classList&&target.classList.contains("dropdown-item")&&!target.disabled){target.focus();return}}while(this!=target);this.$.dialog.focus()},getNextOption_:function(step){var counter=0;var nextOption=null;var options=this.querySelectorAll(".dropdown-item");var numOptions=options.length;var focusedIndex=Array.prototype.indexOf.call(options,this.root.activeElement);if(focusedIndex===-1&&step===-1)focusedIndex=0;do{focusedIndex=(numOptions+focusedIndex+step)%numOptions;nextOption=options[focusedIndex];if(nextOption.disabled||nextOption.hidden)nextOption=null;counter++}while(!nextOption&&counter<numOptions);return nextOption},close:function(){this.removeListeners_();this.$.dialog.close();this.open=false;if(this.anchorElement_){cr.ui.focusWithoutInk(assert(this.anchorElement_));this.anchorElement_=null}if(this.lastConfig_){this.lastConfig_=null}},showAt:function(anchorElement,opt_config){this.anchorElement_=anchorElement;this.anchorElement_.scrollIntoViewIfNeeded();var rect=this.anchorElement_.getBoundingClientRect();this.showAtPosition(Object.assign({top:rect.top,left:rect.left,height:rect.height,width:rect.width,anchorAlignmentX:AnchorAlignment.BEFORE_END},opt_config))},showAtPosition:function(config){var doc=document.scrollingElement;var scrollLeft=doc.scrollLeft;var scrollTop=doc.scrollTop;this.resetStyle_();this.$.dialog.showModal();this.open=true;config.top+=scrollTop;config.left+=scrollLeft;this.positionDialog_(Object.assign({minX:scrollLeft,minY:scrollTop,maxX:scrollLeft+doc.clientWidth,maxY:scrollTop+doc.clientHeight},config));doc.scrollTop=scrollTop;doc.scrollLeft=scrollLeft;this.addListeners_()},resetStyle_:function(){this.$.dialog.style.left="";this.$.dialog.style.right="";this.$.dialog.style.top="0"},positionDialog_:function(config){this.lastConfig_=config;var c=Object.assign(getDefaultShowConfig(),config);var top=c.top;var left=c.left;var bottom=top+c.height;var right=left+c.width;var rtl=getComputedStyle(this).direction=="rtl";if(rtl)c.anchorAlignmentX*=-1;const offsetWidth=this.$.dialog.offsetWidth;var menuLeft=getStartPointWithAnchor(left,right,offsetWidth,c.anchorAlignmentX,c.minX,c.maxX);if(rtl){var menuRight=document.scrollingElement.clientWidth-menuLeft-offsetWidth;this.$.dialog.style.right=menuRight+"px"}else{this.$.dialog.style.left=menuLeft+"px"}var menuTop=getStartPointWithAnchor(top,bottom,this.$.dialog.offsetHeight,c.anchorAlignmentY,c.minY,c.maxY);this.$.dialog.style.top=menuTop+"px"},addListeners_:function(){this.boundClose_=this.boundClose_||function(){if(this.$.dialog.open)this.close()}.bind(this);window.addEventListener("resize",this.boundClose_);window.addEventListener("popstate",this.boundClose_);this.contentObserver_=Polymer.dom(this.$.contentNode).observeNodes(info=>{info.addedNodes.forEach(node=>{if(node.classList&&node.classList.contains(DROPDOWN_ITEM_CLASS)&&!node.getAttribute("role")){node.setAttribute("role","menuitem")}})});if(this.autoReposition){this.resizeObserver_=new ResizeObserver(()=>{if(this.lastConfig_){this.positionDialog_(this.lastConfig_);this.fire("cr-action-menu-repositioned")}});this.resizeObserver_.observe(this.$.dialog)}}})})();
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-lazy-render",behaviors:[Polymer.Templatizer],child_:null,get:function(){if(!this.child_)this.render_();return this.child_},getIfExists:function(){return this.child_},render_:function(){var template=this.getContentChildren()[0];if(!template.ctor)this.templatize(template);var parentNode=this.parentNode;if(parentNode&&!this.child_){var instance=this.stamp({});this.child_=instance.root.firstElementChild;parentNode.insertBefore(instance.root,this)}},_forwardParentProp:function(prop,value){if(this.child_)this.child_._templateInstance[prop]=value},_forwardParentPath:function(path,value){if(this.child_)this.child_._templateInstance.notifyPath(path,value,true)}});
// Copyright (c) 2012 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.ui",function(){function KeyboardShortcut(shortcut){var mods={};var ident="";shortcut.split("|").forEach(function(part){var partLc=part.toLowerCase();switch(partLc){case"alt":case"ctrl":case"meta":case"shift":mods[partLc+"Key"]=true;break;default:if(ident)throw Error("Invalid shortcut");ident=part}});this.ident_=ident;this.mods_=mods}KeyboardShortcut.prototype={matchesEvent:function(e){if(e.key==this.ident_){var mods=this.mods_;return["altKey","ctrlKey","metaKey","shiftKey"].every(function(k){return e[k]==!!mods[k]})}return false}};function KeyboardShortcutList(shortcuts){this.shortcuts_=shortcuts.split(/\s+/).map(function(shortcut){return new KeyboardShortcut(shortcut)})}KeyboardShortcutList.prototype={matchesEvent:function(e){return this.shortcuts_.some(function(keyboardShortcut){return keyboardShortcut.matchesEvent(e)})}};var Command=cr.ui.define("command");Command.prototype={__proto__:HTMLElement.prototype,decorate:function(){CommandManager.init(assert(this.ownerDocument));if(this.hasAttribute("shortcut"))this.shortcut=this.getAttribute("shortcut")},execute:function(opt_element){if(this.disabled)return;var doc=this.ownerDocument;if(doc.activeElement){var e=new Event("command",{bubbles:true});e.command=this;(opt_element||doc.activeElement).dispatchEvent(e)}},canExecuteChange:function(opt_node){dispatchCanExecuteEvent(this,opt_node||this.ownerDocument.activeElement)},shortcut_:"",get shortcut(){return this.shortcut_},set shortcut(shortcut){var oldShortcut=this.shortcut_;if(shortcut!==oldShortcut){this.keyboardShortcuts_=new KeyboardShortcutList(shortcut);this.shortcut_=shortcut;cr.dispatchPropertyChange(this,"shortcut",this.shortcut_,oldShortcut)}},matchesEvent:function(e){if(!this.keyboardShortcuts_)return false;return this.keyboardShortcuts_.matchesEvent(e)}};cr.defineProperty(Command,"label",cr.PropertyKind.ATTR);cr.defineProperty(Command,"disabled",cr.PropertyKind.BOOL_ATTR);cr.defineProperty(Command,"hidden",cr.PropertyKind.BOOL_ATTR);cr.defineProperty(Command,"checked",cr.PropertyKind.BOOL_ATTR);cr.defineProperty(Command,"hideShortcutText",cr.PropertyKind.BOOL_ATTR);function dispatchCanExecuteEvent(command,target){var e=new CanExecuteEvent(command);target.dispatchEvent(e);command.disabled=!e.canExecute}var commandManagers={};function CommandManager(doc){doc.addEventListener("focus",this.handleFocus_.bind(this),true);doc.addEventListener("keydown",this.handleKeyDown_.bind(this),false)}CommandManager.init=function(doc){var uid=cr.getUid(doc);if(!(uid in commandManagers)){commandManagers[uid]=new CommandManager(doc)}};CommandManager.prototype={handleFocus_:function(e){var target=e.target;if(target.menu||target.command)return;var commands=Array.prototype.slice.call(target.ownerDocument.querySelectorAll("command"));commands.forEach(function(command){dispatchCanExecuteEvent(command,target)})},handleKeyDown_:function(e){var target=e.target;var commands=Array.prototype.slice.call(target.ownerDocument.querySelectorAll("command"));for(var i=0,command;command=commands[i];i++){if(command.matchesEvent(e)){command.canExecuteChange();if(!command.disabled){e.preventDefault();e.stopPropagation();command.execute();return}}}}};function CanExecuteEvent(command){var e=new Event("canExecute",{bubbles:true,cancelable:true});e.__proto__=CanExecuteEvent.prototype;e.command=command;return e}CanExecuteEvent.prototype={__proto__:Event.prototype,command:null,canExecute_:false,get canExecute(){return this.canExecute_},set canExecute(canExecute){this.canExecute_=!!canExecute;this.stopPropagation();this.preventDefault()}};return{Command:Command,CanExecuteEvent:CanExecuteEvent,KeyboardShortcutList:KeyboardShortcutList}});(function(){"use strict";var KEY_IDENTIFIER={"U+0008":"backspace","U+0009":"tab","U+001B":"esc","U+0020":"space","U+007F":"del"};var KEY_CODE={8:"backspace",9:"tab",13:"enter",27:"esc",33:"pageup",34:"pagedown",35:"end",36:"home",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",106:"*"};var MODIFIER_KEYS={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"};var KEY_CHAR=/[a-z0-9*]/;var IDENT_CHAR=/U\+/;var ARROW_KEY=/^arrow/;var SPACE_KEY=/^space(bar)?/;var ESC_KEY=/^escape$/;function transformKey(key,noSpecialChars){var validKey="";if(key){var lKey=key.toLowerCase();if(lKey===" "||SPACE_KEY.test(lKey)){validKey="space"}else if(ESC_KEY.test(lKey)){validKey="esc"}else if(lKey.length==1){if(!noSpecialChars||KEY_CHAR.test(lKey)){validKey=lKey}}else if(ARROW_KEY.test(lKey)){validKey=lKey.replace("arrow","")}else if(lKey=="multiply"){validKey="*"}else{validKey=lKey}}return validKey}function transformKeyIdentifier(keyIdent){var validKey="";if(keyIdent){if(keyIdent in KEY_IDENTIFIER){validKey=KEY_IDENTIFIER[keyIdent]}else if(IDENT_CHAR.test(keyIdent)){keyIdent=parseInt(keyIdent.replace("U+","0x"),16);validKey=String.fromCharCode(keyIdent).toLowerCase()}else{validKey=keyIdent.toLowerCase()}}return validKey}function transformKeyCode(keyCode){var validKey="";if(Number(keyCode)){if(keyCode>=65&&keyCode<=90){validKey=String.fromCharCode(32+keyCode)}else if(keyCode>=112&&keyCode<=123){validKey="f"+(keyCode-112+1)}else if(keyCode>=48&&keyCode<=57){validKey=String(keyCode-48)}else if(keyCode>=96&&keyCode<=105){validKey=String(keyCode-96)}else{validKey=KEY_CODE[keyCode]}}return validKey}function normalizedKeyForEvent(keyEvent,noSpecialChars){if(keyEvent.key){return transformKey(keyEvent.key,noSpecialChars)}if(keyEvent.detail&&keyEvent.detail.key){return transformKey(keyEvent.detail.key,noSpecialChars)}return transformKeyIdentifier(keyEvent.keyIdentifier)||transformKeyCode(keyEvent.keyCode)||""}function keyComboMatchesEvent(keyCombo,event){var keyEvent=normalizedKeyForEvent(event,keyCombo.hasModifiers);return keyEvent===keyCombo.key&&(!keyCombo.hasModifiers||!!event.shiftKey===!!keyCombo.shiftKey&&!!event.ctrlKey===!!keyCombo.ctrlKey&&!!event.altKey===!!keyCombo.altKey&&!!event.metaKey===!!keyCombo.metaKey)}function parseKeyComboString(keyComboString){if(keyComboString.length===1){return{combo:keyComboString,key:keyComboString,event:"keydown"}}return keyComboString.split("+").reduce(function(parsedKeyCombo,keyComboPart){var eventParts=keyComboPart.split(":");var keyName=eventParts[0];var event=eventParts[1];if(keyName in MODIFIER_KEYS){parsedKeyCombo[MODIFIER_KEYS[keyName]]=true;parsedKeyCombo.hasModifiers=true}else{parsedKeyCombo.key=keyName;parsedKeyCombo.event=event||"keydown"}return parsedKeyCombo},{combo:keyComboString.split(":").shift()})}function parseEventString(eventString){return eventString.trim().split(" ").map(function(keyComboString){return parseKeyComboString(keyComboString)})}Polymer.IronA11yKeysBehavior={properties:{keyEventTarget:{type:Object,value:function(){return this}},stopKeyboardEventPropagation:{type:Boolean,value:false},_boundKeyHandlers:{type:Array,value:function(){return[]}},_imperativeKeyBindings:{type:Object,value:function(){return{}}}},observers:["_resetKeyEventListeners(keyEventTarget, _boundKeyHandlers)"],keyBindings:{},registered:function(){this._prepKeyBindings()},attached:function(){this._listenKeyEventListeners()},detached:function(){this._unlistenKeyEventListeners()},addOwnKeyBinding:function(eventString,handlerName){this._imperativeKeyBindings[eventString]=handlerName;this._prepKeyBindings();this._resetKeyEventListeners()},removeOwnKeyBindings:function(){this._imperativeKeyBindings={};this._prepKeyBindings();this._resetKeyEventListeners()},keyboardEventMatchesKeys:function(event,eventString){var keyCombos=parseEventString(eventString);for(var i=0;i<keyCombos.length;++i){if(keyComboMatchesEvent(keyCombos[i],event)){return true}}return false},_collectKeyBindings:function(){var keyBindings=this.behaviors.map(function(behavior){return behavior.keyBindings});if(keyBindings.indexOf(this.keyBindings)===-1){keyBindings.push(this.keyBindings)}return keyBindings},_prepKeyBindings:function(){this._keyBindings={};this._collectKeyBindings().forEach(function(keyBindings){for(var eventString in keyBindings){this._addKeyBinding(eventString,keyBindings[eventString])}},this);for(var eventString in this._imperativeKeyBindings){this._addKeyBinding(eventString,this._imperativeKeyBindings[eventString])}for(var eventName in this._keyBindings){this._keyBindings[eventName].sort(function(kb1,kb2){var b1=kb1[0].hasModifiers;var b2=kb2[0].hasModifiers;return b1===b2?0:b1?-1:1})}},_addKeyBinding:function(eventString,handlerName){parseEventString(eventString).forEach(function(keyCombo){this._keyBindings[keyCombo.event]=this._keyBindings[keyCombo.event]||[];this._keyBindings[keyCombo.event].push([keyCombo,handlerName])},this)},_resetKeyEventListeners:function(){this._unlistenKeyEventListeners();if(this.isAttached){this._listenKeyEventListeners()}},_listenKeyEventListeners:function(){if(!this.keyEventTarget){return}Object.keys(this._keyBindings).forEach(function(eventName){var keyBindings=this._keyBindings[eventName];var boundKeyHandler=this._onKeyBindingEvent.bind(this,keyBindings);this._boundKeyHandlers.push([this.keyEventTarget,eventName,boundKeyHandler]);this.keyEventTarget.addEventListener(eventName,boundKeyHandler)},this)},_unlistenKeyEventListeners:function(){var keyHandlerTuple;var keyEventTarget;var eventName;var boundKeyHandler;while(this._boundKeyHandlers.length){keyHandlerTuple=this._boundKeyHandlers.pop();keyEventTarget=keyHandlerTuple[0];eventName=keyHandlerTuple[1];boundKeyHandler=keyHandlerTuple[2];keyEventTarget.removeEventListener(eventName,boundKeyHandler)}},_onKeyBindingEvent:function(keyBindings,event){if(this.stopKeyboardEventPropagation){event.stopPropagation()}if(event.defaultPrevented){return}for(var i=0;i<keyBindings.length;i++){var keyCombo=keyBindings[i][0];var handlerName=keyBindings[i][1];if(keyComboMatchesEvent(keyCombo,event)){this._triggerKeyHandler(keyCombo,handlerName,event);if(event.defaultPrevented){return}}}},_triggerKeyHandler:function(keyCombo,handlerName,keyboardEvent){var detail=Object.create(keyCombo);detail.keyboardEvent=keyboardEvent;var event=new CustomEvent(keyCombo.event,{detail:detail,cancelable:true});this[handlerName].call(this,event);if(event.defaultPrevented){keyboardEvent.preventDefault()}}}})();
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){function DialogFocusManager(){this.previousFocusElement_=null;this.dialogs_=new Set}DialogFocusManager.prototype={showDialog:function(dialog,showFn){if(!showFn){showFn=function(){dialog.showModal()}}if(!this.dialogs_.size||this.dialogs_.has(dialog)&&this.dialogs_.size==1){this.updatePreviousFocus_()}if(!this.dialogs_.has(dialog)){dialog.addEventListener("close",this.getCloseListener_(dialog));this.dialogs_.add(dialog)}showFn()},hasOpenDialog:function(){return this.dialogs_.size>0},clearFocus:function(){this.previousFocusElement_=null},updatePreviousFocus_:function(){this.previousFocusElement_=this.getFocusedElement_()},getFocusedElement_:function(){let focus=document.activeElement;while(focus.root&&focus.root.activeElement)focus=focus.root.activeElement;return focus},getCloseListener_:function(dialog){const closeListener=e=>{if(dialog.open)return;assert(this.dialogs_.delete(dialog));if(!this.hasOpenDialog()&&this.previousFocusElement_)this.previousFocusElement_.focus();dialog.removeEventListener("close",closeListener)};return closeListener}};cr.addSingletonGetter(DialogFocusManager);return{DialogFocusManager:DialogFocusManager}});Polymer.IronControlState={properties:{focused:{type:Boolean,value:false,notify:true,readOnly:true,reflectToAttribute:true},disabled:{type:Boolean,value:false,notify:true,observer:"_disabledChanged",reflectToAttribute:true},_oldTabIndex:{type:String},_boundFocusBlurHandler:{type:Function,value:function(){return this._focusBlurHandler.bind(this)}},__handleEventRetargeting:{type:Boolean,value:function(){return!this.shadowRoot&&!Polymer.Element}}},observers:["_changedControlState(focused, disabled)"],ready:function(){this.addEventListener("focus",this._boundFocusBlurHandler,true);this.addEventListener("blur",this._boundFocusBlurHandler,true)},_focusBlurHandler:function(event){if(Polymer.Element){this._setFocused(event.type==="focus");return}if(event.target===this){this._setFocused(event.type==="focus")}else if(this.__handleEventRetargeting){var target=Polymer.dom(event).localTarget;if(!this.isLightDescendant(target)){this.fire(event.type,{sourceEvent:event},{node:this,bubbles:event.bubbles,cancelable:event.cancelable})}}},_disabledChanged:function(disabled,old){this.setAttribute("aria-disabled",disabled?"true":"false");this.style.pointerEvents=disabled?"none":"";if(disabled){this._oldTabIndex=this.getAttribute("tabindex");this._setFocused(false);this.tabIndex=-1;this.blur()}else if(this._oldTabIndex!==undefined){if(this._oldTabIndex===null){this.removeAttribute("tabindex")}else{this.setAttribute("tabindex",this._oldTabIndex)}}},_changedControlState:function(){if(this._controlStateChanged){this._controlStateChanged()}}};Polymer.IronButtonStateImpl={properties:{pressed:{type:Boolean,readOnly:true,value:false,reflectToAttribute:true,observer:"_pressedChanged"},toggles:{type:Boolean,value:false,reflectToAttribute:true},active:{type:Boolean,value:false,notify:true,reflectToAttribute:true},pointerDown:{type:Boolean,readOnly:true,value:false},receivedFocusFromKeyboard:{type:Boolean,readOnly:true},ariaActiveAttribute:{type:String,value:"aria-pressed",observer:"_ariaActiveAttributeChanged"}},listeners:{down:"_downHandler",up:"_upHandler",tap:"_tapHandler"},observers:["_focusChanged(focused)","_activeChanged(active, ariaActiveAttribute)"],keyBindings:{"enter:keydown":"_asyncClick","space:keydown":"_spaceKeyDownHandler","space:keyup":"_spaceKeyUpHandler"},_mouseEventRe:/^mouse/,_tapHandler:function(){if(this.toggles){this._userActivate(!this.active)}else{this.active=false}},_focusChanged:function(focused){this._detectKeyboardFocus(focused);if(!focused){this._setPressed(false)}},_detectKeyboardFocus:function(focused){this._setReceivedFocusFromKeyboard(!this.pointerDown&&focused)},_userActivate:function(active){if(this.active!==active){this.active=active;this.fire("change")}},_downHandler:function(event){this._setPointerDown(true);this._setPressed(true);this._setReceivedFocusFromKeyboard(false)},_upHandler:function(){this._setPointerDown(false);this._setPressed(false)},_spaceKeyDownHandler:function(event){var keyboardEvent=event.detail.keyboardEvent;var target=Polymer.dom(keyboardEvent).localTarget;if(this.isLightDescendant(target))return;keyboardEvent.preventDefault();keyboardEvent.stopImmediatePropagation();this._setPressed(true)},_spaceKeyUpHandler:function(event){var keyboardEvent=event.detail.keyboardEvent;var target=Polymer.dom(keyboardEvent).localTarget;if(this.isLightDescendant(target))return;if(this.pressed){this._asyncClick()}this._setPressed(false)},_asyncClick:function(){this.async(function(){this.click()},1)},_pressedChanged:function(pressed){this._changedButtonState()},_ariaActiveAttributeChanged:function(value,oldValue){if(oldValue&&oldValue!=value&&this.hasAttribute(oldValue)){this.removeAttribute(oldValue)}},_activeChanged:function(active,ariaActiveAttribute){if(this.toggles){this.setAttribute(this.ariaActiveAttribute,active?"true":"false")}else{this.removeAttribute(this.ariaActiveAttribute)}this._changedButtonState()},_controlStateChanged:function(){if(this.disabled){this._setPressed(false)}else{this._changedButtonState()}},_changedButtonState:function(){if(this._buttonStateChanged){this._buttonStateChanged()}}};Polymer.IronButtonState=[Polymer.IronA11yKeysBehavior,Polymer.IronButtonStateImpl];(function(){var MAX_RADIUS_PX=300;var MIN_DURATION_MS=800;var distance=function(x1,y1,x2,y2){var xDelta=x1-x2;var yDelta=y1-y2;return Math.sqrt(xDelta*xDelta+yDelta*yDelta)};Polymer({is:"paper-ripple",behaviors:[Polymer.IronA11yKeysBehavior],properties:{center:{type:Boolean,value:false},holdDown:{type:Boolean,value:false,observer:"_holdDownChanged"},recenters:{type:Boolean,value:false},noink:{type:Boolean,value:false}},keyBindings:{"enter:keydown":"_onEnterKeydown","space:keydown":"_onSpaceKeydown","space:keyup":"_onSpaceKeyup"},created:function(){this.ripples=[]},attached:function(){this.keyEventTarget=this.parentNode.nodeType==11?Polymer.dom(this).getOwnerRoot().host:this.parentNode;this.keyEventTarget=this.keyEventTarget;this.listen(this.keyEventTarget,"up","uiUpAction");this.listen(this.keyEventTarget,"down","uiDownAction")},detached:function(){this.unlisten(this.keyEventTarget,"up","uiUpAction");this.unlisten(this.keyEventTarget,"down","uiDownAction");this.keyEventTarget=null},simulatedRipple:function(){this.downAction();this.async(function(){this.upAction()}.bind(this),1)},uiDownAction:function(e){if(!this.noink)this.downAction(e)},downAction:function(e){if(this.ripples.length&&this.holdDown)return;this.debounce("show ripple",function(){this.__showRipple(e)},1)},__showRipple:function(e){var rect=this.getBoundingClientRect();var roundedCenterX=function(){return Math.round(rect.width/2)};var roundedCenterY=function(){return Math.round(rect.height/2)};var centered=!e||this.center;if(centered){var x=roundedCenterX();var y=roundedCenterY()}else{var sourceEvent=e.detail.sourceEvent;var x=Math.round(sourceEvent.clientX-rect.left);var y=Math.round(sourceEvent.clientY-rect.top)}var corners=[{x:0,y:0},{x:rect.width,y:0},{x:0,y:rect.height},{x:rect.width,y:rect.height}];var cornerDistances=corners.map(function(corner){return Math.round(distance(x,y,corner.x,corner.y))});var radius=Math.min(MAX_RADIUS_PX,Math.max.apply(Math,cornerDistances));var startTranslate=x-radius+"px, "+(y-radius)+"px";if(this.recenters&&!centered){var endTranslate=roundedCenterX()-radius+"px, "+(roundedCenterY()-radius)+"px"}else{var endTranslate=startTranslate}var ripple=document.createElement("div");ripple.classList.add("ripple");ripple.style.height=ripple.style.width=2*radius+"px";this.ripples.push(ripple);this.shadowRoot.appendChild(ripple);ripple.animate({transform:["translate("+startTranslate+") scale(0)","translate("+endTranslate+") scale(1)"]},{duration:Math.max(MIN_DURATION_MS,Math.log(radius)*radius)||0,easing:"cubic-bezier(.2, .9, .1, .9)",fill:"forwards"})},uiUpAction:function(e){if(!this.noink)this.upAction()},upAction:function(e){if(!this.holdDown)this.debounce("hide ripple",function(){this.__hideRipple()},1)},__hideRipple:function(){Promise.all(this.ripples.map(function(ripple){return new Promise(function(resolve){var removeRipple=function(){ripple.remove();resolve()};var opacity=getComputedStyle(ripple).opacity;if(!opacity.length){removeRipple()}else{var animation=ripple.animate({opacity:[opacity,0]},{duration:150,fill:"forwards"});animation.addEventListener("finish",removeRipple);animation.addEventListener("cancel",removeRipple)}})})).then(function(){this.fire("transitionend")}.bind(this));this.ripples=[]},_onEnterKeydown:function(){this.uiDownAction();this.async(this.uiUpAction,1)},_onSpaceKeydown:function(){this.uiDownAction()},_onSpaceKeyup:function(){this.uiUpAction()},_holdDownChanged:function(newHoldDown,oldHoldDown){if(oldHoldDown===undefined)return;if(newHoldDown)this.downAction();else this.upAction()}})})();Polymer.PaperRippleBehavior={properties:{noink:{type:Boolean,observer:"_noinkChanged"},_rippleContainer:{type:Object}},_buttonStateChanged:function(){if(this.focused){this.ensureRipple()}},_downHandler:function(event){Polymer.IronButtonStateImpl._downHandler.call(this,event);if(this.pressed){this.ensureRipple(event)}},ensureRipple:function(optTriggeringEvent){if(!this.hasRipple()){this._ripple=this._createRipple();this._ripple.noink=this.noink;var rippleContainer=this._rippleContainer||this.root;if(rippleContainer){Polymer.dom(rippleContainer).appendChild(this._ripple)}if(optTriggeringEvent){var domContainer=Polymer.dom(this._rippleContainer||this);var target=Polymer.dom(optTriggeringEvent).rootTarget;if(domContainer.deepContains(target)){this._ripple.uiDownAction(optTriggeringEvent)}}}},getRipple:function(){this.ensureRipple();return this._ripple},hasRipple:function(){return Boolean(this._ripple)},_createRipple:function(){var element=document.createElement("paper-ripple");return element},_noinkChanged:function(noink){if(this.hasRipple()){this._ripple.noink=noink}}};Polymer({is:"paper-icon-button-light",behaviors:[Polymer.PaperRippleBehavior],ready:function(){Polymer.RenderStatus.afterNextRender(this,()=>{this.addEventListener("down",this._rippleDown.bind(this));this.addEventListener("up",this._rippleUp.bind(this));var button=this.getEffectiveChildren()[0];this._rippleContainer=button;button.addEventListener("focus",this._rippleDown.bind(this));button.addEventListener("blur",this._rippleUp.bind(this))})},_rippleDown:function(){this.getRipple().uiDownAction()},_rippleUp:function(){this.getRipple().uiUpAction()},ensureRipple:function(var_args){var lastRipple=this._ripple;Polymer.PaperRippleBehavior.ensureRipple.apply(this,arguments);if(this._ripple&&this._ripple!==lastRipple){this._ripple.center=true;this._ripple.classList.add("circle")}}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-dialog",properties:{open:{type:Boolean,value:false,reflectToAttribute:true},closeText:String,ignorePopstate:{type:Boolean,value:false},ignoreEnterKey:{type:Boolean,value:false},noCancel:{type:Boolean,value:false},showCloseButton:{type:Boolean,value:false}},listeners:{pointerdown:"onPointerdown_"},intersectionObserver_:null,mutationObserver_:null,ready:function(){window.addEventListener("popstate",function(){if(!this.ignorePopstate&&this.$.dialog.open)this.cancel()}.bind(this));if(!this.ignoreEnterKey)this.addEventListener("keypress",this.onKeypress_.bind(this));if(this.noCancel)this.addEventListener("cancel",this.onCancel_.bind(this))},attached:function(){var mutationObserverCallback=function(){if(this.$.dialog.open)this.addIntersectionObserver_();else this.removeIntersectionObserver_()}.bind(this);this.mutationObserver_=new MutationObserver(mutationObserverCallback);this.mutationObserver_.observe(this.$.dialog,{attributes:true,attributeFilter:["open"]});mutationObserverCallback()},detached:function(){this.removeIntersectionObserver_();if(this.mutationObserver_){this.mutationObserver_.disconnect();this.mutationObserver_=null}},addIntersectionObserver_:function(){if(this.intersectionObserver_)return;var bodyContainer=this.$$(".body-container");var bottomMarker=this.$.bodyBottomMarker;var topMarker=this.$.bodyTopMarker;var callback=function(entries){for(var i=0;i<entries.length;i++){var target=entries[i].target;assert(target==bottomMarker||target==topMarker);var classToToggle=target==bottomMarker?"bottom-scrollable":"top-scrollable";bodyContainer.classList.toggle(classToToggle,entries[i].intersectionRatio==0)}};this.intersectionObserver_=new IntersectionObserver(callback,{root:bodyContainer,threshold:0});this.intersectionObserver_.observe(bottomMarker);this.intersectionObserver_.observe(topMarker)},removeIntersectionObserver_:function(){if(this.intersectionObserver_){this.intersectionObserver_.disconnect();this.intersectionObserver_=null}},showModal:function(){this.$.dialog.showModal();this.open=this.$.dialog.open},cancel:function(){this.fire("cancel");this.$.dialog.close();this.open=this.$.dialog.open},close:function(){this.$.dialog.close("success");this.open=this.$.dialog.open},onCloseKeypress_:function(e){e.stopPropagation()},getNative:function(){return this.$.dialog},getCloseButton:function(){return this.$.close},onKeypress_:function(e){if(e.key!="Enter")return;if(e.target!=this&&e.target.tagName!="PAPER-INPUT")return;var actionButton=this.querySelector(".action-button:not([disabled]):not([hidden])");if(actionButton){actionButton.click();e.preventDefault()}},onCancel_:function(e){if(this.noCancel)e.preventDefault()},onPointerdown_:function(e){if(e.button!=0||e.composedPath()[0].tagName!=="DIALOG")return;this.$.dialog.animate([{transform:"scale(1)",offset:0},{transform:"scale(1.02)",offset:.4},{transform:"scale(1.02)",offset:.6},{transform:"scale(1)",offset:1}],{duration:180,easing:"ease-in-out",iterations:1});e.preventDefault()}});Polymer.PaperButtonBehaviorImpl={properties:{elevation:{type:Number,reflectToAttribute:true,readOnly:true}},observers:["_calculateElevation(focused, disabled, active, pressed, receivedFocusFromKeyboard)","_computeKeyboardClass(receivedFocusFromKeyboard)"],hostAttributes:{role:"button",tabindex:"0",animated:true},_calculateElevation:function(){var e=1;if(this.disabled){e=0}else if(this.active||this.pressed){e=4}else if(this.receivedFocusFromKeyboard){e=3}this._setElevation(e)},_computeKeyboardClass:function(receivedFocusFromKeyboard){this.toggleClass("keyboard-focus",receivedFocusFromKeyboard)},_spaceKeyDownHandler:function(event){Polymer.IronButtonStateImpl._spaceKeyDownHandler.call(this,event);if(this.hasRipple()&&this.getRipple().ripples.length<1){this._ripple.uiDownAction()}},_spaceKeyUpHandler:function(event){Polymer.IronButtonStateImpl._spaceKeyUpHandler.call(this,event);if(this.hasRipple()){this._ripple.uiUpAction()}}};Polymer.PaperButtonBehavior=[Polymer.IronButtonState,Polymer.IronControlState,Polymer.PaperRippleBehavior,Polymer.PaperButtonBehaviorImpl];Polymer({is:"paper-button",behaviors:[Polymer.PaperButtonBehavior],properties:{raised:{type:Boolean,reflectToAttribute:true,value:false,observer:"_calculateElevation"}},_calculateElevation:function(){if(!this.raised){this._setElevation(0)}else{Polymer.PaperButtonBehaviorImpl._calculateElevation.apply(this)}}});Polymer.IronFormElementBehavior={properties:{name:{type:String},value:{notify:true,type:String},required:{type:Boolean,value:false},_parentForm:{type:Object}},attached(){if(!Polymer.Element){this.fire("iron-form-element-register")}},detached(){if(!Polymer.Element&&this._parentForm){this._parentForm.fire("iron-form-element-unregister",{target:this})}}};(function(){"use strict";Polymer.IronA11yAnnouncer=Polymer({is:"iron-a11y-announcer",properties:{mode:{type:String,value:"polite"},_text:{type:String,value:""}},created:function(){if(!Polymer.IronA11yAnnouncer.instance){Polymer.IronA11yAnnouncer.instance=this}document.body.addEventListener("iron-announce",this._onIronAnnounce.bind(this))},announce:function(text){this._text="";this.async(function(){this._text=text},100)},_onIronAnnounce:function(event){if(event.detail&&event.detail.text){this.announce(event.detail.text)}}});Polymer.IronA11yAnnouncer.instance=null;Polymer.IronA11yAnnouncer.requestAvailability=function(){if(!Polymer.IronA11yAnnouncer.instance){Polymer.IronA11yAnnouncer.instance=document.createElement("iron-a11y-announcer")}document.body.appendChild(Polymer.IronA11yAnnouncer.instance)}})();(function(){Polymer.IronMeta=function(options){Polymer.IronMeta[" "](options);this.type=options&&options.type||"default";this.key=options&&options.key;if(options&&"value"in options){this.value=options.value}};Polymer.IronMeta[" "]=function(){};Polymer.IronMeta.types={};Polymer.IronMeta.prototype={get value(){var type=this.type;var key=this.key;if(type&&key){return Polymer.IronMeta.types[type]&&Polymer.IronMeta.types[type][key]}},set value(value){var type=this.type;var key=this.key;if(type&&key){type=Polymer.IronMeta.types[type]=Polymer.IronMeta.types[type]||{};if(value==null){delete type[key]}else{type[key]=value}}},get list(){var type=this.type;if(type){var items=Polymer.IronMeta.types[this.type];if(!items){return[]}return Object.keys(items).map(function(key){return metaDatas[this.type][key]},this)}},byKey:function(key){this.key=key;return this.value}};var metaDatas=Polymer.IronMeta.types;Polymer({is:"iron-meta",properties:{type:{type:String,value:"default"},key:{type:String},value:{type:String,notify:true},self:{type:Boolean,observer:"_selfChanged"},__meta:{type:Boolean,computed:"__computeMeta(type, key, value)"}},hostAttributes:{hidden:true},__computeMeta:function(type,key,value){var meta=new Polymer.IronMeta({type:type,key:key});if(value!==undefined&&value!==meta.value){meta.value=value}else if(this.value!==meta.value){this.value=meta.value}return meta},get list(){return this.__meta&&this.__meta.list},_selfChanged:function(self){if(self){this.value=this}},byKey:function(key){return new Polymer.IronMeta({type:this.type,key:key}).value}})})();Polymer.IronValidatableBehaviorMeta=null;Polymer.IronValidatableBehavior={properties:{validator:{type:String},invalid:{notify:true,reflectToAttribute:true,type:Boolean,value:false,observer:"_invalidChanged"}},registered:function(){Polymer.IronValidatableBehaviorMeta=new Polymer.IronMeta({type:"validator"})},_invalidChanged:function(){if(this.invalid){this.setAttribute("aria-invalid","true")}else{this.removeAttribute("aria-invalid")}},get _validator(){return Polymer.IronValidatableBehaviorMeta&&Polymer.IronValidatableBehaviorMeta.byKey(this.validator)},hasValidator:function(){return this._validator!=null},validate:function(value){if(value===undefined&&this.value!==undefined)this.invalid=!this._getValidity(this.value);else this.invalid=!this._getValidity(value);return!this.invalid},_getValidity:function(value){if(this.hasValidator()){return this._validator.validate(value)}return true}};Polymer({is:"iron-input",behaviors:[Polymer.IronValidatableBehavior],properties:{bindValue:{type:String,value:""},value:{type:String,computed:"_computeValue(bindValue)"},allowedPattern:{type:String},autoValidate:{type:Boolean,value:false},_inputElement:Object},observers:["_bindValueChanged(bindValue, _inputElement)"],listeners:{input:"_onInput",keypress:"_onKeypress"},created:function(){Polymer.IronA11yAnnouncer.requestAvailability();this._previousValidInput="";this._patternAlreadyChecked=false},attached:function(){this._observer=Polymer.dom(this).observeNodes(function(info){this._initSlottedInput()}.bind(this))},detached:function(){if(this._observer){Polymer.dom(this).unobserveNodes(this._observer);this._observer=null}},get inputElement(){return this._inputElement},_initSlottedInput:function(){this._inputElement=this.getEffectiveChildren()[0];if(this.inputElement&&this.inputElement.value){this.bindValue=this.inputElement.value}this.fire("iron-input-ready")},get _patternRegExp(){var pattern;if(this.allowedPattern){pattern=new RegExp(this.allowedPattern)}else{switch(this.inputElement.type){case"number":pattern=/[0-9.,e-]/;break}}return pattern},_bindValueChanged:function(bindValue,inputElement){if(!inputElement){return}if(bindValue===undefined){inputElement.value=null}else if(bindValue!==inputElement.value){this.inputElement.value=bindValue}if(this.autoValidate){this.validate()}this.fire("bind-value-changed",{value:bindValue})},_onInput:function(){if(this.allowedPattern&&!this._patternAlreadyChecked){var valid=this._checkPatternValidity();if(!valid){this._announceInvalidCharacter("Invalid string of characters not entered.");this.inputElement.value=this._previousValidInput}}this.bindValue=this._previousValidInput=this.inputElement.value;this._patternAlreadyChecked=false},_isPrintable:function(event){var anyNonPrintable=event.keyCode==8||event.keyCode==9||event.keyCode==13||event.keyCode==27;var mozNonPrintable=event.keyCode==19||event.keyCode==20||event.keyCode==45||event.keyCode==46||event.keyCode==144||event.keyCode==145||event.keyCode>32&&event.keyCode<41||event.keyCode>111&&event.keyCode<124;return!anyNonPrintable&&!(event.charCode==0&&mozNonPrintable)},_onKeypress:function(event){if(!this.allowedPattern&&this.inputElement.type!=="number"){return}var regexp=this._patternRegExp;if(!regexp){return}if(event.metaKey||event.ctrlKey||event.altKey){return}this._patternAlreadyChecked=true;var thisChar=String.fromCharCode(event.charCode);if(this._isPrintable(event)&&!regexp.test(thisChar)){event.preventDefault();this._announceInvalidCharacter("Invalid character "+thisChar+" not entered.")}},_checkPatternValidity:function(){var regexp=this._patternRegExp;if(!regexp){return true}for(var i=0;i<this.inputElement.value.length;i++){if(!regexp.test(this.inputElement.value[i])){return false}}return true},validate:function(){if(!this.inputElement){this.invalid=false;return true}var valid=this.inputElement.checkValidity();if(valid){if(this.required&&this.bindValue===""){valid=false}else if(this.hasValidator()){valid=Polymer.IronValidatableBehavior.validate.call(this,this.bindValue)}}this.invalid=!valid;this.fire("iron-input-validate");return valid},_announceInvalidCharacter:function(message){this.fire("iron-announce",{text:message})},_computeValue:function(bindValue){return bindValue}});Polymer.PaperInputHelper={};Polymer.PaperInputHelper.NextLabelID=1;Polymer.PaperInputHelper.NextAddonID=1;Polymer.PaperInputHelper.NextInputID=1;Polymer.PaperInputBehaviorImpl={properties:{label:{type:String},value:{notify:true,type:String},disabled:{type:Boolean,value:false},invalid:{type:Boolean,value:false,notify:true},allowedPattern:{type:String},type:{type:String},list:{type:String},pattern:{type:String},required:{type:Boolean,value:false},errorMessage:{type:String},charCounter:{type:Boolean,value:false},noLabelFloat:{type:Boolean,value:false},alwaysFloatLabel:{type:Boolean,value:false},autoValidate:{type:Boolean,value:false},validator:{type:String},autocomplete:{type:String,value:"off"},autofocus:{type:Boolean,observer:"_autofocusChanged"},inputmode:{type:String},minlength:{type:Number},maxlength:{type:Number},min:{type:String},max:{type:String},step:{type:String},name:{type:String},placeholder:{type:String,value:""},readonly:{type:Boolean,value:false},size:{type:Number},autocapitalize:{type:String,value:"none"},autocorrect:{type:String,value:"off"},autosave:{type:String},results:{type:Number},accept:{type:String},multiple:{type:Boolean},_ariaDescribedBy:{type:String,value:""},_ariaLabelledBy:{type:String,value:""},_inputId:{type:String,value:""}},listeners:{"addon-attached":"_onAddonAttached"},keyBindings:{"shift+tab:keydown":"_onShiftTabDown"},hostAttributes:{tabindex:0},get inputElement(){if(!this.$){this.$={}}if(!this.$.input){this._generateInputId();this.$.input=this.$$("#"+this._inputId)}return this.$.input},get _focusableElement(){return this.inputElement},created:function(){this._typesThatHaveText=["date","datetime","datetime-local","month","time","week","file"]},attached:function(){this._updateAriaLabelledBy();if(!Polymer.Element&&this.inputElement&&this._typesThatHaveText.indexOf(this.inputElement.type)!==-1){this.alwaysFloatLabel=true}},_appendStringWithSpace:function(str,more){if(str){str=str+" "+more}else{str=more}return str},_onAddonAttached:function(event){var target=Polymer.dom(event).rootTarget;if(target.id){this._ariaDescribedBy=this._appendStringWithSpace(this._ariaDescribedBy,target.id)}else{var id="paper-input-add-on-"+Polymer.PaperInputHelper.NextAddonID++;target.id=id;this._ariaDescribedBy=this._appendStringWithSpace(this._ariaDescribedBy,id)}},validate:function(){return this.inputElement.validate()},_focusBlurHandler:function(event){Polymer.IronControlState._focusBlurHandler.call(this,event);if(this.focused&&!this._shiftTabPressed&&this._focusableElement){this._focusableElement.focus()}},_onShiftTabDown:function(event){var oldTabIndex=this.getAttribute("tabindex");this._shiftTabPressed=true;this.setAttribute("tabindex","-1");this.async(function(){this.setAttribute("tabindex",oldTabIndex);this._shiftTabPressed=false},1)},_handleAutoValidate:function(){if(this.autoValidate)this.validate()},updateValueAndPreserveCaret:function(newValue){try{var start=this.inputElement.selectionStart;this.value=newValue;this.inputElement.selectionStart=start;this.inputElement.selectionEnd=start}catch(e){this.value=newValue}},_computeAlwaysFloatLabel:function(alwaysFloatLabel,placeholder){return placeholder||alwaysFloatLabel},_updateAriaLabelledBy:function(){var label=Polymer.dom(this.root).querySelector("label");if(!label){this._ariaLabelledBy="";return}var labelledBy;if(label.id){labelledBy=label.id}else{labelledBy="paper-input-label-"+Polymer.PaperInputHelper.NextLabelID++;label.id=labelledBy}this._ariaLabelledBy=labelledBy},_generateInputId:function(){if(!this._inputId||this._inputId===""){this._inputId="input-"+Polymer.PaperInputHelper.NextInputID++}},_onChange:function(event){if(this.shadowRoot){this.fire(event.type,{sourceEvent:event},{node:this,bubbles:event.bubbles,cancelable:event.cancelable})}},_autofocusChanged:function(){if(this.autofocus&&this._focusableElement){var activeElement=document.activeElement;var isActiveElementValid=activeElement instanceof HTMLElement;var isSomeElementActive=isActiveElementValid&&activeElement!==document.body&&activeElement!==document.documentElement;if(!isSomeElementActive){this._focusableElement.focus()}}}};Polymer.PaperInputBehavior=[Polymer.IronControlState,Polymer.IronA11yKeysBehavior,Polymer.PaperInputBehaviorImpl];Polymer.PaperInputAddonBehavior={attached:function(){Polymer.dom.flush();this.fire("addon-attached")},update:function(state){}};Polymer({is:"paper-input-char-counter",behaviors:[Polymer.PaperInputAddonBehavior],properties:{_charCounterStr:{type:String,value:"0"}},update:function(state){if(!state.inputElement){return}state.value=state.value||"";var counter=state.value.toString().length.toString();if(state.inputElement.hasAttribute("maxlength")){counter+="/"+state.inputElement.getAttribute("maxlength")}this._charCounterStr=counter}});Polymer({is:"paper-input-container",properties:{noLabelFloat:{type:Boolean,value:false},alwaysFloatLabel:{type:Boolean,value:false},attrForValue:{type:String,value:"bind-value"},autoValidate:{type:Boolean,value:false},invalid:{observer:"_invalidChanged",type:Boolean,value:false},focused:{readOnly:true,type:Boolean,value:false,notify:true},_addons:{type:Array},_inputHasContent:{type:Boolean,value:false},_inputSelector:{type:String,value:"input,iron-input,textarea,.paper-input-input"},_boundOnFocus:{type:Function,value:function(){return this._onFocus.bind(this)}},_boundOnBlur:{type:Function,value:function(){return this._onBlur.bind(this)}},_boundOnInput:{type:Function,value:function(){return this._onInput.bind(this)}},_boundValueChanged:{type:Function,value:function(){return this._onValueChanged.bind(this)}}},listeners:{"addon-attached":"_onAddonAttached","iron-input-validate":"_onIronInputValidate"},get _valueChangedEvent(){return this.attrForValue+"-changed"},get _propertyForValue(){return Polymer.CaseMap.dashToCamelCase(this.attrForValue)},get _inputElement(){return Polymer.dom(this).querySelector(this._inputSelector)},get _inputElementValue(){return this._inputElement[this._propertyForValue]||this._inputElement.value},ready:function(){this.__isFirstValueUpdate=true;if(!this._addons){this._addons=[]}this.addEventListener("focus",this._boundOnFocus,true);this.addEventListener("blur",this._boundOnBlur,true)},attached:function(){if(this.attrForValue){this._inputElement.addEventListener(this._valueChangedEvent,this._boundValueChanged)}else{this.addEventListener("input",this._onInput)}if(this._inputElementValue&&this._inputElementValue!=""){this._handleValueAndAutoValidate(this._inputElement)}else{this._handleValue(this._inputElement)}},_onAddonAttached:function(event){if(!this._addons){this._addons=[]}var target=event.target;if(this._addons.indexOf(target)===-1){this._addons.push(target);if(this.isAttached){this._handleValue(this._inputElement)}}},_onFocus:function(){this._setFocused(true)},_onBlur:function(){this._setFocused(false);this._handleValueAndAutoValidate(this._inputElement)},_onInput:function(event){this._handleValueAndAutoValidate(event.target)},_onValueChanged:function(event){var input=event.target;if(this.__isFirstValueUpdate){this.__isFirstValueUpdate=false;if(input.value===undefined){return}}this._handleValueAndAutoValidate(event.target)},_handleValue:function(inputElement){var value=this._inputElementValue;if(value||value===0||inputElement.type==="number"&&!inputElement.checkValidity()){this._inputHasContent=true}else{this._inputHasContent=false}this.updateAddons({inputElement:inputElement,value:value,invalid:this.invalid})},_handleValueAndAutoValidate:function(inputElement){if(this.autoValidate&&inputElement){var valid;if(inputElement.validate){valid=inputElement.validate(this._inputElementValue)}else{valid=inputElement.checkValidity()}this.invalid=!valid}this._handleValue(inputElement)},_onIronInputValidate:function(event){this.invalid=this._inputElement.invalid},_invalidChanged:function(){if(this._addons){this.updateAddons({invalid:this.invalid})}},updateAddons:function(state){for(var addon,index=0;addon=this._addons[index];index++){addon.update(state)}},_computeInputContentClass:function(noLabelFloat,alwaysFloatLabel,focused,invalid,_inputHasContent){var cls="input-content";if(!noLabelFloat){var label=this.querySelector("label");if(alwaysFloatLabel||_inputHasContent){cls+=" label-is-floating";this.$.labelAndInputContainer.style.position="static";if(invalid){cls+=" is-invalid"}else if(focused){cls+=" label-is-highlighted"}}else{if(label){this.$.labelAndInputContainer.style.position="relative"}if(invalid){cls+=" is-invalid"}}}else{if(_inputHasContent){cls+=" label-is-hidden"}if(invalid){cls+=" is-invalid"}}if(focused){cls+=" focused"}return cls},_computeUnderlineClass:function(focused,invalid){var cls="underline";if(invalid){cls+=" is-invalid"}else if(focused){cls+=" is-highlighted"}return cls},_computeAddOnContentClass:function(focused,invalid){var cls="add-on-content";if(invalid){cls+=" is-invalid"}else if(focused){cls+=" is-highlighted"}return cls}});Polymer({is:"paper-input-error",behaviors:[Polymer.PaperInputAddonBehavior],properties:{invalid:{readOnly:true,reflectToAttribute:true,type:Boolean}},update:function(state){this._setInvalid(state.invalid)}});Polymer({is:"paper-input",behaviors:[Polymer.PaperInputBehavior,Polymer.IronFormElementBehavior],beforeRegister:function(){var version="v1";var template=Polymer.DomModule.import("paper-input","template");var inputTemplate=Polymer.DomModule.import("paper-input","template#"+version);var inputPlaceholder=template.content.querySelector("#template-placeholder");if(inputPlaceholder){inputPlaceholder.parentNode.replaceChild(inputTemplate.content,inputPlaceholder)}},get _focusableElement(){return this.inputElement._inputElement},listeners:{"iron-input-ready":"_onIronInputReady"},_onIronInputReady:function(){if(!this.$.nativeInput){this.$.nativeInput=this.$$("input")}if(this.inputElement&&this._typesThatHaveText.indexOf(this.$.nativeInput.type)!==-1){this.alwaysFloatLabel=true}if(!!this.inputElement.bindValue){this.$.container._handleValueAndAutoValidate(this.inputElement)}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-edit-dialog",properties:{isFolder_:Boolean,isEdit_:Boolean,editItem_:Object,parentId_:String,titleValue_:String,urlValue_:String},showAddDialog:function(isFolder,parentId){this.reset_();this.isEdit_=false;this.isFolder_=isFolder;this.parentId_=parentId;bookmarks.DialogFocusManager.getInstance().showDialog(this.$.dialog)},showEditDialog:function(editItem){this.reset_();this.isEdit_=true;this.isFolder_=!editItem.url;this.editItem_=editItem;this.titleValue_=editItem.title;if(!this.isFolder_)this.urlValue_=assert(editItem.url);bookmarks.DialogFocusManager.getInstance().showDialog(this.$.dialog)},reset_:function(){this.editItem_=null;this.parentId_=null;this.$.url.invalid=false;this.titleValue_="";this.urlValue_=""},getDialogTitle_:function(isFolder,isEdit){let title;if(isEdit)title=isFolder?"renameFolderTitle":"editBookmarkTitle";else title=isFolder?"addFolderTitle":"addBookmarkTitle";return loadTimeData.getString(title)},validateUrl_:function(){const urlInput=this.$.url;const originalValue=this.urlValue_;if(urlInput.validate())return true;this.urlValue_="http://"+originalValue;if(urlInput.validate())return true;this.urlValue_=originalValue;return false},onSaveButtonTap_:function(){const edit={title:this.titleValue_};if(!this.isFolder_){if(!this.validateUrl_())return;edit["url"]=this.urlValue_}if(this.isEdit_){chrome.bookmarks.update(this.editItem_.id,edit)}else{edit["parentId"]=this.parentId_;bookmarks.ApiListener.trackUpdatedItems();chrome.bookmarks.create(edit,bookmarks.ApiListener.highlightUpdatedItems)}this.$.dialog.close()},onCancelButtonTap_:function(){this.$.dialog.cancel()},getHeightOfBody_:function(){const heightTwoInputs=136;const heightOneInput=62;return this.isFolder_?heightOneInput:heightTwoInputs}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){const StoreClient={created:function(){this.watches_=[]},attached:function(){bookmarks.Store.getInstance().addObserver(this)},detached:function(){bookmarks.Store.getInstance().removeObserver(this)},watch:function(localProperty,valueGetter){if(!this.getPropertyInfo(localProperty).defined){console.error("No property "+localProperty+" defined on "+this.is)}this.watches_.push({localProperty:localProperty,valueGetter:valueGetter})},dispatch:function(action){bookmarks.Store.getInstance().dispatch(action)},dispatchAsync:function(action){bookmarks.Store.getInstance().dispatchAsync(action)},onStateChanged:function(newState){this.watches_.forEach(watch=>{const oldValue=this[watch.localProperty];const newValue=watch.valueGetter(newState);if(oldValue===newValue||newValue===undefined)return;this[watch.localProperty]=newValue})},updateFromStore:function(){if(bookmarks.Store.getInstance().isInitialized())this.onStateChanged(bookmarks.Store.getInstance().data)},getState:function(){return bookmarks.Store.getInstance().data}};return{StoreClient:StoreClient}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){const CommandManager=Polymer({is:"bookmarks-command-manager",behaviors:[bookmarks.StoreClient],properties:{menuCommands_:{type:Array,computed:"computeMenuCommands_(menuSource_)"},menuIds_:{type:Object},hasAnySublabel_:{type:Boolean,reflectToAttribute:true,computed:"computeHasAnySublabel_(menuCommands_, menuIds_)"},menuSource_:MenuSource.NONE,globalCanEdit_:Boolean},confirmOpenCallback_:null,attached:function(){assert(CommandManager.instance_==null);CommandManager.instance_=this;this.watch("globalCanEdit_",function(state){return state.prefs.canEdit});this.updateFromStore();this.shortcuts_=new Map;this.addShortcut_(Command.EDIT,"F2","Enter");this.addShortcut_(Command.DELETE,"Delete","Delete Backspace");this.addShortcut_(Command.OPEN,"Enter","Meta|o");this.addShortcut_(Command.OPEN_NEW_TAB,"Ctrl|Enter","Meta|Enter");this.addShortcut_(Command.OPEN_NEW_WINDOW,"Shift|Enter");this.addShortcut_(Command.UNDO,"Ctrl|z","Meta|z");this.addShortcut_(Command.REDO,"Ctrl|y Ctrl|Shift|Z","Meta|Shift|Z");this.addShortcut_(Command.SELECT_ALL,"Ctrl|a","Meta|a");this.addShortcut_(Command.DESELECT_ALL,"Escape");this.addShortcut_(Command.CUT,"Ctrl|x","Meta|x");this.addShortcut_(Command.COPY,"Ctrl|c","Meta|c");this.addShortcut_(Command.PASTE,"Ctrl|v","Meta|v");this.boundListeners_=new Map;const addDocumentListener=(eventName,handler)=>{assert(!this.boundListeners_.has(eventName));const boundListener=handler.bind(this);this.boundListeners_.set(eventName,boundListener);document.addEventListener(eventName,boundListener)};addDocumentListener("open-command-menu",this.onOpenCommandMenu_);addDocumentListener("keydown",this.onKeydown_);const addDocumentListenerForCommand=(eventName,command)=>{addDocumentListener(eventName,e=>{if(e.path[0].tagName=="INPUT")return;const items=this.getState().selection.items;if(this.canExecute(command,items))this.handle(command,items)})};addDocumentListenerForCommand("command-undo",Command.UNDO);addDocumentListenerForCommand("cut",Command.CUT);addDocumentListenerForCommand("copy",Command.COPY);addDocumentListenerForCommand("paste",Command.PASTE)},detached:function(){CommandManager.instance_=null;this.boundListeners_.forEach((handler,eventName)=>document.removeEventListener(eventName,handler))},openCommandMenuAtPosition:function(x,y,source,items){this.menuSource_=source;this.menuIds_=items||this.getState().selection.items;const dropdown=this.$.dropdown.get();Polymer.dom.flush();bookmarks.DialogFocusManager.getInstance().showDialog(dropdown.getDialog(),function(){dropdown.showAtPosition({top:y,left:x})})},openCommandMenuAtElement:function(target,source){this.menuSource_=source;this.menuIds_=this.getState().selection.items;const dropdown=this.$.dropdown.get();Polymer.dom.flush();bookmarks.DialogFocusManager.getInstance().showDialog(dropdown.getDialog(),function(){dropdown.showAt(target)})},closeCommandMenu:function(){this.menuIds_=new Set;this.menuSource_=MenuSource.NONE;this.$.dropdown.get().close()},canExecute:function(command,itemIds){const state=this.getState();switch(command){case Command.OPEN:return itemIds.size>0;case Command.UNDO:case Command.REDO:return this.globalCanEdit_;case Command.SELECT_ALL:case Command.DESELECT_ALL:return true;case Command.COPY:return itemIds.size>0;case Command.CUT:return itemIds.size>0&&!this.containsMatchingNode_(itemIds,function(node){return!bookmarks.util.canEditNode(state,node.id)});case Command.PASTE:return state.search.term==""&&bookmarks.util.canReorderChildren(state,state.selectedFolder);default:return this.isCommandVisible_(command,itemIds)&&this.isCommandEnabled_(command,itemIds)}},isCommandVisible_:function(command,itemIds){switch(command){case Command.EDIT:return itemIds.size==1&&this.globalCanEdit_;case Command.COPY_URL:return this.isSingleBookmark_(itemIds);case Command.DELETE:return itemIds.size>0&&this.globalCanEdit_;case Command.SHOW_IN_FOLDER:return this.menuSource_==MenuSource.ITEM&&itemIds.size==1&&this.getState().search.term!=""&&!this.containsMatchingNode_(itemIds,function(node){return!node.parentId||node.parentId==ROOT_NODE_ID});case Command.OPEN_NEW_TAB:case Command.OPEN_NEW_WINDOW:case Command.OPEN_INCOGNITO:return itemIds.size>0;case Command.ADD_BOOKMARK:case Command.ADD_FOLDER:case Command.SORT:case Command.EXPORT:case Command.IMPORT:case Command.HELP_CENTER:return true}return assert(false)},isCommandEnabled_:function(command,itemIds){const state=this.getState();switch(command){case Command.EDIT:case Command.DELETE:return!this.containsMatchingNode_(itemIds,function(node){return!bookmarks.util.canEditNode(state,node.id)});case Command.OPEN_NEW_TAB:case Command.OPEN_NEW_WINDOW:return this.expandUrls_(itemIds).length>0;case Command.OPEN_INCOGNITO:return this.expandUrls_(itemIds).length>0&&state.prefs.incognitoAvailability!=IncognitoAvailability.DISABLED;case Command.SORT:return this.canChangeList_()&&state.nodes[state.selectedFolder].children.length>1;case Command.ADD_BOOKMARK:case Command.ADD_FOLDER:return this.canChangeList_();case Command.IMPORT:return this.globalCanEdit_;default:return true}},canChangeList_:function(){const state=this.getState();return state.search.term==""&&bookmarks.util.canReorderChildren(state,state.selectedFolder)},handle:function(command,itemIds){const state=this.getState();switch(command){case Command.EDIT:{let id=Array.from(itemIds)[0];this.$.editDialog.get().showEditDialog(state.nodes[id]);break}case Command.COPY_URL:case Command.COPY:{let idList=Array.from(itemIds);chrome.bookmarkManagerPrivate.copy(idList,()=>{let labelPromise;if(command==Command.COPY_URL){labelPromise=Promise.resolve(loadTimeData.getString("toastUrlCopied"))}else if(idList.length==1){labelPromise=Promise.resolve(loadTimeData.getString("toastItemCopied"))}else{labelPromise=cr.sendWithPromise("getPluralString","toastItemsCopied",idList.length)}this.showTitleToast_(labelPromise,state.nodes[idList[0]].title,false)});break}case Command.SHOW_IN_FOLDER:{let id=Array.from(itemIds)[0];this.dispatch(bookmarks.actions.selectFolder(assert(state.nodes[id].parentId),state.nodes));bookmarks.DialogFocusManager.getInstance().clearFocus();this.fire("highlight-items",[id]);break}case Command.DELETE:{let idList=Array.from(this.minimizeDeletionSet_(itemIds));const title=state.nodes[idList[0]].title;let labelPromise;if(idList.length==1){labelPromise=Promise.resolve(loadTimeData.getString("toastItemDeleted"))}else{labelPromise=cr.sendWithPromise("getPluralString","toastItemsDeleted",idList.length)}chrome.bookmarkManagerPrivate.removeTrees(idList,()=>{this.showTitleToast_(labelPromise,title,true)});break}case Command.UNDO:chrome.bookmarkManagerPrivate.undo();bookmarks.ToastManager.getInstance().hide();break;case Command.REDO:chrome.bookmarkManagerPrivate.redo();break;case Command.OPEN_NEW_TAB:case Command.OPEN_NEW_WINDOW:case Command.OPEN_INCOGNITO:this.openUrls_(this.expandUrls_(itemIds),command);break;case Command.OPEN:const isFolder=itemIds.size==1&&this.containsMatchingNode_(itemIds,function(node){return!node.url});if(isFolder){const folderId=Array.from(itemIds)[0];this.dispatch(bookmarks.actions.selectFolder(folderId,state.nodes))}else{this.openUrls_(this.expandUrls_(itemIds),command)}break;case Command.SELECT_ALL:const displayedIds=bookmarks.util.getDisplayedList(state);this.dispatch(bookmarks.actions.selectAll(displayedIds,state));break;case Command.DESELECT_ALL:this.dispatch(bookmarks.actions.deselectItems());break;case Command.CUT:chrome.bookmarkManagerPrivate.cut(Array.from(itemIds));break;case Command.PASTE:const selectedFolder=state.selectedFolder;const selectedItems=state.selection.items;bookmarks.ApiListener.trackUpdatedItems();chrome.bookmarkManagerPrivate.paste(selectedFolder,Array.from(selectedItems),bookmarks.ApiListener.highlightUpdatedItems);break;case Command.SORT:chrome.bookmarkManagerPrivate.sortChildren(assert(state.selectedFolder));bookmarks.ToastManager.getInstance().show(loadTimeData.getString("toastFolderSorted"),true);break;case Command.ADD_BOOKMARK:this.$.editDialog.get().showAddDialog(false,assert(state.selectedFolder));break;case Command.ADD_FOLDER:this.$.editDialog.get().showAddDialog(true,assert(state.selectedFolder));break;case Command.IMPORT:chrome.bookmarks.import();break;case Command.EXPORT:chrome.bookmarks.export();break;case Command.HELP_CENTER:window.open("https://support.google.com/chrome/?p=bookmarks");break;default:assert(false)}bookmarks.util.recordEnumHistogram("BookmarkManager.CommandExecuted",command,Command.MAX_VALUE)},handleKeyEvent:function(e,itemIds){for(const commandTuple of this.shortcuts_){const command=commandTuple[0];const shortcut=commandTuple[1];if(shortcut.matchesEvent(e)&&this.canExecute(command,itemIds)){this.handle(command,itemIds);bookmarks.util.recordEnumHistogram("BookmarkManager.CommandExecutedFromKeyboard",command,Command.MAX_VALUE);e.stopPropagation();e.preventDefault();return true}}return false},addShortcut_:function(command,shortcut,macShortcut){shortcut=cr.isMac&&macShortcut?macShortcut:shortcut;this.shortcuts_.set(command,new cr.ui.KeyboardShortcutList(shortcut))},minimizeDeletionSet_:function(itemIds){const minimizedSet=new Set;const nodes=this.getState().nodes;itemIds.forEach(function(itemId){let currentId=itemId;while(currentId!=ROOT_NODE_ID){currentId=assert(nodes[currentId].parentId);if(itemIds.has(currentId))return}minimizedSet.add(itemId)});return minimizedSet},openUrls_:function(urls,command){assert(command==Command.OPEN||command==Command.OPEN_NEW_TAB||command==Command.OPEN_NEW_WINDOW||command==Command.OPEN_INCOGNITO);if(urls.length==0)return;const openUrlsCallback=function(){const incognito=command==Command.OPEN_INCOGNITO;if(command==Command.OPEN_NEW_WINDOW||incognito){chrome.windows.create({url:urls,incognito:incognito})}else{if(command==Command.OPEN)chrome.tabs.create({url:urls.shift(),active:true});urls.forEach(function(url){chrome.tabs.create({url:url,active:false})})}};if(urls.length<=OPEN_CONFIRMATION_LIMIT){openUrlsCallback();return}this.confirmOpenCallback_=openUrlsCallback;const dialog=this.$.openDialog.get();dialog.querySelector("[slot=body]").textContent=loadTimeData.getStringF("openDialogBody",urls.length);bookmarks.DialogFocusManager.getInstance().showDialog(this.$.openDialog.get())},expandUrls_:function(itemIds){const urls=[];const nodes=this.getState().nodes;itemIds.forEach(function(id){const node=nodes[id];if(node.url){urls.push(node.url)}else{node.children.forEach(function(childId){const childNode=nodes[childId];if(childNode.url)urls.push(childNode.url)})}});return urls},containsMatchingNode_:function(itemIds,predicate){const nodes=this.getState().nodes;return Array.from(itemIds).some(function(id){return predicate(nodes[id])})},isSingleBookmark_:function(itemIds){return itemIds.size==1&&this.containsMatchingNode_(itemIds,function(node){return!!node.url})},getCommandLabel_:function(command){const multipleNodes=this.menuIds_.size>1||this.containsMatchingNode_(this.menuIds_,function(node){return!node.url});let label;switch(command){case Command.EDIT:if(this.menuIds_.size!=1)return"";const id=Array.from(this.menuIds_)[0];const itemUrl=this.getState().nodes[id].url;label=itemUrl?"menuEdit":"menuRename";break;case Command.COPY_URL:label="menuCopyURL";break;case Command.DELETE:label="menuDelete";break;case Command.SHOW_IN_FOLDER:label="menuShowInFolder";break;case Command.OPEN_NEW_TAB:label=multipleNodes?"menuOpenAllNewTab":"menuOpenNewTab";break;case Command.OPEN_NEW_WINDOW:label=multipleNodes?"menuOpenAllNewWindow":"menuOpenNewWindow";break;case Command.OPEN_INCOGNITO:label=multipleNodes?"menuOpenAllIncognito":"menuOpenIncognito";break;case Command.SORT:label="menuSort";break;case Command.ADD_BOOKMARK:label="menuAddBookmark";break;case Command.ADD_FOLDER:label="menuAddFolder";break;case Command.IMPORT:label="menuImport";break;case Command.EXPORT:label="menuExport";break;case Command.HELP_CENTER:label="menuHelpCenter";break}assert(label);return loadTimeData.getString(assert(label))},getCommandSublabel_:function(command){const multipleNodes=this.menuIds_.size>1||this.containsMatchingNode_(this.menuIds_,function(node){return!node.url});switch(command){case Command.OPEN_NEW_TAB:const urls=this.expandUrls_(this.menuIds_);return multipleNodes&&urls.length>0?String(urls.length):"";default:return""}},computeMenuCommands_:function(){switch(this.menuSource_){case MenuSource.ITEM:case MenuSource.TREE:return[Command.EDIT,Command.COPY_URL,Command.SHOW_IN_FOLDER,Command.DELETE,Command.OPEN_NEW_TAB,Command.OPEN_NEW_WINDOW,Command.OPEN_INCOGNITO];case MenuSource.TOOLBAR:return[Command.SORT,Command.ADD_BOOKMARK,Command.ADD_FOLDER,Command.IMPORT,Command.EXPORT,Command.HELP_CENTER];case MenuSource.LIST:return[Command.ADD_BOOKMARK,Command.ADD_FOLDER];case MenuSource.NONE:return[]}assert(false)},computeHasAnySublabel_:function(){if(!this.menuIds_)return false;return this.menuCommands_.some(command=>this.getCommandSublabel_(command)!="")},showDividerAfter_:function(command,itemIds){return(command==Command.SORT||command==Command.ADD_FOLDER||command==Command.EXPORT)&&this.menuSource_==MenuSource.TOOLBAR||command==Command.DELETE&&(this.globalCanEdit_||this.isSingleBookmark_(itemIds))},showTitleToast_:function(labelPromise,title,canUndo){labelPromise.then(function(label){const pieces=loadTimeData.getSubstitutedStringPieces(label,title).map(function(p){p.collapsible=!!p.arg;return p});bookmarks.ToastManager.getInstance().showForStringPieces(pieces,canUndo)})},onOpenCommandMenu_:function(e){if(e.detail.targetElement){this.openCommandMenuAtElement(e.detail.targetElement,e.detail.source)}else{this.openCommandMenuAtPosition(e.detail.x,e.detail.y,e.detail.source)}bookmarks.util.recordEnumHistogram("BookmarkManager.CommandMenuOpened",e.detail.source,MenuSource.NUM_VALUES)},onCommandClick_:function(e){this.handle(Number(e.currentTarget.getAttribute("command")),assert(this.menuIds_));this.closeCommandMenu()},onKeydown_:function(e){const selection=this.getState().selection.items;if(e.target==document.body&&!bookmarks.DialogFocusManager.getInstance().hasOpenDialog()){this.handleKeyEvent(e,selection)}},onMenuMousedown_:function(e){if(e.path[0].tagName!="DIALOG")return;this.closeCommandMenu()},onOpenCancelTap_:function(){this.$.openDialog.get().cancel()},onOpenConfirmTap_:function(){this.confirmOpenCallback_();this.$.openDialog.get().close()}});CommandManager.instance_=null;CommandManager.getInstance=function(){return assert(CommandManager.instance_)};return{CommandManager:CommandManager}});Polymer({is:"iron-iconset-svg",properties:{name:{type:String,observer:"_nameChanged"},size:{type:Number,value:24},rtlMirroring:{type:Boolean,value:false},useGlobalRtlAttribute:{type:Boolean,value:false}},created:function(){this._meta=new Polymer.IronMeta({type:"iconset",key:null,value:null})},attached:function(){this.style.display="none"},getIconNames:function(){this._icons=this._createIconMap();return Object.keys(this._icons).map(function(n){return this.name+":"+n},this)},applyIcon:function(element,iconName){this.removeIcon(element);var svg=this._cloneIcon(iconName,this.rtlMirroring&&this._targetIsRTL(element));if(svg){var pde=Polymer.dom(element.root||element);pde.insertBefore(svg,pde.childNodes[0]);return element._svgIcon=svg}return null},removeIcon:function(element){if(element._svgIcon){Polymer.dom(element.root||element).removeChild(element._svgIcon);element._svgIcon=null}},_targetIsRTL:function(target){if(this.__targetIsRTL==null){if(this.useGlobalRtlAttribute){var globalElement=document.body&&document.body.hasAttribute("dir")?document.body:document.documentElement;this.__targetIsRTL=globalElement.getAttribute("dir")==="rtl"}else{if(target&&target.nodeType!==Node.ELEMENT_NODE){target=target.host}this.__targetIsRTL=target&&window.getComputedStyle(target)["direction"]==="rtl"}}return this.__targetIsRTL},_nameChanged:function(){this._meta.value=null;this._meta.key=this.name;this._meta.value=this;this.async(function(){this.fire("iron-iconset-added",this,{node:window})})},_createIconMap:function(){var icons=Object.create(null);Polymer.dom(this).querySelectorAll("[id]").forEach(function(icon){icons[icon.id]=icon});return icons},_cloneIcon:function(id,mirrorAllowed){this._icons=this._icons||this._createIconMap();return this._prepareSvgClone(this._icons[id],this.size,mirrorAllowed)},_prepareSvgClone:function(sourceSvg,size,mirrorAllowed){if(sourceSvg){var content=sourceSvg.cloneNode(true),svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),viewBox=content.getAttribute("viewBox")||"0 0 "+size+" "+size,cssText="pointer-events: none; display: block; width: 100%; height: 100%;";if(mirrorAllowed&&content.hasAttribute("mirror-in-rtl")){cssText+="-webkit-transform:scale(-1,1);transform:scale(-1,1);transform-origin:center;"}svg.setAttribute("viewBox",viewBox);svg.setAttribute("preserveAspectRatio","xMidYMid meet");svg.setAttribute("focusable","false");svg.style.cssText=cssText;svg.appendChild(content).removeAttribute("id");return svg}return null}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("cr.icon",function(){function getSupportedScaleFactors(){var supportedScaleFactors=[];if(!cr.isIOS){supportedScaleFactors.push(1)}if(cr.isMac||cr.isChromeOS||cr.isWindows||cr.isLinux){supportedScaleFactors.push(2)}else{supportedScaleFactors.push(window.devicePixelRatio)}return supportedScaleFactors}function getImageSet(path){var supportedScaleFactors=getSupportedScaleFactors();var replaceStartIndex=path.indexOf("scalefactor");if(replaceStartIndex<0)return getUrlForCss(path);var s="";for(var i=0;i<supportedScaleFactors.length;++i){var scaleFactor=supportedScaleFactors[i];var pathWithScaleFactor=path.substr(0,replaceStartIndex)+scaleFactor+path.substr(replaceStartIndex+"scalefactor".length);s+=getUrlForCss(pathWithScaleFactor)+" "+scaleFactor+"x";if(i!=supportedScaleFactors.length-1)s+=", "}return"-webkit-image-set("+s+")"}function getImage(path){var chromeThemePath="chrome://theme";var isChromeThemeUrl=path.slice(0,chromeThemePath.length)==chromeThemePath;return isChromeThemeUrl?getImageSet(path+"@scalefactorx"):getUrlForCss(path)}var FAVICON_URL_REGEX=/\.ico$/i;function getFavicon(url){return getImageSet("chrome://favicon/size/16@scalefactorx/"+(FAVICON_URL_REGEX.test(url)?"iconurl/":"")+url)}return{getImage:getImage,getFavicon:getFavicon}});Polymer({is:"iron-icon",properties:{icon:{type:String},theme:{type:String},src:{type:String},_meta:{value:Polymer.Base.create("iron-meta",{type:"iconset"})}},observers:["_updateIcon(_meta, isAttached)","_updateIcon(theme, isAttached)","_srcChanged(src, isAttached)","_iconChanged(icon, isAttached)"],_DEFAULT_ICONSET:"icons",_iconChanged:function(icon){var parts=(icon||"").split(":");this._iconName=parts.pop();this._iconsetName=parts.pop()||this._DEFAULT_ICONSET;this._updateIcon()},_srcChanged:function(src){this._updateIcon()},_usesIconset:function(){return this.icon||!this.src},_updateIcon:function(){if(this._usesIconset()){if(this._img&&this._img.parentNode){Polymer.dom(this.root).removeChild(this._img)}if(this._iconName===""){if(this._iconset){this._iconset.removeIcon(this)}}else if(this._iconsetName&&this._meta){this._iconset=this._meta.byKey(this._iconsetName);if(this._iconset){this._iconset.applyIcon(this,this._iconName,this.theme);this.unlisten(window,"iron-iconset-added","_updateIcon")}else{this.listen(window,"iron-iconset-added","_updateIcon")}}}else{if(this._iconset){this._iconset.removeIcon(this)}if(!this._img){this._img=document.createElement("img");this._img.style.width="100%";this._img.style.height="100%";this._img.draggable=false}this._img.src=this.src;Polymer.dom(this.root).appendChild(this._img)}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-dnd-chip",properties:{showing_:{type:Boolean,reflectToAttribute:true},isMultiItem_:Boolean},showForItems:function(x,y,items,dragItem){this.style.setProperty("--mouse-x",x+"px");this.style.setProperty("--mouse-y",y+"px");if(this.showing_)return;const isFolder=!dragItem.url;this.isMultiItem_=items.length>1;this.$.icon.className=isFolder?"folder-icon":"website-icon";this.$.icon.style.backgroundImage=isFolder?null:cr.icon.getFavicon(assert(dragItem.url));this.$.title.textContent=dragItem.title;this.$.count.textContent=items.length;this.showing_=true},hide:function(){this.showing_=false}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
let NormalizedDragData;cr.define("bookmarks",function(){const DRAG_THRESHOLD=15;function isBookmarkItem(element){return element.tagName=="BOOKMARKS-ITEM"}function isBookmarkFolderNode(element){return element.tagName=="BOOKMARKS-FOLDER-NODE"}function isBookmarkList(element){return element.tagName=="BOOKMARKS-LIST"}function isClosedBookmarkFolderNode(element){return isBookmarkFolderNode(element)&&!element.isOpen}function getBookmarkElement(path){if(!path)return null;for(let i=0;i<path.length;i++){if(isBookmarkItem(path[i])||isBookmarkFolderNode(path[i])||isBookmarkList(path[i])){return path[i]}}return null}function getDragElement(path){const dragElement=getBookmarkElement(path);for(let i=0;i<path.length;i++){if(path[i].tagName=="BUTTON")return null}return dragElement&&dragElement.getAttribute("draggable")?dragElement:null}function getBookmarkNode(bookmarkElement){return bookmarks.Store.getInstance().data.nodes[bookmarkElement.itemId]}function DragInfo(){this.dragData=null}DragInfo.prototype={setNativeDragData:function(newDragData){this.dragData={sameProfile:newDragData.sameProfile,elements:newDragData.elements.map(x=>bookmarks.util.normalizeNode(x))}},clearDragData:function(){this.dragData=null},isDragValid:function(){return!!this.dragData},isSameProfile:function(){return!!this.dragData&&this.dragData.sameProfile},isDraggingFolders:function(){return!!this.dragData&&this.dragData.elements.some(function(node){return!node.url})},isDraggingBookmark:function(bookmarkId){return!!this.dragData&&this.isSameProfile()&&this.dragData.elements.some(function(node){return node.id==bookmarkId})},isDraggingChildBookmark:function(folderId){return!!this.dragData&&this.isSameProfile()&&this.dragData.elements.some(function(node){return node.parentId==folderId})},isDraggingFolderToDescendant:function(itemId,nodes){if(!this.isSameProfile())return false;let parentId=nodes[itemId].parentId;const parents={};while(parentId){parents[parentId]=true;parentId=nodes[parentId].parentId}return!!this.dragData&&this.dragData.elements.some(function(node){return parents[node.id]})}};function AutoExpander(){this.EXPAND_FOLDER_DELAY=400;this.lastElement_=null;this.debouncer_=new bookmarks.Debouncer(()=>{const store=bookmarks.Store.getInstance();store.dispatch(bookmarks.actions.changeFolderOpen(this.lastElement_.itemId,true));this.reset()})}AutoExpander.prototype={update:function(e,overElement){const itemId=overElement?overElement.itemId:null;const store=bookmarks.Store.getInstance();if(overElement&&overElement!=this.lastElement_&&isClosedBookmarkFolderNode(overElement)&&bookmarks.util.hasChildFolders(itemId,store.data.nodes)){this.reset();this.lastElement_=overElement}if(overElement&&overElement==this.lastElement_){this.debouncer_.restartTimeout(this.EXPAND_FOLDER_DELAY);return}this.reset()},reset:function(){this.debouncer_.reset();this.lastElement_=null}};function AutoScroller(){this.SCROLL_ZONE_LENGTH=20;this.SCROLL_DISTANCE=10;this.SCROLL_INTERVAL=100;this.intervalId_=null}AutoScroller.prototype={update:function(e){this.reset();const scrollParent=e.path.find(el=>{return el.nodeType==Node.ELEMENT_NODE&&window.getComputedStyle(el).overflowY=="auto"});if(!scrollParent)return;const rect=scrollParent.getBoundingClientRect();let yDelta=0;if(e.clientY<rect.top+this.SCROLL_ZONE_LENGTH)yDelta=-this.SCROLL_DISTANCE;else if(e.clientY>rect.bottom-this.SCROLL_ZONE_LENGTH)yDelta=this.SCROLL_DISTANCE;this.intervalId_=window.setInterval(()=>{scrollParent.scrollTop+=yDelta},this.SCROLL_INTERVAL)},reset:function(){if(this.intervalId_==null)return;window.clearInterval(this.intervalId_);this.intervalId_=null}};function DropIndicator(){this.removeDropIndicatorTimeoutId_=null;this.lastIndicatorElement_=null;this.lastIndicatorClassName_=null;this.timerProxy=window}DropIndicator.prototype={addDropIndicatorStyle:function(indicatorElement,position){const indicatorStyleName=position==DropPosition.ABOVE?"drag-above":position==DropPosition.BELOW?"drag-below":"drag-on";this.lastIndicatorElement_=indicatorElement;this.lastIndicatorClassName_=indicatorStyleName;indicatorElement.classList.add(indicatorStyleName)},removeDropIndicatorStyle:function(){if(!this.lastIndicatorElement_||!this.lastIndicatorClassName_)return;this.lastIndicatorElement_.classList.remove(this.lastIndicatorClassName_);this.lastIndicatorElement_=null;this.lastIndicatorClassName_=null},update:function(dropDest){this.timerProxy.clearTimeout(this.removeDropIndicatorTimeoutId_);this.removeDropIndicatorTimeoutId_=null;const indicatorElement=dropDest.element.getDropTarget();const position=dropDest.position;this.removeDropIndicatorStyle();this.addDropIndicatorStyle(indicatorElement,position)},finish:function(){if(this.removeDropIndicatorTimeoutId_)return;this.removeDropIndicatorTimeoutId_=this.timerProxy.setTimeout(()=>{this.removeDropIndicatorStyle()},100)}};function DNDManager(){this.dragInfo_=null;this.dropDestination_=null;this.dropIndicator_=null;this.documentListeners_=null;this.autoScroller_=null;this.autoExpander_=null;this.timerProxy_=window;this.chip_=null;this.internalDragElement_=null;this.mouseDownPos_=null}DNDManager.prototype={init:function(){this.dragInfo_=new DragInfo;this.dropIndicator_=new DropIndicator;this.autoExpander_=new AutoExpander;this.autoScroller_=new AutoScroller;this.documentListeners_={mousedown:this.onMousedown_.bind(this),mousemove:this.onMouseMove_.bind(this),mouseup:this.onMouseUp_.bind(this),mouseleave:this.onMouseLeave_.bind(this),dragstart:this.onDragStart_.bind(this),dragenter:this.onDragEnter_.bind(this),dragover:this.onDragOver_.bind(this),dragleave:this.onDragLeave_.bind(this),drop:this.onDrop_.bind(this),dragend:this.clearDragData_.bind(this)};for(const event in this.documentListeners_)document.addEventListener(event,this.documentListeners_[event]);chrome.bookmarkManagerPrivate.onDragEnter.addListener(this.handleChromeDragEnter_.bind(this));chrome.bookmarkManagerPrivate.onDragLeave.addListener(this.clearDragData_.bind(this));chrome.bookmarkManagerPrivate.onDrop.addListener(this.clearDragData_.bind(this))},destroy:function(){if(this.chip_&&this.chip_.parentElement)document.body.removeChild(this.chip_);for(const event in this.documentListeners_)document.removeEventListener(event,this.documentListeners_[event])},onMousedown_:function(e){const dragElement=getDragElement(e.path);if(e.button!=0||!dragElement)return;this.internalDragElement_=dragElement;this.mouseDownPos_={x:e.clientX,y:e.clientY}},onMouseMove_:function(e){if(!this.internalDragElement_||e.clientX<0||e.clientX>window.innerWidth||e.clientY<0||e.clientY>window.innerHeight){return}this.dropDestination_=null;e.preventDefault();this.autoScroller_.update(e);if(!this.dragInfo_.isDragValid()){if(Math.abs(this.mouseDownPos_.x-e.clientX)<DRAG_THRESHOLD&&Math.abs(this.mouseDownPos_.y-e.clientY)<DRAG_THRESHOLD){return}const dragData=this.calculateDragData_();if(!dragData){this.clearDragData_();return}this.dragInfo_.dragData=dragData}const state=bookmarks.Store.getInstance().data;const items=this.dragInfo_.dragData.elements;this.dndChip.showForItems(e.clientX,e.clientY,items,this.internalDragElement_?state.nodes[this.internalDragElement_.itemId]:items[0]);this.onDragOverCommon_(e)},onMouseLeave_:function(){if(!this.internalDragElement_)return;this.startNativeDrag_()},onMouseUp_:function(){if(!this.internalDragElement_)return;if(this.dropDestination_){const dropInfo=this.calculateDropInfo_(this.dropDestination_);const shouldHighlight=this.shouldHighlight_(this.dropDestination_);const movePromises=this.dragInfo_.dragData.elements.map(item=>{return new Promise(resolve=>{chrome.bookmarks.move(item.id,{parentId:dropInfo.parentId,index:dropInfo.index==-1?undefined:dropInfo.index},resolve)})});if(shouldHighlight){bookmarks.ApiListener.trackUpdatedItems();Promise.all(movePromises).then(()=>bookmarks.ApiListener.highlightUpdatedItems())}}this.clearDragData_()},onDragStart_:function(e){const dragElement=getDragElement(e.path);if(!dragElement)return;e.preventDefault();if(!this.startNativeDrag_())return;if(e.dataTransfer){const draggedNodes=this.dragInfo_.dragData.elements;e.dataTransfer.effectAllowed=draggedNodes.length==1&&draggedNodes[0].url?"copyLink":"copyMove"}},onDragLeave_:function(){this.dropIndicator_.finish()},onDrop_:function(e){if(this.dropDestination_){e.preventDefault();const dropInfo=this.calculateDropInfo_(this.dropDestination_);const index=dropInfo.index!=-1?dropInfo.index:undefined;const shouldHighlight=this.shouldHighlight_(this.dropDestination_);if(shouldHighlight)bookmarks.ApiListener.trackUpdatedItems();chrome.bookmarkManagerPrivate.drop(dropInfo.parentId,index,shouldHighlight?bookmarks.ApiListener.highlightUpdatedItems:undefined)}this.clearDragData_()},onDragEnter_:function(e){e.preventDefault()},onDragOver_:function(e){this.dropDestination_=null;if(e.dataTransfer)e.dataTransfer.dropEffect="none";if(e.path[0].tagName=="INPUT")return;e.preventDefault();if(!this.dragInfo_.isDragValid())return;if(this.onDragOverCommon_(e)&&e.dataTransfer){e.dataTransfer.dropEffect=this.dragInfo_.isSameProfile()?"move":"copy"}},handleChromeDragEnter_:function(dragData){this.dragInfo_.setNativeDragData(dragData)},clearDragData_:function(){this.dndChip.hide();this.autoScroller_.reset();this.internalDragElement_=null;this.mouseDownPos_=null;this.autoExpander_.reset();this.timerProxy_.setTimeout(()=>{this.dragInfo_.clearDragData();this.dropDestination_=null;this.dropIndicator_.finish()},0)},startNativeDrag_:function(){const state=bookmarks.Store.getInstance().data;if(!this.dragInfo_.isDragValid())return false;const draggedNodes=this.dragInfo_.dragData.elements.map(item=>item.id);this.clearDragData_();chrome.bookmarkManagerPrivate.startDrag(draggedNodes,false);return true},onDragOverCommon_:function(e){const state=bookmarks.Store.getInstance().data;const items=this.dragInfo_.dragData.elements;const overElement=getBookmarkElement(e.path);this.autoExpander_.update(e,overElement);if(!overElement){this.dropIndicator_.finish();return false}this.dropDestination_=this.calculateDropDestination_(e.clientY,overElement);if(!this.dropDestination_){this.dropIndicator_.finish();return false}this.dropIndicator_.update(this.dropDestination_);return true},calculateDropInfo_:function(dropDestination){if(isBookmarkList(dropDestination.element)){return{index:0,parentId:bookmarks.Store.getInstance().data.selectedFolder}}const node=getBookmarkNode(dropDestination.element);const position=dropDestination.position;let index=-1;let parentId=node.id;if(position!=DropPosition.ON){const state=bookmarks.Store.getInstance().data;parentId=assert(node.parentId);index=state.nodes[parentId].children.indexOf(node.id);if(position==DropPosition.BELOW)index++}return{index:index,parentId:parentId}},calculateDragData_:function(){const dragId=this.internalDragElement_.itemId;const store=bookmarks.Store.getInstance();const state=store.data;let draggedNodes=Array.from(state.selection.items);if(isBookmarkFolderNode(this.internalDragElement_)||draggedNodes.indexOf(dragId)==-1){store.dispatch(bookmarks.actions.deselectItems());if(!isBookmarkFolderNode(this.internalDragElement_)){store.dispatch(bookmarks.actions.selectItem(dragId,state,{clear:false,range:false,toggle:false}))}draggedNodes=[dragId]}const anyUnmodifiable=draggedNodes.some(itemId=>!bookmarks.util.canEditNode(state,itemId));if(anyUnmodifiable)return null;return{elements:draggedNodes.map(id=>state.nodes[id]),sameProfile:true}},calculateDropDestination_:function(elementClientY,overElement){const validDropPositions=this.calculateValidDropPositions_(overElement);if(validDropPositions==DropPosition.NONE)return null;const above=validDropPositions&DropPosition.ABOVE;const below=validDropPositions&DropPosition.BELOW;const on=validDropPositions&DropPosition.ON;const rect=overElement.getDropTarget().getBoundingClientRect();const yRatio=(elementClientY-rect.top)/rect.height;if(above&&(yRatio<=.25||yRatio<=.5&&(!below||!on)))return{element:overElement,position:DropPosition.ABOVE};if(below&&(yRatio>.75||yRatio>.5&&(!above||!on)))return{element:overElement,position:DropPosition.BELOW};if(on)return{element:overElement,position:DropPosition.ON};return null},calculateValidDropPositions_:function(overElement){const dragInfo=this.dragInfo_;const state=bookmarks.Store.getInstance().data;let itemId=overElement.itemId;if((isBookmarkList(overElement)||isBookmarkItem(overElement))&&bookmarks.util.isShowingSearch(state)){return DropPosition.NONE}if(isBookmarkList(overElement))itemId=state.selectedFolder;if(!bookmarks.util.canReorderChildren(state,itemId))return DropPosition.NONE;if(dragInfo.isDraggingBookmark(itemId)||dragInfo.isDraggingFolderToDescendant(itemId,state.nodes)){return DropPosition.NONE}let validDropPositions=this.calculateDropAboveBelow_(overElement);if(this.canDropOn_(overElement))validDropPositions|=DropPosition.ON;return validDropPositions},calculateDropAboveBelow_:function(overElement){const dragInfo=this.dragInfo_;const state=bookmarks.Store.getInstance().data;if(isBookmarkList(overElement))return DropPosition.NONE;if(getBookmarkNode(overElement).parentId==ROOT_NODE_ID)return DropPosition.NONE;const isOverFolderNode=isBookmarkFolderNode(overElement);if(isOverFolderNode&&!dragInfo.isDraggingFolders())return DropPosition.NONE;let validDropPositions=DropPosition.NONE;const previousElem=overElement.previousElementSibling;if(!previousElem||!dragInfo.isDraggingBookmark(previousElem.itemId))validDropPositions|=DropPosition.ABOVE;if(isOverFolderNode&&!isClosedBookmarkFolderNode(overElement)&&bookmarks.util.hasChildFolders(overElement.itemId,state.nodes)){return validDropPositions}const nextElement=overElement.nextElementSibling;if(!nextElement||!dragInfo.isDraggingBookmark(nextElement.itemId))validDropPositions|=DropPosition.BELOW;return validDropPositions},canDropOn_:function(overElement){if(isBookmarkList(overElement)){const state=bookmarks.Store.getInstance().data;return state.selectedFolder&&state.nodes[state.selectedFolder].children.length==0}if(getBookmarkNode(overElement).url)return false;return!this.dragInfo_.isDraggingChildBookmark(overElement.itemId)},shouldHighlight_:function(dropDestination){return isBookmarkItem(dropDestination.element)||isBookmarkList(dropDestination.element)},setTimerProxyForTesting:function(timerProxy){this.timerProxy_=timerProxy;this.dropIndicator_.timerProxy=timerProxy},get dndChip(){if(!this.chip_){this.chip_=document.createElement("bookmarks-dnd-chip");document.body.appendChild(this.chip_)}return this.chip_}};return{AutoExpander:AutoExpander,AutoScroller:AutoScroller,DNDManager:DNDManager,DragInfo:DragInfo,DropIndicator:DropIndicator}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-folder-node",behaviors:[bookmarks.StoreClient],properties:{itemId:{type:String,observer:"updateFromStore"},depth:{type:Number,observer:"depthChanged_"},isOpen:{type:Boolean,computed:"computeIsOpen_(openState_, depth)"},item_:Object,openState_:Boolean,selectedFolder_:String,searchActive_:Boolean,isSelectedFolder_:{type:Boolean,value:false,reflectToAttribute:true,computed:"computeIsSelected_(itemId, selectedFolder_, searchActive_)"},hasChildFolder_:{type:Boolean,computed:"computeHasChildFolder_(item_.children)"}},listeners:{keydown:"onKeydown_"},observers:["updateAriaExpanded_(hasChildFolder_, isOpen)","scrollIntoViewIfNeeded_(isSelectedFolder_)"],attached:function(){this.watch("item_",state=>state.nodes[this.itemId]);this.watch("openState_",state=>{return state.folderOpenState.has(this.itemId)?state.folderOpenState.get(this.itemId):null});this.watch("selectedFolder_",function(state){return state.selectedFolder});this.watch("searchActive_",function(state){return bookmarks.util.isShowingSearch(state)});this.updateFromStore()},getFocusTarget:function(){return this.$.container},getDropTarget:function(){return this.$.container},onKeydown_:function(e){let yDirection=0;let xDirection=0;let handled=true;if(e.key=="ArrowUp"){yDirection=-1}else if(e.key=="ArrowDown"){yDirection=1}else if(e.key=="ArrowLeft"){xDirection=-1}else if(e.key=="ArrowRight"){xDirection=1}else if(e.key==" "){this.selectFolder_()}else{handled=false}if(this.getComputedStyleValue("direction")=="rtl")xDirection*=-1;this.changeKeyboardSelection_(xDirection,yDirection,this.root.activeElement);if(!handled){handled=bookmarks.CommandManager.getInstance().handleKeyEvent(e,new Set([this.itemId]))}if(!handled)return;e.preventDefault();e.stopPropagation()},changeKeyboardSelection_:function(xDirection,yDirection,currentFocus){let newFocusFolderNode=null;const isChildFolderNodeFocused=currentFocus&&currentFocus.tagName=="BOOKMARKS-FOLDER-NODE";if(xDirection==1){if(this.hasChildFolder_){if(!this.isOpen){this.dispatch(bookmarks.actions.changeFolderOpen(this.item_.id,true))}else{yDirection=1}}}else if(xDirection==-1){if(this.hasChildFolder_&&this.isOpen){this.dispatch(bookmarks.actions.changeFolderOpen(this.item_.id,false))}else{const parentFolderNode=this.getParentFolderNode_();if(parentFolderNode.itemId!=ROOT_NODE_ID){parentFolderNode.selectFolder_();parentFolderNode.getFocusTarget().focus()}}}if(!yDirection)return;if(!isChildFolderNodeFocused&&yDirection==1&&this.isOpen){const children=this.getChildFolderNodes_();if(children.length)newFocusFolderNode=children[0]}if(isChildFolderNodeFocused){if(!newFocusFolderNode){newFocusFolderNode=this.getNextChild_(yDirection==-1,currentFocus)}if(!newFocusFolderNode&&yDirection==-1)newFocusFolderNode=this}if(!newFocusFolderNode){if(this.itemId!=ROOT_NODE_ID)this.getParentFolderNode_().changeKeyboardSelection_(0,yDirection,this);return}if(newFocusFolderNode.itemId!=ROOT_NODE_ID){newFocusFolderNode.selectFolder_();newFocusFolderNode.getFocusTarget().focus()}},getNextChild_:function(reverse,child){let newFocus=null;const children=this.getChildFolderNodes_();const index=children.indexOf(child);assert(index!=-1);if(reverse){newFocus=index==0?null:children[index-1].getLastVisibleDescendant_()}else if(index<children.length-1){newFocus=children[index+1]}return newFocus},getParentFolderNode_:function(){let parentFolderNode=this.parentNode;while(parentFolderNode&&parentFolderNode.tagName!="BOOKMARKS-FOLDER-NODE"){parentFolderNode=parentFolderNode.parentNode||parentFolderNode.host}return parentFolderNode||null},getLastVisibleDescendant_:function(){const children=this.getChildFolderNodes_();if(!this.isOpen||children.length==0)return this;return children.pop().getLastVisibleDescendant_()},selectFolder_:function(){if(!this.isSelectedFolder_){this.dispatch(bookmarks.actions.selectFolder(this.itemId,this.getState().nodes))}},onContextMenu_:function(e){e.preventDefault();this.selectFolder_();bookmarks.CommandManager.getInstance().openCommandMenuAtPosition(e.clientX,e.clientY,MenuSource.TREE,new Set([this.itemId]))},getChildFolderNodes_:function(){return Array.from(this.root.querySelectorAll("bookmarks-folder-node"))},toggleFolder_:function(e){this.dispatch(bookmarks.actions.changeFolderOpen(this.itemId,!this.isOpen));e.stopPropagation()},preventDefault_:function(e){e.preventDefault()},computeIsSelected_:function(itemId,selectedFolder,searchActive){return itemId==selectedFolder&&!searchActive},computeHasChildFolder_:function(){return bookmarks.util.hasChildFolders(this.itemId,this.getState().nodes)},depthChanged_:function(){this.style.setProperty("--node-depth",String(this.depth));if(this.depth==-1)this.$.descendants.removeAttribute("role")},getChildDepth_:function(){return this.depth+1},isFolder_:function(itemId){return!this.getState().nodes[itemId].url},isRootFolder_:function(){return this.itemId==ROOT_NODE_ID},getTabIndex_:function(){return this.selectedFolder_==this.itemId?"0":"-1"},updateAriaExpanded_:function(hasChildFolder,isOpen){if(hasChildFolder)this.getFocusTarget().setAttribute("aria-expanded",String(isOpen));else this.getFocusTarget().removeAttribute("aria-expanded")},scrollIntoViewIfNeeded_:function(){if(!this.isSelectedFolder_)return;this.async(()=>this.$.container.scrollIntoViewIfNeeded())},computeIsOpen_:function(openState,depth){return openState!=null?openState:depth<=FOLDER_OPEN_BY_DEFAULT_DEPTH},getButtonAriaLabel_:function(){return loadTimeData.getStringF(this.isOpen?"sidebarNodeCollapseAxLabel":"sidebarNodeExpandAxLabel",this.item_.title)}});Polymer.IronResizableBehavior={properties:{_parentResizable:{type:Object,observer:"_parentResizableChanged"},_notifyingDescendant:{type:Boolean,value:false}},listeners:{"iron-request-resize-notifications":"_onIronRequestResizeNotifications"},created:function(){this._interestedResizables=[];this._boundNotifyResize=this.notifyResize.bind(this)},attached:function(){this._requestResizeNotifications()},detached:function(){if(this._parentResizable){this._parentResizable.stopResizeNotificationsFor(this)}else{window.removeEventListener("resize",this._boundNotifyResize)}this._parentResizable=null},notifyResize:function(){if(!this.isAttached){return}this._interestedResizables.forEach(function(resizable){if(this.resizerShouldNotify(resizable)){this._notifyDescendant(resizable)}},this);this._fireResize()},assignParentResizable:function(parentResizable){this._parentResizable=parentResizable},stopResizeNotificationsFor:function(target){var index=this._interestedResizables.indexOf(target);if(index>-1){this._interestedResizables.splice(index,1);this.unlisten(target,"iron-resize","_onDescendantIronResize")}},resizerShouldNotify:function(element){return true},_onDescendantIronResize:function(event){if(this._notifyingDescendant){event.stopPropagation();return}if(!Polymer.Settings.useShadow){this._fireResize()}},_fireResize:function(){this.fire("iron-resize",null,{node:this,bubbles:false})},_onIronRequestResizeNotifications:function(event){var target=Polymer.dom(event).rootTarget;if(target===this){return}if(this._interestedResizables.indexOf(target)===-1){this._interestedResizables.push(target);this.listen(target,"iron-resize","_onDescendantIronResize")}target.assignParentResizable(this);this._notifyDescendant(target);event.stopPropagation()},_parentResizableChanged:function(parentResizable){if(parentResizable){window.removeEventListener("resize",this._boundNotifyResize)}},_notifyDescendant:function(descendant){if(!this.isAttached){return}this._notifyingDescendant=true;descendant.notifyResize();this._notifyingDescendant=false},_requestResizeNotifications:function(){if(!this.isAttached)return;if(document.readyState==="loading"){var _requestResizeNotifications=this._requestResizeNotifications.bind(this);document.addEventListener("readystatechange",function readystatechanged(){document.removeEventListener("readystatechange",readystatechanged);_requestResizeNotifications()})}else{this.fire("iron-request-resize-notifications",null,{node:this,bubbles:true,cancelable:true});if(!this._parentResizable){window.addEventListener("resize",this._boundNotifyResize);this.notifyResize()}}}};Polymer.IronScrollTargetBehavior={properties:{scrollTarget:{type:HTMLElement,value:function(){return this._defaultScrollTarget}}},observers:["_scrollTargetChanged(scrollTarget, isAttached)"],_shouldHaveListener:true,_scrollTargetChanged:function(scrollTarget,isAttached){var eventTarget;if(this._oldScrollTarget){this._toggleScrollListener(false,this._oldScrollTarget);this._oldScrollTarget=null}if(!isAttached){return}if(scrollTarget==="document"){this.scrollTarget=this._doc}else if(typeof scrollTarget==="string"){var domHost=this.domHost;this.scrollTarget=domHost&&domHost.$?domHost.$[scrollTarget]:Polymer.dom(this.ownerDocument).querySelector("#"+scrollTarget)}else if(this._isValidScrollTarget()){this._oldScrollTarget=scrollTarget;this._toggleScrollListener(this._shouldHaveListener,scrollTarget)}},_scrollHandler:function scrollHandler(){},get _defaultScrollTarget(){return this._doc},get _doc(){return this.ownerDocument.documentElement},get _scrollTop(){if(this._isValidScrollTarget()){return this.scrollTarget===this._doc?window.pageYOffset:this.scrollTarget.scrollTop}return 0},get _scrollLeft(){if(this._isValidScrollTarget()){return this.scrollTarget===this._doc?window.pageXOffset:this.scrollTarget.scrollLeft}return 0},set _scrollTop(top){if(this.scrollTarget===this._doc){window.scrollTo(window.pageXOffset,top)}else if(this._isValidScrollTarget()){this.scrollTarget.scrollTop=top}},set _scrollLeft(left){if(this.scrollTarget===this._doc){window.scrollTo(left,window.pageYOffset)}else if(this._isValidScrollTarget()){this.scrollTarget.scrollLeft=left}},scroll:function(leftOrOptions,top){var left;if(typeof leftOrOptions==="object"){left=leftOrOptions.left;top=leftOrOptions.top}else{left=leftOrOptions}left=left||0;top=top||0;if(this.scrollTarget===this._doc){window.scrollTo(left,top)}else if(this._isValidScrollTarget()){this.scrollTarget.scrollLeft=left;this.scrollTarget.scrollTop=top}},get _scrollTargetWidth(){if(this._isValidScrollTarget()){return this.scrollTarget===this._doc?window.innerWidth:this.scrollTarget.offsetWidth}return 0},get _scrollTargetHeight(){if(this._isValidScrollTarget()){return this.scrollTarget===this._doc?window.innerHeight:this.scrollTarget.offsetHeight}return 0},_isValidScrollTarget:function(){return this.scrollTarget instanceof HTMLElement},_toggleScrollListener:function(yes,scrollTarget){var eventTarget=scrollTarget===this._doc?window:scrollTarget;if(yes){if(!this._boundScrollHandler){this._boundScrollHandler=this._scrollHandler.bind(this);eventTarget.addEventListener("scroll",this._boundScrollHandler)}}else{if(this._boundScrollHandler){eventTarget.removeEventListener("scroll",this._boundScrollHandler);this._boundScrollHandler=null}}},toggleScrollListener:function(yes){this._shouldHaveListener=yes;this._toggleScrollListener(yes,this.scrollTarget)}};(function(){var IOS=navigator.userAgent.match(/iP(?:hone|ad;(?: U;)? CPU) OS (\d+)/);var IOS_TOUCH_SCROLLING=IOS&&IOS[1]>=8;var DEFAULT_PHYSICAL_COUNT=3;var HIDDEN_Y="-10000px";var ITEM_WIDTH=0;var ITEM_HEIGHT=1;var SECRET_TABINDEX=-100;var IS_V2=Polymer.flush!=null;var ANIMATION_FRAME=IS_V2?Polymer.Async.animationFrame:0;var IDLE_TIME=IS_V2?Polymer.Async.idlePeriod:1;var MICRO_TASK=IS_V2?Polymer.Async.microTask:2;if(!Polymer.OptionalMutableDataBehavior){Polymer.OptionalMutableDataBehavior={}}Polymer({is:"iron-list",properties:{items:{type:Array},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},selectedAs:{type:String,value:"selected"},grid:{type:Boolean,value:false,reflectToAttribute:true,observer:"_gridChanged"},selectionEnabled:{type:Boolean,value:false},selectedItem:{type:Object,notify:true},selectedItems:{type:Object,notify:true},multiSelection:{type:Boolean,value:false},scrollOffset:{type:Number,value:0},preserveFocus:{type:Boolean,value:false}},observers:["_itemsChanged(items.*)","_selectionEnabledChanged(selectionEnabled)","_multiSelectionChanged(multiSelection)","_setOverflow(scrollTarget, scrollOffset)"],behaviors:[Polymer.Templatizer,Polymer.IronResizableBehavior,Polymer.IronScrollTargetBehavior,Polymer.OptionalMutableDataBehavior],_ratio:.5,_scrollerPaddingTop:0,_scrollPosition:0,_physicalSize:0,_physicalAverage:0,_physicalAverageCount:0,_physicalTop:0,_virtualCount:0,_estScrollHeight:0,_scrollHeight:0,_viewportHeight:0,_viewportWidth:0,_physicalItems:null,_physicalSizes:null,_firstVisibleIndexVal:null,_collection:null,_lastVisibleIndexVal:null,_maxPages:2,_focusedItem:null,_focusedVirtualIndex:-1,_focusedPhysicalIndex:-1,_offscreenFocusedItem:null,_focusBackfillItem:null,_itemsPerRow:1,_itemWidth:0,_rowHeight:0,_templateCost:0,_parentModel:true,get _physicalBottom(){return this._physicalTop+this._physicalSize},get _scrollBottom(){return this._scrollPosition+this._viewportHeight},get _virtualEnd(){return this._virtualStart+this._physicalCount-1},get _hiddenContentSize(){var size=this.grid?this._physicalRows*this._rowHeight:this._physicalSize;return size-this._viewportHeight},get _itemsParent(){return Polymer.dom(Polymer.dom(this._userTemplate).parentNode)},get _maxScrollTop(){return this._estScrollHeight-this._viewportHeight+this._scrollOffset},get _maxVirtualStart(){var virtualCount=this._convertIndexToCompleteRow(this._virtualCount);return Math.max(0,virtualCount-this._physicalCount)},set _virtualStart(val){val=this._clamp(val,0,this._maxVirtualStart);if(this.grid){val=val-val%this._itemsPerRow}this._virtualStartVal=val},get _virtualStart(){return this._virtualStartVal||0},set _physicalStart(val){val=val%this._physicalCount;if(val<0){val=this._physicalCount+val}if(this.grid){val=val-val%this._itemsPerRow}this._physicalStartVal=val},get _physicalStart(){return this._physicalStartVal||0},get _physicalEnd(){return(this._physicalStart+this._physicalCount-1)%this._physicalCount},set _physicalCount(val){this._physicalCountVal=val},get _physicalCount(){return this._physicalCountVal||0},get _optPhysicalSize(){return this._viewportHeight===0?Infinity:this._viewportHeight*this._maxPages},get _isVisible(){return Boolean(this.offsetWidth||this.offsetHeight)},get firstVisibleIndex(){var idx=this._firstVisibleIndexVal;if(idx==null){var physicalOffset=this._physicalTop+this._scrollOffset;idx=this._iterateItems(function(pidx,vidx){physicalOffset+=this._getPhysicalSizeIncrement(pidx);if(physicalOffset>this._scrollPosition){return this.grid?vidx-vidx%this._itemsPerRow:vidx}if(this.grid&&this._virtualCount-1===vidx){return vidx-vidx%this._itemsPerRow}})||0;this._firstVisibleIndexVal=idx}return idx},get lastVisibleIndex(){var idx=this._lastVisibleIndexVal;if(idx==null){if(this.grid){idx=Math.min(this._virtualCount,this.firstVisibleIndex+this._estRowsInView*this._itemsPerRow-1)}else{var physicalOffset=this._physicalTop+this._scrollOffset;this._iterateItems(function(pidx,vidx){if(physicalOffset<this._scrollBottom){idx=vidx}physicalOffset+=this._getPhysicalSizeIncrement(pidx)})}this._lastVisibleIndexVal=idx}return idx},get _defaultScrollTarget(){return this},get _virtualRowCount(){return Math.ceil(this._virtualCount/this._itemsPerRow)},get _estRowsInView(){return Math.ceil(this._viewportHeight/this._rowHeight)},get _physicalRows(){return Math.ceil(this._physicalCount/this._itemsPerRow)},get _scrollOffset(){return this._scrollerPaddingTop+this.scrollOffset},ready:function(){this.addEventListener("focus",this._didFocus.bind(this),true)},attached:function(){this._debounce("_render",this._render,ANIMATION_FRAME);this.listen(this,"iron-resize","_resizeHandler");this.listen(this,"keydown","_keydownHandler")},detached:function(){this.unlisten(this,"iron-resize","_resizeHandler");this.unlisten(this,"keydown","_keydownHandler")},_setOverflow:function(scrollTarget){this.style.webkitOverflowScrolling=scrollTarget===this?"touch":"";this.style.overflowY=scrollTarget===this?"auto":"";this._lastVisibleIndexVal=null;this._firstVisibleIndexVal=null;this._debounce("_render",this._render,ANIMATION_FRAME)},updateViewportBoundaries:function(){var styles=window.getComputedStyle(this);this._scrollerPaddingTop=this.scrollTarget===this?0:parseInt(styles["padding-top"],10);this._isRTL=Boolean(styles.direction==="rtl");this._viewportWidth=this.$.items.offsetWidth;this._viewportHeight=this._scrollTargetHeight;this.grid&&this._updateGridMetrics()},_scrollHandler:function(){var scrollTop=Math.max(0,Math.min(this._maxScrollTop,this._scrollTop));var delta=scrollTop-this._scrollPosition;var isScrollingDown=delta>=0;this._scrollPosition=scrollTop;this._firstVisibleIndexVal=null;this._lastVisibleIndexVal=null;if(Math.abs(delta)>this._physicalSize&&this._physicalSize>0){delta=delta-this._scrollOffset;var idxAdjustment=Math.round(delta/this._physicalAverage)*this._itemsPerRow;this._virtualStart=this._virtualStart+idxAdjustment;this._physicalStart=this._physicalStart+idxAdjustment;this._physicalTop=Math.floor(this._virtualStart/this._itemsPerRow)*this._physicalAverage;this._update()}else if(this._physicalCount>0){var reusables=this._getReusables(isScrollingDown);if(isScrollingDown){this._physicalTop=reusables.physicalTop;this._virtualStart=this._virtualStart+reusables.indexes.length;this._physicalStart=this._physicalStart+reusables.indexes.length}else{this._virtualStart=this._virtualStart-reusables.indexes.length;this._physicalStart=this._physicalStart-reusables.indexes.length}this._update(reusables.indexes,isScrollingDown?null:reusables.indexes);this._debounce("_increasePoolIfNeeded",this._increasePoolIfNeeded.bind(this,0),MICRO_TASK)}},_getReusables:function(fromTop){var ith,lastIth,offsetContent,physicalItemHeight;var idxs=[];var protectedOffsetContent=this._hiddenContentSize*this._ratio;var virtualStart=this._virtualStart;var virtualEnd=this._virtualEnd;var physicalCount=this._physicalCount;var top=this._physicalTop+this._scrollOffset;var bottom=this._physicalBottom+this._scrollOffset;var scrollTop=this._scrollTop;var scrollBottom=this._scrollBottom;if(fromTop){ith=this._physicalStart;lastIth=this._physicalEnd;offsetContent=scrollTop-top}else{ith=this._physicalEnd;lastIth=this._physicalStart;offsetContent=bottom-scrollBottom}while(true){physicalItemHeight=this._getPhysicalSizeIncrement(ith);offsetContent=offsetContent-physicalItemHeight;if(idxs.length>=physicalCount||offsetContent<=protectedOffsetContent){break}if(fromTop){if(virtualEnd+idxs.length+1>=this._virtualCount){break}if(top+physicalItemHeight>=scrollTop-this._scrollOffset){break}idxs.push(ith);top=top+physicalItemHeight;ith=(ith+1)%physicalCount}else{if(virtualStart-idxs.length<=0){break}if(top+this._physicalSize-physicalItemHeight<=scrollBottom){break}idxs.push(ith);top=top-physicalItemHeight;ith=ith===0?physicalCount-1:ith-1}}return{indexes:idxs,physicalTop:top-this._scrollOffset}},_update:function(itemSet,movingUp){if(itemSet&&itemSet.length===0||this._physicalCount===0){return}this._manageFocus();this._assignModels(itemSet);this._updateMetrics(itemSet);if(movingUp){while(movingUp.length){var idx=movingUp.pop();this._physicalTop-=this._getPhysicalSizeIncrement(idx)}}this._positionItems();this._updateScrollerSize()},_createPool:function(size){this._ensureTemplatized();var i,inst;var physicalItems=new Array(size);for(i=0;i<size;i++){inst=this.stamp(null);physicalItems[i]=inst.root.querySelector("*");this._itemsParent.appendChild(inst.root)}return physicalItems},_isClientFull:function(){return this._scrollBottom!=0&&this._physicalBottom-1>=this._scrollBottom&&this._physicalTop<=this._scrollPosition},_increasePoolIfNeeded:function(count){var nextPhysicalCount=this._clamp(this._physicalCount+count,DEFAULT_PHYSICAL_COUNT,this._virtualCount-this._virtualStart);nextPhysicalCount=this._convertIndexToCompleteRow(nextPhysicalCount);if(this.grid){var correction=nextPhysicalCount%this._itemsPerRow;if(correction&&nextPhysicalCount-correction<=this._physicalCount){nextPhysicalCount+=this._itemsPerRow}nextPhysicalCount-=correction}var delta=nextPhysicalCount-this._physicalCount;var nextIncrease=Math.round(this._physicalCount*.5);if(delta<0){return}if(delta>0){var ts=window.performance.now();[].push.apply(this._physicalItems,this._createPool(delta));for(var i=0;i<delta;i++){this._physicalSizes.push(0)}this._physicalCount=this._physicalCount+delta;if(this._physicalStart>this._physicalEnd&&this._isIndexRendered(this._focusedVirtualIndex)&&this._getPhysicalIndex(this._focusedVirtualIndex)<this._physicalEnd){this._physicalStart=this._physicalStart+delta}this._update();this._templateCost=(window.performance.now()-ts)/delta;nextIncrease=Math.round(this._physicalCount*.5)}if(this._virtualEnd>=this._virtualCount-1||nextIncrease===0){}else if(!this._isClientFull()){this._debounce("_increasePoolIfNeeded",this._increasePoolIfNeeded.bind(this,nextIncrease),MICRO_TASK)}else if(this._physicalSize<this._optPhysicalSize){this._debounce("_increasePoolIfNeeded",this._increasePoolIfNeeded.bind(this,this._clamp(Math.round(50/this._templateCost),1,nextIncrease)),IDLE_TIME)}},_render:function(){if(!this.isAttached||!this._isVisible){return}if(this._physicalCount!==0){var reusables=this._getReusables(true);this._physicalTop=reusables.physicalTop;this._virtualStart=this._virtualStart+reusables.indexes.length;this._physicalStart=this._physicalStart+reusables.indexes.length;this._update(reusables.indexes);this._update();this._increasePoolIfNeeded(0)}else if(this._virtualCount>0){this.updateViewportBoundaries();this._increasePoolIfNeeded(DEFAULT_PHYSICAL_COUNT)}},_ensureTemplatized:function(){if(this.ctor){return}this._userTemplate=this.queryEffectiveChildren("template");if(!this._userTemplate){console.warn("iron-list requires a template to be provided in light-dom")}var instanceProps={};instanceProps.__key__=true;instanceProps[this.as]=true;instanceProps[this.indexAs]=true;instanceProps[this.selectedAs]=true;instanceProps.tabIndex=true;this._instanceProps=instanceProps;this.templatize(this._userTemplate,this.mutableData)},_gridChanged:function(newGrid,oldGrid){if(typeof oldGrid==="undefined")return;this.notifyResize();Polymer.flush?Polymer.flush():Polymer.dom.flush();newGrid&&this._updateGridMetrics()},_itemsChanged:function(change){var rendering=/^items(\.splices){0,1}$/.test(change.path);var lastFocusedIndex,focusedElement;if(rendering&&this.preserveFocus){lastFocusedIndex=this._focusedVirtualIndex;focusedElement=this.querySelector("* /deep/ *:focus")}var preservingFocus=rendering&&this.preserveFocus&&focusedElement;if(change.path==="items"){this._virtualStart=0;this._physicalTop=0;this._virtualCount=this.items?this.items.length:0;this._collection=this.items&&Polymer.Collection?Polymer.Collection.get(this.items):null;this._physicalIndexForKey={};this._firstVisibleIndexVal=null;this._lastVisibleIndexVal=null;this._physicalCount=this._physicalCount||0;this._physicalItems=this._physicalItems||[];this._physicalSizes=this._physicalSizes||[];this._physicalStart=0;if(this._scrollTop>this._scrollOffset&&!preservingFocus){this._resetScrollPosition(0)}this._removeFocusedItem();this._debounce("_render",this._render,ANIMATION_FRAME)}else if(change.path==="items.splices"){this._adjustVirtualIndex(change.value.indexSplices);this._virtualCount=this.items?this.items.length:0;var itemAddedOrRemoved=change.value.indexSplices.some(function(splice){return splice.addedCount>0||splice.removed.length>0});if(itemAddedOrRemoved){var activeElement=this._getActiveElement();if(this.contains(activeElement)){activeElement.blur()}}var affectedIndexRendered=change.value.indexSplices.some(function(splice){return splice.index+splice.addedCount>=this._virtualStart&&splice.index<=this._virtualEnd},this);if(!this._isClientFull()||affectedIndexRendered){this._debounce("_render",this._render,ANIMATION_FRAME)}}else if(change.path!=="items.length"){this._forwardItemPath(change.path,change.value)}if(preservingFocus){Polymer.dom.flush();focusedElement.blur();this._focusPhysicalItem(Math.min(this.items.length-1,lastFocusedIndex));if(!this._isIndexVisible(this._focusedVirtualIndex)){this.scrollToIndex(this._focusedVirtualIndex)}}},_forwardItemPath:function(path,value){path=path.slice(6);var dot=path.indexOf(".");if(dot===-1){dot=path.length}var isIndexRendered;var pidx;var inst;var offscreenInstance=this.modelForElement(this._offscreenFocusedItem);if(IS_V2){var vidx=parseInt(path.substring(0,dot),10);isIndexRendered=this._isIndexRendered(vidx);if(isIndexRendered){pidx=this._getPhysicalIndex(vidx);inst=this.modelForElement(this._physicalItems[pidx])}else if(offscreenInstance){inst=offscreenInstance}if(!inst||inst[this.indexAs]!==vidx){return}}else{var key=path.substring(0,dot);if(offscreenInstance&&offscreenInstance.__key__===key){inst=offscreenInstance}else{pidx=this._physicalIndexForKey[key];inst=this.modelForElement(this._physicalItems[pidx]);if(!inst||inst.__key__!==key){return}}}path=path.substring(dot+1);path=this.as+(path?"."+path:"");IS_V2?inst._setPendingPropertyOrPath(path,value,false,true):inst.notifyPath(path,value,true);inst._flushProperties&&inst._flushProperties(true);if(isIndexRendered){this._updateMetrics([pidx]);this._positionItems();this._updateScrollerSize()}},_adjustVirtualIndex:function(splices){splices.forEach(function(splice){splice.removed.forEach(this._removeItem,this);if(splice.index<this._virtualStart){var delta=Math.max(splice.addedCount-splice.removed.length,splice.index-this._virtualStart);this._virtualStart=this._virtualStart+delta;if(this._focusedVirtualIndex>=0){this._focusedVirtualIndex=this._focusedVirtualIndex+delta}}},this)},_removeItem:function(item){this.$.selector.deselect(item);if(this._focusedItem&&this.modelForElement(this._focusedItem)[this.as]===item){this._removeFocusedItem()}},_iterateItems:function(fn,itemSet){var pidx,vidx,rtn,i;if(arguments.length===2&&itemSet){for(i=0;i<itemSet.length;i++){pidx=itemSet[i];vidx=this._computeVidx(pidx);if((rtn=fn.call(this,pidx,vidx))!=null){return rtn}}}else{pidx=this._physicalStart;vidx=this._virtualStart;for(;pidx<this._physicalCount;pidx++,vidx++){if((rtn=fn.call(this,pidx,vidx))!=null){return rtn}}for(pidx=0;pidx<this._physicalStart;pidx++,vidx++){if((rtn=fn.call(this,pidx,vidx))!=null){return rtn}}}},_computeVidx:function(pidx){if(pidx>=this._physicalStart){return this._virtualStart+(pidx-this._physicalStart)}return this._virtualStart+(this._physicalCount-this._physicalStart)+pidx},_assignModels:function(itemSet){this._iterateItems(function(pidx,vidx){var el=this._physicalItems[pidx];var item=this.items&&this.items[vidx];if(item!=null){var inst=this.modelForElement(el);inst.__key__=this._collection?this._collection.getKey(item):null;this._forwardProperty(inst,this.as,item);this._forwardProperty(inst,this.selectedAs,this.$.selector.isSelected(item));this._forwardProperty(inst,this.indexAs,vidx);this._forwardProperty(inst,"tabIndex",this._focusedVirtualIndex===vidx?0:-1);this._physicalIndexForKey[inst.__key__]=pidx;inst._flushProperties&&inst._flushProperties(true);el.removeAttribute("hidden")}else{el.setAttribute("hidden","")}},itemSet)},_updateMetrics:function(itemSet){Polymer.flush?Polymer.flush():Polymer.dom.flush();var newPhysicalSize=0;var oldPhysicalSize=0;var prevAvgCount=this._physicalAverageCount;var prevPhysicalAvg=this._physicalAverage;this._iterateItems(function(pidx,vidx){oldPhysicalSize+=this._physicalSizes[pidx];this._physicalSizes[pidx]=this._physicalItems[pidx].offsetHeight;newPhysicalSize+=this._physicalSizes[pidx];this._physicalAverageCount+=this._physicalSizes[pidx]?1:0},itemSet);if(this.grid){this._updateGridMetrics();this._physicalSize=Math.ceil(this._physicalCount/this._itemsPerRow)*this._rowHeight}else{oldPhysicalSize=this._itemsPerRow===1?oldPhysicalSize:Math.ceil(this._physicalCount/this._itemsPerRow)*this._rowHeight;this._physicalSize=this._physicalSize+newPhysicalSize-oldPhysicalSize;this._itemsPerRow=1}if(this._physicalAverageCount!==prevAvgCount){this._physicalAverage=Math.round((prevPhysicalAvg*prevAvgCount+newPhysicalSize)/this._physicalAverageCount)}},_updateGridMetrics:function(){this._itemWidth=this._physicalCount>0?this._physicalItems[0].getBoundingClientRect().width:200;this._rowHeight=this._physicalCount>0?this._physicalItems[0].offsetHeight:200;this._itemsPerRow=this._itemWidth?Math.floor(this._viewportWidth/this._itemWidth):this._itemsPerRow},_positionItems:function(){this._adjustScrollPosition();var y=this._physicalTop;if(this.grid){var totalItemWidth=this._itemsPerRow*this._itemWidth;var rowOffset=(this._viewportWidth-totalItemWidth)/2;this._iterateItems(function(pidx,vidx){var modulus=vidx%this._itemsPerRow;var x=Math.floor(modulus*this._itemWidth+rowOffset);if(this._isRTL){x=x*-1}this.translate3d(x+"px",y+"px",0,this._physicalItems[pidx]);if(this._shouldRenderNextRow(vidx)){y+=this._rowHeight}})}else{this._iterateItems(function(pidx,vidx){this.translate3d(0,y+"px",0,this._physicalItems[pidx]);y+=this._physicalSizes[pidx]})}},_getPhysicalSizeIncrement:function(pidx){if(!this.grid){return this._physicalSizes[pidx]}if(this._computeVidx(pidx)%this._itemsPerRow!==this._itemsPerRow-1){return 0}return this._rowHeight},_shouldRenderNextRow:function(vidx){return vidx%this._itemsPerRow===this._itemsPerRow-1},_adjustScrollPosition:function(){var deltaHeight=this._virtualStart===0?this._physicalTop:Math.min(this._scrollPosition+this._physicalTop,0);if(deltaHeight!==0){this._physicalTop=this._physicalTop-deltaHeight;var scrollTop=this._scrollTop;if(!IOS_TOUCH_SCROLLING&&scrollTop>0){this._resetScrollPosition(scrollTop-deltaHeight)}}},_resetScrollPosition:function(pos){if(this.scrollTarget&&pos>=0){this._scrollTop=pos;this._scrollPosition=this._scrollTop}},_updateScrollerSize:function(forceUpdate){if(this.grid){this._estScrollHeight=this._virtualRowCount*this._rowHeight}else{this._estScrollHeight=this._physicalBottom+Math.max(this._virtualCount-this._physicalCount-this._virtualStart,0)*this._physicalAverage}forceUpdate=forceUpdate||this._scrollHeight===0;forceUpdate=forceUpdate||this._scrollPosition>=this._estScrollHeight-this._physicalSize;forceUpdate=forceUpdate||this.grid&&this.$.items.style.height<this._estScrollHeight;if(forceUpdate||Math.abs(this._estScrollHeight-this._scrollHeight)>=this._viewportHeight){this.$.items.style.height=this._estScrollHeight+"px";this._scrollHeight=this._estScrollHeight}},scrollToItem:function(item){return this.scrollToIndex(this.items.indexOf(item))},scrollToIndex:function(idx){if(typeof idx!=="number"||idx<0||idx>this.items.length-1){return}Polymer.flush?Polymer.flush():Polymer.dom.flush();if(this._physicalCount===0){return}idx=this._clamp(idx,0,this._virtualCount-1);if(!this._isIndexRendered(idx)||idx>=this._maxVirtualStart){this._virtualStart=this.grid?idx-this._itemsPerRow*2:idx-1}this._manageFocus();this._assignModels();this._updateMetrics();this._physicalTop=Math.floor(this._virtualStart/this._itemsPerRow)*this._physicalAverage;var currentTopItem=this._physicalStart;var currentVirtualItem=this._virtualStart;var targetOffsetTop=0;var hiddenContentSize=this._hiddenContentSize;while(currentVirtualItem<idx&&targetOffsetTop<=hiddenContentSize){targetOffsetTop=targetOffsetTop+this._getPhysicalSizeIncrement(currentTopItem);currentTopItem=(currentTopItem+1)%this._physicalCount;currentVirtualItem++}this._updateScrollerSize(true);this._positionItems();this._resetScrollPosition(this._physicalTop+this._scrollOffset+targetOffsetTop);this._increasePoolIfNeeded(0);this._firstVisibleIndexVal=null;this._lastVisibleIndexVal=null},_resetAverage:function(){this._physicalAverage=0;this._physicalAverageCount=0},_resizeHandler:function(){this._debounce("_render",function(){this._firstVisibleIndexVal=null;this._lastVisibleIndexVal=null;var delta=Math.abs(this._viewportHeight-this._scrollTargetHeight);this.updateViewportBoundaries();if(this._isVisible){this.toggleScrollListener(true);this._resetAverage();this._render()}else{this.toggleScrollListener(false)}},ANIMATION_FRAME)},selectItem:function(item){return this.selectIndex(this.items.indexOf(item))},selectIndex:function(index){if(index<0||index>=this._virtualCount){return}if(!this.multiSelection&&this.selectedItem){this.clearSelection()}if(this._isIndexRendered(index)){var model=this.modelForElement(this._physicalItems[this._getPhysicalIndex(index)]);if(model){model[this.selectedAs]=true}this.updateSizeForIndex(index)}if(this.$.selector.selectIndex){this.$.selector.selectIndex(index)}else{this.$.selector.select(this.items[index])}},deselectItem:function(item){return this.deselectIndex(this.items.indexOf(item))},deselectIndex:function(index){if(index<0||index>=this._virtualCount){return}if(this._isIndexRendered(index)){var model=this.modelForElement(this._physicalItems[this._getPhysicalIndex(index)]);model[this.selectedAs]=false;this.updateSizeForIndex(index)}if(this.$.selector.deselectIndex){this.$.selector.deselectIndex(index)}else{this.$.selector.deselect(this.items[index])}},toggleSelectionForItem:function(item){return this.toggleSelectionForIndex(this.items.indexOf(item))},toggleSelectionForIndex:function(index){var isSelected=this.$.selector.isIndexSelected?this.$.selector.isIndexSelected(index):this.$.selector.isSelected(this.items[index]);isSelected?this.deselectIndex(index):this.selectIndex(index)},clearSelection:function(){this._iterateItems(function(pidx,vidx){this.modelForElement(this._physicalItems[pidx])[this.selectedAs]=false});this.$.selector.clearSelection()},_selectionEnabledChanged:function(selectionEnabled){var handler=selectionEnabled?this.listen:this.unlisten;handler.call(this,this,"tap","_selectionHandler")},_selectionHandler:function(e){var model=this.modelForElement(e.target);if(!model){return}var modelTabIndex,activeElTabIndex;var target=Polymer.dom(e).path[0];var activeEl=this._getActiveElement();var physicalItem=this._physicalItems[this._getPhysicalIndex(model[this.indexAs])];if(target.localName==="input"||target.localName==="button"||target.localName==="select"){return}modelTabIndex=model.tabIndex;model.tabIndex=SECRET_TABINDEX;activeElTabIndex=activeEl?activeEl.tabIndex:-1;model.tabIndex=modelTabIndex;if(activeEl&&physicalItem!==activeEl&&physicalItem.contains(activeEl)&&activeElTabIndex!==SECRET_TABINDEX){return}this.toggleSelectionForItem(model[this.as])},_multiSelectionChanged:function(multiSelection){this.clearSelection();this.$.selector.multi=multiSelection},updateSizeForItem:function(item){return this.updateSizeForIndex(this.items.indexOf(item))},updateSizeForIndex:function(index){if(!this._isIndexRendered(index)){return null}this._updateMetrics([this._getPhysicalIndex(index)]);this._positionItems();return null},_manageFocus:function(){var fidx=this._focusedVirtualIndex;if(fidx>=0&&fidx<this._virtualCount){if(this._isIndexRendered(fidx)){this._restoreFocusedItem()}else{this._createFocusBackfillItem()}}else if(this._virtualCount>0&&this._physicalCount>0){this._focusedPhysicalIndex=this._physicalStart;this._focusedVirtualIndex=this._virtualStart;this._focusedItem=this._physicalItems[this._physicalStart]}},_convertIndexToCompleteRow:function(idx){this._itemsPerRow=this._itemsPerRow||1;return this.grid?Math.ceil(idx/this._itemsPerRow)*this._itemsPerRow:idx},_isIndexRendered:function(idx){return idx>=this._virtualStart&&idx<=this._virtualEnd},_isIndexVisible:function(idx){return idx>=this.firstVisibleIndex&&idx<=this.lastVisibleIndex},_getPhysicalIndex:function(vidx){return IS_V2?(this._physicalStart+(vidx-this._virtualStart))%this._physicalCount:this._physicalIndexForKey[this._collection.getKey(this.items[vidx])]},focusItem:function(idx){this._focusPhysicalItem(idx)},_focusPhysicalItem:function(idx){if(idx<0||idx>=this._virtualCount){return}this._restoreFocusedItem();if(!this._isIndexRendered(idx)){this.scrollToIndex(idx)}var physicalItem=this._physicalItems[this._getPhysicalIndex(idx)];var model=this.modelForElement(physicalItem);var focusable;model.tabIndex=SECRET_TABINDEX;if(physicalItem.tabIndex===SECRET_TABINDEX){focusable=physicalItem}if(!focusable){focusable=Polymer.dom(physicalItem).querySelector('[tabindex="'+SECRET_TABINDEX+'"]')}model.tabIndex=0;this._focusedVirtualIndex=idx;focusable&&focusable.focus()},_removeFocusedItem:function(){if(this._offscreenFocusedItem){this._itemsParent.removeChild(this._offscreenFocusedItem)}this._offscreenFocusedItem=null;this._focusBackfillItem=null;this._focusedItem=null;this._focusedVirtualIndex=-1;this._focusedPhysicalIndex=-1},_createFocusBackfillItem:function(){var fpidx=this._focusedPhysicalIndex;if(this._offscreenFocusedItem||this._focusedVirtualIndex<0){return}if(!this._focusBackfillItem){var inst=this.stamp(null);this._focusBackfillItem=inst.root.querySelector("*");this._itemsParent.appendChild(inst.root)}this._offscreenFocusedItem=this._physicalItems[fpidx];this.modelForElement(this._offscreenFocusedItem).tabIndex=0;this._physicalItems[fpidx]=this._focusBackfillItem;this._focusedPhysicalIndex=fpidx;this.translate3d(0,HIDDEN_Y,0,this._offscreenFocusedItem)},_restoreFocusedItem:function(){if(!this._offscreenFocusedItem||this._focusedVirtualIndex<0){return}this._assignModels();var fpidx=this._focusedPhysicalIndex;var onScreenItem=this._physicalItems[fpidx];if(!onScreenItem){return}var onScreenInstance=this.modelForElement(onScreenItem);var offScreenInstance=this.modelForElement(this._offscreenFocusedItem);if(onScreenInstance[this.as]===offScreenInstance[this.as]){this._focusBackfillItem=onScreenItem;onScreenInstance.tabIndex=-1;this._physicalItems[fpidx]=this._offscreenFocusedItem;this.translate3d(0,HIDDEN_Y,0,this._focusBackfillItem)}else{this._removeFocusedItem();this._focusBackfillItem=null}this._offscreenFocusedItem=null},_didFocus:function(e){var targetModel=this.modelForElement(e.target);var focusedModel=this.modelForElement(this._focusedItem);var hasOffscreenFocusedItem=this._offscreenFocusedItem!==null;var fidx=this._focusedVirtualIndex;if(!targetModel){return}if(focusedModel===targetModel){if(!this._isIndexVisible(fidx)){this.scrollToIndex(fidx)}}else{this._restoreFocusedItem();if(focusedModel){focusedModel.tabIndex=-1}targetModel.tabIndex=0;fidx=targetModel[this.indexAs];this._focusedVirtualIndex=fidx;this._focusedPhysicalIndex=this._getPhysicalIndex(fidx);this._focusedItem=this._physicalItems[this._focusedPhysicalIndex];if(hasOffscreenFocusedItem&&!this._offscreenFocusedItem){this._update()}}},_keydownHandler:function(e){switch(e.keyCode){case 40:e.preventDefault();this._focusPhysicalItem(this._focusedVirtualIndex+(this.grid?this._itemsPerRow:1));break;case 39:if(this.grid)this._focusPhysicalItem(this._focusedVirtualIndex+(this._isRTL?-1:1));break;case 38:this._focusPhysicalItem(this._focusedVirtualIndex-(this.grid?this._itemsPerRow:1));break;case 37:if(this.grid)this._focusPhysicalItem(this._focusedVirtualIndex+(this._isRTL?1:-1));break;case 13:this._focusPhysicalItem(this._focusedVirtualIndex);this._selectionHandler(e);break}},_clamp:function(v,min,max){return Math.min(max,Math.max(min,v))},_debounce:function(name,cb,asyncModule){if(IS_V2){this._debouncers=this._debouncers||{};this._debouncers[name]=Polymer.Debouncer.debounce(this._debouncers[name],asyncModule,cb.bind(this));Polymer.enqueueDebouncer(this._debouncers[name])}else{Polymer.dom.addDebouncer(this.debounce(name,cb))}},_forwardProperty:function(inst,name,value){if(IS_V2){inst._setPendingProperty(name,value)}else{inst[name]=value}},_forwardHostPropV2:function(prop,value){(this._physicalItems||[]).concat([this._offscreenFocusedItem,this._focusBackfillItem]).forEach(function(item){if(item){this.modelForElement(item).forwardHostProp(prop,value)}},this)},_notifyInstancePropV2:function(inst,prop,value){if(Polymer.Path.matches(this.as,prop)){var idx=inst[this.indexAs];if(prop==this.as){this.items[idx]=value}this.notifyPath(Polymer.Path.translate(this.as,"items."+idx,prop),value)}},_getStampedChildren:function(){return this._physicalItems},_forwardInstancePath:function(inst,path,value){if(path.indexOf(this.as+".")===0){this.notifyPath("items."+inst.__key__+"."+path.slice(this.as.length+1),value)}},_forwardParentPath:function(path,value){(this._physicalItems||[]).concat([this._offscreenFocusedItem,this._focusBackfillItem]).forEach(function(item){if(item){this.modelForElement(item).notifyPath(path,value,true)}},this)},_forwardParentProp:function(prop,value){(this._physicalItems||[]).concat([this._offscreenFocusedItem,this._focusBackfillItem]).forEach(function(item){if(item){this.modelForElement(item)[prop]=value}},this)},_getActiveElement:function(){var itemsHost=this._itemsParent.node.domHost;return Polymer.dom(itemsHost?itemsHost.root:document).activeElement}})})();
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-item",behaviors:[bookmarks.StoreClient],properties:{itemId:{type:String,observer:"onItemIdChanged_"},ironListTabIndex:String,item_:{type:Object,observer:"onItemChanged_"},isSelectedItem_:{type:Boolean,reflectToAttribute:true},isFolder_:Boolean},hostAttributes:{role:"listitem"},observers:["updateFavicon_(item_.url)"],listeners:{click:"onClick_",dblclick:"onDblClick_",contextmenu:"onContextMenu_",keydown:"onKeydown_",auxclick:"onMiddleClick_",mousedown:"cancelMiddleMouseBehavior_",mouseup:"cancelMiddleMouseBehavior_"},attached:function(){this.watch("item_",store=>store.nodes[this.itemId]);this.watch("isSelectedItem_",store=>!!store.selection.items.has(this.itemId));this.updateFromStore()},getDropTarget:function(){return this},onContextMenu_:function(e){e.preventDefault();e.stopPropagation();this.focus();if(!this.isSelectedItem_)this.selectThisItem_();this.fire("open-command-menu",{x:e.clientX,y:e.clientY,source:MenuSource.ITEM})},onMenuButtonClick_:function(e){e.stopPropagation();e.preventDefault();this.selectThisItem_();this.fire("open-command-menu",{targetElement:e.target,source:MenuSource.ITEM})},onMenuButtonDblClick_:function(e){e.stopPropagation()},selectThisItem_:function(){this.dispatch(bookmarks.actions.selectItem(this.itemId,this.getState(),{clear:true,range:false,toggle:false}))},onItemIdChanged_:function(){assert(this.getState().nodes[this.itemId]);this.updateFromStore()},onItemChanged_:function(){this.isFolder_=!this.item_.url;this.setAttribute("aria-label",this.item_.title||this.item_.url||loadTimeData.getString("folderLabel"))},onClick_:function(e){if(e.detail!=2){const addKey=cr.isMac?e.metaKey:e.ctrlKey;this.dispatch(bookmarks.actions.selectItem(this.itemId,this.getState(),{clear:!addKey,range:e.shiftKey,toggle:addKey&&!e.shiftKey}))}e.stopPropagation();e.preventDefault()},onKeydown_:function(e){if(e.key=="ArrowLeft")this.focus();else if(e.key=="ArrowRight")this.$.menuButton.focus()},onDblClick_:function(e){if(!this.isSelectedItem_)this.selectThisItem_();const commandManager=bookmarks.CommandManager.getInstance();const itemSet=this.getState().selection.items;if(commandManager.canExecute(Command.OPEN,itemSet))commandManager.handle(Command.OPEN,itemSet)},onMiddleClick_:function(e){if(e.button!=1)return;this.selectThisItem_();if(this.isFolder_)return;const commandManager=bookmarks.CommandManager.getInstance();const itemSet=this.getState().selection.items;const command=e.shiftKey?Command.OPEN:Command.OPEN_NEW_TAB;if(commandManager.canExecute(command,itemSet))commandManager.handle(command,itemSet)},cancelMiddleMouseBehavior_:function(e){if(e.button==1)e.preventDefault()},updateFavicon_:function(url){this.$.icon.className=url?"website-icon":"folder-icon";this.$.icon.style.backgroundImage=url?cr.icon.getFavicon(url):null},getButtonAriaLabel_:function(){return loadTimeData.getStringF("moreActionsButtonAxLabel",this.item_.title)}});
// Copyright 2018 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
const ListPropertyUpdateBehavior={updateList:function(propertyName,itemUidGetter,updatedList){const list=this[propertyName];const splices=Polymer.ArraySplice.calculateSplices(updatedList.map(itemUidGetter),list.map(itemUidGetter));splices.forEach(splice=>{const index=splice.index;const deleteCount=splice.removed.length;splice.removed=list.slice(index,index+deleteCount);splice.object=list;splice.type="splice";const added=updatedList.slice(index,index+splice.addedCount);const spliceParams=[index,deleteCount].concat(added);list.splice.apply(list,spliceParams)});if(splices.length>0)this.notifySplices(propertyName,splices)}};
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-list",behaviors:[bookmarks.StoreClient,ListPropertyUpdateBehavior],properties:{displayedList_:{type:Array,value:function(){return[]}},displayedIds_:{type:Array,observer:"onDisplayedIdsChanged_"},searchTerm_:{type:String,observer:"onDisplayedListSourceChange_"},selectedFolder_:{type:String,observer:"onDisplayedListSourceChange_"}},listeners:{click:"deselectItems_",contextmenu:"onContextMenu_","open-command-menu":"onOpenCommandMenu_"},attached:function(){const list=this.$.list;list.scrollTarget=this;this.watch("displayedIds_",function(state){return bookmarks.util.getDisplayedList(state)});this.watch("searchTerm_",function(state){return state.search.term});this.watch("selectedFolder_",function(state){return state.selectedFolder});this.updateFromStore();this.$.list.addEventListener("keydown",this.onItemKeydown_.bind(this),true);this.boundOnHighlightItems_=this.onHighlightItems_.bind(this);document.addEventListener("highlight-items",this.boundOnHighlightItems_);Polymer.RenderStatus.afterNextRender(this,function(){Polymer.IronA11yAnnouncer.requestAvailability()})},detached:function(){document.removeEventListener("highlight-items",this.boundOnHighlightItems_)},getDropTarget:function(){return this.$.message},onDisplayedIdsChanged_:function(newValue,oldValue){const updatedList=newValue.map(id=>({id:id}));this.updateList("displayedList_",item=>item.id,updatedList);cr.sendWithPromise("getPluralString","listChanged",this.displayedList_.length).then(label=>this.fire("iron-announce",{text:label}))},onDisplayedListSourceChange_:function(){this.scrollTop=0},scrollToId_:function(itemId){const index=this.displayedIds_.indexOf(itemId);const list=this.$.list;if(index>=0&&index<list.firstVisibleIndex||index>list.lastVisibleIndex){list.scrollToIndex(index)}},emptyListMessage_:function(){let emptyListMessage="noSearchResults";if(!this.searchTerm_){emptyListMessage=bookmarks.util.canReorderChildren(this.getState(),this.getState().selectedFolder)?"emptyList":"emptyUnmodifiableList"}return loadTimeData.getString(emptyListMessage)},isEmptyList_:function(){return this.displayedList_.length==0},deselectItems_:function(){this.dispatch(bookmarks.actions.deselectItems())},getIndexForItemElement_:function(el){return this.$.list.modelForElement(el).index},onOpenCommandMenu_:function(e){if(e.source==MenuSource.ITEM)this.scrollToId_(e.path[0].itemId)},onHighlightItems_:function(e){const toHighlight=e.detail.filter(item=>this.displayedIds_.indexOf(item)!=-1);assert(toHighlight.length>0);const leadId=toHighlight[0];this.dispatch(bookmarks.actions.selectAll(toHighlight,this.getState(),leadId));this.async(function(){this.scrollToId_(leadId);const leadIndex=this.displayedIds_.indexOf(leadId);assert(leadIndex!=-1);this.$.list.focusItem(leadIndex)})},onItemKeydown_:function(e){let handled=true;const list=this.$.list;let focusMoved=false;let focusedIndex=this.getIndexForItemElement_(e.target);const oldFocusedIndex=focusedIndex;const cursorModifier=cr.isMac?e.metaKey:e.ctrlKey;if(e.key=="ArrowUp"){focusedIndex--;focusMoved=true}else if(e.key=="ArrowDown"){focusedIndex++;focusMoved=true;e.preventDefault()}else if(e.key=="Home"){focusedIndex=0;focusMoved=true}else if(e.key=="End"){focusedIndex=list.items.length-1;focusMoved=true}else if(e.key==" "&&cursorModifier){this.dispatch(bookmarks.actions.selectItem(this.displayedIds_[focusedIndex],this.getState(),{clear:false,range:false,toggle:true}))}else{handled=false}if(focusMoved){focusedIndex=Math.min(list.items.length-1,Math.max(0,focusedIndex));list.focusItem(focusedIndex);if(cursorModifier&&!e.shiftKey){this.dispatch(bookmarks.actions.updateAnchor(this.displayedIds_[focusedIndex]))}else{if(e.shiftKey&&this.getState().selection.anchor==null){this.dispatch(bookmarks.actions.updateAnchor(this.displayedIds_[oldFocusedIndex]))}const config={clear:!cursorModifier,range:e.shiftKey,toggle:false};this.dispatch(bookmarks.actions.selectItem(this.displayedIds_[focusedIndex],this.getState(),config))}}if(e.path[0]instanceof HTMLButtonElement&&e.key=="Enter")handled=true;if(!handled){handled=bookmarks.CommandManager.getInstance().handleKeyEvent(e,this.getState().selection.items)}if(handled)e.stopPropagation()},onContextMenu_:function(e){e.preventDefault();this.deselectItems_();this.fire("open-command-menu",{x:e.clientX,y:e.clientY,source:MenuSource.LIST})}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){const HIDE_FOCUS_RING_ATTRIBUTE="hide-focus-ring";const MouseFocusBehavior={attached:function(){this.boundOnMousedown_=this.onMousedown_.bind(this);this.boundOnKeydown=this.onKeydown_.bind(this);document.addEventListener("mousedown",this.boundOnMousedown_,true);document.addEventListener("keydown",this.boundOnKeydown,true)},detached:function(){document.removeEventListener("mousedown",this.boundOnMousedown_,true);document.removeEventListener("keydown",this.boundOnKeydown,true)},onMousedown_:function(){this.setAttribute(HIDE_FOCUS_RING_ATTRIBUTE,"")},onKeydown_:function(e){if(!["Shift","Alt","Control","Meta"].includes(e.key))this.removeAttribute(HIDE_FOCUS_RING_ATTRIBUTE)}};return{HIDE_FOCUS_RING_ATTRIBUTE:HIDE_FOCUS_RING_ATTRIBUTE,MouseFocusBehavior:MouseFocusBehavior}});(function(){"use strict";var workingURL;var urlDoc,urlBase,anchor;function resolveURL(path,base){if(workingURL===undefined){workingURL=false;try{var u=new URL("b","http://a");u.pathname="c%20d";workingURL=u.href==="http://a/c%20d";workingURL=workingURL&&new URL("http://www.google.com/?foo bar").href==="http://www.google.com/?foo%20bar"}catch(e){}}if(workingURL){return new URL(path,base)}if(!urlDoc){urlDoc=document.implementation.createHTMLDocument("url");urlBase=urlDoc.createElement("base");urlDoc.head.appendChild(urlBase);anchor=urlDoc.createElement("a")}urlBase.href=base;anchor.href=path.replace(/ /g,"%20");return anchor}Polymer({is:"iron-location",properties:{path:{type:String,notify:true,value:function(){return window.decodeURIComponent(window.location.pathname)}},query:{type:String,notify:true,value:function(){return window.location.search.slice(1)}},hash:{type:String,notify:true,value:function(){return window.decodeURIComponent(window.location.hash.slice(1))}},dwellTime:{type:Number,value:2e3},urlSpaceRegex:{type:String,value:""},_urlSpaceRegExp:{computed:"_makeRegExp(urlSpaceRegex)"},_lastChangedAt:{type:Number},_initialized:{type:Boolean,value:false}},hostAttributes:{hidden:true},observers:["_updateUrl(path, query, hash)"],created:function(){this.__location=window.location},attached:function(){this.listen(window,"hashchange","_hashChanged");this.listen(window,"location-changed","_urlChanged");this.listen(window,"popstate","_urlChanged");this.listen(document.body,"click","_globalOnClick");this._lastChangedAt=window.performance.now()-(this.dwellTime-200);this._initialized=true;this._urlChanged()},detached:function(){this.unlisten(window,"hashchange","_hashChanged");this.unlisten(window,"location-changed","_urlChanged");this.unlisten(window,"popstate","_urlChanged");this.unlisten(document.body,"click","_globalOnClick");this._initialized=false},_hashChanged:function(){this.hash=window.decodeURIComponent(this.__location.hash.substring(1))},_urlChanged:function(){this._dontUpdateUrl=true;this._hashChanged();this.path=window.decodeURIComponent(this.__location.pathname);this.query=this.__location.search.substring(1);this._dontUpdateUrl=false;this._updateUrl()},_getUrl:function(){var partiallyEncodedPath=window.encodeURI(this.path).replace(/\#/g,"%23").replace(/\?/g,"%3F");var partiallyEncodedQuery="";if(this.query){partiallyEncodedQuery="?"+this.query.replace(/\#/g,"%23")}var partiallyEncodedHash="";if(this.hash){partiallyEncodedHash="#"+window.encodeURI(this.hash)}return partiallyEncodedPath+partiallyEncodedQuery+partiallyEncodedHash},_updateUrl:function(){if(this._dontUpdateUrl||!this._initialized){return}if(this.path===window.decodeURIComponent(this.__location.pathname)&&this.query===this.__location.search.substring(1)&&this.hash===window.decodeURIComponent(this.__location.hash.substring(1))){return}var newUrl=this._getUrl();var fullNewUrl=resolveURL(newUrl,this.__location.protocol+"//"+this.__location.host).href;var now=window.performance.now();var shouldReplace=this._lastChangedAt+this.dwellTime>now;this._lastChangedAt=now;if(shouldReplace){window.history.replaceState({},"",fullNewUrl)}else{window.history.pushState({},"",fullNewUrl)}this.fire("location-changed",{},{node:window})},_globalOnClick:function(event){if(event.defaultPrevented){return}var href=this._getSameOriginLinkHref(event);if(!href){return}event.preventDefault();if(href===this.__location.href){return}window.history.pushState({},"",href);this.fire("location-changed",{},{node:window})},_getSameOriginLinkHref:function(event){if(event.button!==0){return null}if(event.metaKey||event.ctrlKey){return null}var eventPath=Polymer.dom(event).path;var anchor=null;for(var i=0;i<eventPath.length;i++){var element=eventPath[i];if(element.tagName==="A"&&element.href){anchor=element;break}}if(!anchor){return null}if(anchor.target==="_blank"){return null}if((anchor.target==="_top"||anchor.target==="_parent")&&window.top!==window){return null}if(anchor.download){return null}var href=anchor.href;var url;if(document.baseURI!=null){url=resolveURL(href,document.baseURI)}else{url=resolveURL(href)}var origin;if(this.__location.origin){origin=this.__location.origin}else{origin=this.__location.protocol+"//"+this.__location.host}var urlOrigin;if(url.origin){urlOrigin=url.origin}else{var urlHost=url.host;var urlPort=url.port;var urlProtocol=url.protocol;var isExtraneousHTTPS=urlProtocol==="https:"&&urlPort==="443";var isExtraneousHTTP=urlProtocol==="http:"&&urlPort==="80";if(isExtraneousHTTPS||isExtraneousHTTP){urlHost=url.hostname}urlOrigin=urlProtocol+"//"+urlHost}if(urlOrigin!==origin){return null}var normalizedHref=url.pathname+url.search+url.hash;if(normalizedHref[0]!=="/"){normalizedHref="/"+normalizedHref}if(this._urlSpaceRegExp&&!this._urlSpaceRegExp.test(normalizedHref)){return null}var fullNormalizedHref=resolveURL(normalizedHref,this.__location.href).href;return fullNormalizedHref},_makeRegExp:function(urlSpaceRegex){return RegExp(urlSpaceRegex)}})})();"use strict";Polymer({is:"iron-query-params",properties:{paramsString:{type:String,notify:true,observer:"paramsStringChanged"},paramsObject:{type:Object,notify:true,value:function(){return{}}},_dontReact:{type:Boolean,value:false}},hostAttributes:{hidden:true},observers:["paramsObjectChanged(paramsObject.*)"],paramsStringChanged:function(){this._dontReact=true;this.paramsObject=this._decodeParams(this.paramsString);this._dontReact=false},paramsObjectChanged:function(){if(this._dontReact){return}this.paramsString=this._encodeParams(this.paramsObject).replace(/%3F/g,"?").replace(/%2F/g,"/").replace(/'/g,"%27")},_encodeParams:function(params){var encodedParams=[];for(var key in params){var value=params[key];if(value===""){encodedParams.push(encodeURIComponent(key))}else if(value){encodedParams.push(encodeURIComponent(key)+"="+encodeURIComponent(value.toString()))}}return encodedParams.join("&")},_decodeParams:function(paramString){var params={};paramString=(paramString||"").replace(/\+/g,"%20");var paramList=paramString.split("&");for(var i=0;i<paramList.length;i++){var param=paramList[i].split("=");if(param[0]){params[decodeURIComponent(param[0])]=decodeURIComponent(param[1]||"")}}return params}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-router",behaviors:[bookmarks.StoreClient],properties:{queryParams_:Object,searchTerm_:{type:String,value:""},selectedId_:String},observers:["onQueryParamsChanged_(queryParams_)","onStateChanged_(searchTerm_, selectedId_)"],attached:function(){this.watch("selectedId_",function(state){return state.selectedFolder});this.watch("searchTerm_",function(state){return state.search.term});this.updateFromStore()},onQueryParamsChanged_:function(){const searchTerm=this.queryParams_.q||"";let selectedId=this.queryParams_.id;if(!selectedId&&!searchTerm)selectedId=BOOKMARKS_BAR_ID;if(searchTerm!=this.searchTerm_){this.searchTerm_=searchTerm;this.dispatch(bookmarks.actions.setSearchTerm(searchTerm))}if(selectedId&&selectedId!=this.selectedId_){this.selectedId_=selectedId;this.dispatchAsync(dispatch=>{dispatch(bookmarks.actions.selectFolder(selectedId,this.getState().nodes))})}},onStateChanged_:function(){this.debounce("updateQueryParams",this.updateQueryParams_.bind(this))},updateQueryParams_:function(){if(this.searchTerm_)this.queryParams_={q:this.searchTerm_};else if(this.selectedId_!=BOOKMARKS_BAR_ID)this.queryParams_={id:this.selectedId_};else this.queryParams_={}}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-toast",properties:{duration:{type:Number,value:0},open:{type:Boolean,value:false,reflectToAttribute:true}},observers:["resetAutoHide_(duration, open)"],hideTimeoutId_:null,resetAutoHide_:function(){if(this.hideTimeoutId_!=null){window.clearTimeout(this.hideTimeoutId_);this.hideTimeoutId_=null}if(this.open&&this.duration!=0){this.hideTimeoutId_=window.setTimeout(()=>{this.open=false},this.duration)}},show:function(duration){let shouldResetAutoHide=true;if(typeof duration!="undefined"&&duration>=0&&this.duration!=duration){this.duration=duration;shouldResetAutoHide=false}if(!this.open){this.open=true;shouldResetAutoHide=false}if(shouldResetAutoHide)this.resetAutoHide_()},hide:function(){this.open=false}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
cr.define("bookmarks",function(){const ToastManager=Polymer({is:"bookmarks-toast-manager",properties:{duration:{type:Number,value:0},showUndo_:Boolean},attached:function(){assert(ToastManager.instance_==null);ToastManager.instance_=this;Polymer.RenderStatus.afterNextRender(this,function(){Polymer.IronA11yAnnouncer.requestAvailability()})},detached:function(){ToastManager.instance_=null},show:function(label,showUndo){this.$.content.textContent=label;this.showInternal_(showUndo);this.$.toast.show()},showForStringPieces:function(pieces,showUndo){const content=this.$.content;content.textContent="";pieces.forEach(function(p){if(p.value.length==0)return;const span=document.createElement("span");span.textContent=p.value;if(p.collapsible)span.classList.add("collapsible");content.appendChild(span)});this.showInternal_(showUndo)},showInternal_:function(showUndo){this.showUndo_=showUndo;this.fire("iron-announce",{text:this.$.content.textContent});this.$.toast.show()},hide:function(){this.$.toast.hide()},onUndoTap_:function(){this.fire("command-undo")}});ToastManager.instance_=null;ToastManager.getInstance=function(){return assert(ToastManager.instance_)};return{ToastManager:ToastManager}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
var CrSearchFieldBehavior={properties:{label:{type:String,value:""},clearLabel:{type:String,value:""},hasSearchText:{type:Boolean,reflectToAttribute:true,value:false},lastValue_:{type:String,value:""}},getSearchInput:function(){},getValue:function(){return this.getSearchInput().value},setValue:function(value,opt_noEvent){var searchInput=this.getSearchInput();searchInput.value=value;this.onSearchTermInput();this.onValueChanged_(value,!!opt_noEvent)},onSearchTermSearch:function(){this.onValueChanged_(this.getValue(),false)},onSearchTermInput:function(){this.hasSearchText=this.$.searchInput.value!=""},onValueChanged_:function(newValue,noEvent){if(newValue==this.lastValue_)return;this.lastValue_=newValue;if(!noEvent)this.fire("search-changed",newValue)}};Polymer.PaperInkyFocusBehaviorImpl={observers:["_focusedChanged(receivedFocusFromKeyboard)"],_focusedChanged:function(receivedFocusFromKeyboard){if(receivedFocusFromKeyboard){this.ensureRipple()}if(this.hasRipple()){this._ripple.holdDown=receivedFocusFromKeyboard}},_createRipple:function(){var ripple=Polymer.PaperRippleBehavior._createRipple();ripple.id="ink";ripple.setAttribute("center","");ripple.classList.add("circle");return ripple}};Polymer.PaperInkyFocusBehavior=[Polymer.IronButtonState,Polymer.IronControlState,Polymer.PaperRippleBehavior,Polymer.PaperInkyFocusBehaviorImpl];Polymer({is:"paper-icon-button",hostAttributes:{role:"button",tabindex:"0"},behaviors:[Polymer.PaperInkyFocusBehavior],properties:{src:{type:String},icon:{type:String},alt:{type:String,observer:"_altChanged"}},_altChanged:function(newValue,oldValue){var label=this.getAttribute("aria-label");if(!label||oldValue==label){this.setAttribute("aria-label",newValue)}}});Polymer.PaperSpinnerBehavior={properties:{active:{type:Boolean,value:false,reflectToAttribute:true,observer:"__activeChanged"},alt:{type:String,value:"loading",observer:"__altChanged"},__coolingDown:{type:Boolean,value:false}},__computeContainerClasses:function(active,coolingDown){return[active||coolingDown?"active":"",coolingDown?"cooldown":""].join(" ")},__activeChanged:function(active,old){this.__setAriaHidden(!active);this.__coolingDown=!active&&old},__altChanged:function(alt){if(alt==="loading"){this.alt=this.getAttribute("aria-label")||alt}else{this.__setAriaHidden(alt==="");this.setAttribute("aria-label",alt)}},__setAriaHidden:function(hidden){var attr="aria-hidden";if(hidden){this.setAttribute(attr,"true")}else{this.removeAttribute(attr)}},__reset:function(){this.active=false;this.__coolingDown=false}};Polymer({is:"paper-spinner-lite",behaviors:[Polymer.PaperSpinnerBehavior]});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-toolbar-search-field",behaviors:[CrSearchFieldBehavior],properties:{narrow:{type:Boolean,reflectToAttribute:true},showingSearch:{type:Boolean,value:false,notify:true,observer:"showingSearchChanged_",reflectToAttribute:true},label:String,clearLabel:String,spinnerActive:{type:Boolean,reflectToAttribute:true},isSpinnerShown_:{type:Boolean,computed:"computeIsSpinnerShown_(spinnerActive, showingSearch)"},searchFocused_:{type:Boolean,value:false}},listeners:{click:"showSearch_"},getSearchInput:function(){return this.$.searchInput},isSearchFocused:function(){return this.searchFocused_},showAndFocus:function(){this.showingSearch=true;this.focus_()},onSearchTermInput:function(){CrSearchFieldBehavior.onSearchTermInput.call(this);this.showingSearch=this.hasSearchText||this.isSearchFocused()},focus_:function(){this.getSearchInput().focus()},computeIconTabIndex_:function(narrow){return narrow?0:-1},computeIconAriaHidden_:function(narrow){return Boolean(!narrow).toString()},computeIsSpinnerShown_:function(){var showSpinner=this.spinnerActive&&this.showingSearch;if(showSpinner)this.$.spinnerTemplate.if=true;return showSpinner},onInputFocus_:function(){this.searchFocused_=true},onInputBlur_:function(){this.searchFocused_=false;if(!this.hasSearchText)this.showingSearch=false},onSearchTermKeydown_:function(e){if(e.key=="Escape")this.showingSearch=false},showSearch_:function(e){if(e.target!=this.$.clearSearch)this.showingSearch=true},clearSearch_:function(e){this.setValue("");this.focus_()},showingSearchChanged_:function(current,previous){if(previous==undefined)return;if(this.showingSearch){this.focus_();return}this.setValue("");this.getSearchInput().blur()}});Polymer({is:"iron-media-query",properties:{queryMatches:{type:Boolean,value:false,readOnly:true,notify:true},query:{type:String,observer:"queryChanged"},full:{type:Boolean,value:false},_boundMQHandler:{value:function(){return this.queryHandler.bind(this)}},_mq:{value:null}},attached:function(){this.style.display="none";this.queryChanged()},detached:function(){this._remove()},_add:function(){if(this._mq){this._mq.addListener(this._boundMQHandler)}},_remove:function(){if(this._mq){this._mq.removeListener(this._boundMQHandler)}this._mq=null},queryChanged:function(){this._remove();var query=this.query;if(!query){return}if(!this.full&&query[0]!=="("){query="("+query+")"}this._mq=window.matchMedia(query);this._add();this.queryHandler(this._mq)},queryHandler:function(mq){this._setQueryMatches(mq.matches)}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-toolbar",properties:{pageName:String,searchPrompt:String,clearLabel:String,menuLabel:String,menuPromo:String,spinnerActive:Boolean,showMenu:{type:Boolean,value:false},showMenuPromo:{type:Boolean,value:false},showSearch:{type:Boolean,value:true},narrow:{type:Boolean,reflectToAttribute:true,readonly:true,notify:true},narrowThreshold:{type:Number,value:900},closeMenuPromo:String,showingSearch_:{type:Boolean,reflectToAttribute:true}},observers:["possiblyShowMenuPromo_(showMenu, showMenuPromo, showingSearch_)"],getSearchField:function(){return this.$.search},onClosePromoTap_:function(){this.fire("cr-toolbar-menu-promo-close")},onMenuTap_:function(){this.fire("cr-toolbar-menu-tap")},possiblyShowMenuPromo_:function(){Polymer.RenderStatus.afterNextRender(this,function(){if(this.showMenu&&this.showMenuPromo&&!this.showingSearch_){this.$$("#menuPromo").animate({opacity:[0,.9]},{duration:500,fill:"forwards"});this.fire("cr-toolbar-menu-promo-shown")}}.bind(this))},titleIfNotShowMenuPromo_:function(title,showMenuPromo){return showMenuPromo?"":title}});
// Copyright 2017 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"cr-toolbar-selection-overlay",properties:{deleteLabel:String,cancelLabel:String,selectionLabel:String,deleteDisabled:Boolean},get deleteButton(){return this.$.delete},onClearSelectionTap_:function(){this.fire("clear-selected-items")},onDeleteTap_:function(){this.fire("delete-selected-items")}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-toolbar",behaviors:[bookmarks.StoreClient],properties:{sidebarWidth:{type:String,observer:"onSidebarWidthChanged_"},showSelectionOverlay:{type:Boolean,computed:"shouldShowSelectionOverlay_(selectedItems_, globalCanEdit_)",readOnly:true,reflectToAttribute:true},narrow_:{type:Boolean,reflectToAttribute:true},searchTerm_:{type:String,observer:"onSearchTermChanged_"},selectedItems_:Object,globalCanEdit_:Boolean},attached:function(){this.watch("searchTerm_",function(state){return state.search.term});this.watch("selectedItems_",function(state){return state.selection.items});this.watch("globalCanEdit_",function(state){return state.prefs.canEdit});this.updateFromStore()},get searchField(){return this.$$("cr-toolbar").getSearchField()},onMenuButtonOpenTap_:function(e){this.fire("open-command-menu",{targetElement:e.target,source:MenuSource.TOOLBAR})},onDeleteSelectionTap_:function(){const selection=this.selectedItems_;const commandManager=bookmarks.CommandManager.getInstance();assert(commandManager.canExecute(Command.DELETE,selection));commandManager.handle(Command.DELETE,selection)},onClearSelectionTap_:function(){this.dispatch(bookmarks.actions.deselectItems())},onSearchChanged_:function(e){const searchTerm=e.detail;if(searchTerm!=this.searchTerm_)this.dispatch(bookmarks.actions.setSearchTerm(searchTerm))},onSidebarWidthChanged_:function(){this.style.setProperty("--sidebar-width",this.sidebarWidth)},onSearchTermChanged_:function(){this.searchField.setValue(this.searchTerm_||"")},shouldShowSelectionOverlay_:function(){return this.selectedItems_.size>1&&this.globalCanEdit_},canDeleteSelection_:function(){return bookmarks.CommandManager.getInstance().canExecute(Command.DELETE,this.selectedItems_)},getItemsSelectedString_:function(){return loadTimeData.getStringF("itemsSelected",this.selectedItems_.size)}});
// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
Polymer({is:"bookmarks-app",behaviors:[bookmarks.MouseFocusBehavior,bookmarks.StoreClient],properties:{searchTerm_:{type:String,observer:"searchTermChanged_"},folderOpenState_:{type:Object,observer:"folderOpenStateChanged_"},sidebarWidth_:String},boundUpdateSidebarWidth_:null,dndManager_:null,attached:function(){this.watch("searchTerm_",function(state){return state.search.term});this.watch("folderOpenState_",function(state){return state.folderOpenState});chrome.bookmarks.getTree(results=>{const nodeMap=bookmarks.util.normalizeNodes(results[0]);const initialState=bookmarks.util.createEmptyState();initialState.nodes=nodeMap;initialState.selectedFolder=nodeMap[ROOT_NODE_ID].children[0];const folderStateString=window.localStorage[LOCAL_STORAGE_FOLDER_STATE_KEY];initialState.folderOpenState=folderStateString?new Map(JSON.parse(folderStateString)):new Map;bookmarks.Store.getInstance().init(initialState);bookmarks.ApiListener.init();setTimeout(function(){chrome.metricsPrivate.recordTime("BookmarkManager.ResultsRenderedTime",Math.floor(window.performance.now()))})});this.boundUpdateSidebarWidth_=this.updateSidebarWidth_.bind(this);this.initializeSplitter_();this.dndManager_=new bookmarks.DNDManager;this.dndManager_.init()},detached:function(){window.removeEventListener("resize",this.boundUpdateSidebarWidth_);this.dndManager_.destroy();bookmarks.ApiListener.destroy()},initializeSplitter_:function(){const splitter=this.$.splitter;cr.ui.Splitter.decorate(splitter);const splitterTarget=this.$.sidebar;if(LOCAL_STORAGE_TREE_WIDTH_KEY in window.localStorage){splitterTarget.style.width=window.localStorage[LOCAL_STORAGE_TREE_WIDTH_KEY]}this.sidebarWidth_=getComputedStyle(splitterTarget).width;splitter.addEventListener("resize",e=>{window.localStorage[LOCAL_STORAGE_TREE_WIDTH_KEY]=splitterTarget.style.width;this.updateSidebarWidth_()});splitter.addEventListener("dragmove",this.boundUpdateSidebarWidth_);window.addEventListener("resize",this.boundUpdateSidebarWidth_)},updateSidebarWidth_:function(){this.sidebarWidth_=getComputedStyle(this.$.sidebar).width},searchTermChanged_:function(){if(!this.searchTerm_)return;chrome.bookmarks.search(this.searchTerm_,results=>{const ids=results.map(function(node){return node.id});this.dispatch(bookmarks.actions.setSearchResults(ids));this.fire("iron-announce",{text:ids.length>0?loadTimeData.getStringF("searchResults",this.searchTerm_):loadTimeData.getString("noSearchResults")})})},folderOpenStateChanged_:function(){window.localStorage[LOCAL_STORAGE_FOLDER_STATE_KEY]=JSON.stringify(Array.from(this.folderOpenState_))}});